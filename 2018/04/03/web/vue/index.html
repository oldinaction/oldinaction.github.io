<!doctype html><html class="theme-next mist use-motion" lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css"><meta name="keywords" content="vue,"><link rel="alternate" href="/atom.xml" title="月星墙的博客" type="application/atom+xml"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1"><meta name="description" content="简介 参考文章 https://juejin.cn/post/6844903476661583880   vue异常代码开发环境正常报错，编译之后不报错且页面卡死问题。参考: https://github.com/PanJiaChen/vue-element-admin/issues/2212  Vue3 选项式和组合式：选项时为类似Vue2的JSON模式，组合式为类似React的函数式模式(使我"><meta name="keywords" content="vue"><meta property="og:type" content="article"><meta property="og:title" content="Vue"><meta property="og:url" content="http://blog.aezo.cn/2018/04/03/web/vue/index.html"><meta property="og:site_name" content="月星墙的博客"><meta property="og:description" content="简介 参考文章 https://juejin.cn/post/6844903476661583880   vue异常代码开发环境正常报错，编译之后不报错且页面卡死问题。参考: https://github.com/PanJiaChen/vue-element-admin/issues/2212  Vue3 选项式和组合式：选项时为类似Vue2的JSON模式，组合式为类似React的函数式模式(使我"><meta property="og:locale" content="zh-Hans"><meta property="og:image" content="http://blog.aezo.cn/data/images/web/vue-render.png"><meta property="og:image" content="http://blog.aezo.cn/data/images/web/vue-jsx.png"><meta property="og:updated_time" content="2024-10-16T11:55:41.389Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Vue"><meta name="twitter:description" content="简介 参考文章 https://juejin.cn/post/6844903476661583880   vue异常代码开发环境正常报错，编译之后不报错且页面卡死问题。参考: https://github.com/PanJiaChen/vue-element-admin/issues/2212  Vue3 选项式和组合式：选项时为类似Vue2的JSON模式，组合式为类似React的函数式模式(使我"><meta name="twitter:image" content="http://blog.aezo.cn/data/images/web/vue-render.png"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Mist",sidebar:{position:"right",display:"post",offset:12,offset_float:0,b2t:!1,scrollpercent:!1},fancybox:!0,motion:!0,duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"BWD6R9FA4K",apiKey:"3330f3cbaa099dfc30395de5f5b20151",indexName:"blog",hits:{per_page:10},labels:{input_placeholder:"请输入关键字",hits_empty:"我们没有找到任何搜索结果: ${query}",hits_stats:"找到约${hits}条结果（用时${time}ms）"}}}</script><link rel="canonical" href="http://blog.aezo.cn/2018/04/03/web/vue/"><title>Vue | 月星墙的博客</title><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?085f9cd91ef2ad985f791c677472f0d1";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-right page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">月星墙的博客</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">Better Code, Better Life</h1></div><div class="site-nav-toggle"> <button><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br> 首页</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br> 分类</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br> 关于</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br> 归档</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br> 标签</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="menu-item-icon fa fa-fw fa-sitemap"></i><br> 站点地图</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br> 搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i></span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"> <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://blog.aezo.cn/2018/04/03/web/vue/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="smalle"><meta itemprop="description" content=""><meta itemprop="image" content="https://avatars0.githubusercontent.com/u/15698218?v=3&u=ce740bf0b67ff0d74990ba6fc644d6e92f572dcb&s=400"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="月星墙的博客"></span><header class="post-header"><h2 class="post-title" itemprop="name headline">Vue</h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-04-03T17:14:00+08:00">2018-04-03</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/web/" itemprop="url" rel="index"><span itemprop="name">web</span></a></span></span></div></header><div class="post-body" itemprop="articleBody"><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><ul><li>参考文章<ul><li><a href="https://juejin.cn/post/6844903476661583880" target="_blank" rel="noopener">https://juejin.cn/post/6844903476661583880</a></li></ul></li><li>vue异常代码开发环境正常报错，编译之后不报错且页面卡死问题。参考: <a href="https://github.com/PanJiaChen/vue-element-admin/issues/2212" target="_blank" rel="noopener">https://github.com/PanJiaChen/vue-element-admin/issues/2212</a></li></ul><h2 id="Vue3"><a href="#Vue3" class="headerlink" title="Vue3"></a>Vue3</h2><ul><li>选项式和组合式：选项时为类似Vue2的JSON模式，组合式为类似React的函数式模式(使我们可以使用函数而不是声明选项的方式书写 Vue 组件)</li><li>Vue3中没有了<code>$parent</code>和<code>$children</code><ul><li>可通过<code>getCurrentInstance()</code>获取当前组件，<code>findComponentUpward()</code>向上查找父组件，和<code>findComponentsDownward()</code>向下查找子组件。参考：<a href="https://juejin.cn/post/7117808675716071460" target="_blank" rel="noopener">https://juejin.cn/post/7117808675716071460</a></li></ul></li><li>文章<ul><li>Vue3结合JSX<ul><li><a href="https://github.com/vuejs/babel-plugin-jsx" target="_blank" rel="noopener">babel-plugin-jsx</a></li><li>插槽和v-model使用：<a href="https://blog.csdn.net/cookcyq__/article/details/131440253" target="_blank" rel="noopener">https://blog.csdn.net/cookcyq__/article/details/131440253</a></li></ul></li><li><a href="https://zhuanlan.zhihu.com/p/357434039" target="_blank" rel="noopener">Vue2 与 Vue3 如何创建响应式数据</a></li></ul></li></ul><h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><ul><li><a href="https://cn.vuejs.org/guide/components/v-model.html" target="_blank" rel="noopener">v-model</a><ul><li>单个属性建议使用<code>modelValue</code>(固定props值)，此时直接<code>v-model=&quot;data&quot;</code>即可</li><li>多个属性可定时如<code>myModel</code>(取值props.myModel)，此时需使用<code>v-model:myModel=&quot;data&quot;</code>(只有modelValue才能进行省略)</li></ul></li><li><p>watch</p><ul><li><p><a href="https://juejin.cn/post/6980987158710452231" target="_blank" rel="noopener">Vue3中watch的最佳实践</a></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; watch, ref, reactive &#125; <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="comment">// ==&gt; 侦听一个 getter</span></span><br><span class="line"><span class="keyword">const</span> person = reactive(&#123;<span class="attr">name</span>: <span class="string">'小松菜奈'</span>&#125;)</span><br><span class="line">watch(</span><br><span class="line">    () =&gt; person.name, </span><br><span class="line">    (n, o) =&gt; &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(n, o)</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;<span class="attr">immediate</span>:<span class="literal">true</span>&#125;</span><br><span class="line">)</span><br><span class="line">person.name = <span class="string">'有村架纯'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ==&gt; 直接侦听ref，及停止侦听</span></span><br><span class="line"><span class="keyword">const</span> ageRef = ref(<span class="number">16</span>)</span><br><span class="line"><span class="keyword">const</span> stopAgeWatcher = watch(ageRef, (n, o) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(n, o)</span><br><span class="line">    <span class="keyword">if</span> (value &gt; <span class="number">18</span>) &#123;</span><br><span class="line">        stopAgeWatcher() <span class="comment">// 当ageRef大于18，停止侦听</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> changeAge = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    ageRef.value += <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ==&gt; 监听多个数据源</span></span><br><span class="line"><span class="comment">// 如果你在同一个函数里同时改变这些被侦听的来源，侦听器只会执行一次</span></span><br><span class="line"><span class="comment">// 如果用 nextTick 将两次修改隔开，侦听器会执行两次</span></span><br><span class="line"><span class="keyword">const</span> name = ref(<span class="string">'小松菜奈'</span>)</span><br><span class="line"><span class="keyword">const</span> age = ref(<span class="number">25</span>)</span><br><span class="line"></span><br><span class="line">watch([name, age], ([name, age], [prevName, prevAge]) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'newName'</span>, name, <span class="string">'oldName'</span>, prevName)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'newAge'</span>, age, <span class="string">'oldAge'</span>, prevAge)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ==&gt; 侦听引用对象（数组Array或对象Object）</span></span><br><span class="line"><span class="keyword">const</span> arrayRef = ref([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])</span><br><span class="line"><span class="keyword">const</span> objReactive = reactive(&#123;<span class="attr">name</span>: <span class="string">'test'</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ref deep, getter形式，新旧值不一样</span></span><br><span class="line"><span class="keyword">const</span> arrayRefDeepGetterWatch = watch(<span class="function"><span class="params">()</span> =&gt;</span> [...arrayRef.value], (n, o) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(n, o)</span><br><span class="line">&#125;, &#123;<span class="attr">deep</span>: <span class="literal">true</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// reactive，deep，(修改name)新旧值不一样</span></span><br><span class="line"><span class="keyword">const</span> arrayReactiveGetterWatch = watch(<span class="function"><span class="params">()</span> =&gt;</span> objReactive, (n, o) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(n, o)</span><br><span class="line">&#125;, &#123;<span class="attr">deep</span>: <span class="literal">true</span>&#125;)</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure></li></ul></li></ul><h3 id="约定俗成"><a href="#约定俗成" class="headerlink" title="约定俗成"></a>约定俗成</h3><ul><li>习惯<ul><li>项目url固定链接不以<code>/</code>结尾，使用地方手动加<code>/</code>方便全局搜索</li></ul></li><li>注意<ul><li><strong>vue单文件组件，每个文件里面只能含有一个script标签；如果含有多个，默认只解析最后一个</strong></li></ul></li></ul><h3 id="文件引入"><a href="#文件引入" class="headerlink" title="文件引入"></a>文件引入</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- css --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">"less"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="css">    @<span class="keyword">import</span> <span class="string">'../styles/common.less'</span>;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="comment">// (1)引入</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> MyModule1 <span class="keyword">from</span> <span class="string">"./../common/MyModule1.vue"</span>;</span></span><br><span class="line"><span class="javascript"><span class="comment">// @表示项目源码根目录(src)</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> MyModule1 <span class="keyword">from</span> <span class="string">"@/common/MyModule1.vue"</span>;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="comment">// (2) 封装组件库 sm-util.js</span></span></span><br><span class="line"><span class="javascript"><span class="comment">// ==&gt; 示例一</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;&#125; <span class="comment">// 导入：import SmUtil from './libs/sm-util.js'</span></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="comment">// ==&gt; 示例二</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span>; <span class="comment">// 导入其他组件</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">const</span> SmUtil = &#123;&#125;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> SmUtil</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="comment">// ==&gt; 示例三</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">const</span> SmUtil = &#123;&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="vue组件"><a href="#vue组件" class="headerlink" title="vue组件"></a>vue组件</h3><ul><li>文件名建议大写开头驼峰或者小写下划线分割。windows下组件文件名对大小写不敏感，linux下组件文件名对大小写敏感</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> &#123; myUtil &#125; <span class="keyword">from</span> <span class="string">'@/libs/util'</span></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">'component_name'</span>,</span></span><br><span class="line"><span class="undefined">  data () &#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">  &#125;,</span></span><br><span class="line"><span class="undefined">  created () &#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">this</span>.init()</span></span><br><span class="line"><span class="undefined">  &#125;,</span></span><br><span class="line"><span class="undefined">  methods: &#123;</span></span><br><span class="line"><span class="javascript">    myUtil: myUtil, <span class="comment">// 这样才可以在模板中使用：&#123;&#123; myUtil &#125;&#125;</span></span></span><br><span class="line"><span class="undefined">    init () &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">this</span>.fetchData ()</span></span><br><span class="line"><span class="undefined">    &#125;,</span></span><br><span class="line"><span class="undefined">    fetchData () &#123;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">"less"</span> <span class="attr">scoped</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="vue生命周期-含路由"><a href="#vue生命周期-含路由" class="headerlink" title="vue生命周期(含路由)"></a>vue生命周期(含路由)</h3><ul><li>生命周期钩子<ul><li>根组件实例：8个 (beforeCreate、created、beforeMount、mounted、beforeUpdate、updated、beforeDestroy、destroyed)</li><li>组件实例：8个 (beforeCreate、created、beforeMount、mounted、beforeUpdate、updated、beforeDestroy、destroyed)<ul><li>先执行created同步代码, 执行mounted同步代码, 无法控制created中的异步代码执行完后再执行mounted</li></ul></li><li>全局路由钩子：2个 (beforeEach、afterEach)</li><li>组件路由钩子：3个 (beforeRouteEnter、beforeRouteUpdate、beforeRouteLeave)</li><li>指令的周期： 5个 (bind、inserted、update、componentUpdated、unbind)</li><li>beforeRouteEnter的next所对应的周期</li><li>nextTick所对应的周期</li><li><code>&lt;keep-alive&gt;</code> 组件 <code>activated</code> 和 <code>deactivated</code></li></ul></li><li>钩子执行顺序<ul><li>路由勾子 (beforeEach、beforeRouteEnter、afterEach)</li><li>App根组件 (beforeCreate、created、beforeMount)</li><li>父组件-mixins (beforeCreate、created、beforeMount): 父组件 beforeCreate -&gt; mixins beforeCreate -&gt; 父组件 created -&gt; …</li><li>组件 (beforeCreate、created、beforeMount)</li><li>指令 (bind、inserted)</li><li>组件 mounted</li><li>父组件-mixins (mounted)</li><li>App根组件 (mounted)</li><li>beforeRouteEnter的next的回调</li><li>nextTick</li></ul></li><li>销毁顺序<ul><li>mixins (beforeDestroy)</li><li>父组件 (beforeDestroy)</li><li>组件 (beforeDestroy)</li><li>组件 (destroyed)</li><li>mixins (destroyed)</li><li>父组件 (destroyed)</li></ul></li><li>浏览器地址栏刷新/回车/F5<ul><li>所有页面组件重新创建，重头调用<code>beforeCreate</code>；且在某页面刷新时，该页面的<code>beforeDestroy</code>等钩子不会被执行</li></ul></li></ul><h3 id="后端模板中使用VUE"><a href="#后端模板中使用VUE" class="headerlink" title="后端模板中使用VUE"></a>后端模板中使用VUE</h3><ul><li>主页面</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 引入vue.js等通用js --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">#include</span> "<span class="attr">.</span>/<span class="attr">common</span>/<span class="attr">resource.ftl</span>"&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 引入所有需要使用的组件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">#include</span> "<span class="attr">.</span>/<span class="attr">components</span>/<span class="attr">my-widget.ftl</span>"&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="css">        <span class="selector-attr">[v-cloak]</span>&#123;</span></span><br><span class="line"><span class="undefined">            display: none;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 当网络较慢，网页还在加载 Vue.js ，而导致 Vue 来不及渲染，这时页面就会显示出 Vue 源代码。我们可以使用 v-cloak 指令来解决这一问题 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span> <span class="attr">v-cloak</span>&gt;</span></span><br><span class="line">        &#123;&#123;name&#125;&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">my-widget-test</span> <span class="attr">ref</span>=<span class="string">"test"</span>&gt;</span><span class="tag">&lt;/<span class="name">my-widget-test</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>组件页面</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 模板的一部分 my-widget.ftl --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/x-template"</span> <span class="attr">id</span>=<span class="string">"widget"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>content<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    Vue.component(<span class="string">'my-widget-test'</span>, &#123;</span></span><br><span class="line"><span class="javascript">        template: <span class="string">'#widget'</span>,</span></span><br><span class="line"><span class="undefined">        data() &#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> &#123;&#125;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    &#125;)</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="页面渲染"><a href="#页面渲染" class="headerlink" title="页面渲染"></a>页面渲染</h2><h3 id="父子组件加载"><a href="#父子组件加载" class="headerlink" title="父子组件加载"></a>父子组件加载</h3><ul><li>加载顺序：先创建父组件，先挂载子组件<ul><li>创建父组件 <code>beforeCreate</code> - <code>created</code></li><li>挂载父组件之前 <code>beforeMount</code></li><li>创建子组件 <code>beforeCreate</code> - <code>created</code></li><li>挂载子组件之前 <code>beforeMount</code></li><li>挂载子组件 <code>mounted</code></li><li>挂载父组件 <code>mounted</code></li></ul></li><li>父子组件分别请求各自的数据，且子组件请求中的某些参数需要等父组件获取后台数据后才可初始化，此时最好<code>watch</code>对应的参数</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">watch: &#123;</span><br><span class="line">    id(value) &#123;</span><br><span class="line">        <span class="keyword">this</span>.init()</span><br><span class="line">    &#125;,</span><br><span class="line">    $route(to, <span class="keyword">from</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (to.name == <span class="string">"XXX"</span>) &#123;</span><br><span class="line">            <span class="comment">// 监控路由变化，进行数据重新获取</span></span><br><span class="line">            <span class="keyword">this</span>.init()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br><span class="line">method: &#123;</span><br><span class="line">    init() &#123;</span><br><span class="line">        <span class="comment">// ...调用后台</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br><span class="line">created(): &#123;</span><br><span class="line">    <span class="comment">// this.init() // 此处调用则有可能id为空导致只能获取一次数据，且无法获取有有效数据</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="数组-对象改变数据不刷新问题"><a href="#数组-对象改变数据不刷新问题" class="headerlink" title="数组/对象改变数据不刷新问题"></a>数组/对象改变数据不刷新问题</h3><ul><li><p><a href="https://cn.vuejs.org/v2/guide/reactivity.html#%E6%A3%80%E6%B5%8B%E5%8F%98%E5%8C%96%E7%9A%84%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9" target="_blank" rel="noopener">官方说明</a></p><ul><li><strong>由于 JavaScript 的限制，Vue 不能检测以下变动的数组</strong><ul><li>当你利用索引直接设置一个项时，例如：<code>vm.items[indexOfItem] = newValue</code>。如v-for循环想动态给item增加属性，此时只能先定义一个List，动态在方法中设置此List值，并通过JSON进行转换赋值</li><li>当你修改数组的长度时，例如：<code>vm.items.length = newLength</code></li><li><a href="https://cn.vuejs.org/v2/guide/list.html#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9" target="_blank" rel="noopener">下列方法可触发视图更新</a><ul><li>push()、pop()、shift()、unshift()、splice()、sort()、reverse()</li></ul></li></ul></li><li><p><strong>由于 JavaScript 的限制，Vue 不能检测对象属性的添加或删除</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> vm = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    data:&#123;</span><br><span class="line">        a: <span class="number">1</span>,</span><br><span class="line">        user: &#123;</span><br><span class="line">            name: <span class="literal">null</span></span><br><span class="line">        &#125;,</span><br><span class="line">        list: []</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// `vm.a` 是响应的，`vm.b` 是非响应的(添加新属性)</span></span><br><span class="line">vm.b = <span class="number">2</span></span><br><span class="line">vm.user.name = <span class="string">'smalle'</span> <span class="comment">// 是响应的</span></span><br><span class="line">vm.user.password = <span class="string">'123456'</span> <span class="comment">// 是非响应的(添加新属性)</span></span><br><span class="line"></span><br><span class="line">vm.list = [&#123;<span class="attr">name</span>: <span class="string">'hello'</span>&#125;] <span class="comment">// 响应的</span></span><br><span class="line">vm.list[<span class="number">0</span>].name = <span class="string">'smalle'</span> <span class="comment">// 响应的</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 假设有一个按钮需要动态添加loading，可写成&lt;Button :loading="myLoading[i]"&gt;&lt;/Button&gt;，然后created之后对myLoading[i]赋初始值并重新设置myLoading(两次JSON转换)，之后myLoading[i]就可以动态监听了</span></span><br></pre></td></tr></table></figure></li><li><p>Vue.set和Vue.delete的作用</p><ul><li><code>Vue.set</code> 向响应式对象中添加一个 property，并可确保这个新 property 同样是响应式的. eg: Vue.set(this.dictMap, key, list)</li><li><strong>也可使用如<code>this.$set(row, &#39;_editLoading&#39;, true)</code>，常用于表格单行按钮loading效果</strong></li></ul></li><li>Vue3.X新版本开始将采用ES6的Proxy来进行双向绑定。可解决上述问题(可以直接监听对象而非属性，可以直接监听数组下标的变化)</li></ul></li><li><strong>vue无法检测数组的元素变化(包括元素的添加或删除)；可以检测子对象的属性值变化，但是无法检测未在data中定义的属性或子属性的变化</strong><ul><li>解决上述数组和未定义属性不响应的方法：<strong><code>this.user = JSON.parse(JSON.stringify(this.user));</code></strong>(部分场景可使用<code>this.user = Object.assign({}, this.user);</code>)</li><li><strong>对于v-for，最好定义key值(且不能使用index作为key)</strong>，否则容易出现无法选择/无法修改该select的值<ul><li>如结合select的option循环时，只需要当前select的option的key值唯一，无需整个页面的key值保证唯一性</li><li>大多数情况下不建议使用index作为key。当第一条记录被删除后，第二条记录的key的索引号会从1变为0，这样导致oldVNode和newNNode两者的key相同。而key相同时，Virtual DOM diff算法会认为它们是相同的VNode，那么旧的VNode指向的Vue实例(如果VNode是一个组件)会被复用，导致显示出错 <a href="https://asyncoder.com/2018/07/20/%E8%AE%B0%E4%B8%80%E6%AC%A1Vue%E4%B8%AD%E7%9A%84v-for%E8%B8%A9%E5%9D%91%E4%B9%8B%E6%97%85/" target="_blank" rel="noopener">^3</a></li></ul></li></ul></li><li>provide和inject无法实时响应解决办法<ul><li><a href="https://www.jianshu.com/p/2f210939cc4e" target="_blank" rel="noopener">https://www.jianshu.com/p/2f210939cc4e</a></li><li>provide 和 inject 绑定并不是可响应的，这是刻意为之的。然而，如果你传入了一个可监听的对象，那么其对象的属性还是可响应的</li><li><code>provide: {obj, name}</code> name如果是字符串类型(或者通过computed返回的字符串类型)，则无法进行响应传递，可考虑放到obj对象中</li></ul></li><li>扩展说明</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 示例使用iveiw库 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- (1) 产品可以选择多个，选择产品后，产品单位需要联动变化 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-for</span>=<span class="string">"(item, index) in customer.customerProducts"</span>&gt;</span></span><br><span class="line">    产品：<span class="comment">&lt;!-- 此处要通过v-model="customer.customerProducts[index].id"进行绑定，不要使用 item.id --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Select</span> <span class="attr">v-model</span>=<span class="string">"customer.customerProducts[index].id"</span> @<span class="attr">on-change</span>=<span class="string">"productChange(index)"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Option</span> <span class="attr">v-for</span>=<span class="string">"(item, index) in products"</span> <span class="attr">:value</span>=<span class="string">"item.id"</span> <span class="attr">:key</span>=<span class="string">"item.id"</span>&gt;</span>&#123;&#123; item.productName &#125;&#125;<span class="tag">&lt;/<span class="name">Option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Select</span>&gt;</span></span><br><span class="line">    产品单位：&#123;&#123; customer.customerProducts[index].productUnit &#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- (2) 省市级联 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- @on-change="provinceChange" 使用change时，改变customer.province的值无法触发change事件（this.$set也不行） --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Select</span> <span class="attr">v-model</span>=<span class="string">"customer.province"</span> <span class="attr">placeholder</span>=<span class="string">"请选择省份"</span> <span class="attr">clearable</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Option</span> <span class="attr">v-for</span>=<span class="string">"item in provinceList"</span> <span class="attr">:value</span>=<span class="string">"item.value"</span> <span class="attr">:key</span>=<span class="string">"item.value"</span>&gt;</span>&#123;&#123; item.label &#125;&#125;<span class="tag">&lt;/<span class="name">Option</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Select</span> <span class="attr">v-model</span>=<span class="string">"customer.city"</span> <span class="attr">clearable</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Option</span> <span class="attr">v-for</span>=<span class="string">"item in cityList"</span> <span class="attr">:value</span>=<span class="string">"item.value"</span> <span class="attr">:key</span>=<span class="string">"item.value"</span>&gt;</span>&#123;&#123; item.label &#125;&#125;<span class="tag">&lt;/<span class="name">Option</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="undefined">    data() &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="undefined">            customer: &#123;</span></span><br><span class="line"><span class="javascript">                customerProducts: [&#123; <span class="comment">// 客户所有的产品</span></span></span><br><span class="line"><span class="javascript">                    id: <span class="literal">null</span>,</span></span><br><span class="line"><span class="javascript">                    productUnit: <span class="string">''</span>,</span></span><br><span class="line"><span class="undefined">                &#125;],</span></span><br><span class="line"><span class="javascript">                province: <span class="literal">null</span>,</span></span><br><span class="line"><span class="javascript">                city: <span class="literal">null</span>,</span></span><br><span class="line"><span class="undefined">            &#125;,</span></span><br><span class="line"><span class="javascript">            products: [], <span class="comment">// 所有的产品</span></span></span><br><span class="line"><span class="undefined">            provinceList: [],</span></span><br><span class="line"><span class="undefined">            cityList: []</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    &#125;,</span></span><br><span class="line"><span class="undefined">    computed: &#123;</span></span><br><span class="line"><span class="undefined">        province() &#123;</span></span><br><span class="line"><span class="javascript">    　　　　<span class="keyword">return</span> <span class="keyword">this</span>.customer.province</span></span><br><span class="line"><span class="undefined">    　　&#125;</span></span><br><span class="line"><span class="undefined">    &#125;,</span></span><br><span class="line"><span class="undefined">    watch: &#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// 利用computed观测子对象具体属性的变化</span></span></span><br><span class="line"><span class="undefined">        province(newValue, oldValue) &#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">this</span>.provinceChange()</span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="javascript">        <span class="comment">// 监控某个子属性，在部分场景可取代 deep: true 的全监控(效率更高)</span></span></span><br><span class="line"><span class="javascript">        <span class="string">'customer.province.name'</span>: &#123;</span></span><br><span class="line"><span class="undefined">            handler(n, o) &#123;</span></span><br><span class="line"><span class="undefined">            &#125;,</span></span><br><span class="line"><span class="javascript">            immediate: <span class="literal">true</span></span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="javascript">        <span class="comment">// 扩展：观测整个对象的变化</span></span></span><br><span class="line"><span class="undefined">        customer: &#123;</span></span><br><span class="line"><span class="undefined">            handler(newValue, oldValue) &#123;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(newValue)</span></span><br><span class="line"><span class="undefined">            &#125;,</span></span><br><span class="line"><span class="javascript">            deep: <span class="literal">true</span> <span class="comment">// 包括子对象(默认只能监控一个普通值，设置deep则可监控整个对象，否则只能监测到一次对象值改变)</span></span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="undefined">        products: &#123;</span></span><br><span class="line"><span class="javascript">            immediate: <span class="literal">true</span>, <span class="comment">// 代表如果在 wacth 里声明了之后，就会立即先去执行里面的handler方法。(可解决 list 变更后无法watch到变化的问题)</span></span></span><br><span class="line"><span class="undefined">            handler(n, o) &#123;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(n)</span></span><br><span class="line"><span class="undefined">            &#125;,</span></span><br><span class="line"><span class="javascript">            <span class="comment">// deep: true</span></span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    &#125;,</span></span><br><span class="line"><span class="undefined">    methods: &#123;</span></span><br><span class="line"><span class="undefined">        productChange(index) &#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">let</span> vm = <span class="keyword">this</span></span></span><br><span class="line"><span class="javascript">            <span class="keyword">let</span> product = &#123;&#125;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">this</span>.products.some(<span class="function"><span class="keyword">function</span>(<span class="params">item</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="comment">// 函数内部不能使用this拿到vue实例。 item =&gt; &#123;&#125; 中可以通过this拿到</span></span></span><br><span class="line"><span class="javascript">                <span class="keyword">if</span>(item.id == vm.customer.customerProducts[index].id) &#123;</span></span><br><span class="line"><span class="javascript">                    product = <span class="built_in">Object</span>.assign(&#123;&#125;, item) <span class="comment">// 此处一定要重新赋值成一个新对象。product = item 会导致产品单位永远是第一次选中的值</span></span></span><br><span class="line"><span class="javascript">                    <span class="keyword">return</span> <span class="literal">true</span>;</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="undefined">            &#125;)</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">            <span class="comment">// list元素改变需要重新赋值。或者通过 this.customer.customerProducts = JSON.parse(JSON.stringify(this.customer.customerProducts))</span></span></span><br><span class="line"><span class="javascript">            <span class="keyword">this</span>.$set(<span class="keyword">this</span>.customer.customerProducts, index, product); <span class="comment">// 从新设值强行刷新此属性. this.$set(Object/Array, string/number, any)</span></span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="undefined">        provinceChange() &#123;</span></span><br><span class="line"><span class="javascript">            <span class="comment">//</span></span></span><br><span class="line"><span class="javascript">            <span class="comment">// ... 请求后台获取省份下的城市</span></span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    &#125;,</span></span><br><span class="line"><span class="undefined">    mounted() &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">this</span>.customer.province = <span class="number">1000</span>; <span class="comment">// 手动改省份</span></span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="页面渲染优化-性能优化"><a href="#页面渲染优化-性能优化" class="headerlink" title="页面渲染优化(性能优化)"></a>页面渲染优化(性能优化)</h3><ul><li>参考文章 <a href="https://juejin.im/post/5d548b83f265da03ab42471d" title="Vue 项目性能优化 — 实践指南" target="_blank" rel="noopener">^9</a></li><li>vue渲染流程</li></ul><p><img src="/data/images/web/vue-render.png" alt="vue-render"></p><ul><li><a href="https://developers.google.com/web/tools/chrome-devtools/evaluate-performance/" target="_blank" rel="noopener">Chrome Devtool Performance使用</a></li></ul><h4 id="打包优化"><a href="#打包优化" class="headerlink" title="打包优化"></a>打包优化</h4><ul><li><p>采用懒加载 <a href="https://juejin.im/post/6844903584899792909" target="_blank" rel="noopener">^13</a></p><ul><li>将 <code>import Hello from &#39;@/components/Hello&#39;</code> 改成 <code>const Hello = () =&gt; import(&#39;@/components/Hello&#39;)</code>。本质上，它是利用了Promise</li><li><p>如使用动态加载的路由配置方式</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 未使用：打包后代码在一个 chunk-vendors 文件中</span></span><br><span class="line"><span class="keyword">import</span> Hello <span class="keyword">from</span> <span class="string">'@/pages/Hello'</span></span><br><span class="line">&#123;</span><br><span class="line">    path: <span class="string">'hello1'</span>,</span><br><span class="line">    name: <span class="string">'hello1'</span>,</span><br><span class="line">    component: Hello</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用动态加载的路由配置方式：打包后代码被分散到多个 chunk-* 文件中，之后客户端可按需加载</span></span><br><span class="line">&#123;</span><br><span class="line">    path: <span class="string">'hello2'</span>,</span><br><span class="line">    name: <span class="string">'hello2'</span>,</span><br><span class="line">    component: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'@/pages/Hello'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>启用 Gzip 压缩（以下两种方式建议同时进行）</p><ul><li>开启nginx等服务器gzip。参考<a href="/_posts/arch/nginx.md#配置示例">nginx.md#配置示例</a></li><li><p>使用 <a href="https://www.webpackjs.com/plugins/compression-webpack-plugin/" target="_blank" rel="noopener">compression-webpack-plugin</a> 将静态资源提前压缩成 gz 格式，且nginx开启<code>gzip_static on;</code>，就不用在服务器进行压缩。参考<a href="/_posts/arch/nginx.md#配置示例">nginx.md#配置示例</a>。速度比服务器压缩要更快，且传输资源更少</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">npm install compression-webpack-plugin --save-dev</span><br><span class="line"></span><br><span class="line"><span class="comment">// vue-cli为例。开发环境不进行压缩，否则页面无法显示</span></span><br><span class="line">chainWebpack: <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(process.env.NODE_ENV === <span class="string">'production'</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> CompressionPlugin = <span class="built_in">require</span>(<span class="string">'compression-webpack-plugin'</span>);</span><br><span class="line">        config.plugin(<span class="string">'compressionPlugin'</span>)</span><br><span class="line">        .use(<span class="keyword">new</span> CompressionPlugin(&#123;</span><br><span class="line">            algorithm: <span class="string">'gzip'</span>,</span><br><span class="line">            test: <span class="regexp">/\.(js|css|json|txt|html|ico|svg)(\?.*)?$/i</span>,</span><br><span class="line">            threshold: <span class="number">10240</span>,</span><br><span class="line">            minRatio: <span class="number">0.8</span></span><br><span class="line">            <span class="comment">// ,deleteOriginalAssets: true // 是否删除原资源，即只保留 .gz 文件。Electron打包需要保留原资源，否则安装包找不到相应js文件</span></span><br><span class="line">        &#125;));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>将依赖库挂到 CDN 上。可以提高首屏响应速度</p><ul><li>常用CDN服务商<ul><li><a href="https://cdn.bytedance.com/" target="_blank" rel="noopener">字节跳动CDN</a></li><li><a href="https://www.bootcdn.cn/" target="_blank" rel="noopener">bootcdn</a> 2409出现过异常</li><li><a href="http://staticfile.org/" target="_blank" rel="noopener">七牛云</a> 2401出现过异常</li><li><a href="http://jscdn.upai.com/" target="_blank" rel="noopener">又拍云</a></li><li><a href="https://unpkg.com/" target="_blank" rel="noopener">unpkg</a></li><li><a href="https://www.jsdelivr.com/" target="_blank" rel="noopener">jsdelivr</a></li><li><a href="https://cdnjs.net/" target="_blank" rel="noopener">cdnjs</a></li></ul></li><li><p>在 <code>public/index.html</code> 中引入库，部分代码如下</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- built files will be auto injected --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 方式一：引入相应版本的库文件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdn.bootcss.com/vue/2.6.10/vue.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdn.bootcss.com/vue-router/3.0.7/vue-router.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdn.bootcss.com/vuex/3.1.1/vuex.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdn.bootcss.com/axios/0.19.0/axios.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdn.bootcss.com/element-ui/2.10.1/index.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 方式二： --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">%</span> <span class="attr">for</span> (<span class="attr">var</span> <span class="attr">i</span> <span class="attr">in</span> <span class="attr">htmlWebpackPlugin.options.cdn</span> &amp;&amp; <span class="attr">htmlWebpackPlugin.options.cdn.js</span>) &#123; %&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"&lt;%= htmlWebpackPlugin.options.cdn.js[i] %&gt;"</span> <span class="attr">defer</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">%</span> &#125; %&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>配置</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 然后在 webpack(vue-cli为例) 中配置额外依赖(两种方式都需要)</span></span><br><span class="line">configureWebpack: &#123;</span><br><span class="line">    externals: &#123;</span><br><span class="line">        <span class="string">'vue'</span>: <span class="string">'Vue'</span>,</span><br><span class="line">        <span class="string">'vue-router'</span>: <span class="string">'VueRouter'</span>,</span><br><span class="line">        <span class="string">'vuex'</span>: <span class="string">'Vuex'</span>,</span><br><span class="line">        <span class="string">'element-ui'</span>: <span class="string">'elementUI'</span>,</span><br><span class="line">        <span class="string">'axios'</span>: <span class="string">'axios'</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 方式二：注入cdn参数到htmlWebpackPlugin</span></span><br><span class="line">chainWebpack: <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> cdn = &#123;</span><br><span class="line">        js: [<span class="string">'https://cdn.bootcss.com/vue/2.6.10/vue.min.js'</span>]</span><br><span class="line">    &#125;</span><br><span class="line">    cdn = process.env.NODE_ENV === <span class="string">'production'</span> ? cdn : &#123;<span class="attr">css</span>:[],<span class="attr">js</span>:[]&#125;;</span><br><span class="line">    config.plugin(<span class="string">'html'</span>).tap(<span class="function"><span class="params">args</span> =&gt;</span> &#123;</span><br><span class="line">        args[<span class="number">0</span>].cdn = cdn</span><br><span class="line">        <span class="keyword">return</span> args</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除 package.json 的 dependencies 中此插件的依赖</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// vue 页面可正常使用，无需修改</span></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>减少不必要的库依赖</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">// 方式一(不推荐)：手动增加webpack-bundle-analyzer分析插件(vue-cli自带无需安装，参考方式二)</span></span><br><span class="line">  <span class="comment">// 包依赖分析工具</span></span><br><span class="line">  npm install webpack-bundle-analyzer --save-dev</span><br><span class="line">  <span class="comment">// vue-cli为例。执行 npm run build 后会自动打开 http://127.0.0.1:8888/ 显示包依赖信息。**使用完之后可注释此行代码，否则命令行一直不会退出，给人一种没打包完成的错觉**</span></span><br><span class="line">  chainWebpack: <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span>(process.env.NODE_ENV === <span class="string">'production'</span>) &#123;</span><br><span class="line">          <span class="keyword">const</span> BundleAnalyzerPlugin = <span class="built_in">require</span>(<span class="string">'webpack-bundle-analyzer'</span>).BundleAnalyzerPlugin</span><br><span class="line">          config.plugin(<span class="string">'bundleAnalyzerPlugin'</span>).use(<span class="keyword">new</span> BundleAnalyzerPlugin(&#123;&#125;))</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 方式二(推荐)：vue-cli 自带分析插件</span></span><br><span class="line">  <span class="string">"scripts"</span>: &#123;</span><br><span class="line">  	<span class="string">"report"</span>: <span class="string">"vue-cli-service build --report --mode pord"</span></span><br><span class="line">&#125;</span><br><span class="line">  <span class="comment">// 打包之后在dist文件夹里面会生成report.html文件</span></span><br><span class="line">  npm run report</span><br></pre></td></tr></table></figure></li><li><p>去掉 .map 文件：vue-cli设置<code>productionSourceMap: false</code>，参考下文<a href="#vue-cli">vue-cli</a></p></li><li>使用 UglifyJsPlugin 丑化js，去掉debugger/console等信息</li><li>使用<code>cnpm i -save-dev image-webpack-loader</code>对图片进行压缩</li><li><p>测试环境和生产环境出来的包不一致问题</p><ul><li>测试环境 js 文件在 dist 根目录下，且存在很大的 main.js 和 app.js；build 打包之后 js 文件在 dist/js 目录下，main和app也被分割成几个小文件了</li><li><p><code>NODE_ENV</code> 为webpack内置参数，可通过<code>process.env.NODE_ENV</code>获取，当其值是<code>production</code>(固定值)时，会进行压缩混淆等操作。所以测试环境和生产环境打包都应该设置<code>NODE_ENV=production</code>，然后通过<code>.env.test</code>和<code>.env.prod</code>环境变量文件(vue-cli功能)区分不同环境的API地址，如created</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .env.test</span></span><br><span class="line">NODE_ENV = production</span><br><span class="line">VUE_APP_ENV = testenv</span><br><span class="line"></span><br><span class="line"><span class="comment">// .env.prod</span></span><br><span class="line">NODE_ENV = production</span><br><span class="line">VUE_APP_ENV = production</span><br></pre></td></tr></table></figure></li></ul></li><li><p>公共代码抽离</p></li></ul><h4 id="指令等语法优化"><a href="#指令等语法优化" class="headerlink" title="指令等语法优化"></a>指令等语法优化</h4><ul><li><code>v-if</code> &amp; <code>v-show</code> <a href="https://juejin.im/entry/5c30f46be51d4551b508fec0" target="_blank" rel="noopener">^8</a><ul><li>生命周期<ul><li>v-if 控制着绑定元素或者子组件实例 重新挂载（条件为真）/销毁（条件为假） 到DOM上，并且包含其元素绑定的事件监听器，会重新开启监听。</li><li>v-show 控制CSS的切换，元素永远挂载在DOM上</li></ul></li><li>权限问题<ul><li>涉及到权限相关的UI展示无疑用的是v-if</li></ul></li><li>UI操作<ul><li>初始化渲染，如果要加快首屏渲染，建议用v-if</li><li>频次选择，如果是频繁切换使用，建议使用v-show</li></ul></li></ul></li><li><code>v-key</code>使用<ul><li>v-for需要配合v-key使用，且不能使用index作为key</li></ul></li><li>computed 和 watch 区分使用场景<ul><li>需要进行数值计算，并且依赖于其它数据时，应该使用 computed，因为可以利用 computed 的缓存特性，避免每次获取值时，都要重新计算</li><li>需要在数据变化时执行异步或开销较大的操作时，应该使用 watch，使用 watch 选项允许我们执行异步操作(访问一个 API)，限制我们执行该操作的频率</li><li>动态增加Watch和Compute：<a href="https://juejin.cn/post/6911647306659938317" target="_blank" rel="noopener">https://juejin.cn/post/6911647306659938317</a></li><li>在v-for中使用计算属性：<a href="https://qastack.cn/programming/40322404/vuejs-how-can-i-use-computed-property-with-v-for" target="_blank" rel="noopener">https://qastack.cn/programming/40322404/vuejs-how-can-i-use-computed-property-with-v-for</a></li></ul></li></ul><h4 id="Vuex使用及优化"><a href="#Vuex使用及优化" class="headerlink" title="Vuex使用及优化"></a>Vuex使用及优化</h4><ul><li>参考<a href="#Vuex的使用场景">Vuex的使用场景</a><ul><li>扁平化 Store 数据结构</li><li>避免持久化 Store 数据带来的性能问题：对必要数据进行写入；多次写入操作合并为一次</li><li>避免持久化存储的容量持续增长</li></ul></li></ul><h4 id="使用Object-freeze-进行优化"><a href="#使用Object-freeze-进行优化" class="headerlink" title="使用Object.freeze()进行优化"></a>使用Object.freeze()进行优化</h4><ul><li><code>Object.freeze()</code>是ES5新增的特性，可以冻结一个对象，防止对象被修改 <a href="https://juejin.im/post/5d5e89aee51d453bdb1d9b61" target="_blank" rel="noopener">^10</a><ul><li>const定义的对象不能被重新赋值引用，但是对象属性可进行修改</li><li>Object.freeze()定义的对象可以重新赋值引用，但是对象属性不能修改</li></ul></li><li>当把一个普通的 JavaScript 对象传给 Vue 实例的 data 选项，Vue 将遍历此对象所有的属性，并使用 Object.defineProperty 把这些属性全部转为 getter/setter，以便 Vue 追踪依赖，在属性被访问和修改时通知变化，进行页面重新渲染。但 Vue 在遇到像 Object.freeze() 这样被设置为不可配置之后的对象属性时，不会为对象加上 setter getter 等数据劫持的方法</li><li>示例</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    data: &#123;</span><br><span class="line">        list: []</span><br><span class="line">    &#125;,</span><br><span class="line">    mounted () &#123;</span><br><span class="line">        <span class="keyword">this</span>.fetchData()</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">        fetchData () &#123;</span><br><span class="line">            <span class="comment">// vue不会对list里的object做getter、setter绑定</span></span><br><span class="line">            <span class="keyword">this</span>.list = <span class="built_in">Object</span>.freeze([&#123; <span class="attr">value</span>: <span class="number">100</span> &#125;,&#123; <span class="attr">value</span>: <span class="number">200</span> &#125;])</span><br><span class="line">        &#125;,</span><br><span class="line">        changeData () &#123;</span><br><span class="line">            <span class="comment">// 界面不会有响应</span></span><br><span class="line">            <span class="keyword">this</span>.list[<span class="number">0</span>].value = <span class="number">200</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 下面两种做法，界面都会响应</span></span><br><span class="line">            <span class="keyword">this</span>.list = [&#123; <span class="attr">value</span>: <span class="number">200</span> &#125;,&#123; <span class="attr">value</span>: <span class="number">200</span> &#125;]</span><br><span class="line">            <span class="keyword">this</span>.list = <span class="built_in">Object</span>.freeze([&#123; <span class="attr">value</span>: <span class="number">200</span> &#125;,&#123; <span class="attr">value</span>: <span class="number">200</span> &#125;])</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="优化无限列表性能"><a href="#优化无限列表性能" class="headerlink" title="优化无限列表性能"></a>优化无限列表性能</h4><ul><li>如果应用存在非常长或者无限滚动的列表，那么采用窗口化的技术来优化性能，只需要渲染少部分区域的内容，减少重新渲染组件和创建 dom 节点的时间</li><li>开源工具如：<a href="https://github.com/Akryum/vue-virtual-scroller" target="_blank" rel="noopener">vue-virtual-scroller</a> 和 <a href="https://github.com/tangbc/vue-virtual-scroll-list" target="_blank" rel="noopener">vue-virtual-scroll-list</a></li></ul><h4 id="图片资源懒加载"><a href="#图片资源懒加载" class="headerlink" title="图片资源懒加载"></a>图片资源懒加载</h4><ul><li><a href="https://github.com/hilongjw/vue-lazyload" target="_blank" rel="noopener">vue-lazyload</a> 插件使用</li></ul><h4 id="组件懒加载"><a href="#组件懒加载" class="headerlink" title="组件懒加载"></a>组件懒加载</h4><ul><li>使用组件懒加载在不可见时只需要渲染一个骨架屏，不需要渲染一些隐藏组件</li><li><a href="https://github.com/xunleif2e/vue-lazy-component" target="_blank" rel="noopener">插件vue-lazy-component</a></li></ul><h4 id="第三方插件的按需引入"><a href="#第三方插件的按需引入" class="headerlink" title="第三方插件的按需引入"></a>第三方插件的按需引入</h4><ul><li>基于babel-plugin-component插件</li></ul><h4 id="服务端渲染-预渲染"><a href="#服务端渲染-预渲染" class="headerlink" title="服务端渲染/预渲染"></a>服务端渲染/预渲染</h4><ul><li><a href="https://ssr.vuejs.org/zh/" target="_blank" rel="noopener">服务端渲染</a></li><li><a href="https://github.com/chrisvfritz/prerender-spa-plugin" target="_blank" rel="noopener">预渲染插件prerender-spa-plugin</a></li></ul><h2 id="组件"><a href="#组件" class="headerlink" title="组件"></a>组件</h2><ul><li><a href="http://www.yanfadi.com/vue/#%E5%8D%81-%E7%BB%84%E4%BB%B6%E5%8E%9F%E7%90%86" target="_blank" rel="noopener">组件原理</a></li></ul><h3 id="v-model使用"><a href="#v-model使用" class="headerlink" title="v-model使用"></a>v-model使用</h3><ul><li><a href="https://cn.vuejs.org/v2/guide/components-custom-events.html#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%84%E4%BB%B6%E7%9A%84-v-model" target="_blank" rel="noopener">官方说明</a></li><li>双向数据绑定主要需要解决表单元素值改变后对应的变量值同时变化(变量值变化表单元素的值变化是肯定的)</li><li>在原生表单元素中 <code>&lt;input v-model=&quot;inputValue&quot;&gt;</code> 相当于 <code>&lt;input v-bind:value=&quot;inputValue&quot; v-on:input=&quot;inputValue = $event.target.value&quot;&gt;</code></li><li>简单弹框案例</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">	<span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">		props: &#123;</span><br><span class="line">			value: &#123;</span><br><span class="line">				type: <span class="built_in">Boolean</span>,</span><br><span class="line">				<span class="keyword">default</span>: <span class="literal">false</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		data() &#123;</span><br><span class="line">			<span class="keyword">return</span> &#123;</span><br><span class="line">				show: <span class="keyword">this</span>.value</span><br><span class="line">			&#125;;</span><br><span class="line">		&#125;,</span><br><span class="line">		watch: &#123;</span><br><span class="line">			value (n, o) &#123;</span><br><span class="line">				<span class="keyword">this</span>.show = <span class="keyword">this</span>.value</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		methods: &#123;</span><br><span class="line">			open() &#123;</span><br><span class="line">				<span class="keyword">this</span>.show = <span class="literal">true</span>;</span><br><span class="line">				<span class="keyword">this</span>.$emit(<span class="string">'input'</span>, <span class="keyword">this</span>.show)</span><br><span class="line">			&#125;,</span><br><span class="line">			close() &#123;</span><br><span class="line">				<span class="keyword">this</span>.show = <span class="literal">false</span>;</span><br><span class="line">				<span class="keyword">this</span>.$emit(<span class="string">'input'</span>, <span class="keyword">this</span>.show)</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><ul><li>扩展案例说明</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 示例一 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="comment">// 本质是表单元素原生事件，并将值放入其中。$emit('change', 'smalle')</span></span></span><br><span class="line"><span class="javascript">Vue.component(<span class="string">'base-checkbox'</span>, &#123;</span></span><br><span class="line"><span class="javascript">    <span class="comment">// model: 允许一个自定义组件在使用 v-model 时定制 prop(组件会将v-model和此prop绑定，调用者将值传到v-model中，最终相当于传入到了此prop上) 和 event</span></span></span><br><span class="line"><span class="undefined">    model: &#123;</span></span><br><span class="line"><span class="javascript">        prop: <span class="string">'checked'</span>, <span class="comment">// props中的key。默认取pops中的value</span></span></span><br><span class="line"><span class="javascript">        event: <span class="string">'change'</span> <span class="comment">// 默认为input事件</span></span></span><br><span class="line"><span class="undefined">    &#125;,</span></span><br><span class="line"><span class="undefined">    props: &#123;</span></span><br><span class="line"><span class="javascript">        checked: <span class="built_in">Boolean</span></span></span><br><span class="line"><span class="undefined">    &#125;,</span></span><br><span class="line"><span class="undefined">    template: `</span></span><br><span class="line"><span class="undefined">        &lt;input</span></span><br><span class="line"><span class="javascript">            type=<span class="string">"checkbox"</span></span></span><br><span class="line"><span class="javascript">            v-bind:checked=<span class="string">"checked"</span></span></span><br><span class="line"><span class="javascript">            v-on:change=<span class="string">"$emit('change', $event.target.checked)"</span></span></span><br><span class="line"><span class="undefined">        &gt;</span></span><br><span class="line"><span class="undefined">        `</span></span><br><span class="line"><span class="undefined">&#125;)</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 调用组件：相当于将 lovingVue 的值和 model.prop =&gt; props.checked 进行绑定 (此时调用此组件则不需要传checked这个参数) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">base-checkbox</span> <span class="attr">v-model</span>=<span class="string">"lovingVue"</span>&gt;</span><span class="tag">&lt;/<span class="name">base-checkbox</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 实例二：基于element-ui组装一个v-model --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- MyEleSelect.vue --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 此处不能直接使用v-model="value"，因为当element的el-select发生改变时则会修改v-model="value"中value的属性，违背了子组件不建议修改porps参数的值(v-model的$emit修改除外) --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-select</span> <span class="attr">v-model</span>=<span class="string">"model"</span> <span class="attr">multiple</span> <span class="attr">:remote-method</span>=<span class="string">"findList"</span> @<span class="attr">change</span>=<span class="string">"change"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-option</span> <span class="attr">v-for</span>=<span class="string">"(item, index) in list"</span> <span class="attr">:key</span>=<span class="string">"index"</span> <span class="attr">:label</span>=<span class="string">"name"</span> <span class="attr">:value</span>=<span class="string">"item"</span>&gt;</span><span class="tag">&lt;/<span class="name">el-option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">        name: <span class="string">'MyEleSelect'</span>,</span></span><br><span class="line"><span class="undefined">        model: &#123;</span></span><br><span class="line"><span class="javascript">            event: <span class="string">'change'</span> <span class="comment">// ***只能代表本组件中的事件，默认是input***</span></span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="undefined">        props: &#123;</span></span><br><span class="line"><span class="javascript">            <span class="comment">// ***取得是 v-model="myValue" 中 myValue 的值***</span></span></span><br><span class="line"><span class="undefined">            value: &#123;</span></span><br><span class="line"><span class="javascript">                type: <span class="built_in">Array</span>,</span></span><br><span class="line"><span class="javascript">                <span class="keyword">default</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">return</span> []</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="undefined">            &#125;,</span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="undefined">        data() &#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="undefined">                list: [],</span></span><br><span class="line"><span class="javascript">                model: <span class="keyword">this</span>.value <span class="comment">// v-model="model" 保证了此组件(MyEleSelect)与&lt;el-select&gt;组件的数据绑定</span></span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="undefined">        computed: &#123;</span></span><br><span class="line"><span class="javascript">            <span class="comment">// model() &#123;return this.value&#125; // computed属性一般没有setter方法，不建议使用</span></span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="undefined">        watch: &#123;</span></span><br><span class="line"><span class="undefined">            value(n, o) &#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">if</span> (n !== o) <span class="keyword">this</span>.model = <span class="keyword">this</span>.value <span class="comment">// 此处保证了父组件(调用MyEleSelect的组件)可以将最近的值更新到model中(从而传递到&lt;el-select&gt;中)</span></span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="undefined">        methods: &#123;</span></span><br><span class="line"><span class="undefined">            findList(query) &#123;</span></span><br><span class="line"><span class="javascript">                <span class="comment">// this.list = ...</span></span></span><br><span class="line"><span class="undefined">            &#125;,</span></span><br><span class="line"><span class="undefined">            change() &#123;</span></span><br><span class="line"><span class="javascript">                <span class="comment">// 此处保证了子组件发送的数据会被父组件的v-model="myValue"接受，再被value="myValue"传回</span></span></span><br><span class="line"><span class="javascript">                <span class="comment">// 如果上面没有定义model.event="change"，则此处的事件必须是'input' (this.$emit('input', this.model))，this.model可为实际值</span></span></span><br><span class="line"><span class="javascript">                <span class="comment">// el-select中也有change事件，但是该事件传回的值只能到此组件的v-model中，无法再往外面传输，因此此处必须触发新的事件(本组件中定义的事件)</span></span></span><br><span class="line"><span class="javascript">                <span class="comment">// *** 自定义组件中也可以不用有类似的input表单元素，自定义一个model字段名，并指定其model.event，并在此处emit即可修改model ***</span></span></span><br><span class="line"><span class="javascript">                <span class="keyword">this</span>.$emit(<span class="string">'change'</span>, <span class="keyword">this</span>.model) <span class="comment">// 不能直接修改this.value的值，需要通过修改此处的model属性然后传递到外部组件</span></span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="undefined">    &#125;;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 调用 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">MyEleSelect</span> <span class="attr">v-model</span>=<span class="string">"myValue"</span>/&gt;</span></span><br></pre></td></tr></table></figure><h3 id="父子组件通信"><a href="#父子组件通信" class="headerlink" title="父子组件通信"></a>父子组件通信</h3><blockquote><p><a href="https://cn.vuejs.org/v2/guide/components.html#Prop" target="_blank" rel="noopener">Prop</a>、<a href="">自定义事件</a><a href="https://cn.vuejs.org/v2/guide/components.html#%E8%87%AA%E5%AE%9A%E4%B9%89%E4%BA%8B%E4%BB%B6" target="_blank" rel="noopener">https://cn.vuejs.org/v2/guide/components.html#%E8%87%AA%E5%AE%9A%E4%B9%89%E4%BA%8B%E4%BB%B6</a></p></blockquote><h4 id="通信方式"><a href="#通信方式" class="headerlink" title="通信方式"></a>通信方式</h4><ul><li>通过<code>props</code>从父向子组件传递数据，父组件对应属性改变，子组件也会改变。<strong>子组件中不建议修改<code>props</code>中的属性</strong><ul><li>在Vue2中组件的props的数据流动改为了只能单向流动，即只能由组件外（调用组件方）通过组件的DOM属性attribute传递props给组件内，组件内只能被动接收组件外传递过来的数据，并且在组件内，不能修改由外层传来的props数据</li><li>如果在子组件中修改定义的<code>props</code>参数，则会报错：<code>vue.esm.js:591 [Vue warn]: Avoid mutating a prop directly since the value will be overwritten whenever the parent component re-renders. Instead, use a data or computed property based on the prop&#39;s value. Prop being mutated: &quot;customerId&quot;</code></li></ul></li><li>自定义事件<code>$emit</code>，子组件可以向父组件传递数据(参考以下示例)</li><li><strong>通过<code>$refs</code>属性，父组件可直接取得、修改、调用子组件的数据</strong><ul><li>场景还原：父组件点击按钮，控制显示子组件的弹框(<code>iview</code>弹框)，此时当<code>iview</code>弹框关闭时会修改<code>v-model</code>的值，如果用<code>props</code>则违反了<code>props</code>单向数据流的原则</li><li><code>ref</code>可以用于标记一个普通元素或组件</li><li><code>$refs</code>只有<code>mounted</code>了之后才能获取到数据</li></ul></li><li>在子组件中可以通过<code>$parent</code>调用父组件属性和方法，<strong>修改父组件的属性也不会报错</strong>。注意：像被iview的TabPane包裹的组件，其父组件就是TabPane</li><li>在父组件中使用<code>sync</code>修饰符修饰props属性，则实现了父子组件中hello的双向绑定，但是违反了单项数据流，只适合特定业务场景</li><li><strong>全量绑定props参数(v-bind/v-on)</strong></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">    1.假设子组件接受参数：name, age, sex; dataBind/eventBind中指定的优先级高于dom上指定的属性</span></span><br><span class="line"><span class="comment">    2.此时v-bind和:name同时传参，此时会优先:name，除非:name的值为null，才会读取v-bind</span></span><br><span class="line"><span class="comment">    3.v-on="eventBind"表示使用对象来处理所有事件</span></span><br><span class="line"><span class="comment">    4.v-bind="$listeners" 是上述的一个特例，表示监听child-component的事件，并将其$emit到外部，即透传child-component的事件到父组件</span></span><br><span class="line"><span class="comment">    5.此时v-on和@test同时监听事件，都会生效(貌似会先触发@test)；可考虑创建一个新的对象如eventBindNew这样就只会触发一次test事件</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 两个v-on仅做演示 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">child-component</span> <span class="attr">:name</span>=<span class="string">"smalle2"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">v-bind</span>=<span class="string">"dataBind"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">v-on</span>=<span class="string">"eventBind"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">v-on</span>=<span class="string">"$listeners"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">v-on</span>=<span class="string">"eventBindNew"</span></span></span><br><span class="line"><span class="tag">        @<span class="attr">test</span>=<span class="string">"myTest"</span></span></span><br><span class="line"><span class="tag">    &gt;</span><span class="tag">&lt;/<span class="name">child-component</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 重新包装el-pagination成组件，在使用此组件时将参数全部绑定到el-pagination中 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-pagination</span></span></span><br><span class="line"><span class="tag">        <span class="attr">v-bind</span>=<span class="string">"$attrs"</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="comment">// 此时子组件参数全部使用默认值</span></span></span><br><span class="line"><span class="javascript">dataBind = <span class="literal">null</span>;</span></span><br><span class="line"><span class="javascript"><span class="comment">// 指定部分参数</span></span></span><br><span class="line"><span class="undefined">dataBind = &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">'smalle'</span>,</span></span><br><span class="line"><span class="javascript">    <span class="comment">// age: 18, // 不传递age则使用默认值</span></span></span><br><span class="line"><span class="javascript">    sex: <span class="literal">true</span>,</span></span><br><span class="line"><span class="javascript">    xxx: <span class="string">'不接受此参数，传递也不报错'</span></span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="javascript"><span class="comment">// 或者通过 $props 将父组件的 props 一起传给子组件</span></span></span><br><span class="line"><span class="javascript">dataBind = <span class="keyword">this</span>.$props;</span></span><br><span class="line"><span class="undefined">eventBind = &#123;</span></span><br><span class="line"><span class="javascript">    test: <span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="javascript"><span class="comment">// </span></span></span><br><span class="line"><span class="undefined">computed: &#123;</span></span><br><span class="line"><span class="undefined">    eventBindNew() &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> event = &#123;</span></span><br><span class="line"><span class="undefined">            ...this.$listeners</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">delete</span> event[<span class="string">'test'</span>]</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> event</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="props定义说明"><a href="#props定义说明" class="headerlink" title="props定义说明"></a>props定义说明</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">props: [<span class="string">'count'</span>, <span class="string">'name'</span>]</span><br><span class="line"></span><br><span class="line">props: &#123;</span><br><span class="line">    obj: [<span class="built_in">Array</span>, <span class="built_in">Object</span>],</span><br><span class="line">    list: &#123;</span><br><span class="line">        type: <span class="built_in">Array</span>,</span><br><span class="line">        <span class="comment">// Props with type Object/Array must use a factory function to return the default value.</span></span><br><span class="line">        <span class="keyword">default</span>: <span class="function"><span class="params">()</span> =&gt;</span> [] <span class="comment">// 或者 default: () =&gt; &#123;&#125;</span></span><br><span class="line">        <span class="comment">// default: function() &#123;</span></span><br><span class="line">        <span class="comment">//     return [];</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    age: &#123;</span><br><span class="line">        type: <span class="built_in">Number</span>,</span><br><span class="line">        <span class="keyword">default</span>: <span class="number">18</span>,</span><br><span class="line">        validator (value) &#123;</span><br><span class="line">            <span class="keyword">return</span> value &gt; <span class="number">0</span> &amp;&amp; value &lt; <span class="number">150</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    myFunc: &#123;</span><br><span class="line">        type: <span class="built_in">Function</span>, <span class="comment">// default省略亦可</span></span><br><span class="line">        <span class="comment">/*如果是Object/Function/Array，default需要通过函数表示*/</span></span><br><span class="line">        <span class="comment">// default() &#123;&#125; // 亦可</span></span><br><span class="line">        <span class="keyword">default</span>: <span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- parent.vue --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">v-on:click</span>=<span class="string">"clickParent"</span>&gt;</span>点击<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Child</span> <span class="attr">ref</span>=<span class="string">"child"</span> <span class="attr">msg</span>=<span class="string">"hello child"</span> @<span class="attr">my-event</span>=<span class="string">"myEvent"</span>&gt;</span><span class="tag">&lt;/<span class="name">Child</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--使用sync修饰符，则实现了父子组件中hello的双向绑定，但是违反了单项数据流，只适合特定业务场景--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Child</span> <span class="attr">ref</span>=<span class="string">"child"</span> <span class="attr">:show.sync</span>=<span class="string">"show"</span> @<span class="attr">my-event</span>=<span class="string">"myEvent"</span>&gt;</span><span class="tag">&lt;/<span class="name">Child</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">import</span> Child <span class="keyword">from</span> <span class="string">'./child'</span>;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">        name: <span class="string">"parent"</span>,</span></span><br><span class="line"><span class="undefined">        components: &#123;</span></span><br><span class="line"><span class="undefined">            Child</span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="undefined">        data() &#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">                hello: <span class="string">''</span>,</span></span><br><span class="line"><span class="javascript">                show: <span class="literal">false</span></span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="undefined">        methods: &#123;</span></span><br><span class="line"><span class="undefined">            clickParent() &#123;</span></span><br><span class="line"><span class="javascript">                <span class="comment">// this.$refs.child.$emit('click-child', "high");</span></span></span><br><span class="line"><span class="javascript">                <span class="keyword">this</span>.$refs.child.childMethod(<span class="string">"hello"</span>); <span class="comment">// 父组件调用子组件方法</span></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">                <span class="comment">// 不能写成 @click="this.$refs.child.show = true"，此时this不是vue。</span></span></span><br><span class="line"><span class="javascript">                <span class="comment">// 但是可以写成 @click="() =&gt; &#123;this.$refs.child.show = true&#125;"</span></span></span><br><span class="line"><span class="javascript">                <span class="keyword">this</span>.$refs.child.show = <span class="literal">true</span>;</span></span><br><span class="line"><span class="undefined">            &#125;,</span></span><br><span class="line"><span class="undefined">            myEvent(params) &#123;</span></span><br><span class="line"><span class="javascript">                <span class="comment">// 捕获事件</span></span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(params)</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- child.vue --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Modal</span> <span class="attr">v-model</span>=<span class="string">"showView"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span>$&#123;msg&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">"triggerMyEvent('msg')"</span>&gt;</span>触发子组件事件<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Modal</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">        name: <span class="string">"child"</span>,</span></span><br><span class="line"><span class="javascript">        <span class="comment">// 组件定义好组件属性名称</span></span></span><br><span class="line"><span class="javascript">        props: [<span class="string">"count"</span>, <span class="string">"msg"</span>, <span class="string">"show"</span>],</span></span><br><span class="line"><span class="undefined">        data: () &#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">                showView: <span class="literal">false</span></span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="undefined">        watch: &#123;</span></span><br><span class="line"><span class="undefined">            show (val) &#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">this</span>.showView = val</span></span><br><span class="line"><span class="undefined">            &#125;,</span></span><br><span class="line"><span class="undefined">            showView (val) &#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">if</span> (<span class="keyword">this</span>.show != val) &#123;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">this</span>.$emit(<span class="string">'update:show'</span>, val) <span class="comment">// 必须触发 update:xxx 才能实现子组件中修改props(双向绑定), 必须使用.sync修饰的属性</span></span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">if</span> (val) &#123;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">this</span>.childMethod()</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="undefined">        methods: &#123;</span></span><br><span class="line"><span class="undefined">            childMethod(e) &#123;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.info(e)</span></span><br><span class="line"><span class="undefined">            &#125;,</span></span><br><span class="line"><span class="undefined">            triggerMyEvent(name) &#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">this</span>.$emit(<span class="string">"my-event"</span>, <span class="keyword">this</span>.data); <span class="comment">// 参数一为事件名称(不要使用驼峰命名)、参数二负载</span></span></span><br><span class="line"><span class="javascript">                <span class="keyword">this</span>.$emit(<span class="string">`update:<span class="subst">$&#123;name&#125;</span>`</span>, <span class="keyword">this</span>.data) <span class="comment">// 事件名称包含变量</span></span></span><br><span class="line"><span class="javascript">                <span class="keyword">this</span>.$emit(<span class="string">'input'</span>, &#123;&#125;, &#123;&#125;) <span class="comment">// 此处可以传递多个参数，并可用多参方法捕获</span></span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="子组件和子组件通信-Bus"><a href="#子组件和子组件通信-Bus" class="headerlink" title="子组件和子组件通信(Bus)"></a>子组件和子组件通信(Bus)</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在初始化web app的时候，main.js给data添加一个 名字为eventBus的空vue对象。就可以使用 this.$root.eventBus 获取对象</span></span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">'#app'</span>,</span><br><span class="line">    router,</span><br><span class="line">    render: <span class="function"><span class="params">h</span> =&gt;</span> h(App),</span><br><span class="line">    data: &#123;</span><br><span class="line">        eventBus: <span class="keyword">new</span> Vue()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在一个组件内调用事件触发。通过this.$root.eventBus获取此对象，调用 $emit 方法</span></span><br><span class="line"><span class="keyword">this</span>.$root.eventBus.$emit(<span class="string">'eventName'</span>, data)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在另一个组件调用事件接受(如created)，移除事件监听器使用$off方法(如destroyed)</span></span><br><span class="line"><span class="keyword">this</span>.$root.eventBus.$on(<span class="string">'eventName'</span>, (data) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 处理数据</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">this</span>.$root.eventBus.$off(<span class="string">'eventName'</span>)</span><br></pre></td></tr></table></figure><h3 id="slot插槽"><a href="#slot插槽" class="headerlink" title="slot插槽"></a>slot插槽</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- (定义slot)组件comp.vue --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">"$slots.content"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- name为插槽名称，如果只有一个可省略(即为默认插槽)；v-bind:item="item"将item传递到子组件(此处两个item必须一致) --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">"content"</span> <span class="attr">v-bind:item</span>=<span class="string">"item"</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-else</span>&gt;</span>默认内容<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- (使用slot)组件调用者 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">comp</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--插槽实际内容</span></span><br><span class="line"><span class="comment">        1.content为上述插槽名称，如果组件只有一个默认插槽，则此处可将:content换成:default或省略；v2.6开始，具名插槽可缩写为 &lt;template #content="&#123; item &#125;"&gt;</span></span><br><span class="line"><span class="comment">        2.使用了解构获取item；还可使用v-slot:content="props"获取作用域，并通过props.item获取值&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- v2.6后：带上指令名，或者缩写成#content，如果是默认的则为#default；需要使用template来渲染 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- &lt;template v-slot:content="&#123; item &#125;"&gt; --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">template</span> #<span class="attr">content</span>=<span class="string">"&#123; item &#125;"</span>&gt;</span></span><br><span class="line">        &#123;&#123; item &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- v2.6之前(兼容) --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- &lt;template slot="content" slot-scope="slotProps"&gt; --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">slot</span>=<span class="string">"content"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">comp</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="动态组件-异步组件"><a href="#动态组件-异步组件" class="headerlink" title="动态组件/异步组件"></a>动态组件/异步组件</h3><ul><li>基本说明 <a href="https://www.cnblogs.com/-ding/p/6339740.html" title="动态组件" target="_blank" rel="noopener">^1</a><ul><li><code>v-bind:is=&quot;组件名&quot;</code>：就是几个组件放在一个挂载点下，然后根据父组件的某个变量来决定显示哪个，或者都不显示</li><li><code>keep-alive</code>：默认被切换掉（非当前显示）的组件，是直接被移除了。假如需要子组件在切换后，依然需要他保留在内存中，避免下次出现的时候重新渲染，那么就应该在component标签中添加<code>keep-alive</code>属性</li><li><code>activate</code>：钩子，延迟加载</li><li><code>transition-mode</code>过渡模式</li></ul></li><li>动态加载外部组件<ul><li><a href="#开发组件库">组件库中使用动态组件 - 参考下文开发组件库</a></li><li><a href="https://blog.csdn.net/cbaili/article/details/122726149" target="_blank" rel="noopener">httpVueLoader - 从URL加载vue文件</a></li><li><a href="https://github.com/merfais/vue-demo/blob/main/doc" target="_blank" rel="noopener">运行时渲染 - 可以做组件在线编辑器</a></li><li><a href="https://juejin.cn/post/6992483283187531789" target="_blank" rel="noopener">动态组件 - 广告弹框案例</a></li></ul></li><li>简单案例</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">"toshow"</span>&gt;</span>点击让子组件显示<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">component</span> <span class="attr">v-bind:is</span>=<span class="string">"which_to_show"</span> <span class="attr">keep-alive</span>&gt;</span><span class="tag">&lt;/<span class="name">component</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">MyComp</span> <span class="attr">ref</span>=<span class="string">"comp"</span> <span class="attr">v-if</span>=<span class="string">"show"</span>&gt;</span><span class="tag">&lt;/<span class="name">MyComp</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Tinymce</span> <span class="attr">v-model</span>=<span class="string">"fieldModel"</span>&gt;</span><span class="tag">&lt;/<span class="name">Tinymce</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">import</span> &#123; LoadAssets &#125; <span class="keyword">from</span> <span class="string">'@sqbiz/sqbiz-vue'</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">import</span> &#123; NPM_CDN_URL, MODULE_VERSION &#125; <span class="keyword">from</span> <span class="string">'@/utils/config'</span></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> vm = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">        el: <span class="string">'#app'</span>,</span></span><br><span class="line"><span class="undefined">        components: &#123;</span></span><br><span class="line"><span class="javascript">            first: &#123; <span class="comment">//第一个子组件</span></span></span><br><span class="line"><span class="xml">                template: "<span class="tag">&lt;<span class="name">div</span>&gt;</span>这里是子组件1<span class="tag">&lt;/<span class="name">div</span>&gt;</span>"</span></span><br><span class="line"><span class="undefined">            &#125;,</span></span><br><span class="line"><span class="javascript">            second: &#123; <span class="comment">//第二个子组件</span></span></span><br><span class="line"><span class="xml">                template: "<span class="tag">&lt;<span class="name">div</span>&gt;</span>这里是子组件2<span class="tag">&lt;/<span class="name">div</span>&gt;</span>"</span></span><br><span class="line"><span class="undefined">            &#125;,</span></span><br><span class="line"><span class="javascript">            third: &#123; <span class="comment">//第三个子组件</span></span></span><br><span class="line"><span class="xml">                template: "<span class="tag">&lt;<span class="name">div</span>&gt;</span>这里是子组件3<span class="tag">&lt;/<span class="name">div</span>&gt;</span>"</span></span><br><span class="line"><span class="undefined">            &#125;,</span></span><br><span class="line"><span class="javascript">            <span class="comment">// 异步导入组件，router中一般使用此方式导入</span></span></span><br><span class="line"><span class="javascript">            <span class="comment">// 假设 MainComp 和 MyComp 相互依赖，则其中一个需要是异步组件</span></span></span><br><span class="line"><span class="javascript">            MyComp: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./MyComp.vue'</span>).then(<span class="function"><span class="params">comp</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">                <span class="comment">// comp.default为当前组件，this此时为undefined\</span></span></span><br><span class="line"><span class="javascript">                <span class="comment">// 如果需要监听异步组件的挂载事件，可通过在异步组件内部emit事件出来，主组件进行监听</span></span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(comp, <span class="keyword">this</span>)</span></span><br><span class="line"><span class="undefined">            &#125;),</span></span><br><span class="line"><span class="javascript">            <span class="comment">// 异步基于CDN加载组件. NPM_CDN_URL=https://npm.elemecdn.com MODULE_VERSION=1.0.2-biz-minions</span></span></span><br><span class="line"><span class="javascript">            Tinymce: <span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="undefined">                LoadAssets.loadScript(</span></span><br><span class="line"><span class="javascript">                    <span class="string">`<span class="subst">$&#123;NPM_CDN_URL&#125;</span>/@sqbiz/wplugin-tinymce-vue@<span class="subst">$&#123;MODULE_VERSION[<span class="string">'@sqbiz/wplugin-tinymce-vue'</span>]&#125;</span>/lib/WpluginTinymceVue.umd.min.js`</span>,</span></span><br><span class="line"><span class="javascript">                    <span class="string">'WpluginTinymceVue'</span></span></span><br><span class="line"><span class="javascript">                ).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">                    resolve(<span class="built_in">window</span>.WpluginTinymceVue)</span></span><br><span class="line"><span class="undefined">                &#125;)</span></span><br><span class="line"><span class="undefined">            &#125;,</span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="undefined">        data: &#123;</span></span><br><span class="line"><span class="javascript">            which_to_show: <span class="string">"first"</span>,</span></span><br><span class="line"><span class="javascript">            show: <span class="literal">false</span></span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="undefined">        created() &#123;</span></span><br><span class="line"><span class="javascript">            LoadAssets.loadCss(<span class="string">`<span class="subst">$&#123;NPM_CDN_URL&#125;</span>/@sqbiz/wplugin-tinymce-vue@<span class="subst">$&#123;MODULE_VERSION[<span class="string">'@sqbiz/wplugin-tinymce-vue'</span>]&#125;</span>/lib/WpluginTinymceVue.css`</span>, <span class="string">'WpluginTinymceVue'</span>)</span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="undefined">        mounted () &#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">this</span>.show = <span class="literal">true</span></span></span><br><span class="line"><span class="javascript">            <span class="keyword">this</span>.$nextTick(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">                <span class="comment">// 由于是异步组件，可能为undefined，因为组件可能还没加载进来</span></span></span><br><span class="line"><span class="javascript">                <span class="comment">// ***如果需要监听异步组件的挂载事件，可通过在异步组件内部emit事件出来，主组件进行监听***</span></span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="keyword">this</span>.$refs.comp)</span></span><br><span class="line"><span class="undefined">            &#125;)</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">        methods: &#123;</span></span><br><span class="line"><span class="undefined">            toshow () &#123;</span></span><br><span class="line"><span class="javascript">                <span class="comment">//切换组件显示</span></span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> arr = [<span class="string">"first"</span>, <span class="string">"second"</span>, <span class="string">"third"</span>, <span class="string">""</span>];</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> index = arr.indexOf(<span class="keyword">this</span>.which_to_show);</span></span><br><span class="line"><span class="javascript">                <span class="keyword">if</span> (index &lt; <span class="number">3</span>) &#123;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">this</span>.which_to_show = arr[index + <span class="number">1</span>];</span></span><br><span class="line"><span class="javascript">                &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">this</span>.which_to_show = arr[<span class="number">0</span>];</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">                <span class="comment">// 或者动态导入组件(更多用法参考官网)</span></span></span><br><span class="line"><span class="javascript">                Vue.component(<span class="string">'first'</span>, () =&gt; <span class="keyword">import</span>(<span class="string">'./first.vue'</span>)) <span class="comment">// 动态注册全局组件</span></span></span><br><span class="line"><span class="javascript">                <span class="keyword">let</span> second = <span class="string">'second.vue'</span></span></span><br><span class="line"><span class="javascript">                Vue.component(<span class="string">'first'</span>,</span></span><br><span class="line"><span class="undefined">                    () =&gt; (&#123;</span></span><br><span class="line"><span class="javascript">                        <span class="comment">// 参考: https://jishuin.proginn.com/p/763bfbd56d1b</span></span></span><br><span class="line"><span class="javascript">                        <span class="comment">// 1.require + component实现: 实现了动态加载功能，并未实现按需加载。require是CommonJS规范，在同路径下的vue文件，都会被打包进去</span></span></span><br><span class="line"><span class="javascript">                        <span class="comment">// component: require('./component/demo.vue').default</span></span></span><br><span class="line"><span class="javascript">                        <span class="comment">// 2.import + component实现：该方法不同于import A from B，这种属于纯静态编译；import()方法，该方法属于动态编译，webpack在打包时，碰到import()方法，会单独生存一个独立文件，用于按需加载。但不能实现完全动态，例如下面编译时会编译所有@/components下的模块，运行时才会加载second的值从而实现懒加载</span></span></span><br><span class="line"><span class="javascript">                        <span class="comment">// 3.require + Vue.extend实现 (Vue.extend可不用挂载到comment直接使用，参考：https://juejin.cn/post/6890072682864476168)</span></span></span><br><span class="line"><span class="javascript">                        <span class="comment">// *** 组件库中使用动态组件 - 参考下文开发组件库</span></span></span><br><span class="line"><span class="javascript">                        component: <span class="keyword">import</span>(<span class="string">`@/components/<span class="subst">$&#123;second&#125;</span>`</span>),</span></span><br><span class="line"><span class="javascript">                        error: MyDefaultComp <span class="comment">// 加载失败可显示默认组件</span></span></span><br><span class="line"><span class="undefined">                    &#125;)</span></span><br><span class="line"><span class="undefined">                )</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    &#125;);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="keep-alive"><a href="#keep-alive" class="headerlink" title="keep-alive"></a>keep-alive</h3><ul><li>默认被切换掉（非当前显示）的组件，是直接被移除了。假如需要子组件在切换后，依然需要他保留在内存中，避免下次出现的时候重新渲染，可使用<code>keep-alive</code> <a href="https://juejin.im/post/5b41bdef6fb9a04fe63765f1" target="_blank" rel="noopener">^5</a></li><li><p>用法</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 缓存动态组件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">keep-alive</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">component</span> <span class="attr">:is</span>=<span class="string">"view"</span>&gt;</span><span class="tag">&lt;/<span class="name">component</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">keep-alive</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 多个条件判断的子组件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">keep-alive</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">comp-a</span> <span class="attr">v-if</span>=<span class="string">"a &gt; 1"</span>&gt;</span><span class="tag">&lt;/<span class="name">comp-a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">comp-b</span> <span class="attr">v-else</span>&gt;</span><span class="tag">&lt;/<span class="name">comp-b</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">keep-alive</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 缓存路由组件，可以将所有路径匹配到的路由组件都缓存起来，包括路由组件里面的组件。如果使用include属性则可有条件的缓存 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">keep-alive</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">keep-alive</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>生命周期钩子</p><ul><li>在被keep-alive包含的组件/路由中，会多出两个生命周期的钩子 <code>activated</code> 与 <code>deactivated</code>(写在匹配到的组件中)</li><li>不使用keep-alive: beforeRouteEnter -&gt; created -&gt; mounted -&gt; destroyed</li><li>使用keep-alive<ul><li>初次进入页面: beforeRouteEnter -&gt; created -&gt; mounted -&gt; activated -&gt; deactivated</li><li>再次进入缓存的页面: beforeRouteEnter -&gt; activated -&gt; deactivated (created和mounted不会再执行)</li></ul></li></ul></li><li><p><code>include</code> 和 <code>exclude</code>(Vue2.1.0新增，之前版本可通过其他方式代替)</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 缓存路由 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 逗号分隔字符串 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">keep-alive</span> <span class="attr">include</span>=<span class="string">"a,b"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">component</span> <span class="attr">:is</span>=<span class="string">"view"</span>&gt;</span><span class="tag">&lt;/<span class="name">component</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">keep-alive</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 正则表达式 (使用 `v-bind`) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">keep-alive</span> <span class="attr">:include</span>=<span class="string">"/a|b/"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">component</span> <span class="attr">:is</span>=<span class="string">"view"</span>&gt;</span><span class="tag">&lt;/<span class="name">component</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">keep-alive</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 数组 (使用 `v-bind`) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">keep-alive</span> <span class="attr">:include</span>=<span class="string">"['a', 'b']"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">component</span> <span class="attr">:is</span>=<span class="string">"view"</span>&gt;</span><span class="tag">&lt;/<span class="name">component</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">keep-alive</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 缓存路由，仍然可以使用数组 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">keep-alive</span> <span class="attr">include</span>=<span class="string">'a'</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">keep-alive</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>匹配规则<ul><li>首先匹配组件的name选项，如果name选项不可用</li><li>则匹配它的局部注册名称(父组件 components 选项的键值)</li><li>匿名组件，不可匹配(比如路由组件没有name选项时，并且没有注册的组件名)</li><li>只能匹配当前被包裹的组件，不能匹配更下面嵌套的子组件(比如用在路由上，只能匹配路由组件的name选项，不能匹配路由组件里面的嵌套组件的name选项)</li><li><code>&lt;keep-alive&gt;</code>不会在函数式组件中正常工作，因为它们没有缓存实例</li><li>include和exclude可同时使用，exclude的优先级大于include</li></ul></li></ul></li><li><p>路由和keep-alive</p><ul><li>如果发现未缓存，可看看是否有子孙路由也用到了router-view，此时要将最近的router-view进行缓存</li><li><a href="https://www.lmlphp.com/user/16603/article/item/552232/" target="_blank" rel="noopener">https://www.lmlphp.com/user/16603/article/item/552232/</a></li><li><p>案例</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">keep-alive</span> <span class="attr">:include</span>=<span class="string">"includedComponents"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">router-view</span> <span class="attr">v-if</span>=<span class="string">"keepAlive"</span> <span class="attr">:key</span>=<span class="string">"key"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">keep-alive</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">router-view</span> <span class="attr">v-if</span>=<span class="string">"!keepAlive"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">const</span> CACHE_INCLUDED_ROUTES = <span class="string">'cache_included_routes'</span></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">'ParentView'</span>,</span></span><br><span class="line"><span class="undefined">    data() &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> &#123;&#125;</span></span><br><span class="line"><span class="undefined">    &#125;,</span></span><br><span class="line"><span class="undefined">    computed: &#123;</span></span><br><span class="line"><span class="undefined">        key() &#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> <span class="keyword">this</span>.$route.path</span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="undefined">        includedComponents() &#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> includedRouters = Vue.ls.get(CACHE_INCLUDED_ROUTES)</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> (<span class="keyword">this</span>.$route.name &amp;&amp; !(<span class="keyword">this</span>.$route.meta &amp;&amp; <span class="keyword">this</span>.$route.meta.notCache)) &#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">let</span> cacheRouterArray = Vue.ls.get(CACHE_INCLUDED_ROUTES) || []</span></span><br><span class="line"><span class="javascript">                <span class="keyword">if</span> (!cacheRouterArray.includes(<span class="keyword">this</span>.$route.name)) &#123;</span></span><br><span class="line"><span class="javascript">                    cacheRouterArray.push(<span class="keyword">this</span>.$route.name)</span></span><br><span class="line"><span class="undefined">                    Vue.ls.set(CACHE_INCLUDED_ROUTES, cacheRouterArray)</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">return</span> cacheRouterArray</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> includedRouters</span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="undefined">        keepAlive() &#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> !(<span class="keyword">this</span>.$route.meta &amp;&amp; <span class="keyword">this</span>.$route.meta.notCache)</span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="undefined">    &#125;,</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 删除标签时清除缓存 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">    handleCloseTag(remailTag) &#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// 关闭缓存</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> CACHE_INCLUDED_ROUTES = <span class="string">'cache_included_routes'</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> cacheRouterArray = remailTag.map(<span class="function"><span class="params">x</span> =&gt;</span> x.name)</span></span><br><span class="line"><span class="undefined">        Vue.ls.set(CACHE_INCLUDED_ROUTES, cacheRouterArray)</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>不同路由指向同一组件，需要全部缓存</p><ul><li>方案一：避免路由直接指向同一组件，可将在外面报告一层页面，参考：<a href="https://blog.csdn.net/yanxiaomu/article/details/100753335" target="_blank" rel="noopener">https://blog.csdn.net/yanxiaomu/article/details/100753335</a></li><li>方案二：更改keep-alive源码使自定义key为path(默认为组件name)，参考：<a href="https://blog.csdn.net/qq_44170108/article/details/133313641" target="_blank" rel="noopener">https://blog.csdn.net/qq_44170108/article/details/133313641</a></li><li>参考路由页签组件：<a href="https://github.com/bhuh12/vue-router-tab" target="_blank" rel="noopener">https://github.com/bhuh12/vue-router-tab</a></li></ul></li></ul><h2 id="事件"><a href="#事件" class="headerlink" title="事件"></a>事件</h2><h3 id="示例-1"><a href="#示例-1" class="headerlink" title="示例"></a>示例</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- stop阻止冒泡，prevent阻止原生事件(如表单提交页面刷新) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">v-on:click.stop.prevent</span>=<span class="string">"doThis"</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 只当事件在该元素本身点击时触发事件，子元素点击则不执行 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> @<span class="attr">click.self</span>=<span class="string">"doThat"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 关于click事件不生效，以iview的Drawer组件为例 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 点击后不会执行a函数，因为Drawer实际渲染dom并不在此div中 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> @<span class="attr">click.native</span>=<span class="string">"a"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 点击后会执行c函数，此处表示使用原生click事件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Drawer</span> @<span class="attr">click.native</span>=<span class="string">"c"</span>&gt;</span><span class="tag">&lt;/<span class="name">Drawer</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- ** 点击后不会执行b函数 **，因为Drawer组件并没有定义click事件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Drawer</span> @<span class="attr">click</span>=<span class="string">"b"</span>&gt;</span><span class="tag">&lt;/<span class="name">Drawer</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="鼠标点击其他区域事件"><a href="#鼠标点击其他区域事件" class="headerlink" title="鼠标点击其他区域事件"></a>鼠标点击其他区域事件</h3><ul><li>基于指令<ul><li>简易版本参考：<a href="https://www.jianshu.com/p/9e1c241d8edb" target="_blank" rel="noopener">https://www.jianshu.com/p/9e1c241d8edb</a></li><li>iview版本参考：iview/src/directives/v-click-outside-x.js</li></ul></li></ul><h3 id="监控全局点击事件-不推荐"><a href="#监控全局点击事件-不推荐" class="headerlink" title="监控全局点击事件(不推荐)"></a>监控全局点击事件(不推荐)</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. main.js</span></span><br><span class="line"><span class="comment">// 定义全局点击函数</span></span><br><span class="line">Vue.prototype.globalClick = <span class="function"><span class="keyword">function</span> (<span class="params">callback</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">document</span>.getElementById(<span class="string">'app'</span>).onclick = <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">      callback(e)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 组件中使用</span></span><br><span class="line">mounted () &#123;</span><br><span class="line">    <span class="keyword">this</span>.globalClick(<span class="keyword">this</span>.handleGlobalClick)</span><br><span class="line">&#125;,</span><br><span class="line">methods: &#123;</span><br><span class="line">    handleGlobalClick (e) &#123;</span><br><span class="line">        <span class="comment">// 修改data数据不会更新到dom，可以watch到</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="点击按钮后下载"><a href="#点击按钮后下载" class="headerlink" title="点击按钮后下载"></a>点击按钮后下载</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- click方法中不能直接使用window对象 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> @<span class="attr">click</span>=<span class="string">"linkDownload('https://www.baidu.com')"</span>&gt;</span>百度<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">linkDownload (url) &#123;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">window</span>.open(url, <span class="string">'_blank'</span>) <span class="comment">// 新窗口打开外链接</span></span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="插入字符串"><a href="#插入字符串" class="headerlink" title="插入字符串"></a>插入字符串</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Select</span> <span class="attr">v-model</span>=<span class="string">"editForm.alertField"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Option</span> <span class="attr">v-for</span>=<span class="string">"item in alertFieldList"</span> <span class="attr">:value</span>=<span class="string">"item.code"</span> <span class="attr">:key</span>=<span class="string">"item.code"</span>&gt;</span>&#123;&#123; item.name &#125;&#125;<span class="tag">&lt;/<span class="name">Option</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Button</span> @<span class="attr">click</span>=<span class="string">"insertStr()"</span> <span class="attr">style</span>=<span class="string">"margin-left: 15px;"</span>&gt;</span>插入<span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">textarea</span> <span class="attr">ref</span>=<span class="string">"content"</span> <span class="attr">v-model</span>=<span class="string">"editForm.content"</span> <span class="attr">class</span>=<span class="string">"ivu-input"</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">rows</span>=<span class="string">"3"</span><span class="attr">required</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">insertStr() &#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">if</span>(<span class="keyword">this</span>.editForm.content) &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> start = <span class="keyword">this</span>.that.$refs.content.selectionStart <span class="comment">// 获取光标位置</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> a = <span class="keyword">this</span>.editForm.content.substring(<span class="number">0</span>, start)</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> b = <span class="keyword">this</span>.editForm.content.substring(start, <span class="keyword">this</span>.editForm.content.length)</span></span><br><span class="line"><span class="javascript">        <span class="keyword">this</span>.editForm.content = a + <span class="keyword">this</span>.editForm.alertField + b</span></span><br><span class="line"><span class="javascript">    &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">this</span>.editForm.content = <span class="keyword">this</span>.editForm.alertField</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">this</span>.editForm = <span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(<span class="keyword">this</span>.editForm))</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="自动转大写"><a href="#自动转大写" class="headerlink" title="自动转大写"></a>自动转大写</h3><ul><li>有时候会出现看着转大写了，但是传输到后台的最后一个字母还是小写</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Input</span> <span class="attr">size</span>=<span class="string">"small"</span> <span class="attr">placeholder</span>=<span class="string">"编号"</span> <span class="attr">v-model</span>=<span class="string">"form.orderNo"</span> <span class="attr">clearable</span></span></span><br><span class="line"><span class="tag">    @<span class="attr">keyup.native</span>=<span class="string">"$upper(form, 'orderNo')"</span>&gt;</span><span class="tag">&lt;/<span class="name">Input</span>&gt;</span></span><br><span class="line"></span><br><span class="line">Vue.prototype.$upper = function (map, key) &#123;</span><br><span class="line">  if (!map || !key || !map[key]) return</span><br><span class="line">  map[key] = map[key].toUpperCase()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="样式"><a href="#样式" class="headerlink" title="样式"></a>样式</h2><h3 id="lang-和-scoped"><a href="#lang-和-scoped" class="headerlink" title="lang 和 scoped"></a>lang 和 scoped</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="comment">// js中也可以引入样式</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> <span class="string">'./index.css'</span></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- lang：可选。默认是以css的方式解析样式；也可指定如 less/sass/stylus 等预处理器(需要提前安装对应依赖，如less需安装 `npm install -D less-loader less`) --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- scoped：可选。不写scoped时，本身写在vue组件内的样式只会对当前组件和引入此文件的另一组件产生影响，不会影响全局样式；写scoped时，表示该样式只对此组件产生影响，最终会生成样式如 `.example[data-v-5558831a] &#123;color: blue;&#125;` --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span> <span class="attr">lang</span>=<span class="string">"less"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="css"><span class="comment">/* @import '~view-design/src/styles/index.less'; 使用iview的变量需要导入 */</span></span></span><br><span class="line"><span class="css">@<span class="keyword">import</span> <span class="string">'./assets/globle-varables.less'</span>; <span class="comment">/* 引入外部文件。@default-color: red; */</span></span></span><br><span class="line"><span class="undefined">@default-color: blue; /* 覆盖外部文件变量或自定义变量 */</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css"><span class="selector-class">.example</span> &#123;</span></span><br><span class="line"><span class="css">    <span class="selector-tag">color</span>: @<span class="keyword">default</span>-<span class="keyword">color</span>; <span class="comment">/* 使用变量 */</span></span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css"><span class="comment">/* scoped穿透问题：需要在局部组件中修改第三方组件库(如 iview)的样式，而又不想去除scoped属性造成组件之间的样式覆盖，这时可以通过特殊的方式穿透scoped */</span></span></span><br><span class="line"><span class="css"><span class="comment">/* less/sass格式如：`外层 /deep/ 或 ::v-deep 第三方组件 &#123;样式&#125;`(外层也可省略)，stylus则是将 /deep/ 换成 &gt;&gt;&gt; */</span></span></span><br><span class="line"><span class="undefined">.wrapper /deep/ .ivu-table th &#123;</span></span><br><span class="line"><span class="css">    <span class="selector-tag">background-color</span>: <span class="selector-id">#eef8ff</span>;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css"><span class="selector-class">.box</span> &#123;</span></span><br><span class="line"><span class="css">    <span class="comment">/* 解决直接使用 height: calc(100% - 60px); 不生效的问题 */</span> </span></span><br><span class="line"><span class="undefined">    height: calc(~"96vh - 100px"); </span></span><br><span class="line"><span class="undefined">    height: e("calc(100% - 60px)");</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 也可在组件中额外定义全局样式 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="全局样式-自动化导入"><a href="#全局样式-自动化导入" class="headerlink" title="全局样式/自动化导入"></a>全局样式/自动化导入</h3><blockquote><p><a href="https://cli.vuejs.org/zh/guide/css.html#%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AF%BC%E5%85%A5" target="_blank" rel="noopener">https://cli.vuejs.org/zh/guide/css.html#%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AF%BC%E5%85%A5</a></p></blockquote><ul><li>以vue-cli自动导入stylus为例</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">npm i style-resources-loader -D <span class="comment">// 需要提前安装依赖</span></span><br><span class="line"><span class="comment">// npm i sass-resources-loader -D // sass/less</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// vue.config.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  chainWebpack: <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 设置缩写</span></span><br><span class="line">    config.resolve.alias</span><br><span class="line">      .set(<span class="string">'@'</span>, resolve(<span class="string">'src'</span>))</span><br><span class="line">      .set(<span class="string">'_c'</span>, resolve(<span class="string">'src/components'</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置全局样式自动导入</span></span><br><span class="line">    <span class="keyword">const</span> types = [<span class="string">'vue-modules'</span>, <span class="string">'vue'</span>, <span class="string">'normal-modules'</span>, <span class="string">'normal'</span>]</span><br><span class="line">    types.forEach(<span class="function"><span class="params">type</span> =&gt;</span> addStyleResource(config.module.rule(<span class="string">'stylus'</span>).oneOf(type)))</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addStyleResource</span> (<span class="params">rule</span>) </span>&#123;</span><br><span class="line">  rule.use(<span class="string">'style-resource'</span>)</span><br><span class="line">    .loader(<span class="string">'style-resources-loader'</span>)</span><br><span class="line">    .options(&#123;</span><br><span class="line">      patterns: [</span><br><span class="line">        <span class="comment">// index.less 文件中可以定义全局变量或者全局样式，或者导入其他样式文件 (不能使用别名路径)</span></span><br><span class="line">        path.resolve(__dirname, <span class="string">'./src/assets/theme/default/index.less'</span>),</span><br><span class="line">      ],</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>less/sass为例(stylus亦可)</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 更新vue cli到3.0以上</span></span><br><span class="line">vue --version <span class="comment"># @vue/cli 4.3.0</span></span><br><span class="line">npm install -g @vue/cli</span><br><span class="line"></span><br><span class="line"><span class="comment"># 增加依赖(会将相应依赖添加到package.json)</span></span><br><span class="line">vue add style-resources-loader</span><br><span class="line"></span><br><span class="line"><span class="comment"># vue.config.js 配置</span></span><br><span class="line">module.exports = &#123;</span><br><span class="line">    pluginOptions: &#123;</span><br><span class="line">        <span class="string">'style-resources-loader'</span>: &#123;</span><br><span class="line">            preProcessor: <span class="string">'less'</span>,</span><br><span class="line">            patterns: [path.resolve(__dirname, <span class="string">'src/styles/theme/index.less'</span>)]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>main.js引入样式文件、全局样式自动化导入、vue文件中样式关系<ul><li>优先级：vue文件样式 &gt; 全局样式自动化导入 &gt; main.js引入样式文件</li><li>全局样式自动化导入中使用<code>/deep/</code>有效；main.js引入样式文件中<code>/deep/</code>无效，直接写即可修改第三方组件样式</li><li>main.js引入文件作用域<ul><li>引入的 css 都是全局生效的</li><li>引入的 js 文件只在 main.js 中生效。是因为 main.js 在webpack中是一个模块，引入的 js 文件也是一个模块，在其他地方是访问不到的，这就是ES6的模块化。所以如果想 main.js 引入的 js 全局可用，就需要绑定到全局对象上，比如绑定 Vue 上</li></ul></li></ul></li></ul><h3 id="样式使用举例"><a href="#样式使用举例" class="headerlink" title="样式使用举例"></a>样式使用举例</h3><ul><li>使用案例</li></ul><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 通过~导入node_module目录下模块样式(也可写成相对路径), 从而可进行变量覆盖</span></span><br><span class="line"><span class="keyword">@import</span> <span class="string">'~view-design/src/styles/index.less'</span>;</span><br><span class="line"><span class="comment">// src/assets/theme/default/index.less</span></span><br><span class="line"><span class="keyword">@import</span> <span class="string">"main.less"</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">@default-color:</span> <span class="number">#ff6633</span>;</span><br><span class="line"><span class="variable">@default-color__change:</span> <span class="number">#ff8d66</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// src/assets/theme/default/main.less</span></span><br><span class="line"><span class="selector-class">.sq-color</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="variable">@default-color</span>;</span><br><span class="line">    <span class="selector-tag">&amp;</span><span class="selector-pseudo">:active</span>,<span class="selector-tag">&amp;</span><span class="selector-class">.active</span>,<span class="selector-tag">&amp;</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">        <span class="attribute">color</span>: <span class="variable">@default-color__change</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.ivu-btn</span><span class="selector-class">.sq-btn__primary</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="variable">@default-color</span>;</span><br><span class="line">    <span class="attribute">border-color</span>: <span class="variable">@default-color</span>;</span><br><span class="line">    <span class="selector-tag">&amp;</span><span class="selector-pseudo">:active</span>,<span class="selector-tag">&amp;</span><span class="selector-class">.active</span>,<span class="selector-tag">&amp;</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">        <span class="attribute">color</span>: <span class="number">#f2f2f2</span>;</span><br><span class="line">        <span class="attribute">background-color</span>: <span class="variable">@default-color__change</span>;</span><br><span class="line">        <span class="attribute">border-color</span>: <span class="variable">@default-color__change</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*空心按钮*/</span></span><br><span class="line">    <span class="selector-tag">&amp;</span><span class="selector-class">.sq-btn__empty</span>&#123;</span><br><span class="line">        <span class="attribute">color</span>: <span class="variable">@default-color</span>;</span><br><span class="line">        <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span><br><span class="line">        <span class="attribute">border-color</span>: <span class="variable">@default-color</span>;</span><br><span class="line">        <span class="selector-tag">&amp;</span><span class="selector-pseudo">:active</span>,<span class="selector-tag">&amp;</span><span class="selector-class">.active</span>,<span class="selector-tag">&amp;</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">            <span class="attribute">color</span>: <span class="variable">@default-color__change</span>;</span><br><span class="line">            <span class="attribute">background-color</span>: <span class="number">#f2f2f2</span>;</span><br><span class="line">            <span class="attribute">border-color</span>: <span class="variable">@default-color__change</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>vue组件中给body设置样式</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 法一：通过生命周期直接修改body样式 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="undefined">  beforeCreate () &#123;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.querySelector(<span class="string">'body'</span>).setAttribute(<span class="string">'style'</span>, <span class="string">'background: transparent !important'</span>)</span></span><br><span class="line"><span class="undefined">  &#125;,</span></span><br><span class="line"><span class="undefined">  beforeDestroy () &#123;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.querySelector(<span class="string">'body'</span>).removeAttribute(<span class="string">'style'</span>)</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 法二：给template中的第一个div设置如下样式。只是加了一个遮住，如果是想把此页面通过iframe嵌套在其他页面进行透明则无此方法无效  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="css"><span class="selector-class">.body-bg</span> &#123;</span></span><br><span class="line"><span class="undefined">  position: absolute;</span></span><br><span class="line"><span class="undefined">  width: 100%;</span></span><br><span class="line"><span class="undefined">  height: 100%;</span></span><br><span class="line"><span class="undefined">  top: 0;</span></span><br><span class="line"><span class="undefined">  left: 0;</span></span><br><span class="line"><span class="undefined">  overflow-y: auto;</span></span><br><span class="line"><span class="css">  <span class="selector-tag">background-color</span>: <span class="selector-id">#000</span>;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="接受外部参数动态修改样式"><a href="#接受外部参数动态修改样式" class="headerlink" title="接受外部参数动态修改样式"></a>接受外部参数动态修改样式</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Vue2支持 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"box"</span> <span class="attr">:style</span>=<span class="string">"&#123;'--heightline': heightLine + 'px'&#125;"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 变量名必须以--开头，且不要使用驼峰变量(uniapp会不起作用)，此处背景图的url必须写到上面 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"login-bg"</span> <span class="attr">:style</span>=<span class="string">"&#123;'--maloginbg': 'url(' + maLoginBg + ')'&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="undefined">  data() &#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="undefined">    	height: 42,</span></span><br><span class="line"><span class="javascript">        maLoginBg: <span class="string">'https://example.com/bg.png'</span></span></span><br><span class="line"><span class="undefined">    &#125;;</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined">&#125;;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">"less"</span> <span class="attr">scoped</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="css"><span class="selector-class">.box</span>&#123;</span></span><br><span class="line"><span class="undefined">	height: var(--heightline); </span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="css"><span class="selector-class">.login-bg</span><span class="selector-pseudo">::after</span> &#123;</span></span><br><span class="line"><span class="undefined">	content: '';</span></span><br><span class="line"><span class="undefined">	background-image: var(--maloginbg);</span></span><br><span class="line"><span class="undefined">	background-repeat: no-repeat;</span></span><br><span class="line"><span class="undefined">	background-size: cover;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="transition-动画"><a href="#transition-动画" class="headerlink" title="transition 动画"></a>transition 动画</h3><ul><li>参考：<a href="https://cn.vuejs.org/v2/api/#transition" target="_blank" rel="noopener">API</a>、<a href="https://cn.vuejs.org/v2/guide/transitions.html" target="_blank" rel="noopener">guide</a></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    name：用于自动生成 CSS 过渡类名。例如：name: 'fade' 将自动拓展为.fade-enter，.fade-enter-active等class，只需要提前定义好对应的css即可</span></span><br><span class="line"><span class="comment">    mode：控制离开/进入的过渡时间序列。有效的模式有 "out-in" 和 "in-out"；默认同时生效</span></span><br><span class="line"><span class="comment">    tag：&lt;transition&gt; 它会以一个真实元素呈现：默认为一个 &lt;span&gt;，可以通过 tag 属性更换为其他元素</span></span><br><span class="line"><span class="comment">    @after-enter：绑定进入后的事件，还有其他事件可以监听</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">transition</span> <span class="attr">name</span>=<span class="string">"fade"</span> <span class="attr">mode</span>=<span class="string">"out-in"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- transition 只能包含一个根节点，两个可以使用 v-if/v-else 或动态组件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">v-if</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">v-else</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">transition</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="css"><span class="selector-class">.fade-enter-active</span>, <span class="selector-class">.fade-leave-active</span> &#123;</span></span><br><span class="line"><span class="css">  <span class="selector-tag">transition</span>: <span class="selector-tag">opacity</span> <span class="selector-class">.5s</span>;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="css"><span class="selector-class">.fade-enter</span>, <span class="selector-class">.fade-leave-to</span> &#123;</span></span><br><span class="line"><span class="undefined">  opacity: 0;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 只能用于列表过渡(v-for)，列表需要有唯一key --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">transition-group</span> <span class="attr">name</span>=<span class="string">"list"</span> <span class="attr">tag</span>=<span class="string">"p"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">v-for</span>=<span class="string">"item in items"</span> <span class="attr">:key</span>=<span class="string">"item"</span>&gt;</span>&#123;&#123; item &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">transition-group</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>结合<a href="https://github.com/julianshapiro/velocity" target="_blank" rel="noopener">Velocity.js</a>，Velocity 和 jQuery.animate 的工作方式类似，也是用来实现 JavaScript 动画</li></ul><h2 id="mixins混入"><a href="#mixins混入" class="headerlink" title="mixins混入"></a>mixins混入</h2><ul><li>mixins<ul><li>值为对象的选项，例如 data()、methods、components 和 directives，将被合并为同一个对象。两个对象键名冲突时，取组件对象的键值对</li><li>created 等方法，会先执行混入created方法，再执行组件created方法</li></ul></li><li>全局混入<ul><li><code>Vue.mixin({...})</code></li></ul></li><li>案例</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 被导入通用功能组件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- b()为导入的bem函数，在create()函数中混入，对组件名进行class命名 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">:class</span>=<span class="string">"b()"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> create <span class="keyword">from</span> <span class="string">"core/create"</span>;</span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> locale <span class="keyword">from</span> <span class="string">"./locale"</span>;</span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> hello <span class="keyword">from</span> <span class="string">'./hello'</span></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> create(&#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">"upload"</span>,</span></span><br><span class="line"><span class="undefined">  mixins: [hello(), locale],</span></span><br><span class="line"><span class="undefined">  data () &#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">      name: <span class="string">'smalle'</span>,</span></span><br><span class="line"><span class="undefined">    &#125;;</span></span><br><span class="line"><span class="undefined">  &#125;,</span></span><br><span class="line"><span class="javascript">  <span class="comment">// 打印结果为: 111-333-222-444</span></span></span><br><span class="line"><span class="javascript">  mounted: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="number">333</span>)</span></span><br><span class="line"><span class="javascript">    <span class="keyword">this</span>.$nextTick(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="number">444</span>)</span></span><br><span class="line"><span class="undefined">    &#125;)</span></span><br><span class="line"><span class="undefined">  &#125;,</span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>通用代码</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// create.js</span></span><br><span class="line"><span class="keyword">import</span> bem <span class="keyword">from</span> <span class="string">'utils/bem'</span>; <span class="comment">// 对css进行bem命名，参考 https://gitee.com/smallweigit/avue/blob/v2.7.6/src/utils/bem.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; KEY_COMPONENT_NAME &#125; <span class="keyword">from</span> <span class="string">'global/variable'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 再次封装，options为原始组件配置</span></span><br><span class="line">  options.name = KEY_COMPONENT_NAME + (options.name || <span class="string">''</span>); <span class="comment">// 给组件名加上统一前缀</span></span><br><span class="line">  options.mixins = options.mixins || [];</span><br><span class="line">  options.mixins.push(bem); <span class="comment">// 在原混入基础上加入bem功能</span></span><br><span class="line">  <span class="keyword">return</span> options;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// hello.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    data () &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        hello: <span class="literal">null</span>,</span><br><span class="line">        safe: <span class="keyword">this</span>,</span><br><span class="line">        <span class="comment">// 所有的对象，只有组件定义了，则全部按照组件定义的为准。**组件的属性不会和mixins的属性进行合并**</span></span><br><span class="line">        map: &#123;</span><br><span class="line">         num: <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    computed: &#123;</span><br><span class="line">      helloName () &#123;</span><br><span class="line">        <span class="comment">// this.safe.name =&gt; undefined; this['name'] =&gt; smalle; this.name =&gt; smalle; // ts使用this.name编辑器报红</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>[<span class="string">'name'</span>] + <span class="string">' smalle'</span> <span class="comment">// this 指当前函数对象，被混入后，也可获取到功能组件(导入此混入的组件)属性</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    mounted: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="number">111</span>)</span><br><span class="line">      <span class="keyword">this</span>.$nextTick(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="number">222</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      hello () &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'mixins methods'</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// locale.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; t &#125; <span class="keyword">from</span> <span class="string">'locale'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  methods: &#123;</span><br><span class="line">    t(...args) &#123;</span><br><span class="line">      <span class="keyword">return</span> t.apply(<span class="keyword">this</span>, args);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="指令"><a href="#指令" class="headerlink" title="指令"></a>指令</h2><h3 id="自定义指令"><a href="#自定义指令" class="headerlink" title="自定义指令"></a>自定义指令</h3><ul><li><a href="https://cn.vuejs.org/v2/guide/custom-directive.html" target="_blank" rel="noopener">文档</a></li><li>钩子函数<ul><li><code>bind</code> 只调用一次，指令第一次绑定到元素时调用</li><li><code>inserted</code> 被绑定元素插入父节点时调用 (仅保证父节点存在，但不一定已被插入文档中)</li><li><code>update</code> 所在组件的 VNode 更新时调用，但是可能发生在其子 VNode 更新之前</li><li>·componentUpdated` 指令所在组件的 VNode 及其子 VNode 全部更新后调用</li><li><code>unbind</code> 只调用一次，指令与元素解绑时调用</li></ul></li><li>钩子函数参数<ul><li><code>el</code> 指令所绑定的元素，可以用来直接操作 DOM</li><li><code>binding</code> 包含name, value, expression, arg, modifiers. 案例<code>v-demo:foo.a.b=&quot;message&quot;</code>(message=hello!)<ul><li>name: demo</li><li>arg: foo (也支持变量 <code>v-pin:[direction]=&quot;200&quot;</code>)</li><li>modifiers: {“a”: true, “b”: true}</li><li>expression: message</li><li>value: hello! (如果指令需要多个值，可以传入一个 JavaScript 对象字面量, <code>v-demo=&quot;{ color: &#39;white&#39;, text: &#39;hello!&#39;}&quot;</code>)</li></ul></li><li><code>vnode</code></li><li><code>oldVnode</code></li></ul></li></ul><h3 id="自定义指令案例"><a href="#自定义指令案例" class="headerlink" title="自定义指令案例"></a>自定义指令案例</h3><h4 id="input输入自动转大写"><a href="#input输入自动转大写" class="headerlink" title="input输入自动转大写"></a>input输入自动转大写</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;Input v-uppercase v-model=<span class="string">"form.orderNo"</span> placeholder=<span class="string">"编号"</span> clearable&gt;<span class="xml"><span class="tag">&lt;/<span class="name">Input</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">Vue.directive(<span class="string">"uppercase"</span>, &#123;</span><br><span class="line">  inserted: <span class="function"><span class="keyword">function</span> (<span class="params">el</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> input = el.querySelector(<span class="string">'input'</span>) <span class="comment">// iview为例，找到实际的input输入框</span></span><br><span class="line">    input.onkeyup = <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">      input.value = input.value.toUpperCase()</span><br><span class="line">    &#125;</span><br><span class="line">    input.onblur = <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">      input.value = input.value.toUpperCase()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="多环境配置用户权限"><a href="#多环境配置用户权限" class="headerlink" title="多环境配置用户权限"></a>多环境配置用户权限</h4><ul><li>permission.js</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// v-permission="['admin','editor']"</span></span><br><span class="line"><span class="comment">// v-permission:[`Prod`, `Test`]="['admin','editor']"</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">'@/store'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  inserted (el, binding, vnode) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; value, arg &#125; = binding</span><br><span class="line">    <span class="keyword">const</span> roles = store.getters &amp;&amp; store.getters.roles</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (arg &amp;&amp; arg.split(<span class="string">','</span>).indexOf(process.env.VUE_APP_SAAS_USER) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (value &amp;&amp; value <span class="keyword">instanceof</span> <span class="built_in">Array</span> &amp;&amp; value.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> permissionRoles = value</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> hasPermission = roles.some(<span class="function"><span class="params">role</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> permissionRoles.includes(role)</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!hasPermission) &#123;</span><br><span class="line">        el.parentNode &amp;&amp; el.parentNode.removeChild(el)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">`need roles! Like v-permission="['admin','editor']"`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="API说明"><a href="#API说明" class="headerlink" title="API说明"></a>API说明</h2><ul><li><p><code>Vue.use(demo, opts)</code> <strong>注册插件</strong></p><ul><li>自定义插件参考<a href="#开发组件库">开发组件库</a></li><li>如果插件是一个对象，必须提供 install 方法。如果插件是一个函数，它会被作为 install 方法。install 方法调用时，会将 Vue 作为参数传入</li><li><p>实际是调用了demo的install(Vue, opts)方法，相当于传入了Vue对象到demo中</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// config.js</span></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">let</span> config = &#123;</span><br><span class="line">    name: <span class="string">'hello world'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    install(Vue) &#123;</span><br><span class="line">        <span class="comment">// 之后在组件中可使用this.$config</span></span><br><span class="line">        Vue.prototype.$config = config</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">// 等同于</span></span><br><span class="line"><span class="comment">const install = Vue =&gt; &#123;</span></span><br><span class="line"><span class="comment">    Vue.prototype.$config = config</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">export default &#123; install &#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">import</span> config <span class="keyword">from</span> <span class="string">'./config/index.js'</span></span><br><span class="line">Vue.use(config)</span><br></pre></td></tr></table></figure></li></ul></li><li><p><code>Vue.extend(options)</code> 使用基础 Vue 构造器，创建一个子类. Vue.component 是基于此函数的</p><ul><li>创建异步组件可参考：<a href="https://juejin.cn/post/6890072682864476168" target="_blank" rel="noopener">https://juejin.cn/post/6890072682864476168</a></li><li>参考report-table#report-modal</li></ul></li><li><p><code>Vue.component(name, component)</code> 通过js手动<strong>注册全局组件</strong>，此时无需在components属性中定义。如果在main.js执行了此函数，则全局.vue文件均可使用此主键。使用是可使用name或其下划线形式名称</p><ul><li>Vue.component注册全局组件时，内部会调用<code>Vue.extend</code>方法，将定义挂载到Vue.options.components上</li><li><p><code>components: { Demo }</code> components属性是用于注册局部组件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// &#123;string&#125; id</span></span><br><span class="line"><span class="comment">// &#123;Function | Object&#125; [definition]</span></span><br><span class="line">Vue.component(<span class="string">'demo'</span>, &#123;</span><br><span class="line">    <span class="comment">// render: function (createElement) &#123;&#125;,</span></span><br><span class="line">    template: <span class="string">`</span></span><br><span class="line"><span class="string">        &lt;div class="demo"&gt;</span></span><br><span class="line"><span class="string">            hello world</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">    `</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 基于函数(动态组件)</span></span><br><span class="line">Vue.component(<span class="string">'demo'</span>, </span><br><span class="line">    () =&gt; (&#123;</span><br><span class="line">        component: <span class="keyword">import</span>(<span class="string">'@/view/components/demo.vue'</span>),</span><br><span class="line">        error: MyErrorComp</span><br><span class="line">    &#125;)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 全局异步组件</span></span><br><span class="line">Vue.component(<span class="string">'demo'</span>, resolve =&gt; &#123;</span><br><span class="line">    <span class="comment">// require会告诉webpack将构建的代码分割成多个包，这些包通过Ajax请求</span></span><br><span class="line">    <span class="built_in">require</span>([<span class="string">'./Demo'</span>], resolve)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li></ul></li><li><p><code>Vue.mixin({...})</code> 全局混入</p></li><li><p><code>Vue.directive</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注册</span></span><br><span class="line">Vue.directive(<span class="string">'my-directive'</span>, &#123;</span><br><span class="line">    bind: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;,</span><br><span class="line">    inserted: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;,</span><br><span class="line">    update: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;,</span><br><span class="line">    componentUpdated: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;,</span><br><span class="line">    unbind: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 或指令函数</span></span><br><span class="line">Vue.directive(<span class="string">'my-directive'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 这里将会被 `bind` 和 `update` 调用</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li></ul><h2 id="开发组件库"><a href="#开发组件库" class="headerlink" title="开发组件库"></a>开发组件库</h2><ul><li><p>说明</p><ul><li><p>当基于element-ui等进行二次开发时</p><ul><li>在案例入口文件中可以引入element-ui(案例不打包到库文件中)，可将element-ui加到dependences和externals(对应public/index.html需引入element-ui的CDN文件)中，这样打包案例时体积会减少</li><li><strong>在组件库模板中可以使用element-ui的标签，组件库无需在入口js中导入element-ui进行use</strong>(前提是主应用全局use安装了element-ui插件)</li><li><p><strong>如果在库入口js文件及引申文件中引入了vue/element-ui，则不管包依赖是在dependences还是devDependences，都会将element-ui打包到组件库的输出文件中(如果只是使用element-ui的标签则不会)</strong></p><ul><li>在产物中搜索<code>ElInput</code>或<code>el-input</code>如果有则说明插件库中包含了element-ui包</li><li><p>如果此时将vue/element-ui设置成了externals，则将此插件在另外一个vue项目中引用时会出现插件模块缺少Vue对象。可动态判断是否需要设置成externals</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> IS_PROD = process.env.NODE_ENV === <span class="string">'production'</span></span><br><span class="line"><span class="comment">// script中增加`"lib": "vue-cli-service build --target lib ......"`</span></span><br><span class="line"><span class="comment">// 此时通过 npm run lib 进行打包库文件，则 process.env.npm_config_argv(original) 的值为['run', 'lib']</span></span><br><span class="line"><span class="keyword">const</span> IS_BUILD = <span class="built_in">JSON</span>.parse(process.env.npm_config_argv).original.filter(<span class="function"><span class="params">x</span> =&gt;</span> x === <span class="string">'build'</span>).length &gt; <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    configureWebpack(config) &#123;</span><br><span class="line">        <span class="keyword">if</span> (IS_PROD &amp;&amp; IS_BUILD) &#123;</span><br><span class="line">            config.externals = &#123;</span><br><span class="line">                vue: <span class="string">'Vue'</span>,</span><br><span class="line">                <span class="string">'vue-router'</span>: <span class="string">'VueRouter'</span>,</span><br><span class="line">                <span class="string">'element-ui'</span>: <span class="string">'ELEMENT'</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>如果一定需要使用vue/element-ui的方法，可在插件的install方法(Vue插件安装的入口方法)中接收外部应用(主应用)传入进来的vue/element-ui对象并缓存到全局属性中(<strong>如在插件内部调用Vue.component动态注册组件，此时必须使用同一个Vue对象，因此必须接收外部传入进来的</strong>，参考下文<a href="#组件库中使用动态组件">组件库中使用动态组件</a>)</p></li></ul></li></ul></li><li>异步加载插件<ul><li>使用 externals</li><li><a href="https://github.com/jiangshanmeta/vue-async-assets" target="_blank" rel="noopener">vue2异步加载插件/组件/指令等</a> vue2自带异步加载组件</li><li>vue3支持异步加载插件</li></ul></li><li>案例<ul><li><a href="https://gitee.com/sqbiz/wplugin-variant-form" target="_blank" rel="noopener">https://gitee.com/sqbiz/wplugin-variant-form</a> 基于vue-cli打包</li><li><a href="https://github.com/sscfaith/avue-form-design" target="_blank" rel="noopener">https://github.com/sscfaith/avue-form-design</a> 基于vue-cli打包(packages文件为实际包, src为案例)</li><li><a href="https://gitee.com/smallweigit/avue-plugin-ueditor" target="_blank" rel="noopener">https://gitee.com/smallweigit/avue-plugin-ueditor</a> 无需打包(直接将packages目录下文件暴露成包)</li></ul></li></ul><h3 id="打包与导入"><a href="#打包与导入" class="headerlink" title="打包与导入"></a>打包与导入</h3><ul><li><p>打包方式</p><ul><li><p>通过vue-cli打包</p><ul><li><p>参考: <a href="https://blog.csdn.net/qq_41887214/article/details/120619211" target="_blank" rel="noopener">https://blog.csdn.net/qq_41887214/article/details/120619211</a></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    // 导入模块时的入口函数(如果需要调试可去掉min，这样主应用导入后可直接在浏览器打断点。修改package.json后需要重启主应用)</span><br><span class="line">    // 如果导出了多个模块，可以在引入的时候写全路径，如`import ReportTable from 'report-table'`引入默认模块，而通过类似`import ReportTableDemo from 'report-table/lib-demo/report-table-demo.umd.min.js`引入另外一个模块</span><br><span class="line">    "main": "./lib/report-table.umd.min.js",</span><br><span class="line">    // 如果是scope类型模块(name以@xxx/开头)，则npm默认为发布私有包，如果需要发布成公开则需要定义下面配置</span><br><span class="line">    "publishConfig": &#123;</span><br><span class="line">        "access": "public"</span><br><span class="line">    &#125;,</span><br><span class="line">    // 上传到npm仓库的文件夹</span><br><span class="line">    "files": [</span><br><span class="line">        "lib",</span><br><span class="line">        <span class="string">"types"</span></span><br><span class="line">    ],</span><br><span class="line">    "typings": "types/index.d.ts",</span><br><span class="line">    "scripts": &#123;</span><br><span class="line">        // 参考: https://gitee.com/gitee-frontend/</span><br><span class="line">        // 实时监控打包(修改代码编译较快，可实时反映到主应用，且调试时显示的是源码；可增加如`lib/*.hot-update.*`让git忽略热更新产生的文件)</span><br><span class="line">        // 其他如npm link引用本地模块的方法参考：https://blog.csdn.net/zhangxin09/article/details/119344515</span><br><span class="line">        // 配合 npm link(通过本地路径直接安装模块即可，偶尔还是需要npm link) 就可以做本地调试了。(1)现在模块目录执行&lt;sudo&gt; npm link将当前模块关联到全局 (2) 在到项目目录执行`npm link my-module`关联模块到项目中(执行后会将本地开发包关联到node_modules中；如果项目目录中配置的是远程包，当重新npm i就会重新下载远程包，即npm link失效)</span><br><span class="line">        // 注意：--watch模式下，打包的lib中不会出现.css文件(样式和图片等资源无法实时监控)，因为css样式已经内联了，可通过在模块的 vue.config.js 中设置 css: &#123; extract: true &#125; 取消内联</span><br><span class="line">        // vue-cli-service build只会将组件中的样式进行打包到单独的文件或放在js内联中；无法将额外的less等样式进行打包，如需要可在主入口引入一下(如果时间开发需要额外的less，可将style目录放到打包产物中，主应用直接应用less文件也可以)</span><br><span class="line">        "start": "vue-cli-service build --target lib --name report-table --dest lib ./src/index.js --watch",</span><br><span class="line">        // 打包命令，打出来的包在lib文件夹中</span><br><span class="line">        // --formats umd-min # 产物包类型，默认包含common.js、.umd.js、.umd.min.js，此时表示只打包umd.min</span><br><span class="line">        "lib": "vue-cli-service build --target lib --name report-table --dest lib --formats umd-min ./src/index.js",</span><br><span class="line">        "lint": "vue-cli-service lint",</span><br><span class="line">        // 分析的是以 vue.config.js 中的 pages.index.entry 为入口</span><br><span class="line">        "report": "vue-cli-service build --report --mode prod"</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>通过rolljs打包</p><ul><li>参考<a href="https://segmentfault.com/a/1190000038827540，[demo](https://github.com/Zack921/zui-demo)" target="_blank" rel="noopener">https://segmentfault.com/a/1190000038827540，[demo](https://github.com/Zack921/zui-demo)</a></li></ul></li><li>通过webpack打包<ul><li>参考<a href="https://www.cnblogs.com/zdf-xue/articles/13062357.html" target="_blank" rel="noopener">https://www.cnblogs.com/zdf-xue/articles/13062357.html</a></li></ul></li></ul></li><li>主应用导入本地环境组件库<ul><li>参考：<a href="https://qastack.cn/programming/8088795/installing-a-local-module-using-npm" target="_blank" rel="noopener">https://qastack.cn/programming/8088795/installing-a-local-module-using-npm</a></li><li><code>npm install /path/to/component/project/dir</code>此时会在package.json中创建对应的依赖，值为<code>file:..</code>的相对路径<ul><li>模块更新不会直接热部署到应用，必须重新build</li></ul></li><li><code>npm link</code>(或对应的<code>yarn link</code>同理使用)<ul><li>在模块目录执行<code>npm link</code>会将当前模块链接到全局模块中</li><li>在应用目录执行<code>npm link package-name</code>引用该模块</li><li>也可直接使用相对/绝对路径，相当于上面两步</li><li>此方式不会在package.json中增加依赖</li><li>模块更新不会直接热部署到应用，必须重新build</li></ul></li><li>解决使用 npm link 时, eslint 提示对应包存在错误的问题<ul><li>在vue.coonfig.js的configureWebpack属性中加 <code>resolve: { symlinks: false }</code>，参考: <a href="https://stackoverflow.com/questions/48410203/webpack-gives-eslint-errors-while-using-npm-link" target="_blank" rel="noopener">https://stackoverflow.com/questions/48410203/webpack-gives-eslint-errors-while-using-npm-link</a></li></ul></li></ul></li><li>主应用导入远程环境组件库(均需先上传包)<ul><li>通过github安装，参考<a href="/_posts/web/node-dev-tools.md#基于git仓库进行安装">基于git仓库进行安装</a></li><li>通过npm镜像安装</li></ul></li></ul><h3 id="组件库中使用动态组件"><a href="#组件库中使用动态组件" class="headerlink" title="组件库中使用动态组件"></a>组件库中使用动态组件</h3><ul><li>把主应用的组件通过在组件库中import/require动态引入，会出现找不到组件文件；且通过Vue.component注册时并没有注册到主应用Vue对象中，而是注册到组件的Vue对象中</li><li>解决方法：在通过Vue.use组件库的时候，将主应用的Vue构造函数传递到组件库中，并且把需要动态引入主应用组件添加到Vue原型中(当然也可以注册成全局Vue组件)</li><li>组件库主要代码</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// =============&gt; 组件库入口函数</span></span><br><span class="line"><span class="keyword">import</span> GlobalConfig <span class="keyword">from</span> <span class="string">'./config'</span></span><br><span class="line"><span class="keyword">import</span> helper, &#123; install <span class="keyword">as</span> HelperInstall &#125; <span class="keyword">from</span> <span class="string">'./common/helper.js'</span></span><br><span class="line"><span class="comment">// 如Vue组件</span></span><br><span class="line"><span class="keyword">import</span> Demo <span class="keyword">from</span> <span class="string">'./packages/demo/index.js'</span></span><br><span class="line"><span class="comment">// 如果需要使用src下面的js必须在此文件导出</span></span><br><span class="line"><span class="comment">// 主引用中不能使用`import tools from 'my-comp/src/utils/tools'`导入对象，必须使用 import &#123; tools &#125; from 'my-comp'导入</span></span><br><span class="line"><span class="comment">// 但是主应用可以使用`@import '~my-comp/src/styles/theme-default.less'`导入样式文件到`index.less`(模块打包后默认将组件中css生成到一个css文件中，main.js中也只能引入css样式)</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> tools <span class="keyword">from</span> <span class="string">'./utils/tools'</span> <span class="comment">// 此文件中导出了很多小函数</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> install = <span class="function"><span class="keyword">function</span> (<span class="params">Vue, options = &#123;&#125;</span>) </span>&#123;</span><br><span class="line">  _.merge(GlobalConfig, options)</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 此Vue为主应用传入的Vue构造函数(_base)，缓存起来用于动态注册组件</span></span><br><span class="line">  Vue.use(HelperInstall, options)</span><br><span class="line"></span><br><span class="line">  Vue.prototype.$sqrt = helper</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这样导出后，可使用 import MyComp from 'my-comp' 导入全部对象</span></span><br><span class="line"><span class="keyword">const</span> MyComp = &#123;</span><br><span class="line">  install,</span><br><span class="line">  Demo,</span><br><span class="line">  tools</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> ReportTable</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这样导出后，可使用 import &#123; Demo &#125; from 'my-comp' 导入部分对象</span></span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">  install,</span><br><span class="line">  Demo,</span><br><span class="line">  tools</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// =============&gt; 组件其他文件</span></span><br><span class="line"><span class="comment">// common/helper.js</span></span><br><span class="line"><span class="keyword">import</span> GlobalConfig <span class="keyword">from</span> <span class="string">'./config'</span></span><br><span class="line"><span class="keyword">const</span> Helper = &#123;</span><br><span class="line">  <span class="comment">// 主应用 Vue 构造函数，用于组件库中动态注册组件</span></span><br><span class="line">  Vue: <span class="literal">null</span>,</span><br><span class="line">  <span class="comment">// 主应用 vm 对象(可省略)</span></span><br><span class="line">  get main() &#123;</span><br><span class="line">    <span class="keyword">return</span> GlobalConfig.main || GlobalConfig.refreshMain()</span><br><span class="line">  &#125;,</span><br><span class="line">  get exportComp () &#123;</span><br><span class="line">    <span class="keyword">return</span> Helper.Vue.prototype[GlobalConfig.exportCompKey] || &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> install = <span class="function"><span class="keyword">function</span> (<span class="params">Vue, options = &#123;&#125;</span>) </span>&#123;</span><br><span class="line">  Helper.Vue = Vue</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Helper</span><br><span class="line"></span><br><span class="line"><span class="comment">// ./config.js</span></span><br><span class="line"><span class="keyword">const</span> GlobalConfig = &#123;</span><br><span class="line">  exportCompKey: <span class="string">'exportComp'</span>,</span><br><span class="line">  <span class="comment">// 主应用 vm</span></span><br><span class="line">  main: <span class="literal">null</span>,</span><br><span class="line">  refreshMain: <span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> GlobalConfig</span><br><span class="line"></span><br><span class="line"><span class="comment">// 动态导入组件</span></span><br><span class="line">&lt;component :is=<span class="string">"mainComp"</span> /&gt;</span><br><span class="line"><span class="keyword">this</span>.mainComp = <span class="string">'mainComp'</span></span><br><span class="line"><span class="comment">// 必须使用主应用的Vue构造函数注册主应用的组件</span></span><br><span class="line"><span class="comment">// this.$sqrt.Vue.component(this.mainComp, this.$sqrt.Vue.options.components['mainComp']) // 从注册到Vue全局组件中获取</span></span><br><span class="line"><span class="keyword">this</span>.$sqrt.Vue.component(<span class="keyword">this</span>.mainComp, <span class="keyword">this</span>.exportComp[<span class="string">'mainComp'</span>]) <span class="comment">// 从Vue原型中获取</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">// 此方式存在问题：组件库中通过from vue导入的Vue对象，最终都是组件库的webpack加载vue.js中的Vue对象(vue__WEBPACK_IMPORTED_MODULE_13___default.a)到当前组件库上下文，因此后面通过Vue.component注册的组件是注册到组件库的Vue对象中了，并没有添加到主应用的Vue对象中</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">// 会打包出下面的代码</span></span><br><span class="line"><span class="comment">// vue__WEBPACK_IMPORTED_MODULE_13___default.a.component(mainComp, (function() &#123;</span></span><br><span class="line"><span class="comment">//     return &#123;</span></span><br><span class="line"><span class="comment">//         component: __webpack_require__("0f13")("./" + mainComp + ".vue")</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">// import('@/components/'...) 会转成 __webpack_require__("0f13"), 相当于再当前组件库webpack上下文查找组件源文件(业务上实际需要把主应用的组件通过在组件库中import/require动态引入)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">import Vue from 'vue'</span></span><br><span class="line"><span class="comment">Vue.component(mainComp, () =&gt; &#123;</span></span><br><span class="line"><span class="comment">  component: import('@/components/' + x.extMap.component + '.vue')</span></span><br><span class="line"><span class="comment">&#125;)</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><ul><li>主应用主要代码</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="comment">// 注册需要动态导入的组件</span></span><br><span class="line"><span class="keyword">import</span> Packages <span class="keyword">from</span> <span class="string">'./packages'</span></span><br><span class="line">Vue.use(Packages)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> vm</span><br><span class="line">Vue.use(ReportTable, &#123;</span><br><span class="line">  refreshMain: <span class="function"><span class="params">()</span> =&gt;</span> vm</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">vm = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  el: <span class="string">'#app'</span>,</span><br><span class="line">  render: <span class="function"><span class="params">h</span> =&gt;</span> h(App)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// packages.js</span></span><br><span class="line"><span class="keyword">import</span> mainComp <span class="keyword">from</span> <span class="string">'./components/mainComp.vue'</span></span><br><span class="line"><span class="keyword">const</span> install = <span class="function"><span class="keyword">function</span> (<span class="params">Vue</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// Vue.component(mainComp.name, mainComp) // 注册成Vue全局组件</span></span><br><span class="line">  Vue.prototype.exportComp = &#123; mainComp &#125; <span class="comment">// 添加到Vue原型上</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> install</span><br></pre></td></tr></table></figure><h3 id="相关问题"><a href="#相关问题" class="headerlink" title="相关问题"></a>相关问题</h3><ul><li><p>部分插件引用的模块用到了PostCSS，当<code>npm link</code>后，在主项目中启动后报错<code>Error: No PostCSS Config found</code></p><ul><li><p>在当前项目根目录下创建<code>postcss.config.js</code>，并加入配置</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    plugins: &#123;</span><br><span class="line">        autoprefixer: &#123;</span><br><span class="line">            browsers: <span class="string">'last 5 version'</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ul><h2 id="JSX使用"><a href="#JSX使用" class="headerlink" title="JSX使用"></a>JSX使用</h2><ul><li>类似的可参考<a href="#render函数(iview">render函数</a>)</li><li><p>vue的jsx语法是基于<a href="https://github.com/vuejs/babel-plugin-transform-vue-jsx" target="_blank" rel="noopener">babel-plugin-transform-vue-jsx</a>插件实现的 <a href="https://www.njleonzhang.com/2018/08/21/vue-jsx.html" target="_blank" rel="noopener">^7</a></p><p> <img src="/data/images/web/vue-jsx.png" alt="vue-jsx"></p></li><li><strong>使用vue-cli3则不需要手动安装下述babel插件即可使用</strong>(如果重复安装会报错Duplicate declaration “h”)。其他方式需要手动安装</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 非vue-cli3需要手动安装</span></span><br><span class="line">npm install babel-plugin-syntax-jsx babel-plugin-transform-vue-jsx babel-helper-vue-jsx-merge-props babel-preset-env --save-dev</span><br><span class="line"><span class="comment"># .babelrc文件中增加配置</span></span><br><span class="line"><span class="string">"plugins"</span>: [<span class="string">"transform-vue-jsx"</span>]</span><br></pre></td></tr></table></figure><ul><li>使用 <a href="https://www.njleonzhang.com/2018/08/21/vue-jsx.html" target="_blank" rel="noopener">^6</a><ul><li>babel插件会通过正则匹配的方式在编译阶段将书写在组件上属性进行分类<ul><li>onXXX的均被认为是事件，nativeOnXXX是原生事件，domPropsXXX是Dom属性，class、staticClass、style、key、ref、refInFor、slot、scopedSlots这些被认为是顶级属性，至于组件声明的props，以及html属性attrs，不需要加前缀，插件会将其统一分类到attrs属性下，然后在运行阶段根据是否在props声明来决定属性归属</li><li>不建议声明onXXX的属性</li></ul></li><li>对于原生指令，只有v-show是支持的。v-if可用(&amp;&amp; 或 ?:)代替；v-for可用array.map代替；v-model使用事件触发；自定义指令使用…解构<ul><li><code>&lt;el-input value={this.value} onInput={$event =&gt; this.value = $event} {...{ directives }}&gt;&lt;/el-input&gt;</code> (其中<code>let directives = [{ name: &#39;rt-permission&#39;, value: [&#39;manager&#39;] }]</code>)</li></ul></li><li>对于事件<ul><li>使用 <code>on-[eventName]</code> 格式, 比如 on-on-change, on-click, on-camelCaseEvent</li><li>使用 <code>on[eventName]</code> 格式，比如 onClick, onCamelCaseEvent。click-two 需要这样写 onClick-two，onClickTwo 是不对的</li><li>使用 spread 语法，即 <code>{...{on: {event: handlerFunction}}}</code></li></ul></li><li>对于样式<ul><li>如果组件中使用了scoped，则对该组件的JSX标签中的css类进行样式编写时必须添加<code>/deep/</code>等作用于穿透标识</li></ul></li></ul></li><li>示例</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// v-if使用 &amp;&amp; 代替，v-if 和 v-else 使用 ?: 代替</span></span><br><span class="line">render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">'wrapper'</span>&gt;</span><br><span class="line">            &lt;span&gt;<span class="number">123</span>&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">            &#123;</span></span><br><span class="line"><span class="regexp">                this.hello &amp;&amp; (&lt;div class='content'&gt;hello&lt;/</span>div&gt;)</span><br><span class="line">            &#125;</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">this</span>.hello2 &amp;&amp; (<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">'content'</span>&gt;</span>&#123; this.hello2 &#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ v-html的两种写法</span></span><br><span class="line"><span class="regexp">render() &#123;</span></span><br><span class="line"><span class="regexp">    return (</span></span><br><span class="line"><span class="regexp">        &lt;div&gt;</span></span><br><span class="line"><span class="regexp">            &lt;div domPropsInnerHTML=&#123; htmlVal &#125; /</span>&gt;</span><br><span class="line">            &lt;div domProps=&#123; &#123; <span class="attr">innerHTML</span>: htmlVal &#125; &#125; /&gt;</span><br><span class="line">        &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ iview 列</span></span><br><span class="line"><span class="regexp">columns: [&#123;</span></span><br><span class="line"><span class="regexp">    title: '处理人',</span></span><br><span class="line"><span class="regexp">    key: 'workerName',</span></span><br><span class="line"><span class="regexp">    width: 95,</span></span><br><span class="line"><span class="regexp">    // render (h, params) &#123;</span></span><br><span class="line"><span class="regexp">    //     此作用域的this和param类似</span></span><br><span class="line"><span class="regexp">    // &#125;,</span></span><br><span class="line"><span class="regexp">    render: (h, params) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">        // 此组件可以拿到vue组件 this</span></span><br><span class="line"><span class="regexp">        return (</span></span><br><span class="line"><span class="regexp">            &lt;FieldEdit type="select" value=&#123;params.row.worker&#125; dataList=&#123;this.projectUserList&#125; dataKey="uid" dataLabel="uname"</span></span><br><span class="line"><span class="regexp">            on-on-change=&#123;v =&gt; this.editWork('worker', v, params.row)&#125; /&gt;</span></span><br><span class="line"><span class="regexp">        )</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;]</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ v-for使用 array.map 代替</span></span><br><span class="line"><span class="regexp">render() &#123;</span></span><br><span class="line"><span class="regexp">    return (</span></span><br><span class="line"><span class="regexp">      &lt;div class='wrapper'&gt;</span></span><br><span class="line"><span class="regexp">        &lt;ul&gt;</span></span><br><span class="line"><span class="regexp">          &#123;</span></span><br><span class="line"><span class="regexp">            this.items.map(item =&gt; (</span></span><br><span class="line"><span class="regexp">              &lt;li&gt;&#123; item.name &#125;&lt;/</span>li&gt;</span><br><span class="line">            ))</span><br><span class="line">          &#125;</span><br><span class="line">        &lt;<span class="regexp">/ul&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// v-model</span></span><br><span class="line">render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;component</span><br><span class="line">            <span class="comment">// 保证value会随着this.test进行变化</span></span><br><span class="line">            value=&#123; <span class="keyword">this</span>.test &#125;</span><br><span class="line">            <span class="comment">// 保证组件的值可以传递给this.test</span></span><br><span class="line">            onInput=&#123; val =&gt; &#123; <span class="keyword">this</span>.test = val &#125; &#125;</span><br><span class="line">        &gt;</span><br><span class="line">        &lt;<span class="regexp">/component&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ iview的部分组件，此时只能使用下划线，如：Button需要是i-button，Tag=&gt;tag。更多见官网</span></span><br><span class="line"><span class="regexp">&#123;</span></span><br><span class="line"><span class="regexp">    title: '计划日期',</span></span><br><span class="line"><span class="regexp">    key: 'planTm',</span></span><br><span class="line"><span class="regexp">    render: (h, params) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">        return (</span></span><br><span class="line"><span class="regexp">            &lt;date-picker type="date" value=&#123; params.row.planTm &#125; on-on-change=&#123; v =&gt; &#123; this.planTm = v &#125; &#125; /</span>&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 属性</span></span><br><span class="line"><span class="keyword">return</span> (</span><br><span class="line">    &lt;span &#123;...&#123;</span><br><span class="line">        style: &#123; <span class="attr">color</span>: color &#125;,</span><br><span class="line">        <span class="comment">// HTML其他属性</span></span><br><span class="line">        attrs: &#123;</span><br><span class="line">            title: <span class="string">'鼠标悬停标题'</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;&#125;&gt;&#123; msg &#125;&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">)</span></span><br></pre></td></tr></table></figure><h3 id="render函数"><a href="#render函数" class="headerlink" title="render函数"></a>render函数</h3><ul><li><a href="https://cn.vuejs.org/v2/guide/render-function.html" target="_blank" rel="noopener">参考vue render属性</a></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Vue.component(<span class="string">'anchored-heading'</span>, &#123;</span><br><span class="line">  <span class="comment">// render 可代替 template 的 dom 节点</span></span><br><span class="line">  <span class="comment">// template: '#div',</span></span><br><span class="line">  render: <span class="function"><span class="keyword">function</span> (<span class="params">createElement</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> createElement(</span><br><span class="line">      <span class="string">'h'</span> + <span class="keyword">this</span>.level,   <span class="comment">// 标签名称</span></span><br><span class="line">      <span class="keyword">this</span>.$slots.default <span class="comment">// 子节点数组</span></span><br><span class="line">    )</span><br><span class="line">  &#125;,</span><br><span class="line">  props: &#123;</span><br><span class="line">    level: &#123;</span><br><span class="line">      type: <span class="built_in">Number</span>,</span><br><span class="line">      required: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ul><li>render 语法(iview案例)</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 语法</span></span><br><span class="line">render: <span class="function">(<span class="params">h, &#123;params | param&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="comment">// 此时params中包含row、column和index; param就是row</span></span><br><span class="line">    <span class="comment">// 如果是非文本元素，如需要继续渲染子元素的，第三个参数需要使用数组接收</span></span><br><span class="line">	<span class="keyword">return</span> h(<span class="string">"定义元素标签/Vue对象标签"</span>, &#123; 元素性质 &#125;, <span class="string">"元素内容"</span>/[元素内容])</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2个参数的情况</span></span><br><span class="line">    <span class="keyword">return</span> h(<span class="string">"定义的元素"</span>, &#123; 元素性质 &#125;)</span><br><span class="line">	<span class="keyword">return</span> h(<span class="string">"定义的元素"</span>, <span class="string">"元素的内容"</span>/[元素的内容])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 示例</span></span><br><span class="line">render: <span class="function">(<span class="params">h, params</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="comment">// 如果在表格的列中使用，此时params中包含row、column和index，分别指当前单元格数据，当前列数据，当前是第几行。</span></span><br><span class="line">	<span class="keyword">return</span> h(<span class="string">'div'</span>, &#123;</span><br><span class="line">		style:&#123;<span class="attr">width</span>:<span class="string">'100px'</span>, <span class="attr">height</span>:<span class="string">'100px'</span>, <span class="attr">background</span>:<span class="string">'#ccc'</span>&#125;</span><br><span class="line">	&#125;, <span class="string">'用户名：smalle'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 案例2</span></span><br><span class="line">    <span class="keyword">return</span> h(<span class="string">"div"</span>, [</span><br><span class="line">        h(<span class="string">"Button"</span>, &#123;&#125;, <span class="string">"重登"</span>)</span><br><span class="line">    ])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 写法优化1</span></span><br><span class="line">&#123;</span><br><span class="line">	title:<span class="string">'操作'</span>,</span><br><span class="line">	align: <span class="string">'center'</span>,</span><br><span class="line">	render: <span class="function">(<span class="params">h, params</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> row = params.row</span><br><span class="line">        <span class="keyword">let</span> that = <span class="keyword">this</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> editButtonAttr = &#123;</span><br><span class="line">            <span class="comment">// vue3使用onClick</span></span><br><span class="line">            on: &#123;</span><br><span class="line">                click: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">                    that.edit(row)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// vue3使用修饰符</span></span><br><span class="line">            <span class="comment">// import &#123; withModifiers &#125; from 'vue'</span></span><br><span class="line">            onClick: withModifiers(<span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;, [<span class="string">'stop'</span>, <span class="string">'prevent'</span>])</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> editButton = h(<span class="string">'Button'</span>, editButtonAttr, <span class="string">'编辑'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> h(<span class="string">'div'</span>, [editButton])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 写法优化2</span></span><br><span class="line">&#123;</span><br><span class="line">	title:<span class="string">'操作'</span>,</span><br><span class="line">	align: <span class="string">'center'</span>,</span><br><span class="line">    render: <span class="function">(<span class="params">h, params</span>) =&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">let</span> that = <span class="keyword">this</span></span><br><span class="line">        <span class="keyword">return</span> h(<span class="string">'div'</span>, that.getEditButton(h, params.row)) <span class="comment">// getEditButton定义省略</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>vue的data对象对应属性</li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  // 其他特殊顶层属性</span><br><span class="line">  key: 'myKey',</span><br><span class="line">  ref: 'myRef',</span><br><span class="line">  // 和`v-bind:class`一样的 API</span><br><span class="line">  // class: 'class-name'</span><br><span class="line">  'class': &#123;</span><br><span class="line">    foo: true,</span><br><span class="line">    bar: false</span><br><span class="line">  &#125;,</span><br><span class="line">  // 和`v-bind:style`一样的 API</span><br><span class="line">  style: &#123;</span><br><span class="line">    color: 'red',</span><br><span class="line">    fontSize: '14px',</span><br><span class="line">    paddingRight: '10px'</span><br><span class="line">  &#125;,</span><br><span class="line">  // 正常的 HTML 特性</span><br><span class="line">  attrs: &#123;</span><br><span class="line">    id: 'foo'</span><br><span class="line">  &#125;,</span><br><span class="line">  // 组件 props</span><br><span class="line">  props: &#123;</span><br><span class="line">    myProp: 'bar'</span><br><span class="line">  &#125;,</span><br><span class="line">  // DOM 属性</span><br><span class="line">  domProps: &#123;</span><br><span class="line">    innerHTML: 'baz'</span><br><span class="line">  &#125;,</span><br><span class="line">  // 事件监听器基于 `on`</span><br><span class="line">  // 所以不再支持如 `v-on:keyup.enter` 修饰器</span><br><span class="line">  // 需要手动匹配 keyCode。</span><br><span class="line">  on: &#123;</span><br><span class="line">    click: this.clickHandler</span><br><span class="line">  &#125;,</span><br><span class="line">  // 仅对于组件，用于监听原生事件，而不是组件内部使用 `vm.$emit` 触发的事件。</span><br><span class="line">  nativeOn: &#123;</span><br><span class="line">    click: this.nativeClickHandler</span><br><span class="line">  &#125;,</span><br><span class="line">  // 自定义指令。注意事项：必须是全局指令；不能对绑定的旧值设值</span><br><span class="line">  directives: [</span><br><span class="line">    &#123;</span><br><span class="line">      // 如果在标签上使用是 v-permission，此时需要省略 v-</span><br><span class="line">      name: 'permission',</span><br><span class="line">      value: ['Button_Report_Manage']</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      name: 'my-custom-directive',</span><br><span class="line">      value: '2',</span><br><span class="line">      expression: '1 + 1',</span><br><span class="line">      arg: 'foo',</span><br><span class="line">      modifiers: &#123;</span><br><span class="line">        bar: true</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  // Scoped slots in the form of</span><br><span class="line">  // &#123; name: props =&gt; VNode | Array&lt;VNode&gt; &#125;</span><br><span class="line">  scopedSlots: &#123;</span><br><span class="line">    default: props =&gt; createElement('span', props.text)</span><br><span class="line">  &#125;,</span><br><span class="line">  // 如果组件是其他组件的子组件，需为插槽指定名称</span><br><span class="line">  slot: 'name-of-slot'</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>iview示例：此时Poptip和Tag都是Vue对象，因此要设置参数props</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 调用组件并监听事件</span></span><br><span class="line">&lt;MyComponent @my-event=<span class="string">"myEvent"</span>/&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 组件内部渲染</span></span><br><span class="line">render: <span class="function">(<span class="params">h, params</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 也 render 一个自定义的组件</span></span><br><span class="line">	<span class="keyword">return</span> h(<span class="string">'Poptip'</span>, &#123;</span><br><span class="line">		props: &#123;</span><br><span class="line">			trigger: <span class="string">'hover'</span>,</span><br><span class="line">			title: params.row.name + <span class="string">'的信息'</span>,</span><br><span class="line">			placement: <span class="string">'bottom'</span>,</span><br><span class="line">            transfer: <span class="literal">true</span></span><br><span class="line">            <span class="comment">// confirm: true</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// on: &#123;</span></span><br><span class="line">        <span class="comment">//     'on-ok': () =&gt; &#123;</span></span><br><span class="line">        <span class="comment">//         this.confirm()</span></span><br><span class="line">        <span class="comment">//     &#125;</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line">	&#125;, [</span><br><span class="line">        <span class="comment">// Poptip-Tag</span></span><br><span class="line">		h(<span class="string">'Tag'</span>, &#123;</span><br><span class="line">			<span class="comment">// 此处必须写在props里面，不能直接将组件属性放在元素性质里面</span></span><br><span class="line">			props: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">				<span class="keyword">const</span> color = params.index == <span class="number">1</span> ? <span class="string">'red'</span> : params.index == <span class="number">3</span> ? <span class="string">'green'</span> : <span class="string">''</span>;</span><br><span class="line">				<span class="keyword">const</span> props = &#123;</span><br><span class="line">					type: <span class="string">"dot"</span>,</span><br><span class="line">					color: color</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">return</span> color == <span class="string">''</span> ? &#123;&#125; : props</span><br><span class="line">			&#125;()</span><br><span class="line">		&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">vm</span>) </span>&#123;</span><br><span class="line">			<span class="comment">// 此时this为函数作用域类，拿不到vue对象，通过vm传递</span></span><br><span class="line">			<span class="built_in">console</span>.log(vm)</span><br><span class="line">			<span class="keyword">return</span> params.row.CorporateName + <span class="string">'...'</span></span><br><span class="line">        &#125;(<span class="keyword">this</span>)),</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Poptip-xxx</span></span><br><span class="line">        (<span class="function"><span class="keyword">function</span>(<span class="params">vm</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> params.row.content</span><br><span class="line">        &#125;(<span class="keyword">this</span>)),</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Poptip-div</span></span><br><span class="line">		h(<span class="string">'div'</span>, &#123;</span><br><span class="line">			slot: <span class="string">'content'</span></span><br><span class="line">		&#125;, [</span><br><span class="line">			h(<span class="string">'p'</span>, &#123;</span><br><span class="line">				style: &#123;</span><br><span class="line">					padding: <span class="string">'4px'</span></span><br><span class="line">				&#125;</span><br><span class="line">			&#125;, <span class="string">'用户名：'</span> + params.row.name)</span><br><span class="line">        ]),</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Poptip-div</span></span><br><span class="line">		<span class="keyword">return</span> h(<span class="string">"div"</span>, [</span><br><span class="line">			h(<span class="string">"Button"</span>, &#123;</span><br><span class="line">				props: &#123;</span><br><span class="line">					type: <span class="string">"info"</span>,</span><br><span class="line">					size: <span class="string">"small"</span></span><br><span class="line">                &#125;,</span><br><span class="line">                class: 'class-name'</span><br><span class="line">				style: &#123;</span><br><span class="line">                    marginRight: <span class="string">"8px"</span>,</span><br><span class="line">                    <span class="comment">// 控制此按钮是否可见</span></span><br><span class="line">                    display: params.row.statsu == <span class="string">'Y'</span> ? <span class="string">'inline-block'</span> : <span class="string">'none'</span></span><br><span class="line">				&#125;,</span><br><span class="line">				attrs: &#123;</span><br><span class="line">					<span class="comment">// button 标签的其他属性</span></span><br><span class="line">				&#125;,</span><br><span class="line">				on: &#123;</span><br><span class="line">					click: <span class="function"><span class="params">ok</span> =&gt;</span> &#123;</span><br><span class="line">						<span class="comment">// 触发事件</span></span><br><span class="line">						<span class="keyword">this</span>.$emit(<span class="string">"my-event"</span>, params);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">"重登"</span>)</span><br><span class="line">		])</span><br><span class="line">	])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>报错 You may have an infinite update loop in a component render function<ul><li>参考：<a href="https://www.itread01.com/content/1541599683.html" target="_blank" rel="noopener">https://www.itread01.com/content/1541599683.html</a></li><li><code>render method is triggered whenever any state changes</code> vue组件中任何属性改变致使render函数重新执行。如果在模板中直接修改vue属性或调用的方法中修改了属性(如双括号中，而@click等事件中是可以修改vue属性的)，就会导致重新render。从而产生<strong>render - 属性改变 - render</strong>无限循环</li></ul></li></ul><h2 id="Vue对Typescript的支持"><a href="#Vue对Typescript的支持" class="headerlink" title="Vue对Typescript的支持"></a>Vue对Typescript的支持</h2><ul><li>参考<a href="/_posts/web/typescript.md#Vue结合Typescript">typescript.md#Vue结合Typescript</a></li></ul><h2 id="VueRouter路由"><a href="#VueRouter路由" class="headerlink" title="VueRouter路由"></a>VueRouter路由</h2><blockquote><p><a href="https://yuchengkai.cn/blog/2018-07-27.html" target="_blank" rel="noopener">https://yuchengkai.cn/blog/2018-07-27.html</a> 源码解析</p></blockquote><h3 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h3><ul><li>路由生命周期见上文</li><li><code>query</code>和<code>params</code>的区别<ul><li>query参数会拼接到url上面，param不会</li><li>params的参数值可以赋值给路由路径中的动态参数。因此使用params时路由跳转后再次刷新页面会导致参数丢失($router.go也会丢失params参数)</li></ul></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.$router.push(&#123;</span><br><span class="line">    name: <span class="string">"VisitInfo"</span>,</span><br><span class="line">    query: <span class="built_in">Object</span>.assign(&#123;&#125;, contact, &#123;</span><br><span class="line">        visitId: <span class="keyword">this</span>.visitId</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ul><li>redirect</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    path: <span class="string">'/base_info/*'</span>,</span><br><span class="line">    name: <span class="string">'基础信息'</span>,</span><br><span class="line">    <span class="comment">// 可以接受函数</span></span><br><span class="line">    redirect: <span class="function"><span class="params">to</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(to.path)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><ul><li><code>$route</code>和<code>$router</code>区别<ul><li><code>$route</code>为当前路由，为vue内置</li><li><code>$router</code>为路由管理器(全局的)，一般在main.js中new Vue()时挂载</li></ul></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  computed: &#123;</span><br><span class="line">    username () &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.$route.params.username</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    goBack () &#123;</span><br><span class="line">      <span class="built_in">window</span>.history.length &gt; <span class="number">1</span> ? <span class="keyword">this</span>.$router.go(<span class="number">-1</span>) : <span class="keyword">this</span>.$router.push(<span class="string">'/'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>push和replace的区别<ul><li>编程式<code>router.push(...)</code>和声明式<code>&lt;router-link :to=&quot;...&quot;&gt;</code>类似，都是往 history 栈添加一个新的记录，所以，当用户点击浏览器后退按钮时，则回到之前的 URL</li><li><code>router.replace(...)</code>和<code>&lt;router-link :to=&quot;...&quot; replace&gt;</code>类似，它们不会向 history 添加新记录，而是替换掉当前的 history 记录</li><li><code>router.go(n)</code>类似<code>window.history.go(n)</code></li></ul></li><li>动态路由、嵌套路由、<code>&lt;router-view /&gt;</code><ul><li>实现嵌套路由有两个要点：在组件内部使用<code>&lt;router-view /&gt;</code>标签、VueRouter 的参数中使用 children 配置</li><li>嵌套路由（<a href="https://router.vuejs.org/zh/guide/essentials/nested-routes.html）" target="_blank" rel="noopener">https://router.vuejs.org/zh/guide/essentials/nested-routes.html）</a></li></ul></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=<span class="string">"app"</span>&gt;</span><br><span class="line">  &lt;router-view&gt;<span class="xml"><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 此时由于visit_info基于Mobile的，因此Mobile中必须要有一个路由出口(&lt;router-view /&gt;)来展示visit_info。即表示含有children属性的组件(Mobile)的template中必须要有一个&lt;router-view /&gt;</span></span><br><span class="line"><span class="keyword">const</span> routers = [&#123;</span><br><span class="line">  <span class="comment">// 访问 /m 时，会将Mobile渲染到app的router-view中，相当于渲染顶级组件</span></span><br><span class="line">  path: <span class="string">"/m"</span>,</span><br><span class="line">  name: <span class="string">"mobile"</span>,</span><br><span class="line">  component: Mobile,</span><br><span class="line">  children: [&#123;</span><br><span class="line">    <span class="comment">// 当访问 /m/visit/info/1 时，会将visit_info.vue渲染到其父组件(Mobile)的router-view中，因此此时Mobile需要有一个&lt;router-view /&gt;的出口</span></span><br><span class="line">    <span class="comment">// 如果父组件中没有router-view路由出口，则此子组件将无妨成功created；且只有当路由到此子路径时，才会开始创建此子组件(仅访问父路径不会创建子组件)</span></span><br><span class="line">    path: <span class="string">"visit/info/:info_id"</span>, <span class="comment">// path带/表示绝对路径。此时不带/。要通过name=visit_info路由(且路由params参数中info_id=1)进来时，url会自动变成/m/visit/info/1</span></span><br><span class="line">    name: <span class="string">"visit_info"</span>,</span><br><span class="line">    meta: &#123;</span><br><span class="line">      title: <span class="string">"拜访编辑"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    component: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">"@/views/mobile/visit_info.vue"</span>),</span><br><span class="line">    <span class="comment">// props: true, // 将参数(info_id)传递到组件的prop</span></span><br><span class="line">    props: <span class="function"><span class="params">route</span> =&gt;</span> (&#123; <span class="attr">id</span>: route.query.info_id &#125;) <span class="comment">// 传递参数给组件</span></span><br><span class="line">  &#125;]</span><br><span class="line">&#125;]</span><br></pre></td></tr></table></figure><ul><li>路由懒加载(当打包构建应用时，Javascript 包会变得非常大，影响页面加载速度)<ul><li><a href="https://router.vuejs.org/zh/guide/advanced/lazy-loading.html" target="_blank" rel="noopener">https://router.vuejs.org/zh/guide/advanced/lazy-loading.html</a></li><li><a href="https://panjiachen.github.io/vue-element-admin-site/zh/guide/advanced/lazy-loading.html" target="_blank" rel="noopener">https://panjiachen.github.io/vue-element-admin-site/zh/guide/advanced/lazy-loading.html</a></li></ul></li><li><code>router.addRoute</code> 动态添加路由，如果该路由规则有 name，并且已经存在一个与之相同的名字，则会覆盖它</li></ul><h3 id="路由变化页面数据不刷新"><a href="#路由变化页面数据不刷新" class="headerlink" title="路由变化页面数据不刷新"></a>路由变化页面数据不刷新</h3><ul><li>参考上文【父子组件加载】中的示例，监控<code>$route</code>变化</li></ul><blockquote><p>官方说明 <a href="https://router.vuejs.org/zh/guide/essentials/dynamic-matching.html#%E5%93%8D%E5%BA%94%E8%B7%AF%E7%94%B1%E5%8F%82%E6%95%B0%E7%9A%84%E5%8F%98%E5%8C%96" target="_blank" rel="noopener">https://router.vuejs.org/zh/guide/essentials/dynamic-matching.html#%E5%93%8D%E5%BA%94%E8%B7%AF%E7%94%B1%E5%8F%82%E6%95%B0%E7%9A%84%E5%8F%98%E5%8C%96</a></p></blockquote><ul><li>当使用路由参数时，例如参数 <code>/user/:username</code>，且从 /user/foo 导航到 /user/bar，原来的组件实例会被复用<ul><li>因为两个路由都渲染同个组件(User)，比起销毁再创建，复用则显得更加高效</li><li>不过这也意味着组件的生命周期钩子(如created)不会再被调用</li><li>但是两个路径显示的data数据是缓存两份，不会覆盖</li></ul></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter(&#123;</span><br><span class="line">  routes: [</span><br><span class="line">    <span class="comment">// 动态路径参数，以冒号开头，通过route.params.userId传递参数。从路由中获取的参数均为字符串，Id一般需要通过Number()转换一下，防止后面 === 比较不正确，新增可用0</span></span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">'/user/:userId'</span>, <span class="attr">component</span>: User &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 解决办法(都会看到之前的数据突然刷新成了新的数据)。根据路由获取数据：https://router.vuejs.org/zh/guide/advanced/data-fetching.html</span></span><br><span class="line"><span class="keyword">const</span> User = &#123;</span><br><span class="line">    template: <span class="string">'...'</span>,</span><br><span class="line">    watch: &#123;</span><br><span class="line">        <span class="comment">// 观测 $route 时组件第一次创建和挂载都不会监测(触发)到，因此需要和created/mounted等结合使用</span></span><br><span class="line">        <span class="comment">// 只要此组件在声明周期中就会，此方法就会一致监测到变化并执行逻辑(尽管此组件的元素没有显示在浏览器中也会如此)</span></span><br><span class="line">        <span class="comment">// 单引号可以省略</span></span><br><span class="line">        <span class="string">'$route'</span> (to, <span class="keyword">from</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (to.name == <span class="string">"XXX"</span>) &#123;</span><br><span class="line">                <span class="comment">// 对路由变化作出响应...</span></span><br><span class="line">                <span class="keyword">this</span>.init();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 页面路由钩子(还有全局路由钩子)：https://router.vuejs.org/guide/advanced/navigation-guards.html</span></span><br><span class="line">    beforeRouteEnter (to, <span class="keyword">from</span>, next) &#123;</span><br><span class="line">        <span class="comment">// 在渲染该组件的对应路由被 confirm 前调用，不！能！获取组件实例 `this`，因为当守卫执行前，组件实例还没被创建</span></span><br><span class="line">        <span class="comment">// don't forget to call next()，下同</span></span><br><span class="line">        next(<span class="function"><span class="params">vm</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// vm === this; mounted了之后才会调用next</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    beforeRouteUpdate (to, <span class="keyword">from</span>, next) &#123;</span><br><span class="line">        <span class="comment">// 在当前路由改变，但是该组件被复用时调用</span></span><br><span class="line">        <span class="comment">// 举例来说，对于一个带有动态参数的路径 /foo/:id，在 /foo/1 和 /foo/2 之间跳转的时候，由于会渲染同样的 Foo 组件，因此组件实例会被复用。而这个钩子就会在这个情况下被调用。</span></span><br><span class="line">        <span class="comment">// 可以访问组件实例 `this`</span></span><br><span class="line">    &#125;,</span><br><span class="line">    beforeRouteLeave (to, <span class="keyword">from</span>, next) &#123;</span><br><span class="line">        <span class="comment">// 导航离开该组件的对应路由时调用</span></span><br><span class="line">        <span class="comment">// 可以访问组件实例 `this`</span></span><br><span class="line">    &#125;,</span><br><span class="line">    created() &#123;</span><br><span class="line">        <span class="keyword">this</span>.init()</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">        init() &#123;</span><br><span class="line">            <span class="keyword">this</span>.userId = <span class="built_in">Number</span>(<span class="keyword">this</span>.$route.params.userId)</span><br><span class="line">            <span class="keyword">this</span>.fetchData()</span><br><span class="line">        &#125;,</span><br><span class="line">        fetchData() &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="hash和history路由模式"><a href="#hash和history路由模式" class="headerlink" title="hash和history路由模式"></a>hash和history路由模式</h3><ul><li>为了构建 SPA(单页面应用)，需要引入前端路由系统，这也就是 Vue-Router 存在的意义。前端路由的核心，就在于改变视图的同时不会向后端发出请求。为了达到这种目的，浏览器当前提供了hash和history两种支持模式，Vue-Router是基于此两者特性完成 <a href="https://juejin.im/post/5b4ca076f265da0f900e0a7d" target="_blank" rel="noopener">^4</a><ul><li><code>hash</code>：即地址栏 URL 中的 <code>#</code> 符号(此 hash 不是密码学里的散列运算)。比如这个 URL：<a href="http://www.abc.com/#/hello，hash" target="_blank" rel="noopener">http://www.abc.com/#/hello，hash</a> 的值为 #/hello。它的特点在于：hash 虽然出现在 URL 中，但不会被包括在 HTTP 请求中，对后端完全没有影响，因此改变 hash 不会重新加载页面</li><li><code>history</code>：利用了 HTML5 History Interface 中新增的 <code>pushState()</code> 和 <code>replaceState()</code> 方法。<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/History" target="_blank" rel="noopener">支持的浏览器(IE=10)</a>。这两个方法应用于浏览器的历史记录栈，在当前已有的 back、forward、go 的基础之上，它们提供了对历史记录进行修改的功能。只是当它们执行修改时，虽然改变了当前的 URL，但浏览器不会立即向后端发送请求</li></ul></li><li>Vue-Router使用对比<ul><li>hash模式<ul><li>前进、后退、刷新均不会请求后端，仅刷新路由</li><li>缺点：Url中带有<code>#</code>号，nginx同域名多项目配置不支持</li><li>router.beforeEach 中执行 next({..from}) 跳转后，不会执行afterEach()；而history模式会在执行一次beforeEach后执行afterEach。参考 <a href="https://www.okcode.net/article/70038" target="_blank" rel="noopener">https://www.okcode.net/article/70038</a></li></ul></li><li>history模式<ul><li>前进、后退不会请求后端，<strong>但是刷新、f5会请求后端</strong>(nginx)，如果后端无浏览器地址栏中的路径则会404</li><li>缺点：需要浏览器支持(IE=10)，刷新可能会出404</li></ul></li><li>两种模式对于router.push、replace、go的效果一致</li></ul></li><li>history模式使用(<a href="https://router.vuejs.org/zh/guide/essentials/history-mode.html" target="_blank" rel="noopener">https://router.vuejs.org/zh/guide/essentials/history-mode.html</a>)</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 开启history模式</span></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router(&#123;</span><br><span class="line">  <span class="comment">// 路由的基础路径，类似publicPath。只不过publicPath是针对静态文件，而此处是将&lt;router-link&gt;中的路径添加此基础路径</span></span><br><span class="line">  <span class="comment">// base: '/my-app/', // 多环境配置时可自定义变量(VUE_APP_BASE_URL = /my-app/)到 .env.xxx 文件中，如：publicPath: process.env.VUE_APP_VUE_ROUTER_BASE</span></span><br><span class="line">  routes,</span><br><span class="line">  mode: <span class="string">'history'</span> <span class="comment">// 默认为hash模式</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如后端nginx服务器配置</span></span><br><span class="line">location / &#123;</span><br><span class="line">  try_files $uri $uri/ <span class="regexp">/index.html;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="刷新页面"><a href="#刷新页面" class="headerlink" title="刷新页面"></a>刷新页面</h3><ul><li>参考：<a href="https://segmentfault.com/a/1190000019635080" target="_blank" rel="noopener">https://segmentfault.com/a/1190000019635080</a></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 添加组件src/views/redirect.vue --&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  created () &#123;</span><br><span class="line">    const &#123; params, query &#125; = this.$route</span><br><span class="line">    const &#123; path &#125; = params</span><br><span class="line">    this.$router.replace(&#123;</span><br><span class="line">      path: &apos;/&apos; + path,</span><br><span class="line">      query</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  render: function (h) &#123;</span><br><span class="line">    return h()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 添加路由 --&gt;</span><br><span class="line">&#123;</span><br><span class="line">    path: &apos;/redirect/:path*&apos;,</span><br><span class="line">    name: &apos;redirect&apos;,</span><br><span class="line">    component: () =&gt; import(&apos;@/views/redirect&apos;),</span><br><span class="line">    hidden: true</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;!-- 自定义刷新方法 --&gt;</span><br><span class="line">refresh () &#123;</span><br><span class="line">    const &#123; fullPath &#125; = this.$route</span><br><span class="line">    this.$router.replace(&#123;</span><br><span class="line">        path: &apos;/redirect&apos; + fullPath</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="打开新页面"><a href="#打开新页面" class="headerlink" title="打开新页面"></a>打开新页面</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 可结合下文vue-contextmenujs插件实现右键打开新标签</span></span><br><span class="line">open() &#123;</span><br><span class="line">    <span class="keyword">let</span> route = <span class="keyword">this</span>.$router.resolve(&#123;</span><br><span class="line">        path: <span class="string">"/open"</span>, <span class="comment">// 也可使用name或传入整个route</span></span><br><span class="line">        query: &#123;<span class="attr">id</span>: <span class="number">96</span>&#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="built_in">window</span>.open(route.href, <span class="string">'_blank'</span>)</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 通过提示框渲染一个链接处理打开新标签页</span></span><br><span class="line">getInfo() &#123;</span><br><span class="line">    <span class="keyword">this</span>.$Modal.info(&#123;</span><br><span class="line">        title: <span class="string">'提示'</span>,</span><br><span class="line">        render: <span class="function">(<span class="params">h</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> h(<span class="string">'a'</span>, &#123;</span><br><span class="line">                on: &#123;</span><br><span class="line">                    click: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">                        <span class="keyword">let</span> route = <span class="keyword">this</span>.$router.resolve(&#123;</span><br><span class="line">                        path: <span class="string">'/test/new'</span>,</span><br><span class="line">                            query: &#123;</span><br><span class="line">                                name: <span class="string">'test'</span></span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;)</span><br><span class="line">                        <span class="built_in">window</span>.open(route.href, <span class="string">'_blank'</span>)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, <span class="string">'打开新标签页'</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="子模块路由案例-iview-admin为例"><a href="#子模块路由案例-iview-admin为例" class="headerlink" title="子模块路由案例(iview-admin为例)"></a>子模块路由案例(iview-admin为例)</h3><ul><li>隐藏菜单</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 路由</span></span><br><span class="line">&#123;</span><br><span class="line">    path: <span class="string">'/base'</span>,</span><br><span class="line">    name: <span class="string">'base'</span>,</span><br><span class="line">    component: Main,</span><br><span class="line">    meta: &#123;</span><br><span class="line">      access: [],</span><br><span class="line">      icon: <span class="string">'md-people'</span>,</span><br><span class="line">      showAlways: <span class="literal">true</span>,</span><br><span class="line">      title: <span class="string">'客户管理'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    icon: <span class="string">'md-home'</span>,</span><br><span class="line">    children: [</span><br><span class="line">      &#123; <span class="attr">name</span>: <span class="string">'customer'</span>, <span class="attr">path</span>: <span class="string">'customer'</span>, <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">'客户管理'</span> &#125;, <span class="attr">component</span>: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'@/views/customer/CustomerList'</span>) &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        name: <span class="string">'customerInfo'</span>,</span><br><span class="line">        path: <span class="string">'customer/customerInfo/:customerId'</span>,</span><br><span class="line">        meta: &#123; <span class="attr">title</span>: <span class="string">'客户信息'</span>, <span class="attr">hideInMenu</span>: <span class="literal">true</span> &#125;, <span class="comment">// iview-admin中hideInMenu为隐藏菜单</span></span><br><span class="line">        component: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'@/views/customer/CustomerInfo.vue'</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 路由跳转</span></span><br><span class="line"><span class="keyword">this</span>.$router.push(&#123;</span><br><span class="line">    name: <span class="string">'customerInfo'</span>,</span><br><span class="line">    params: &#123;</span><br><span class="line">        customerId: <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ul><li>子组件路由(嵌套路由，参考上文)</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 路由</span></span><br><span class="line">&#123;</span><br><span class="line">    path: <span class="string">'/workspace'</span>,</span><br><span class="line">    name: <span class="string">''</span>,</span><br><span class="line">    component: Main, <span class="comment">// Main为iview-admin的基础组件，组件内包含一个router-view出口来展示下面的children</span></span><br><span class="line">    children: [</span><br><span class="line">      &#123;</span><br><span class="line">        path: <span class="string">'project/:projectId'</span>,</span><br><span class="line">        name: <span class="string">'project'</span>,</span><br><span class="line">        component: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'@/view/workspace/project/project-index.vue'</span>), <span class="comment">// 组件内必须包含一个router-view出口来展示下面的children</span></span><br><span class="line">        children: [</span><br><span class="line">          &#123;</span><br><span class="line">            path: <span class="string">'workbench/:levelId'</span>,</span><br><span class="line">            name: <span class="string">'workbench'</span>,</span><br><span class="line">            component: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'@/view/workspace/project/workbench/workbench-index.vue'</span>), <span class="comment">// 组件内必须包含一个router-view出口来展示下面的children</span></span><br><span class="line">            children: [</span><br><span class="line">              &#123;</span><br><span class="line">                path: <span class="string">'work-level/:workLevelId'</span>,</span><br><span class="line">                name: <span class="string">'work-edit'</span>,</span><br><span class="line">                component: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'@/view/workspace/project/workbench/work/work-edit.vue'</span>)</span><br><span class="line">              &#125;</span><br><span class="line">            ]</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            path: <span class="string">'document'</span>,</span><br><span class="line">            name: <span class="string">'document'</span>,</span><br><span class="line">            meta: &#123;</span><br><span class="line">              title: <span class="function"><span class="params">route</span> =&gt;</span> <span class="string">`<span class="subst">$&#123;route.params.name&#125;</span>`</span></span><br><span class="line">            &#125;,</span><br><span class="line">            component: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'@/view/workspace/project/document/document-index.vue'</span>)</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// project-index.vue包含下列代码。workbench-index.vue同理</span></span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"project-info"</span>&gt;</span><br><span class="line">    &lt;keep-alive&gt;</span><br><span class="line">        &lt;router-view /&gt;</span><br><span class="line">    &lt;<span class="regexp">/keep-alive&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>div&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 路由跳转</span></span><br><span class="line"><span class="keyword">this</span>.$router.push(&#123;</span><br><span class="line">    name: <span class="string">'work-edit'</span>,</span><br><span class="line">    params: &#123;</span><br><span class="line">        projectId: <span class="number">1</span>,</span><br><span class="line">        levelId: <span class="number">1</span>,</span><br><span class="line">        workLevelId: <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="数据库动态路由"><a href="#数据库动态路由" class="headerlink" title="数据库动态路由"></a>数据库动态路由</h3><ul><li>数据库以路由格式存储json</li><li>前端初始化时，默认路由设置成空，或者添加几个静态路由(如403/404等页面)</li><li>用户登录后，通过<code>addRoutes</code>动态将路由项添加到路由对象中，并存储路由数组到Vuex防止重复添加</li><li>用户退出登录后，重置路由对象(重新new一个路由对象)</li></ul><h2 id="Vuex"><a href="#Vuex" class="headerlink" title="Vuex"></a>Vuex</h2><ul><li><a href="https://vuex.vuejs.org/zh/" target="_blank" rel="noopener">Vuex</a></li><li>刷新浏览器地址会导致vuex的state状态丢失，一般是默认给state的相应属性赋值Cookie的值或者在使用的地方通过Cookie重新获</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Cookies <span class="keyword">from</span> <span class="string">'js-cookie'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> user = &#123;</span><br><span class="line">  <span class="comment">// 开启严格模式，仅需在创建 store 的时候传入 strict: true。在严格模式下，无论何时发生了状态变更且不是由 mutation 函数引起的，将会抛出错误</span></span><br><span class="line">  strict: process.env.NODE_ENV !== <span class="string">'production'</span></span><br><span class="line">  <span class="comment">// 状态</span></span><br><span class="line">  <span class="comment">// this.$store.state.name 或 this.$store.user.state.name(被嵌入到modules)</span></span><br><span class="line">  state: &#123;</span><br><span class="line">    token: Cookies.get(<span class="string">'X-Token'</span>), <span class="comment">// 刷新浏览器后，初始化时数据线从Cookies中获取</span></span><br><span class="line">    name: <span class="string">''</span>, <span class="comment">// 刷新浏览器数据会丢失</span></span><br><span class="line">    info: Cookies.get(<span class="string">'info'</span>) ? <span class="built_in">JSON</span>.parse(Cookies.get(<span class="string">'info'</span>)) : &#123;&#125; <span class="comment">// Cookies获取的是字符串，需要转换</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// this.$store.getters.username 即可访问</span></span><br><span class="line">  getters: &#123;</span><br><span class="line">    username: <span class="function"><span class="params">state</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> state.info.username</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 更改 Vuex 的 store 中的状态的唯一方法是提交 mutation。它会接受 state 作为第一个参数</span></span><br><span class="line">  <span class="comment">// **同步调用**：this.$store.commit('SET_TOKEN', 'my-token-xxx')</span></span><br><span class="line">  mutations: &#123;</span><br><span class="line">    SET_TOKEN: <span class="function">(<span class="params">state, token</span>) =&gt;</span> &#123;</span><br><span class="line">      state.token = token</span><br><span class="line">      <span class="comment">// this.commit('SET_NAME', 'hello') // 内部调用</span></span><br><span class="line">      <span class="comment">// this.dispatch('Login', &#123;&#125;) // 内部调用</span></span><br><span class="line">    &#125;,</span><br><span class="line">    SET_NAME: <span class="function">(<span class="params">state, name</span>) =&gt;</span> &#123;</span><br><span class="line">      state.name = name</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// Action 类似于 mutation，不同在于：Action 提交的是 mutation，而不是直接变更状态；Action 可以包含任意异步操作</span></span><br><span class="line">  <span class="comment">// **异步调用**：this.$store.dispatch('Login')</span></span><br><span class="line">  actions: &#123;</span><br><span class="line">    <span class="comment">// actions只能接受一个参数，如此处的userInfo</span></span><br><span class="line">    Login(&#123; commit &#125;, userInfo) &#123;</span><br><span class="line">      <span class="keyword">const</span> username = userInfo.username.trim()</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        login(username, userInfo.password).then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">          setToken(data.token) <span class="comment">// 存储在 Cookies</span></span><br><span class="line">          commit(<span class="string">'SET_TOKEN'</span>, data.token)</span><br><span class="line">          resolve()</span><br><span class="line">        &#125;).catch(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">          reject(error)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 引入其他模块</span></span><br><span class="line">  <span class="comment">// 调用：this.$store.permission.state.access</span></span><br><span class="line">  modules: &#123;</span><br><span class="line">    permission <span class="comment">// Vuex对象</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> user</span><br></pre></td></tr></table></figure><h3 id="Vuex的使用场景"><a href="#Vuex的使用场景" class="headerlink" title="Vuex的使用场景"></a>Vuex的使用场景</h3><ul><li>采用单向数据流的模式，子组件修改数据必须通过事件触发回调。如果当组件的层级越来越深，会造成父组件可能会与很远的组件之间共享同份数据，如果此时很远的组件需要修改数据时，就会造成事件回调需要层层返回。因此可通过Vuex这个状态管理库来统一维护 <a href="https://juejin.im/entry/5c30f46be51d4551b508fec0" target="_blank" rel="noopener">^8</a><ul><li>实践：父组件负责渲染Store的数据状态(初始化)且通过computed监听状态变化，然后通过props传递数据到子组件中，子组件触发事件提交更改状态的action, Store可以在Dispatcher上监听到Action并做出相应的操作，当数据模型发生变化时，就触发刷新整个父组件界面</li></ul></li><li><p>利用computed的特性，用get和set来获取和设值</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">computed: &#123;</span><br><span class="line">    message: &#123;</span><br><span class="line">        get () &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.$store.state.message</span><br><span class="line">        &#125;,</span><br><span class="line">        set (value) &#123;</span><br><span class="line">            <span class="keyword">this</span>.$store.commit(<span class="string">'updateMessage'</span>, value)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 对于一些需要动态转换的属性较为实用</span></span><br><span class="line">    curList: &#123;</span><br><span class="line">        get () &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>[<span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.searchForm.dataType&#125;</span>List`</span>]</span><br><span class="line">        &#125;,</span><br><span class="line">        set (newValue) &#123;</span><br><span class="line">            <span class="keyword">this</span>[<span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.searchForm.dataType&#125;</span>List`</span>] = newValue</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>持久化工具[vuex-persistedstate]。可将store数据写入到localStorage中</p></li><li><p>扁平化 Store 数据结构</p><ul><li>可基于JSON数据规范化(normalize)，使用如 <a href="https://github.com/paularmstrong/normalizr" target="_blank" rel="noopener">Normalizr</a> 等开源的工具，可以将深层嵌套的 JSON 对象通过定义好的 schema 转变成使用 id 作为字典的实体表示的对象</li><li><p>分离渲染UI数据量大的属性，以免其他不必要的状态改变而影响它</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 假设某组件A会通过商铺名获取商铺信息。如果A商铺loading状态变更，则state1.shops属性变化，这时Getter监听到变化后，会通知绑定的组件（商铺A，商铺B，...），然后UI响应变化。像fruits本没有变化也会触发水果组件重新渲染，而其数据量大会导致性能变差</span></span><br><span class="line"><span class="keyword">const</span> state1 = &#123;</span><br><span class="line">    shops: &#123;</span><br><span class="line">        <span class="comment">// 对应商铺组件</span></span><br><span class="line">        商铺A: &#123;</span><br><span class="line">            startDate: <span class="string">"2018-11-01"</span>,</span><br><span class="line">            endDate: <span class="string">"2018-11-30"</span>,</span><br><span class="line">            loading: <span class="literal">false</span>,</span><br><span class="line">            diplayMoreFruitsLink: <span class="literal">true</span>,</span><br><span class="line">            fruits: [&#123;&#125;,&#123;&#125;,&#123;&#125;...], <span class="comment">// 水果，对应水果组件</span></span><br><span class="line">        &#125;,</span><br><span class="line">        商铺B:&#123;...&#125;,</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 改进后。此时商铺信息变化并不会影响"商铺A_fruits"属性变化，水果组件不会重新渲染</span></span><br><span class="line"><span class="keyword">const</span> state2 = &#123;</span><br><span class="line">    shops: &#123;</span><br><span class="line">        商铺A: &#123;</span><br><span class="line">            startDate: <span class="string">"2018-11-01"</span>,</span><br><span class="line">            endDate: <span class="string">"2018-11-30"</span>,</span><br><span class="line">            loading: <span class="literal">false</span>,</span><br><span class="line">            diplayMoreFruitsLink: <span class="literal">true</span>,</span><br><span class="line">            fruits: [&#123;&#125;,&#123;&#125;,&#123;&#125;...], <span class="comment">// 水果</span></span><br><span class="line">        &#125;,</span><br><span class="line">        商铺B:&#123;...&#125;,</span><br><span class="line">        ...</span><br><span class="line">    &#125;,</span><br><span class="line">    商铺A_fruits: [&#123;&#125;,&#123;&#125;,&#123;&#125;...],</span><br><span class="line">    商铺B_fruits: [&#123;&#125;,&#123;&#125;,&#123;&#125;...],</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ul><h2 id="vue-cli"><a href="#vue-cli" class="headerlink" title="vue-cli"></a>vue-cli</h2><ul><li><a href="https://cli.vuejs.org/zh/" target="_blank" rel="noopener">官网</a></li><li>安装</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Vue CLI 4.x 需要 Node.js v8.9 或更高版本 (推荐 v10 以上)</span></span><br><span class="line"><span class="comment"># Vue CLI 5.x 需要 Node.js v12 以上</span></span><br><span class="line">npm install -g @vue/cli <span class="comment"># 指定版本 @vue/cli@4.5.19</span></span><br><span class="line">vue --version <span class="comment"># @vue/cli 4.5.19</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个demo项目</span></span><br><span class="line">vue create demo</span><br><span class="line"><span class="string">''</span><span class="string">'json</span></span><br><span class="line"><span class="string">"devDependencies": &#123;</span></span><br><span class="line"><span class="string">    // 默认创建的</span></span><br><span class="line"><span class="string">    "@vue/cli-plugin-babel": "~4.5.19",</span></span><br><span class="line"><span class="string">    "@vue/cli-plugin-eslint": "~4.5.19",</span></span><br><span class="line"><span class="string">    "@vue/cli-service": "~4.5.19",</span></span><br><span class="line"><span class="string">    "babel-eslint": "^10.1.0",</span></span><br><span class="line"><span class="string">    "eslint": "^6.7.2",</span></span><br><span class="line"><span class="string">    "eslint-plugin-vue": "^6.2.2",</span></span><br><span class="line"><span class="string">    "vue-template-compiler": "^2.6.11",</span></span><br><span class="line"><span class="string">    // 手动添加</span></span><br><span class="line"><span class="string">    "@types/lodash": "^4.14.168",</span></span><br><span class="line"><span class="string">    "node-sass": "^4.9.0",</span></span><br><span class="line"><span class="string">    "sass-loader": "^7.0.1",</span></span><br><span class="line"><span class="string">    "prettier": "^2.2.1",</span></span><br><span class="line"><span class="string">    "webpack-bundle-analyzer": "^3.0.3"</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">'</span><span class="string">''</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># [审查项目的-webpack-配置](https://cli.vuejs.org/zh/guide/webpack.html#%E5%AE%A1%E6%9F%A5%E9%A1%B9%E7%9B%AE%E7%9A%84-webpack-%E9%85%8D%E7%BD%AE)</span></span><br><span class="line"><span class="comment"># 将 vue-cli 中（vue.config.js）对 webpack 的配置信息导出到 output.js 文件</span></span><br><span class="line">vue inspect &gt; output.js</span><br><span class="line"><span class="comment"># 如可以看到如下内容，因此在js中可以使用 `process.env.NODE_ENV`，在 public/index.html 中可使用 href="&lt;%= BASE_URL %&gt;favicon.ico" 进行变量替换</span></span><br><span class="line"><span class="string">''</span><span class="string">'</span></span><br><span class="line"><span class="string">new DefinePlugin(</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">        '</span>process.env<span class="string">': &#123;</span></span><br><span class="line"><span class="string">            NODE_ENV: '</span><span class="string">"development"</span><span class="string">',</span></span><br><span class="line"><span class="string">            VUE_APP_BASE_URL: '</span><span class="string">"http://localhost:8800/api/v1"</span><span class="string">',</span></span><br><span class="line"><span class="string">            VUE_APP_ENV: '</span><span class="string">"development"</span><span class="string">',</span></span><br><span class="line"><span class="string">            BASE_URL: '</span><span class="string">"/"</span><span class="string">'</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">)</span></span><br><span class="line"><span class="string">'</span><span class="string">''</span></span><br></pre></td></tr></table></figure><h3 id="vue-cli-service"><a href="#vue-cli-service" class="headerlink" title="vue-cli-service"></a>vue-cli-service</h3><ul><li>命令说明</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看帮助</span></span><br><span class="line">npx vue-cli-service -h</span><br><span class="line"></span><br><span class="line">vue-cli-service</span><br><span class="line">    build</span><br><span class="line">        --mode <span class="built_in">test</span>-sq <span class="comment"># 指定环境变量配置文件为.env-test-sq</span></span><br><span class="line">        --report <span class="comment"># 生成分析报告到dist/report.html(vue-cli自带分析插件)</span></span><br><span class="line">        --target lib <span class="comment"># 生成lib包(用于npm安装或浏览器引用的js)</span></span><br><span class="line">        --name report-table <span class="comment"># lib包名称</span></span><br><span class="line">        --dest lib </span><br><span class="line">        --formats umd-min <span class="comment"># 产物包类型，默认包含common.js、.umd.js、.umd.min.js，此时表示只打包umd.min</span></span><br><span class="line">        &lt;./src/index.js&gt; <span class="comment"># 打包时的目标目录为lib，入口文件为./src/index.js</span></span><br><span class="line">        --watch <span class="comment"># 实时观测打包文件</span></span><br></pre></td></tr></table></figure><ul><li>package.json 常用配置</li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">        "serve": "vue-cli-service serve", // 一般为运行开发环境(此时process.env.NODE_ENV='development')。执行命令：npm run serve</span><br><span class="line">        "dev": "vue-cli-service serve --open --port=8000", // 类似serve，其中 --open 表示自动打开浏览器，--port 指定端口</span><br><span class="line">        // 在vue-cli2中打包时可以修改 "build" 和 "config" 中的文件来区分不同的线上环境。而vue-cli3号称0配置，无法直接修改打包文件进行环境区分，具体见下文</span><br><span class="line">        "build": "vue-cli-service build", // 一般为生成环境打包(此时process.env.NODE_ENV='production')</span><br><span class="line">        // 区分环境进行打包，此时在 vue.config.js 文件的同级目录(根目录)创建文件 .env.test-sq，其中可添加变量如 `NODE_ENV = test-sq` (一行一个变量，最终都会挂载到 process.env 下)</span><br><span class="line">        "build-test-sq": "vue-cli-service build --mode test-sq",</span><br><span class="line">        // 生成分析报告到dist/report.html(vue-cli自带分析插件)</span><br><span class="line">        "report": "vue-cli-service build --report --mode pord"</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="evn"><a href="#evn" class="headerlink" title=".evn"></a>.evn</h3><ul><li><code>.env.test-sq</code> (多)环境变量配置。具体参考：<a href="https://cli.vuejs.org/zh/guide/mode-and-env.html" target="_blank" rel="noopener">https://cli.vuejs.org/zh/guide/mode-and-env.html</a></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 获取的值都是字符串类型</span></span><br><span class="line"><span class="comment">## 修改之后必须要重启项目才会生效</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用都是 process.env.xxx</span></span><br><span class="line">NODE_ENV = <span class="built_in">test</span>-sq</span><br><span class="line"><span class="comment"># 以 VUE_APP_ 开头的变量才会被 webpack.DefinePlugin 静态嵌入到客户端侧的包中</span></span><br><span class="line">VUE_APP_VUE_ROUTER_BASE = /my-app/</span><br><span class="line"><span class="comment"># 可识别为json字符串(不支持字符串换行，暂未找到换行写法)</span></span><br><span class="line">VUE_APP_JSON = &#123;<span class="string">"a"</span>: 1, <span class="string">"b"</span>: <span class="string">"abc"</span>&#125;</span><br></pre></td></tr></table></figure><h3 id="vue-config-js"><a href="#vue-config-js" class="headerlink" title="vue.config.js"></a>vue.config.js</h3><ul><li><a href="https://cli.vuejs.org/zh/config/" target="_blank" rel="noopener">官方文档</a></li><li><a href="/_posts/arch/springboot-vue.md#多项目配置">多项目配置参考</a></li><li>vue.config.js 常用配置</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// process.env 可以获取node下所有的环境变量</span></span><br><span class="line"><span class="keyword">const</span> port = process.env.port || process.env.npm_config_port || <span class="number">9528</span></span><br><span class="line"><span class="keyword">const</span> publicPath = process.env.NODE_ENV === <span class="string">'production'</span> ? <span class="string">'/'</span> : <span class="string">'/'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// process.argv 可以获取node命令行全参数</span></span><br><span class="line"><span class="comment">// node vue-cli-service serve --mode dev</span></span><br><span class="line"><span class="keyword">const</span> args = process.argv.slice(<span class="number">2</span>) <span class="comment">// ['serve', '--mode', 'dev']</span></span><br><span class="line"><span class="keyword">const</span> hasMode = args.indexOf(<span class="string">'--mode'</span>) &gt;= <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">// 多项目参考 [springboot-vue.md#多项目配置](/_posts/arch/springboot-vue.md#多项目配置)</span></span><br><span class="line">    <span class="comment">// index.html中引入的静态文件路径，如：/js/app.28dc7003.js(如果publicPath为 /demo1/，则生成的路径为 /demo1/js/app.28dc7003.js)</span></span><br><span class="line">    publicPath: publicPath, <span class="comment">// 对应vue-cli2 或者 webpack中的 assetsPublicPath 参数</span></span><br><span class="line">    outputDir: <span class="string">'dist'</span>, <span class="comment">// 打包后的文件生成在此项目的dist根文件夹，一般是把此文件夹下的文件(index.html和一些静态文件)放到www目录</span></span><br><span class="line">    lintOnSave: <span class="literal">false</span>, <span class="comment">// 保存文件时进行eslint校验，false表示保存时不校验。如果校验不通过则开发时页面无法显示</span></span><br><span class="line">    <span class="comment">// 打包时不生成.map文件</span></span><br><span class="line">    <span class="comment">// 项目打包后，代码都是经过压缩加密的，如果运行时报错，输出的错误信息无法准确得知是哪里的代码报错。有了map就可以像未加密的代码一样，准确的输出是哪一行哪一列有错。但是在生产环境中我们就不需要了</span></span><br><span class="line">    productionSourceMap: <span class="literal">false</span>,</span><br><span class="line"></span><br><span class="line">    configureWebpack: <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> plugins = []</span><br><span class="line">        <span class="comment">// if (process.env.NODE_ENV === 'production') &#123;</span></span><br><span class="line">        <span class="comment">//   // 打生产包，进行依赖分析</span></span><br><span class="line">        <span class="comment">//   const BundleAnalyzerPlugin = require('webpack-bundle-analyzer').BundleAnalyzerPlugin</span></span><br><span class="line">        <span class="comment">//   plugins.push(new BundleAnalyzerPlugin())</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            devtool: <span class="string">'source-map'</span>, <span class="comment">// 生成source-map, 否则debugger容易定位不准确</span></span><br><span class="line">            plugins: plugins,</span><br><span class="line">            <span class="comment">// 和下文 chainWebpack 中的配置效果一样</span></span><br><span class="line">            externals: &#123;</span><br><span class="line">                vue: <span class="string">'Vue'</span>,</span><br><span class="line">                <span class="string">'vue-router'</span>: <span class="string">'VueRouter'</span>,</span><br><span class="line">                <span class="string">'element-ui'</span>: <span class="string">'ELEMENT'</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 对上文 configureWebpack 属性再次设置</span></span><br><span class="line">    chainWebpack: <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 忽略的打包文件，使用CDN文件。安装和导入以模块的方式，index.html中引入对应cnd路径文件，开发/打包则使用此文件</span></span><br><span class="line">        config.externals(&#123;</span><br><span class="line">            <span class="string">'vue'</span>: <span class="string">'Vue'</span>,</span><br><span class="line">            <span class="string">'vue-router'</span>: <span class="string">'VueRouter'</span>,</span><br><span class="line">            <span class="string">'vuex'</span>: <span class="string">'Vuex'</span>,</span><br><span class="line">            <span class="string">'axios'</span>: <span class="string">'axios'</span>,</span><br><span class="line">            <span class="string">'element-ui'</span>: <span class="string">'ELEMENT'</span>,</span><br><span class="line">            <span class="string">'lodash'</span>: <span class="string">'_'</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// key,value自行定义。在src的vue文件中可通过此别名引入文件，如 import A from '@/test/index'，相当于引入 scr/test/index.js</span></span><br><span class="line">        <span class="comment">// 设置了别名之后会导致通过快捷键无法快速定位到文件。此时可在项目根目录添加一个tsconfig.json(无需在devDependencies中引入额外依赖)，将其中的 paths 属性的值也加入此别名定义，从而可解决(不支持子文件夹项目)</span></span><br><span class="line">        config.resolve.alias</span><br><span class="line">            .set(<span class="string">'@'</span>, resolve(<span class="string">'src'</span>))</span><br><span class="line">            .set(<span class="string">'_c'</span>, resolve(<span class="string">'src/components'</span>))</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 修改插件选项</span></span><br><span class="line">        config</span><br><span class="line">            .plugin(<span class="string">'define'</span>) <span class="comment">// 对应 DefinePlugin 插件，其简称可通过 vue inspect &gt; output.js 生成目标配置查看。其实通过 .env 文件定义的变量会自动加到 DefinePlugin 中</span></span><br><span class="line">            .tap(<span class="function"><span class="params">args</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="comment">// 修改构造函数参数值并返回</span></span><br><span class="line">                args[<span class="number">0</span>][<span class="string">'process.env'</span>].BUILD_ENV = <span class="built_in">JSON</span>.stringify(process.env.BUILD_ENV)</span><br><span class="line">                <span class="keyword">return</span> args</span><br><span class="line">            &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 修改 Loader 和新增 Loader</span></span><br><span class="line">        config.module</span><br><span class="line">            .rule(<span class="string">'vue'</span>)</span><br><span class="line">            .use(<span class="string">'vue-loader'</span>)</span><br><span class="line">            .tap(<span class="function"><span class="params">options</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="comment">// 修改它的选项...</span></span><br><span class="line">                <span class="keyword">return</span> options</span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="comment">// 你还可以再添加一个 loader</span></span><br><span class="line">            .use(<span class="string">'other-loader'</span>)</span><br><span class="line">            .loader(<span class="string">'other-loader'</span>)</span><br><span class="line">            .end()</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 入口文件修改</span></span><br><span class="line">        <span class="comment">// 会在默认的源文件(src/main.js)后加入mock.js一起打包成app.js的入口文件</span></span><br><span class="line">        config.entry(<span class="string">'app'</span>).add(<span class="string">'./src/mock.js'</span>)</span><br><span class="line">        <span class="comment">// vue-cli默认生成的入口文件为app.js(chunk文件)，clear方法会把vue-cli默认的.entry('app')清空</span></span><br><span class="line">        <span class="comment">// config.entryPoints.clear().end()</span></span><br><span class="line">        <span class="comment">//     .entry('main').add('./src/main.js').end() // main chunk. 可以在同一个chunk，add多个模块</span></span><br><span class="line">        <span class="comment">//     .entry('routes').add('./src/app-routes.js');</span></span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    pluginOptions: &#123;</span><br><span class="line">        <span class="string">'style-resources-loader'</span>: &#123;</span><br><span class="line">            preProcessor: <span class="string">'less'</span>,</span><br><span class="line">            patterns: [path.resolve(__dirname, <span class="string">'src/styles/theme/index.less'</span>)]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 多页面配置，可为每个页面定义入口文件</span></span><br><span class="line">    pages: &#123;</span><br><span class="line">        index: &#123;</span><br><span class="line">            entry: <span class="string">'src/views/index/main.js'</span>,</span><br><span class="line">            template: <span class="string">'public/index.html'</span>,</span><br><span class="line">            <span class="comment">// 在 dist/index.html 的输出</span></span><br><span class="line">            filename: <span class="string">'index.html'</span>,</span><br><span class="line">            <span class="comment">// 提取出来的通用 chunk 和 vendor chunk</span></span><br><span class="line">            chunks: [<span class="string">'chunk-vendors'</span>, <span class="string">'chunk-common'</span>, <span class="string">'index'</span>]</span><br><span class="line">        &#125;,</span><br><span class="line">        preview: &#123;</span><br><span class="line">            entry: <span class="string">'src/views/preview/main.js'</span>,</span><br><span class="line">            template: <span class="string">'public/preview.html'</span>,</span><br><span class="line">            filename: <span class="string">'preview.html'</span>,</span><br><span class="line">            chunks: [<span class="string">'chunk-vendors'</span>, <span class="string">'chunk-common'</span>, <span class="string">'preview'</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    devServer: &#123;</span><br><span class="line">        <span class="comment">// host: 'localhost', // target host</span></span><br><span class="line">        <span class="comment">// 启动本项目的默认端口，可通过命令行参数--port覆盖</span></span><br><span class="line">        <span class="comment">// 在mac os中，非root用户是无法使用小于1024的常用端口的。如果小于1024端口，会从1024开始。解决: sudo npm run dev (貌似没效果)</span></span><br><span class="line">        port: port,</span><br><span class="line">        open: <span class="literal">true</span>,</span><br><span class="line">        <span class="comment">// 解决使用花生壳内网穿透进行调试时，打开网页显示：invalid host header（需要重启项目, 好像修改代码之后仍然需要重启项目）</span></span><br><span class="line">        disableHostCheck: <span class="literal">true</span>,</span><br><span class="line">        overlay: &#123;</span><br><span class="line">            warnings: <span class="literal">false</span>,</span><br><span class="line">            errors: <span class="literal">true</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 参考：https://www.cnblogs.com/liuguiqian/p/11362211.html</span></span><br><span class="line">        proxy: &#123;</span><br><span class="line">            <span class="comment">// /api/xxx</span></span><br><span class="line">            <span class="string">'^/api'</span>: &#123;</span><br><span class="line">                target: <span class="string">`http://127.0.0.1:<span class="subst">$&#123;port&#125;</span>/mock`</span>, <span class="comment">// url = target + uri(使用pathRewrite去掉原url根路径)</span></span><br><span class="line">                changeOrigin: <span class="literal">true</span>, <span class="comment">// 如果接口跨域，需要进行这个参数配置</span></span><br><span class="line">                <span class="comment">// ws: true, // proxy websockets</span></span><br><span class="line">                pathRewrite: &#123;          <span class="comment">// 不重写url为 `http://127.0.0.1:$&#123;port&#125;/mock/api/xxx`</span></span><br><span class="line">                    <span class="string">'^/api'</span>: <span class="string">'/'</span>,       <span class="comment">// 重写之后url为 `http://127.0.0.1:$&#123;port&#125;/mock/xxx`</span></span><br><span class="line">                    <span class="string">'^/api'</span>: <span class="string">'/api2'</span>    <span class="comment">// 重写之后url为 `http://127.0.0.1:$&#123;port&#125;/mock/api2/xxx`</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 一般开发组件库时用到. build打包时，--watch时默认为css内联样式，此处设置成非内联模式(样式生成到单独的css文件中)；非 --watch 默认就是true</span></span><br><span class="line">    <span class="comment">// css: &#123;</span></span><br><span class="line">    <span class="comment">//     extract: true</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Vuepress文档框架"><a href="#Vuepress文档框架" class="headerlink" title="Vuepress文档框架"></a>Vuepress文档框架</h2><ul><li><p><a href="https://vuepress.vuejs.org/zh/" target="_blank" rel="noopener">Vuepress</a> 官方推出的文档框架</p><ul><li><a href="https://gitee.com/changhaojun/vuepress-demo" target="_blank" rel="noopener">demo</a></li><li><p>多版本部署</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// # .vuepress/config.js</span></span><br><span class="line"><span class="keyword">var</span> json = <span class="built_in">require</span>(<span class="string">'../../package.json'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">// base: '/',</span></span><br><span class="line">    base: <span class="string">'/dist.'</span> + json.version + <span class="string">'/'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>nginx</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       5200;</span><br><span class="line">    server_name  localhost;</span><br><span class="line">    index  index.html index.htm;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># http://localhost:5200/</span></span><br><span class="line">    location = / &#123;</span><br><span class="line">        rewrite . http://<span class="variable">$server_name</span>/dist.0.5.2-beta.2/ <span class="built_in">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># http://localhost:5200/dist.0.5.2-beta.2/</span></span><br><span class="line">    location ~ ^/dist(.+?)/ &#123;</span><br><span class="line">        root /www/demo/;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ul></li><li><p>可结合<a href="https://github.com/vuese/vuese" target="_blank" rel="noopener">vuese</a> 先对vue组件进行解析成markdown</p></li><li>其他框架<ul><li>Docsify/Docute<ul><li>这两个项目同样都是基于 Vue，然而它们都是完全的运行时驱动，因此对 SEO 不够友好</li></ul></li><li>Hexo<ul><li>Vue 的文档一直使用此框架，Hexo 最大的问题在于他的主题系统太过于静态以及过度地依赖纯字符串，二vuepress可以使用vue来处理布局和交互</li></ul></li><li>GitBook<ul><li>GitBook 最大的问题在于当文件很多时，每次编辑后的重新加载时间长得令人无法忍受</li></ul></li><li>​docz​</li><li><a href="https://github.com/txd-team/docsite" target="_blank" rel="noopener">docsite</a> 阿里开源(React), 对SEO友好</li></ul></li><li>静态站点<ul><li><a href="https://www.gatsbyjs.com/" target="_blank" rel="noopener">GatsbyJS</a>: 基于React</li><li>Next.js: 基于React的</li><li><a href="https://nuxt.com.cn/" target="_blank" rel="noopener">Nuxt.js</a>: 基于Vue.js, 相比Vuepress更偏Web应用</li><li>Gridsome: 基于Vue.js, 支持GraphQL</li><li><a href="https://docusaurus.io/" target="_blank" rel="noopener">docusaurus</a><ul><li><strong>技术类官网(基于react)</strong>，如果lowcode-engine，官网有很多模板可供选择</li><li>以Markdown/MDX内容驱动. <a href="https://mdxjs.com/" target="_blank" rel="noopener">MDX</a>、<a href="https://www.mdxjs.cn/" target="_blank" rel="noopener">MDX中文</a></li></ul></li></ul></li></ul><h2 id="插件收集"><a href="#插件收集" class="headerlink" title="插件收集"></a>插件收集</h2><ul><li>自定义右键菜单 <a href="https://github.com/GitHub-Laziji/menujs" target="_blank" rel="noopener">vue-contextmenujs</a> 包大小130K<ul><li>可以在指定元素上开启自定义右键菜单</li></ul></li><li>栅格布局 <a href="https://jbaysolutions.github.io/vue-grid-layout/zh/" target="_blank" rel="noopener">Vue Grid Layout</a><ul><li>如可用于首页自定义栅格</li></ul></li></ul><hr><p>参考文章</p></div><div></div><div></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> smalle</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="http://blog.aezo.cn/2018/04/03/web/vue/" title="Vue">http://blog.aezo.cn/2018/04/03/web/vue/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！</li></ul></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/vue/" rel="tag"># vue</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2018/03/13/bigdata/solr/" rel="next" title="Solr"><i class="fa fa-chevron-left"></i> Solr</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"> <a href="/2018/04/11/java/java-release/" rel="prev" title="Java各版本新特性">Java各版本新特性<i class="fa fa-chevron-right"></i></a></div></div></footer></article><div class="post-spread"><div> <a target="_blank" href="https://github.com/oldinaction/ChatGPT-MP"><img class="nofancybox" style="width:300px;margin:0 auto" src="https://cdn7.aezo.cn/one/chat/chat-gpt-open-banner.jpg" alt="ChatGPT开源小程序" title="ChatGPT开源小程序"></a></div></div></div></div><div class="comments" id="comments"></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap"> 文章目录</li><li class="sidebar-nav-overview" data-target="site-overview"> 站点概览</li></ul><section class="site-overview sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" src="https://avatars0.githubusercontent.com/u/15698218?v=3&u=ce740bf0b67ff0d74990ba6fc644d6e92f572dcb&s=400" alt="smalle"><p class="site-author-name" itemprop="name">smalle</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">162</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/index.html"><span class="site-state-item-count">14</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/index.html"><span class="site-state-item-count">150</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"></div><div> 欢迎关注公众号：阿壹族 <img class="nofancybox" style="width:120px;margin:0 auto" src="https://cdn7.aezo.cn/common/qrcode/ayz_qrcode.jpg" alt="欢迎关注公众号：阿壹族" title="欢迎关注公众号：阿壹族"></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#简介"><span class="nav-number">1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Vue3"><span class="nav-number">2.</span> <span class="nav-text">Vue3</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#语法"><span class="nav-number">2.1.</span> <span class="nav-text">语法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#约定俗成"><span class="nav-number">2.2.</span> <span class="nav-text">约定俗成</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#文件引入"><span class="nav-number">2.3.</span> <span class="nav-text">文件引入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#vue组件"><span class="nav-number">2.4.</span> <span class="nav-text">vue组件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#vue生命周期-含路由"><span class="nav-number">2.5.</span> <span class="nav-text">vue生命周期(含路由)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#后端模板中使用VUE"><span class="nav-number">2.6.</span> <span class="nav-text">后端模板中使用VUE</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#页面渲染"><span class="nav-number">3.</span> <span class="nav-text">页面渲染</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#父子组件加载"><span class="nav-number">3.1.</span> <span class="nav-text">父子组件加载</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数组-对象改变数据不刷新问题"><span class="nav-number">3.2.</span> <span class="nav-text">数组/对象改变数据不刷新问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#页面渲染优化-性能优化"><span class="nav-number">3.3.</span> <span class="nav-text">页面渲染优化(性能优化)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#打包优化"><span class="nav-number">3.3.1.</span> <span class="nav-text">打包优化</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#指令等语法优化"><span class="nav-number">3.3.2.</span> <span class="nav-text">指令等语法优化</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Vuex使用及优化"><span class="nav-number">3.3.3.</span> <span class="nav-text">Vuex使用及优化</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#使用Object-freeze-进行优化"><span class="nav-number">3.3.4.</span> <span class="nav-text">使用Object.freeze()进行优化</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#优化无限列表性能"><span class="nav-number">3.3.5.</span> <span class="nav-text">优化无限列表性能</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#图片资源懒加载"><span class="nav-number">3.3.6.</span> <span class="nav-text">图片资源懒加载</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#组件懒加载"><span class="nav-number">3.3.7.</span> <span class="nav-text">组件懒加载</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#第三方插件的按需引入"><span class="nav-number">3.3.8.</span> <span class="nav-text">第三方插件的按需引入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#服务端渲染-预渲染"><span class="nav-number">3.3.9.</span> <span class="nav-text">服务端渲染/预渲染</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#组件"><span class="nav-number">4.</span> <span class="nav-text">组件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#v-model使用"><span class="nav-number">4.1.</span> <span class="nav-text">v-model使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#父子组件通信"><span class="nav-number">4.2.</span> <span class="nav-text">父子组件通信</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#通信方式"><span class="nav-number">4.2.1.</span> <span class="nav-text">通信方式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#props定义说明"><span class="nav-number">4.2.2.</span> <span class="nav-text">props定义说明</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#示例"><span class="nav-number">4.2.3.</span> <span class="nav-text">示例</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#子组件和子组件通信-Bus"><span class="nav-number">4.2.4.</span> <span class="nav-text">子组件和子组件通信(Bus)</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#slot插槽"><span class="nav-number">4.3.</span> <span class="nav-text">slot插槽</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#动态组件-异步组件"><span class="nav-number">4.4.</span> <span class="nav-text">动态组件/异步组件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#keep-alive"><span class="nav-number">4.5.</span> <span class="nav-text">keep-alive</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#事件"><span class="nav-number">5.</span> <span class="nav-text">事件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#示例-1"><span class="nav-number">5.1.</span> <span class="nav-text">示例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#鼠标点击其他区域事件"><span class="nav-number">5.2.</span> <span class="nav-text">鼠标点击其他区域事件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#监控全局点击事件-不推荐"><span class="nav-number">5.3.</span> <span class="nav-text">监控全局点击事件(不推荐)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#点击按钮后下载"><span class="nav-number">5.4.</span> <span class="nav-text">点击按钮后下载</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#插入字符串"><span class="nav-number">5.5.</span> <span class="nav-text">插入字符串</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#自动转大写"><span class="nav-number">5.6.</span> <span class="nav-text">自动转大写</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#样式"><span class="nav-number">6.</span> <span class="nav-text">样式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#lang-和-scoped"><span class="nav-number">6.1.</span> <span class="nav-text">lang 和 scoped</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#全局样式-自动化导入"><span class="nav-number">6.2.</span> <span class="nav-text">全局样式/自动化导入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#样式使用举例"><span class="nav-number">6.3.</span> <span class="nav-text">样式使用举例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#接受外部参数动态修改样式"><span class="nav-number">6.4.</span> <span class="nav-text">接受外部参数动态修改样式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#transition-动画"><span class="nav-number">6.5.</span> <span class="nav-text">transition 动画</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#mixins混入"><span class="nav-number">7.</span> <span class="nav-text">mixins混入</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#指令"><span class="nav-number">8.</span> <span class="nav-text">指令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#自定义指令"><span class="nav-number">8.1.</span> <span class="nav-text">自定义指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#自定义指令案例"><span class="nav-number">8.2.</span> <span class="nav-text">自定义指令案例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#input输入自动转大写"><span class="nav-number">8.2.1.</span> <span class="nav-text">input输入自动转大写</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#多环境配置用户权限"><span class="nav-number">8.2.2.</span> <span class="nav-text">多环境配置用户权限</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#API说明"><span class="nav-number">9.</span> <span class="nav-text">API说明</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#开发组件库"><span class="nav-number">10.</span> <span class="nav-text">开发组件库</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#打包与导入"><span class="nav-number">10.1.</span> <span class="nav-text">打包与导入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#组件库中使用动态组件"><span class="nav-number">10.2.</span> <span class="nav-text">组件库中使用动态组件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#相关问题"><span class="nav-number">10.3.</span> <span class="nav-text">相关问题</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#JSX使用"><span class="nav-number">11.</span> <span class="nav-text">JSX使用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#render函数"><span class="nav-number">11.1.</span> <span class="nav-text">render函数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Vue对Typescript的支持"><span class="nav-number">12.</span> <span class="nav-text">Vue对Typescript的支持</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#VueRouter路由"><span class="nav-number">13.</span> <span class="nav-text">VueRouter路由</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#基本概念"><span class="nav-number">13.1.</span> <span class="nav-text">基本概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#路由变化页面数据不刷新"><span class="nav-number">13.2.</span> <span class="nav-text">路由变化页面数据不刷新</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#hash和history路由模式"><span class="nav-number">13.3.</span> <span class="nav-text">hash和history路由模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#刷新页面"><span class="nav-number">13.4.</span> <span class="nav-text">刷新页面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#打开新页面"><span class="nav-number">13.5.</span> <span class="nav-text">打开新页面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#子模块路由案例-iview-admin为例"><span class="nav-number">13.6.</span> <span class="nav-text">子模块路由案例(iview-admin为例)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数据库动态路由"><span class="nav-number">13.7.</span> <span class="nav-text">数据库动态路由</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Vuex"><span class="nav-number">14.</span> <span class="nav-text">Vuex</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Vuex的使用场景"><span class="nav-number">14.1.</span> <span class="nav-text">Vuex的使用场景</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#vue-cli"><span class="nav-number">15.</span> <span class="nav-text">vue-cli</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#vue-cli-service"><span class="nav-number">15.1.</span> <span class="nav-text">vue-cli-service</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#evn"><span class="nav-number">15.2.</span> <span class="nav-text">.evn</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#vue-config-js"><span class="nav-number">15.3.</span> <span class="nav-text">vue.config.js</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Vuepress文档框架"><span class="nav-number">16.</span> <span class="nav-text">Vuepress文档框架</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#插件收集"><span class="nav-number">17.</span> <span class="nav-text">插件收集</span></a></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2016 - <span itemprop="copyrightYear">2024</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">smalle</span>&nbsp;&nbsp;&nbsp;&nbsp;<div class="powered-by"> 由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div><div class="powered-by"> 主题 - <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a></div><div class="theme-info"> <a class="theme-link" target="_blank" href="https://tongji.baidu.com/main/overview/10000542408/overview/index?siteId=18991897">站长统计</a></div></div><div class="ad"> <span style="font-weight:700">AD&nbsp;&nbsp;&nbsp;&nbsp;</span><div class="theme-info"> <a target="_blank" href="https://promotion.aliyun.com/ntms/yunparter/invite.html?userCode=oby5nolb">阿里云大礼包</a></div></div><div class="aezocn"> <span style="font-weight:700">&copy;AEZO.CN&nbsp;&nbsp;&nbsp;&nbsp;</span><div class="powered-by"> <a target="_blank" href="https://shengqitech.aezo.cn/">圣骑科技</a></div><div class="powered-by"> <a target="_blank" href="https://cdn7.aezo.cn/common/qrcode/one_qrcode.jpg">【One能抽屉】小程序</a></div><div class="theme-info"> <a target="_blank" href="http://shop.aezo.cn/">杂货铺(省钱小助手)</a></div></div><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?085f9cd91ef2ad985f791c677472f0d1";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script><script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script type="text/javascript" src="/js/src/js.cookie.js?v=5.1.1"></script><script type="text/javascript" src="/js/src/scroll-cookie.js?v=5.1.1"></script></body></html>