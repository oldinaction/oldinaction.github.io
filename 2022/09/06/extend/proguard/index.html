<!doctype html><html class="theme-next mist use-motion" lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css"><meta name="keywords" content="aezo, aezocn, smalle blog"><link rel="alternate" href="/atom.xml" title="Smalle's Blog | AEZOCN" type="application/atom+xml"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1"><meta name="description" content="简介 官网、使用手册 Proguard 是一个适用于 Java 平台混淆代码的工具，也可以用于 Android，虽然我们直接称为混淆，实际上 Proguard 包括 shrink（压缩），optimize（优化），obfuscate（混淆），preverify（预校验）四步 shrink： 检测并移除没有用到的类，变量，方法和属性 optimize: 优化代码，非入口节点类会加上 private/"><meta property="og:type" content="article"><meta property="og:title" content="Proguard —— 加密java代码"><meta property="og:url" content="http://blog.aezo.cn/2022/09/06/extend/proguard/index.html"><meta property="og:site_name" content="Smalle&#39;s Blog | AEZOCN"><meta property="og:description" content="简介 官网、使用手册 Proguard 是一个适用于 Java 平台混淆代码的工具，也可以用于 Android，虽然我们直接称为混淆，实际上 Proguard 包括 shrink（压缩），optimize（优化），obfuscate（混淆），preverify（预校验）四步 shrink： 检测并移除没有用到的类，变量，方法和属性 optimize: 优化代码，非入口节点类会加上 private/"><meta property="og:locale" content="zh-Hans"><meta property="og:updated_time" content="2022-09-06T13:00:09.015Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Proguard —— 加密java代码"><meta name="twitter:description" content="简介 官网、使用手册 Proguard 是一个适用于 Java 平台混淆代码的工具，也可以用于 Android，虽然我们直接称为混淆，实际上 Proguard 包括 shrink（压缩），optimize（优化），obfuscate（混淆），preverify（预校验）四步 shrink： 检测并移除没有用到的类，变量，方法和属性 optimize: 优化代码，非入口节点类会加上 private/"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Mist",sidebar:{position:"right",display:"post",offset:12,offset_float:0,b2t:!1,scrollpercent:!1},fancybox:!0,motion:!0,duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"BWD6R9FA4K",apiKey:"3330f3cbaa099dfc30395de5f5b20151",indexName:"blog",hits:{per_page:10},labels:{input_placeholder:"请输入关键字",hits_empty:"我们没有找到任何搜索结果: ${query}",hits_stats:"找到约${hits}条结果（用时${time}ms）"}}}</script><link rel="canonical" href="http://blog.aezo.cn/2022/09/06/extend/proguard/"><title>Proguard —— 加密java代码 | Smalle's Blog | AEZOCN</title><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?d82223039d601f2f819f8fe140a63468";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><div style="display:none"><script src="//s95.cnzz.com/z_stat.php?id=cnzz_stat_icon_1276691827&web_id=cnzz_stat_icon_1276691827" language="JavaScript"></script></div></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-right page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">Smalle's Blog | AEZOCN</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">Better Code, Better Life</h1></div><div class="site-nav-toggle"> <button><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br> 首页</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br> 分类</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br> 关于</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br> 归档</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br> 标签</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="menu-item-icon fa fa-fw fa-sitemap"></i><br> 站点地图</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br> 搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i></span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"> <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://blog.aezo.cn/2022/09/06/extend/proguard/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="smalle"><meta itemprop="description" content=""><meta itemprop="image" content="https://avatars0.githubusercontent.com/u/15698218?v=3&u=ce740bf0b67ff0d74990ba6fc644d6e92f572dcb&s=400"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Smalle's Blog | AEZOCN"></span><header class="post-header"><h2 class="post-title" itemprop="name headline">Proguard —— 加密java代码</h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2022-09-06T21:00:00+08:00">2022-09-06</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/extend/" itemprop="url" rel="index"><span itemprop="name">extend</span></a></span></span></div></header><div class="post-body" itemprop="articleBody"><div></div><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><ul><li><a href="https://www.guardsquare.com/" target="_blank" rel="noopener">官网</a>、<a href="https://www.guardsquare.com/manual/home" target="_blank" rel="noopener">使用手册</a></li><li>Proguard 是一个适用于 Java 平台混淆代码的工具，也可以用于 Android，虽然我们直接称为混淆，实际上 Proguard 包括 shrink（压缩），optimize（优化），obfuscate（混淆），preverify（预校验）四步<ul><li>shrink： 检测并移除没有用到的类，变量，方法和属性</li><li>optimize: 优化代码，非入口节点类会加上 private/static/final, 没有用到的参数会被删除，一些方法可能会变成内联代码</li><li>obfuscate: 使用短又没有语义的名字重命名非入口类的类名，变量名，方法名。入口类的名字保持不变</li><li>preverify: 预校验代码是否符合 Java1.6 或者更高的规范(唯一一个与入口类不相关的步骤)</li></ul></li><li>支持客户端、Grandle、Ant等，Maven需要第三方插件<ul><li>客户端使用参考: <a href="https://blog.51cto.com/jeecg/3193512" target="_blank" rel="noopener">https://blog.51cto.com/jeecg/3193512</a></li><li><a href="https://github.com/wvengen/proguard-maven-plugin" target="_blank" rel="noopener">第三方Maven插件</a><ul><li><a href="http://wvengen.github.io/proguard-maven-plugin/index.html" target="_blank" rel="noopener">文档</a></li><li><a href="https://github.com/wvengen/proguard-maven-plugin/blob/master/src/it/simple/pom.xml" target="_blank" rel="noopener">官方案例</a></li><li><a href="https://github.com/devslm/proguard-spring-boot-example" target="_blank" rel="noopener">Springboot案例</a></li></ul></li></ul></li><li>6个常用Java源代码保护工具: <a href="https://www.cnblogs.com/jpfss/p/11533257.html" target="_blank" rel="noopener">https://www.cnblogs.com/jpfss/p/11533257.html</a></li></ul><h2 id="Springboot案例"><a href="#Springboot案例" class="headerlink" title="Springboot案例"></a>Springboot案例</h2><ul><li><a href="https://github.com/oldinaction/smjava/blob/master/extend/proguard-springboot/pom.xml" target="_blank" rel="noopener">案例源码</a></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- proguard混淆插件. spring-boot-maven-plugin需要放到此插件的后面 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 之后打包后，会生成 proguard_map.txt 的映射文件(源码名称和混淆后名称的映射) --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.wvengen<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>proguard-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">id</span>&gt;</span>run-proguard<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goal</span>&gt;</span>proguard<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>proguard.conf (放在pom根目录)</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">-dontnote</span><br><span class="line">-dontwarn</span><br><span class="line">-verbose</span><br><span class="line">-dontshrink</span><br><span class="line">-dontoptimize</span><br><span class="line"></span><br><span class="line">-adaptresourcefilenames    **.properties,**.xml,META-INF/MANIFEST.MF,META-INF/spring.*</span><br><span class="line">-adaptresourcefilecontents **.properties,**.xml,META-INF/MANIFEST.MF,META-INF/spring.*</span><br><span class="line">-adaptclassstrings</span><br><span class="line"></span><br><span class="line">-keepattributes Exceptions,InnerClasses,Signature,Deprecated,SourceFile,LineNumberTable,*Annotation*,EnclosingMethod</span><br><span class="line">-renamesourcefileattribute SourceFile</span><br><span class="line"></span><br><span class="line">-keep public class cn.aezo.smjava.proguard.Application &#123;</span><br><span class="line">    public static void main(java.lang.String[]);</span><br><span class="line">&#125;</span><br><span class="line">-keep public class **.entity.* &#123;</span><br><span class="line">    *;</span><br><span class="line">&#125;</span><br><span class="line">-keep class * extends java.io.Serializable</span><br><span class="line">-keepclassmembers class * extends java.io.Serializable &#123;</span><br><span class="line">    *;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>解决混淆后，Bean类名找不到的问题</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomGenerator</span> <span class="keyword">implements</span> <span class="title">BeanNameGenerator</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">generateBeanName</span><span class="params">(BeanDefinition definition, BeanDefinitionRegistry registry)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> definition.getBeanClassName();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> SpringApplicationBuilder(Application.class)</span><br><span class="line">                .beanNameGenerator(<span class="keyword">new</span> CustomGenerator())</span><br><span class="line">                .run(args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="配置模板"><a href="#配置模板" class="headerlink" title="配置模板"></a>配置模板</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 方括号: [] # 方括号代表里面的内容是可选的</span></span><br><span class="line"><span class="comment"># 省略号: ... # 代表前面被指定的条目可以有任意多个。</span></span><br><span class="line"><span class="comment"># 竖线: | # 划分两个选项</span></span><br><span class="line"><span class="comment"># 括号: () # 代表整体</span></span><br><span class="line"><span class="comment"># 缩进 # 用于说明意图</span></span><br><span class="line"><span class="comment"># 空格 # 没有意义</span></span><br><span class="line"></span><br><span class="line">[@annotationtype] [[!]public|final|abstract|@ ...] [!]interface|class|enum classname</span><br><span class="line">    [extends|implements [@annotationtype] classname]</span><br><span class="line">[&#123;</span><br><span class="line">    [@annotationtype] [[!]public|private|protected|static|volatile|transient ...] &lt;fields&gt; |</span><br><span class="line">                                                                      (fieldtype fieldname);</span><br><span class="line">    [@annotationtype] [[!]public|private|protected|static|synchronized|native|abstract|strictfp ...] &lt;methods&gt; |</span><br><span class="line">                                                                                           &lt;init&gt;(argumenttype,...) |</span><br><span class="line">                                                                                           classname(argumenttype,...) |</span><br><span class="line">                                                                                           (returntype methodname(argumenttype,...));</span><br><span class="line">    [@annotationtype] [[!]public|private|protected|static ... ] *;</span><br><span class="line">    ...</span><br><span class="line">&#125;]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 说明</span></span><br><span class="line">关键字class可以指向任何接口或类。interface关键字只能指向接口，enum只能指向枚举,接口或者枚举前面的！表示相对应的非枚举或者接口</span><br><span class="line">每个classname都必须是全路径指定，比如：java.lang.String 内部类使用美元符”$”分开，比如： java.lang.Thread<span class="variable">$State</span> 类名可以使用包含以下通配符的正则表达式:</span><br><span class="line">    ? 任意匹配类名中的一个字符，但是不匹配包名分隔符。例如 “mypackage.Test?” 匹配”mypackage.Test1” 和 “mypackage.Test2”,不匹配 “mypackage.Test12”</span><br><span class="line">    * 匹配类名的任何部分除了包名分隔符，例如”mypackage.*Test*”匹配 “mypackage.Test” 和 “mypackage.YourTestApplication”,但是不匹配 “mypackage.mysubpackage.MyTest”. 或者更通俗的讲， “mypackage.*” 匹配所有 “mypackage”包里的内容,但是不匹配它子包里的内容</span><br><span class="line">    ** 匹配所有类名的所有部分，包括报名分隔符</span><br><span class="line">extend和implements符号用于使用统配付来限定类. 他们效果是一样的，指定只有继承或者实现指定的类和接口</span><br><span class="line">@符号用于限定那些被指定注解符号标注的类和类成员，注解符的指定方法和类名一样</span><br><span class="line">域和方法的指定更像java语言，除了方法参数中没有参数名。表达式可以包含以下通配符</span><br><span class="line">    &lt;init&gt;匹配任何构造函数</span><br><span class="line">    &lt;fields&gt;匹配任何域</span><br><span class="line">    &lt;methods&gt;匹配任何方法</span><br><span class="line">    * 匹配任何方法和域</span><br><span class="line">    注意：上面的所有统配符都没有返回值，只有&lt;init&gt;有参数列表</span><br><span class="line">方法和域还可以用正则表示指定，可以使用的通配符如下</span><br><span class="line">    ? 任意匹配方法名中的单个字符</span><br><span class="line">    * 匹配方法命中的任意部分</span><br><span class="line">数据类型描述可以使用以下通配符</span><br><span class="line">    % 匹配任何原生类型 (“boolean”, “int”, etc, but not “void”)</span><br><span class="line">    ? 任意匹配单个字符</span><br><span class="line">    * 匹配类名的任何部分除了包名分隔符</span><br><span class="line">    ** 匹配所有类名的所有部分，包括报名分隔符</span><br><span class="line">    *** 匹配任何类型，包括原生和非原生，数组和非数组</span><br><span class="line">    ... 匹配任意参数个数</span><br><span class="line">    * 和 ** 永远不会匹配原生类型，而且只有 **** 匹配数组类型。举个栗子：”** get*()” 匹配“java.lang.Object getObject()” 但是不匹配”<span class="built_in">float</span> getFloat()” 也不匹配”java.lang.Object[] getObjects()”</span><br><span class="line">构造函数可以使用段类名（不包含包名）</span><br><span class="line">类访问修饰符(public private static)一般用来限制统配类和类成员. 他们限定指定的类必须拥有指定的访问修饰符.一个前置的！表示该修饰符没有被设置</span><br><span class="line">可以组合多个标志 (e.g. public static). 表示两个条件都要满足</span><br></pre></td></tr></table></figure><h2 id="配置参数"><a href="#配置参数" class="headerlink" title="配置参数"></a>配置参数</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#递归的从给定文件中读取参数</span></span><br><span class="line">-include filename</span><br><span class="line"></span><br><span class="line"><span class="comment">#指定当前配置文件中所有路径参数的基本目录</span></span><br><span class="line">-basedirectory directoryname</span><br><span class="line"></span><br><span class="line"><span class="comment">#指定需要被处理r的jar(或者 aars, wars, ears, zips, apks, or directories)。在默认情况下任何非.class的文件会被原样复制到最终打包的jar。这里需要注意的是那些临时文件（如IDE产生的文件），尤其是当你直接用一个目录指定jar文件。class_path下的条目可以被过滤，详细请看filter，为了可读性，可以使用多条-injars命令</span></span><br><span class="line">-injars class_path</span><br><span class="line"></span><br><span class="line"><span class="comment">#指定输出jar包的名字(或者 aars, wars, ears, zips, apks, or directories)。前面-injars 指定的jar包会被包含到输出jar包里。这个也可以使用过滤，详细请看filter， </span></span><br><span class="line"><span class="comment">#你必须避免让输出文件复写输入文件。为了可读性，可以使用多条-outjars ，如果没有指定-outjar,不会有任何jar包生成。</span></span><br><span class="line">-outjars class_path</span><br><span class="line"></span><br><span class="line"><span class="comment">#指定要被处理的程序依赖的jar(或者 aars, wars, ears, zips, apks, or directories)，这些jar不会被包进output jar。这个指定的jar至少得包含程序中有被继承的类。那些只有被调用的库中的class文件不需要出现，虽然他们的出现会改善优化的结果（什么鬼， Library class files that are only called needn’t be present, although their presence can improve the results of the optimization step. ）。当然这些path也是可以过滤的 ，为了可读性，可以使用多条 -libraryjars options. </span></span><br><span class="line"><span class="comment">#请注意那些为运行proguard设置的class path，不会被用于寻找类文件，也就是说你必须显示的指定你的代码需要用到的jar路径。虽然这看上去有点麻烦，但是可以让你处理不同运行环境下的程序。比如你可以处理 </span></span><br><span class="line"><span class="comment">#j2se 的程序也可以处理jar包，只要你指定合适的jar路径。</span></span><br><span class="line">-libraryjars class_path</span><br><span class="line"></span><br><span class="line"><span class="comment">#在读取依赖的库文件时，略过非public类，来加快处理速度和减少ProGuard内存消耗 。</span></span><br><span class="line">-skipnonpubliclibraryclasses</span><br><span class="line"></span><br><span class="line"><span class="comment">#在读取依赖的库文件时，不要略过那些非public类，在4.5版本中，这是默认设置</span></span><br><span class="line">-dontskipnonpubliclibraryclasses</span><br><span class="line"></span><br><span class="line"><span class="comment">#不要忽略依赖库中的非公有的类成员，包括域和方法，proguard默认会忽略</span></span><br><span class="line">-dontskipnonpubliclibraryclassmembers</span><br><span class="line"></span><br><span class="line"><span class="comment">#指定那些需要被保留在输出jar的文件目录，在默认情况下，这些目录会被移除来减小输出文件的size。</span></span><br><span class="line">-keepdirectories [directory_filter]</span><br><span class="line"></span><br><span class="line"><span class="comment">#指定需要被处理的类文件的java版本，如1.0, 1.1, 1.2, 1.3, 1.4, 1.5 (or just 5), 1.6 (or just 6), 1.7 (or just 7), or 1.8 (or just 8)</span></span><br><span class="line">-target version</span><br><span class="line"></span><br><span class="line"><span class="comment">#指定需要被保留的类和成员。</span></span><br><span class="line">-keep 选项</span><br><span class="line"></span><br><span class="line"><span class="comment">#指定需要被保留的类成员，如果他们的类也有被保留。比如你要保留一个序列化类中的所有成员和方法</span></span><br><span class="line">-keepclassmembers</span><br><span class="line"></span><br><span class="line"><span class="comment">#指定保留那些含有指定类成员的类，比如你想保留所有包含main方法的类</span></span><br><span class="line">-keepclasseswithmembers</span><br><span class="line"></span><br><span class="line"><span class="comment">#指定那些需要被保留名字的类和类成员，前提是他们在被代码压缩的时候没有被移除。举个栗子，你可能希望保留那些实现了Serializable接口的类的名字</span></span><br><span class="line">-keepnames</span><br><span class="line"></span><br><span class="line"><span class="comment">#指定那些希望被保留的类成员的名字</span></span><br><span class="line">-keepclassmembernames</span><br><span class="line"></span><br><span class="line"><span class="comment">#保留含有指定名字的类和类成员。</span></span><br><span class="line">-keepclasseswithmembernames</span><br><span class="line"></span><br><span class="line"><span class="comment">#将匹配的类和成员全部打印到文件或者输出。这个可以用来验证自己需要保留的类有没有成功保留</span></span><br><span class="line">-printseeds</span><br><span class="line"></span><br><span class="line"><span class="comment"># ======================================== #（文件压缩选项配置）</span></span><br><span class="line"><span class="comment"># Shrinking options  </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#不压缩类文件。默认情况下会压缩所有的类文件，除了那些用keep声明和被这些类依赖的class</span></span><br><span class="line">-dontshrink</span><br><span class="line"></span><br><span class="line"><span class="comment">#将没有用到的code打印到文件或者后台</span></span><br><span class="line">-printusage [filename]</span><br><span class="line"></span><br><span class="line"><span class="comment">#将那些被保留的类的原因打印出来</span></span><br><span class="line">-whyareyoukeeping class_specification</span><br><span class="line"></span><br><span class="line"><span class="comment"># ======================================== #（文件优化配置项）</span></span><br><span class="line"><span class="comment"># Optimization options</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#不优化代码，默认优化</span></span><br><span class="line">-dontoptimize</span><br><span class="line"></span><br><span class="line"><span class="comment">#指定需要被enable和disable的优化项目。</span></span><br><span class="line">-optimizations optimization_filter</span><br><span class="line"></span><br><span class="line"><span class="comment">#指定优化的pass数目，默认是1，多个pass可以提升优化效果. 如果在一个优化pass结束后，没有发现被提升的项目，优化就结束</span></span><br><span class="line">-optimizationpasses n</span><br><span class="line"></span><br><span class="line"><span class="comment">#指定那些没有任何副作用的方法，也就是说这些方法没有实际用处，移除也没关系，比如log方法，请谨慎使用该参数，除非你知道你在做什么</span></span><br><span class="line">-assumenosideeffects class_specification</span><br><span class="line"></span><br><span class="line"><span class="comment">#设置该参数后，允许proguard在优化过程中扩大访问权限。这样可以提升优化效果。请不要讲此选项应用在 </span></span><br><span class="line"><span class="comment">#作为lib使用的code中，因为这可能会将那些不希望被访问的代码变的可以被访问</span></span><br><span class="line">-allowaccessmodification</span><br><span class="line"></span><br><span class="line"><span class="comment">#设置该参数后，允许interface被merge，即使他们的实现类没有全部实现他们。这样可以通过减少class的数量来减小输出结果的size。java 二进制规范是允许这样做的 (cfr. The Java Language Specification, Third Edition, Section 13.5.3), 虽然java语言不允许这样做(cfr. The Java Language Specification, Third Edition, Section 8.1.4). 设置这个选项会在默写虚拟机上降低处理的性能，因为一些高级的JIT偏向于更少的类实现更多的接口，更坏的是，一些虚拟机可能无法处理被优化过的代码。</span></span><br><span class="line">-mergeinterfacesaggressively</span><br><span class="line"></span><br><span class="line"><span class="comment"># ======================================== #（代码混淆选项配置）</span></span><br><span class="line"><span class="comment"># Obfuscation options </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#不混淆代码，默认混淆</span></span><br><span class="line">-dontobfuscate</span><br><span class="line"></span><br><span class="line"><span class="comment">#将mapping 打印到文件或后台</span></span><br><span class="line">-printmapping [filename]</span><br><span class="line"></span><br><span class="line"><span class="comment">#使用已有的mapping文件来混淆代码</span></span><br><span class="line">-applymapping filename</span><br><span class="line"></span><br><span class="line"><span class="comment">#指定希望被用做指定类和类成员混淆后新名字的列表</span></span><br><span class="line">-obfuscationdictionary filename</span><br><span class="line"></span><br><span class="line"><span class="comment">#指定一个文件，里面的所有名字将被用作混淆后类的名字</span></span><br><span class="line">-classobfuscationdictionary filename</span><br><span class="line"></span><br><span class="line"><span class="comment">#指定一个文件，里面的所有名字将被用作混淆后包的名字</span></span><br><span class="line">-packageobfuscationdictionary filename</span><br><span class="line"></span><br><span class="line"><span class="comment">#这只这个选项后，多个方法和域会使用同一个名字，只要他们的参数和返回类型不一样。这样可以减少优化后的size</span></span><br><span class="line">-overloadaggressively</span><br><span class="line"></span><br><span class="line"><span class="comment">#如果类成员在混淆前拥有相同的名字，那么混淆后也使用相同的名字，如果混淆前拥有不同的名字，那么混淆后也是用不同的名字。如果不设置这个参数，那么更多的成员可以被映射到同一个名字。如 ‘a’, ‘b’, 等。所以使用这个参数会稍微增加最后的size，但是这个可以确保被保存的混淆后的名字在后面的处理中被尊重。</span></span><br><span class="line">-useuniqueclassmembernames</span><br><span class="line"></span><br><span class="line"><span class="comment">#不生成大小写混合的类名。在默认情况下，混淆后的类名会包含大小写。但是当你在那些大小写不敏感的平台，比如windows下解压混淆后的jar，解包工具会将那些相似名字的类复写。</span></span><br><span class="line">-dontusemixedcaseclassnames</span><br><span class="line"></span><br><span class="line"><span class="comment">#不混淆指定的包名，包名用逗号分开。可以包含？ * ，** 等通配符，也可以用！前置</span></span><br><span class="line">-keeppackagenames [package_filter]</span><br><span class="line"></span><br><span class="line"><span class="comment">#将那些被重新命名的包重新打包，他们将会被移动到同一个父包里。如果不指定包名或者是空字串，那么他们会被打包到根包。</span></span><br><span class="line">-flattenpackagehierarchy [package_name]</span><br><span class="line"></span><br><span class="line"><span class="comment">#将那些被重新命名的类重新打包，如果没有指定参数或者是空字串，那么包会被完全删除。这个参数会覆盖 -flattenpackagehierarchy参数。</span></span><br><span class="line">-repackageclasses [package_name]</span><br><span class="line"></span><br><span class="line"><span class="comment">#指定需要被保留的属性，可以使用多条 -keepattributes命令。多条属性用逗号分开，也可以使用？ * ** 通配符，也可以使用！。例如，当你处理一个lib的时候至少得保留Exceptions, InnerClasses, and Signature 属性。当你生成混淆stack traces时应该保留SourceFile 和LineNumberTable 。最后你可以保留annotations 如果你的代码依赖他们。</span></span><br><span class="line">-keepattributes [attribute_filter]</span><br><span class="line"></span><br><span class="line"><span class="comment">#保留那些需要被保留的方法的参数名字。这个选项事实上保留的是LocalVariableTable 和LocalVariableTypeTable这两个debug属性的修剪版本。这在处理lib的时候很有用。有些IDE可以用这些信息去协助开发者，比如工具提示和自动补全。</span></span><br><span class="line">-keepparameternames</span><br><span class="line"></span><br><span class="line"><span class="comment">#指定一个放在类文件SourceFile 属性的String。这些属性必须放在开头，所以这也必须用-keepattributes 显示的指定。</span></span><br><span class="line">-renamesourcefileattribute [string]</span><br><span class="line"></span><br><span class="line"><span class="comment">#指定那些对应到某个class name的String常量也要被混淆。如果没有设置过滤，所有对应于某个class name的string都要被适配。如果有设置过滤，只适配匹配过滤的string。举个例子，如果你的代码中有大量对应class的硬编码的string，然后你又不想保留他们的名字，就可以可以使用这个选项。</span></span><br><span class="line">-adaptclassstrings [class_filter]</span><br><span class="line"></span><br><span class="line"><span class="comment">#指定对资源文件重命名的时候，使用对应class被混淆后的名字。如果没有指定过滤，所有资源文件都会被重命名，如果设置过滤，只有匹配的资源文件才会被过滤</span></span><br><span class="line">-adaptresourcefilenames [file_filter]</span><br><span class="line"></span><br><span class="line"><span class="comment">#指定内容需要被更新的资源文件。任何在这些资源文件中被提及的class name都要被重名，基于那些相应的类被混淆后的名字。如果没有设置过滤，所有资源文件的内容将被更新。资源文件使用系统默认的字符集来解析和写入。你可以通过设置环境变量 LANG或者java 系统属性 file.encoding来更改。 </span></span><br><span class="line"><span class="comment">#警告: 你可能只希望将这个选项应用于text文件，因为解析和适配二进制文件会导致一些意想不到的问题，所以请确保你的指定的file足够精确.</span></span><br><span class="line">-adaptresourcefilecontents [file_filter]</span><br><span class="line"></span><br><span class="line"><span class="comment"># ======================================== #（预校验选项）</span></span><br><span class="line"><span class="comment"># Preverification options </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#不对类文件进行预校验。默认情况下，如果类文件的目标是Java ME或者不低于java 6，都会进行预校验。 </span></span><br><span class="line"><span class="comment">#对于Java ME，预校验是要求的，所以你需要运行一个外部的预校验过程在你处理过的代码上如果你设置了这个选项。对于 java 6 这是一个可选的选项，但是在java 7 这是被要求的。只有在andriod中这是不被强制要求的，所以你可以关闭这个选项。</span></span><br><span class="line">-dontpreverify</span><br><span class="line"></span><br><span class="line"><span class="comment">#指定被处理的class file是指向Java ME的。这样预校验就会适当的添加StackMap属性，这个和默认的StackMapTable属性不一样，因为这是对于Java SE来说。</span></span><br><span class="line">-microedition</span><br><span class="line"></span><br><span class="line"><span class="comment"># ======================================== #（一般选项）</span></span><br><span class="line"><span class="comment"># General options </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#在处理过程中输出更详细的信息，如果在处理过程中出现异常，将会输出完整的调用栈，而不是只有错误信息</span></span><br><span class="line">-verbose</span><br><span class="line"></span><br><span class="line"><span class="comment">#不要输出配置文件的潜在错误和遗漏，比如类名拼写错误或者缺少一些有用的选项。可选的过滤器是一个正则表达式；ProGuard 不会打印那些被过滤器匹配成功的类名的信息。</span></span><br><span class="line">-dontnote [class_filter]</span><br><span class="line"></span><br><span class="line"><span class="comment">#完全不要警告unresolved references 和 其他重要的问题.可选的过滤器是一个正则表达式。 ProGuard 不会打印那些被过滤器匹配的成功的类的警告信息。忽略警告是非常危险的，举个例子，如果 unresolved classes or class members是确实被需要的，那么代码可能无法正常工作，所以请小心使用</span></span><br><span class="line">-dontwarn [class_filter]</span><br><span class="line"></span><br><span class="line"><span class="comment">#打印任何关于unresolved references 和其他重要问题的警告，但是会继续处理下去。忽略警告是危险的。举个例子如果 unresolved classes or class members是确实被需要的，那么代码可能无法正常工作，所以请小心使用</span></span><br><span class="line">-ignorewarnings</span><br><span class="line"></span><br><span class="line"><span class="comment">#将配置文件的内容，包括被替换的变量和引入的文件打印到后台或者文件。</span></span><br><span class="line">-printconfiguration [filename]</span><br><span class="line"></span><br><span class="line"><span class="comment">#在任何处理步骤后，输出类文件的内部结构。可以输出到后台或者文件。比如，你可能希望打印出一个jar包的所有内容。</span></span><br><span class="line">-dump [filename]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#另外 ProGuard还可以基于类文件的完整相对名字来过滤类路径和他们的内容。每个类路径可以被最多7个文件过滤器跟着，这些过滤器用圆括号括起来，并用分号分开：</span></span><br><span class="line"><span class="comment">#用于aar的过滤器,</span></span><br><span class="line"><span class="comment">#用于apk 的过滤器,</span></span><br><span class="line"><span class="comment">#用于zip 的过滤器,</span></span><br><span class="line"><span class="comment">#用于ear 的过滤器,</span></span><br><span class="line"><span class="comment">#用于war 的过滤器,</span></span><br><span class="line"><span class="comment">#用于jar 的过滤器,</span></span><br><span class="line"><span class="comment">#用于所有类文件名和资源文件名的过滤器.</span></span><br><span class="line"><span class="comment">#如果少于7个过滤器被指定，他们会被认为是后者的过滤器。任何空的过滤器会被忽略。更正式，一个被过滤的class path可以如下：</span></span><br><span class="line">classpathentry([[[[[[aarfilter;]apkfilter;]zipfilter;]earfilter;]warfilter;]jarfilter;]filefilter)</span><br><span class="line"></span><br><span class="line"><span class="comment">#方括号的意思是里面的内容是可选的</span></span><br><span class="line"><span class="comment">#例如, “rt.jar(java/.class,javax/.class)” 匹配rt.jar中所有在java和javax目录下的class文件</span></span><br><span class="line"><span class="comment">#例如, “input.jar(!.gif,images/)” 匹配在input.jar里images目录下所有文件，除了.gif文件</span></span><br><span class="line"><span class="comment">#不同的过滤器会被应用到所有相应的文件类型，不管他们在jar中的嵌套层次；他们是正交的（orthogonal）</span></span><br><span class="line"><span class="comment">#例如, “input.war(lib/.jar,support/.jar;.class,.gif)” 只关注input war 里lib目录下的jar和suppor目录下的jar，然后会匹配所有遇到的class文件和gif文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#File names</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ProGuard 接受文件和目录的绝对路径和相对路径。相对路径的解释如下： </span></span><br><span class="line"><span class="comment">#如果设置了基准目录，则就相对基准目录，否则就相对与配置文件的路径，其他任何情况就相对与工作目录。名字可以包含java系统属性（或者Ant 属性，如果使用Ant），用’&lt;’和’&gt;’分隔。属性会被自动替换成他们对应点值。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#那些带有特殊字符的名字像空格和括号，必须用单引号或者双引号括起来。每个在列表中的名字必须用引号单独的括起来。引号本身需要escaped 当使用命令行的时候，来避免被shell gobbled。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#例如，在命令行，你可以使用’-injars “myprogram.jar”:”/your directory/your program.jar”’</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#File filters</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#像通用过滤器，文件过滤器是一个包含通配符，用逗号分开的名字列表。只有名字匹配了过滤的的文件才会被读取或者写入。支持以下通配符：</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#? 匹配任何单个字符 </span></span><br><span class="line"><span class="comment">#* 匹配文件名的任何部分，除了路径分隔符 </span></span><br><span class="line"><span class="comment">#** 匹配文件名的任何部分，包含任意个文件分隔符</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#例如, “java/.class,javax/.class” 匹配所有在java和javax里的class文件。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#此外, 文件名字之前可以加！，表示排除这个文件名</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#例如，”!**.gif,images/**”匹配所有在images目录下除了gif文件之外的所有文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Filters</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ProGuard提供了很多带有过滤器的选项，在配置的各个方面：文件名，目录，类，包，属性，优化等。 过滤器是包含了一串用逗号分开的含有通配符的名字列表。只有匹配的名字才可以通过过滤器。支持的通配符依赖于那些被过滤名字的类型，但是以下的通配符是典型的： </span></span><br><span class="line"><span class="comment">#A filter is a list of comma-separated names that can contain wildcards. Only names that match an item on the list pass the filter. The supported wildcards depend on the type of names for which the filter is being used, but the following wildcards are typical:</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#? 匹配任何单个字符 </span></span><br><span class="line"><span class="comment">#* 匹配文件名的任何部分，除了路径分隔符</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#此外, 名字还可以用！做前缀来用于在后面的匹配中将该名字排除。所以一个名字如果匹配一个过滤器，它是被拒绝或者接受取决于那个过滤器的条目是不是以！开头。如果名字不匹配这个过滤条目，就继续匹配接下来的条目。如果不匹配任何个条目，它是被拒绝还是接受要取决于最后的过滤条目是否以！开头</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#例如, “!foobar,*bar” 匹配所有以bar结尾的名字，除了footbar。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Keep option modifiers</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#如果某些方法和域被-keep保留，那么这些方法和域的类型描述符中的任何类也要被保留。这在保留native方法名字时很有用，用来确保native方法的参数类型不会被重命名。</span></span><br><span class="line">includedescriptorclasses</span><br><span class="line"></span><br><span class="line"><span class="comment">#指定被-keep保留的条目可以被压缩，即使他们不得不被保留。意思是，条目可能在压缩步骤中被移除，但是如果他们是必须的，他们可以不被优化或者混淆。</span></span><br><span class="line">allowshrinking</span><br><span class="line"></span><br><span class="line"><span class="comment">#指定被-keep的条目可以被优化，即使他们必须被保留。意思是条目可能在优化步骤中被改变，但是他们可以不被移除或者混淆。</span></span><br><span class="line">allowoptimization</span><br><span class="line"></span><br><span class="line"><span class="comment">#指定被-keep的条目可以被混淆，即使他们必须被保留。意思是，条目可能在混淆步骤中被改名，但是他们可以不被移除和优化。</span></span><br><span class="line">allowobfuscation</span><br><span class="line"></span><br><span class="line"><span class="comment">#各种各样的用于压缩和混淆的-keep选项 在刚开始可能让人感觉混乱，但是却是有规律的。下表罗列了他们之间的关系：</span></span><br><span class="line">Overview of keep options</span><br><span class="line"></span><br><span class="line"><span class="comment">#Keep	From being removed or renamed	From being renamed</span></span><br><span class="line"><span class="comment">#Classes and class members	-keep	-keepnames</span></span><br><span class="line"><span class="comment">#Class members only	-keepclassmembers	-keepclassmembernames</span></span><br><span class="line"><span class="comment">#Classes and class members, if class members present	-keepclasseswithmembers	-keepclasseswithmembernames</span></span><br><span class="line"><span class="comment">#每一个-keep 选项后面会跟着一个类和类成员的定义，-keep将被引用到这些类和类成员中。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#如果你不确定你需要哪一个选项，你应该简单的使用-keep。它会确保指定的类好成员不会在压缩步骤中被移除，和在混淆步骤中被改名。</span></span><br><span class="line"><span class="comment">#如果你指定类的时候没有指定类成员，ProGuard只会保留类和它的无参构造函数。</span></span><br><span class="line"><span class="comment">#如果你指定了一个方法，ProGuard只会保留这个方法，它的代码任然会被优化和适配。</span></span><br></pre></td></tr></table></figure><h3 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#例如下面的proguad-rules.pro</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#指定library文件</span></span><br><span class="line">-libraryjars &lt;java.home&gt;/lib/rt.jar</span><br><span class="line"></span><br><span class="line"><span class="comment"># JDK目标版本1.8</span></span><br><span class="line">-target 1.8</span><br><span class="line"></span><br><span class="line"><span class="comment"># 不做收缩（删除注释、未被引用代码）</span></span><br><span class="line">-dontshrink</span><br><span class="line"></span><br><span class="line"><span class="comment"># 不做优化（变更代码实现逻辑）</span></span><br><span class="line">-dontoptimize</span><br><span class="line"></span><br><span class="line"><span class="comment"># 用于告诉ProGuard，不要跳过对非公开类的处理。</span></span><br><span class="line"><span class="comment"># 默认情况下是跳过的，因为程序中不会引用它们，</span></span><br><span class="line"><span class="comment"># 有些情况下人们编写的代码与类库中的类在同一个包下，并且对包中内容加以引用，此时需要加入此条声明。</span></span><br><span class="line">-dontskipnonpubliclibraryclasses</span><br><span class="line"></span><br><span class="line"><span class="comment"># 优化时允许访问并修改有修饰符的类和类的成员</span></span><br><span class="line">-dontskipnonpubliclibraryclassmembers</span><br><span class="line"></span><br><span class="line"><span class="comment"># 确定统一的混淆类的成员名称来增加混淆</span></span><br><span class="line">-allowaccessmodification</span><br><span class="line"></span><br><span class="line"><span class="comment"># 保留第三方jar包的所有类及其成员和方法，例如&#123;*;&#125;匹配了类内的所有成员和方法。</span></span><br><span class="line">-useuniqueclassmembernames</span><br><span class="line"></span><br><span class="line">-dontwarn org.apache.logging.log4j.**</span><br><span class="line"></span><br><span class="line">-keep class org.apache.logging.log4j.** &#123; *;&#125;</span><br><span class="line"><span class="comment"># 不混淆所有包名，本人测试混淆后WEB项目问题实在太多，毕竟Spring配置中有大量固定写法的包名</span></span><br><span class="line">-keeppackagenames</span><br><span class="line"><span class="comment"># 不混淆所有特殊的类</span></span><br><span class="line">-keepattributes Exceptions,InnerClasses,Signature,Deprecated,SourceFile,LineNumberTable,LocalVariable*Table,*Annotation*,Synthetic,EnclosingMethod</span><br><span class="line"><span class="comment"># 不混淆所有的set/get方法，毕竟项目中使用的部分第三方框架（例如Shiro）会用到大量的set/get映射</span></span><br><span class="line">-keepclassmembers public class * &#123;void <span class="built_in">set</span>*(***);*** get*();&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 不混淆security包下的所有类名，且类中的方法也不混淆</span></span><br><span class="line">-keep class com.*.security.** &#123; &lt;methods&gt;; &#125;</span><br><span class="line"><span class="comment"># 不混淆model包中的所有类以及类的属性及方法，实体包，混淆了会导致ORM框架及前端无法识别</span></span><br><span class="line">-keep class com.*.model.** &#123;*;&#125;</span><br><span class="line"><span class="comment"># 以下两个包因为大部分是Spring管理的Bean，不对包类的类名进行混淆，但对类中的属性和方法混淆</span></span><br><span class="line">-keep class com.*.service.** </span><br><span class="line">-keep class com.*.dao.**</span><br><span class="line">-keep class com.*.interceptor.** &#123;&lt;methods&gt;;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 有了verbose这句话，混淆后就会生成映射文件</span></span><br><span class="line"><span class="comment"># 包含有类名-&gt;混淆后类名的映射关系</span></span><br><span class="line"><span class="comment"># 然后使用printmapping指定映射文件的名称</span></span><br><span class="line">-verbose</span><br><span class="line">-printmapping proguardMapping.txt</span><br><span class="line"><span class="comment"># 指定混淆时采用的算法，后面的参数是一个过滤器</span></span><br><span class="line"><span class="comment"># 这个过滤器是谷歌推荐的算法，一般不改变</span></span><br><span class="line">-optimizations !code/simplification/arithmetic,!field/*,!class/merging/*</span><br><span class="line"></span><br><span class="line">-keepdirectories</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这个是给Microsoft Windows用户的，因为ProGuard假定使用的操作系统是能区分两个只是大小写不同的文件名，</span></span><br><span class="line"><span class="comment"># 但是Microsoft Windows不是这样的操作系统，所以必须为ProGuard指定-dontusemixedcaseclassnames选</span></span><br><span class="line">-dontusemixedcaseclassnames</span><br><span class="line"></span><br><span class="line"><span class="comment"># 保留所有的本地native方法不被混淆</span></span><br><span class="line">-keepclasseswithmembernames class * &#123;</span><br><span class="line">    native &lt;methods&gt;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 保留了com.*.web.common.BaseController</span></span><br><span class="line"><span class="comment"># 保留了继承自BaseController这些类的子类</span></span><br><span class="line"><span class="comment"># 因为这些子类，都有可能被外部调用</span></span><br><span class="line"><span class="comment"># 比如说，第一行就保证了所有Activity的子类不要被混淆</span></span><br><span class="line"> -keep public class * com.*.web.common.BaseController</span><br><span class="line"> -keep public class * extends com.*.web.common.BaseController</span><br><span class="line"></span><br><span class="line"><span class="comment"># 枚举类不能被混淆</span></span><br><span class="line">-keepclassmembers enum * &#123;</span><br><span class="line">    public static **[] values();</span><br><span class="line">    public static ** valueOf(java.lang.String);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 保留实体类和成员不被混淆</span></span><br><span class="line">-keep public class * extends com.*.model.common.BaseModel &#123;</span><br><span class="line">    public void <span class="built_in">set</span>*(***);</span><br><span class="line">    public *** get*();</span><br><span class="line">    public *** is*();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div></div><div></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> smalle</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="http://blog.aezo.cn/2022/09/06/extend/proguard/" title="Proguard —— 加密java代码">http://blog.aezo.cn/2022/09/06/extend/proguard/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！</li></ul></div><footer class="post-footer"><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2022/05/12/java/Quartz/" rel="next" title="Quartz任务调度"><i class="fa fa-chevron-left"></i> Quartz任务调度</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"></div></div></footer></article><div class="post-spread"></div></div></div><div class="comments" id="comments"></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap"> 文章目录</li><li class="sidebar-nav-overview" data-target="site-overview"> 站点概览</li></ul><section class="site-overview sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" src="https://avatars0.githubusercontent.com/u/15698218?v=3&u=ce740bf0b67ff0d74990ba6fc644d6e92f572dcb&s=400" alt="smalle"><p class="site-author-name" itemprop="name">smalle</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">159</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/index.html"><span class="site-state-item-count">13</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/index.html"><span class="site-state-item-count">141</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#简介"><span class="nav-number">1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Springboot案例"><span class="nav-number">2.</span> <span class="nav-text">Springboot案例</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#配置模板"><span class="nav-number">3.</span> <span class="nav-text">配置模板</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#配置参数"><span class="nav-number">4.</span> <span class="nav-text">配置参数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#案例"><span class="nav-number">4.1.</span> <span class="nav-text">案例</span></a></li></ol></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2016 - <span itemprop="copyrightYear">2022</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">smalle</span>&nbsp;&nbsp;&nbsp;&nbsp;<div class="powered-by"> 由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div><div class="powered-by"> 主题 - <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a></div><div class="theme-info cnzz" style="margin:0 0 -5px 10px"><script type="text/javascript">var cnzz_protocol="https:"==document.location.protocol?"https://":"http://";document.write(unescape("%3Cspan id='cnzz_stat_icon_1276691827'%3E%3C/span%3E%3Cscript src='"+cnzz_protocol+"s23.cnzz.com/z_stat.php%3Fid%3D1276691827%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"))</script></div></div><div class="ad"> <span style="font-weight:700">AD&nbsp;&nbsp;&nbsp;&nbsp;</span><div class="theme-info"> <a target="_blank" href="https://promotion.aliyun.com/ntms/yunparter/invite.html?userCode=oby5nolb">阿里云大礼包</a></div></div><div class="aezocn"> <span style="font-weight:700">@AEZO.CN&nbsp;&nbsp;&nbsp;&nbsp;</span><div class="theme-info"> <a target="_blank" href="http://shop.aezo.cn/">杂货铺</a></div></div><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?d82223039d601f2f819f8fe140a63468";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script><script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script type="text/javascript" src="/js/src/js.cookie.js?v=5.1.1"></script><script type="text/javascript" src="/js/src/scroll-cookie.js?v=5.1.1"></script></body></html>