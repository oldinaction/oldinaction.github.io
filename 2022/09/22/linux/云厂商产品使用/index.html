<!doctype html><html class="theme-next mist use-motion" lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css"><meta name="keywords" content="aezo, aezocn, smalle blog"><link rel="alternate" href="/atom.xml" title="月星墙的博客" type="application/atom+xml"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1"><meta name="description" content="简介 Gist(一些免费的云资源) 16个免费的VPS  业务短信 短信服务（Short Message Service、SMS）是指通过调用短信发送API，将指定短信内容发送给指定手机用户  阿里云短信服务 阿里云短信服务产品介绍：https://www.aliyun.com/product/sms 支持API或在阿里云后台通过群发助手导入Excel批量发送短信(支持模板变量) 短信字数含”签名"><meta property="og:type" content="article"><meta property="og:title" content="云厂商产品使用"><meta property="og:url" content="http://blog.aezo.cn/2022/09/22/linux/云厂商产品使用/index.html"><meta property="og:site_name" content="月星墙的博客"><meta property="og:description" content="简介 Gist(一些免费的云资源) 16个免费的VPS  业务短信 短信服务（Short Message Service、SMS）是指通过调用短信发送API，将指定短信内容发送给指定手机用户  阿里云短信服务 阿里云短信服务产品介绍：https://www.aliyun.com/product/sms 支持API或在阿里云后台通过群发助手导入Excel批量发送短信(支持模板变量) 短信字数含”签名"><meta property="og:locale" content="zh-Hans"><meta property="og:updated_time" content="2025-10-15T02:12:24.499Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="云厂商产品使用"><meta name="twitter:description" content="简介 Gist(一些免费的云资源) 16个免费的VPS  业务短信 短信服务（Short Message Service、SMS）是指通过调用短信发送API，将指定短信内容发送给指定手机用户  阿里云短信服务 阿里云短信服务产品介绍：https://www.aliyun.com/product/sms 支持API或在阿里云后台通过群发助手导入Excel批量发送短信(支持模板变量) 短信字数含”签名"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Mist",sidebar:{position:"right",display:"post",offset:12,offset_float:0,b2t:!1,scrollpercent:!1},fancybox:!0,motion:!0,duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"BWD6R9FA4K",apiKey:"3330f3cbaa099dfc30395de5f5b20151",indexName:"blog",hits:{per_page:10},labels:{input_placeholder:"请输入关键字",hits_empty:"我们没有找到任何搜索结果: ${query}",hits_stats:"找到约${hits}条结果（用时${time}ms）"}}}</script><link rel="canonical" href="http://blog.aezo.cn/2022/09/22/linux/云厂商产品使用/"><title>云厂商产品使用 | 月星墙的博客</title><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?085f9cd91ef2ad985f791c677472f0d1";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-right page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">月星墙的博客</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">Better Code, Better Life</h1></div><div class="site-nav-toggle"> <button><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br> 首页</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br> 分类</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br> 关于</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br> 归档</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br> 标签</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="menu-item-icon fa fa-fw fa-sitemap"></i><br> 站点地图</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br> 搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i></span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"> <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://blog.aezo.cn/2022/09/22/linux/云厂商产品使用/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="smalle"><meta itemprop="description" content=""><meta itemprop="image" content="https://avatars0.githubusercontent.com/u/15698218?v=3&u=ce740bf0b67ff0d74990ba6fc644d6e92f572dcb&s=400"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="月星墙的博客"></span><header class="post-header"><h2 class="post-title" itemprop="name headline">云厂商产品使用</h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2022-09-22T21:00:00+08:00">2022-09-22</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a></span></span></div></header><div class="post-body" itemprop="articleBody"><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><ul><li><a href="https://gist.github.com/imba-tjd/d73258f0817255dbe77d64d40d985e76" target="_blank" rel="noopener">Gist(一些免费的云资源)</a></li><li><a href="https://www.fuwu7.com/vps/3637.html" target="_blank" rel="noopener">16个免费的VPS</a></li></ul><h2 id="业务"><a href="#业务" class="headerlink" title="业务"></a>业务</h2><h3 id="短信"><a href="#短信" class="headerlink" title="短信"></a>短信</h3><ul><li>短信服务（Short Message Service、SMS）是指通过调用短信发送API，将指定短信内容发送给指定手机用户</li></ul><h4 id="阿里云短信服务"><a href="#阿里云短信服务" class="headerlink" title="阿里云短信服务"></a>阿里云短信服务</h4><ul><li>阿里云短信服务产品介绍：<a href="https://www.aliyun.com/product/sms" target="_blank" rel="noopener">https://www.aliyun.com/product/sms</a><ul><li>支持API或在阿里云后台通过<code>群发助手</code>导入Excel批量发送短信(支持模板变量)</li><li>短信字数含”签名+模版内容+变量内容”，短信70个字数含以内，按1条短信计费；超出70个字为长短信，按照67个字数记为1条短信费用（如果短信内容过长可能算作多条费用，具体参考阿里云对应计费规则）</li></ul></li><li>短信发送API帮助文档(Java)：<a href="https://help.aliyun.com/document_detail/55284.html" target="_blank" rel="noopener">https://help.aliyun.com/document_detail/55284.html</a></li><li>下载官方SDK：<a href="https://help.aliyun.com/document_detail/55359.html" target="_blank" rel="noopener">https://help.aliyun.com/document_detail/55359.html</a></li><li>发送短信(发送验证码)需要以下配置<ul><li>在阿里云管理后台右上角，账号 - AccessKey管理中查看<code>accessKeyId</code>、<code>accessKeySecret</code><ul><li>或者新增子账号，并赋权(搜索SMS，赋权AliyunDysmsFullAccess)</li></ul></li><li>短信签名(类似短信前缀，如【阿里云】)<ul><li>一般要求网站可访问，且网站对应信息和备案/主体信息一致</li></ul></li><li>自己配置的短信模板ID（如：SMS_45680123）</li><li>模板变量（如果模板中存在变量，如${code}）<ul><li>变量值不支持QQ号、微信号、网址信息；1~35位字符，但电话号码支持5~11位</li><li>通知短信非变量是支持微信号内容</li></ul></li></ul></li><li>部分业务场景可配置短信发送状态回调接口实现状态接收<ul><li>进入系统设置 - 通用设置 - HTTP批量推送模式(开启) - 接收地址(需要上线后的地址，配置时会检测)</li><li>也可接入短信发送详情主动查询接口查看短信发送与用户接收情况，或通过进入业务统计 - 发送记录查询界面查看</li></ul></li><li>使用maven</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- aliyun短信 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-java-sdk-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.5.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>工具类示例</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SmsU</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SmsU.sendMessage(<span class="string">"15812345678"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*********************************************  需要修改的部分start  *************************************************/</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 需要替换为自己的ACCESS_KEY_ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String ACCESS_KEY_ID = <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 需要替换为自己的ACCESS_KEY_SECRET</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String ACCESS_KEY_SECRET = <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 这里要修改为自己的短信签名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String SIGN_NAME = <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改为自己的模板CODE</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TEMPLATE_CODE = <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 模板中的变量名称，例如模板中为$&#123;code&#125;，此处就填写code</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TEMPLATE_PARAM = <span class="string">"code"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*********************************************  需要修改的部分end  *************************************************/</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Pattern PATTERN = Pattern.compile(<span class="string">"^((13[0-9])|(15[^4,\\D])|(18[0-9]))\\d&#123;8&#125;$"</span>);</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 下面是一些默认的配置，无需修改</span></span><br><span class="line"><span class="comment">     * REGION_ID 服务器大区   不建议修改</span></span><br><span class="line"><span class="comment">     * SYS_DOMAIN API地址   不可修改</span></span><br><span class="line"><span class="comment">     * SYS_VERSION 系统版本 不可修改</span></span><br><span class="line"><span class="comment">     * SYS_ACTION API接口名必须为SendSms 不可修改</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String REGION_ID = <span class="string">"cn-hangzhou"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String SYS_DOMAIN = <span class="string">"dysmsapi.aliyuncs.com"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String SYS_VERSION = <span class="string">"2017-05-25"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String SYS_ACTION = <span class="string">"SendSms"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> IAcsClient client = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> CommonRequest request = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        DefaultProfile profile = DefaultProfile.getProfile(REGION_ID, ACCESS_KEY_ID, ACCESS_KEY_SECRET);</span><br><span class="line">        client = <span class="keyword">new</span> DefaultAcsClient(profile);</span><br><span class="line">        request = <span class="keyword">new</span> CommonRequest();</span><br><span class="line">        request.setSysMethod(MethodType.POST);</span><br><span class="line">        request.setSysDomain(SYS_DOMAIN);</span><br><span class="line">        request.setSysVersion(SYS_VERSION);</span><br><span class="line">        request.setSysAction(SYS_ACTION);</span><br><span class="line">        request.putQueryParameter(<span class="string">"RegionId"</span>, REGION_ID);</span><br><span class="line">        request.putQueryParameter(<span class="string">"SignName"</span>, SIGN_NAME);</span><br><span class="line">        request.putQueryParameter(<span class="string">"TemplateCode"</span>, TEMPLATE_CODE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">SmsU</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 发送短信</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> phoneNumber 手机号码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> code</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title">sendMessage</span><span class="params">(String phoneNumber)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!isPhoneNumber(phoneNumber)) &#123;</span><br><span class="line">            <span class="keyword">return</span> Result.failure(<span class="string">"手机号格式不正确"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取六位随机数. 基于Hutool</span></span><br><span class="line">        String code = RandomUtil.randomString(<span class="string">"0123456789"</span>, <span class="number">6</span>);</span><br><span class="line">        <span class="comment">// 初始化用户自定义参数</span></span><br><span class="line">        request.putQueryParameter(<span class="string">"PhoneNumbers"</span>, phoneNumber);</span><br><span class="line">        <span class="comment">// 在短信内容中嵌入随机数</span></span><br><span class="line">        request.putQueryParameter(<span class="string">"TemplateParam"</span>, <span class="string">"&#123;\""</span> + TEMPLATE_PARAM + <span class="string">"\":\""</span> + code + <span class="string">"\"&#125;"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 发送的业务逻辑</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// &#123;"Message":"账户余额不足","RequestId":"415E9BF0-6904-5920-933A-F27B920E2644","Code":"isv.AMOUNT_NOT_ENOUGH"&#125;</span></span><br><span class="line">            <span class="comment">// &#123;"Message":"触发分钟级流控Permits:1","RequestId":"9D7F3798-1CA1-5110-9056-1ECB14A91097","Code":"isv.BUSINESS_LIMIT_CONTROL"&#125;</span></span><br><span class="line">            <span class="comment">// &#123;"Message":"OK","RequestId":"2E6BD8A4-D1A3-5A25-A237-2AB702893632","Code":"OK","BizId":"303700784907161870^0"&#125;</span></span><br><span class="line">            CommonResponse response = client.getCommonResponse(request);</span><br><span class="line">            <span class="keyword">if</span>(response.getHttpStatus() != <span class="number">200</span> || !<span class="string">"OK"</span>.equals(JSONUtil.parseObj(response.getData()).get(<span class="string">"Message"</span>))) &#123;</span><br><span class="line">                log.error(<span class="string">"发送短信失败 &#123;&#125; &#123;&#125; &#123;&#125;"</span>, phoneNumber, response.getHttpStatus(), response.getData());</span><br><span class="line">                <span class="keyword">return</span> Result.failure(<span class="string">"发送短信失败"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">"发送短信出错 &#123;&#125;"</span>, phoneNumber, e);</span><br><span class="line">            <span class="keyword">return</span> Result.failure(<span class="string">"发送短信出错"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Result.success(code);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isPhoneNumber</span><span class="params">(String phoneNumber)</span> </span>&#123;</span><br><span class="line">        Matcher m = PATTERN.matcher(phoneNumber);</span><br><span class="line">        <span class="keyword">return</span> m.matches();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>其中模板中的<code>${code}</code>即为随机生成的验证码，将此验证码发送到用户手机，并将此验证码和其过期时间一起保存到session中供业务验证</li></ul><h3 id="敏感词检测"><a href="#敏感词检测" class="headerlink" title="敏感词检测"></a>敏感词检测</h3><h4 id="ToolGood-Words"><a href="#ToolGood-Words" class="headerlink" title="ToolGood.Words"></a>ToolGood.Words</h4><ul><li><a href="https://github.com/toolgood/ToolGood.Words" target="_blank" rel="noopener">ToolGood.Words</a></li><li>敏感词下载：<a href="https://github.com/toolgood/ToolGood.Words/blob/master/java/sensi_words.txt" target="_blank" rel="noopener">https://github.com/toolgood/ToolGood.Words/blob/master/java/sensi_words.txt</a></li><li>功能一般，没有在线API智能；比如提供的敏感词库中包含了”的”，则只有文本中有”的”字就都会判作敏感</li><li>maven</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 敏感词校验: https://github.com/toolgood/ToolGood.Words/blob/master/java/toolgood.words/README.MD --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.github.toolgood<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>toolgood-words<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>使用</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">StringSearch commonStringSearch = <span class="keyword">new</span> StringSearch();</span><br><span class="line">commonStringSearch.SetKeywords(MiscU.toList(<span class="string">"敏感词1"</span>, <span class="string">"敏感词2"</span>));</span><br><span class="line">commonStringSearch.ContainsAny(<span class="string">"我包含了敏感词1"</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><h2 id="阿里云"><a href="#阿里云" class="headerlink" title="阿里云"></a>阿里云</h2><ul><li><a href="https://www.bilibili.com/video/BV14e411T7G1" target="_blank" rel="noopener">https://www.bilibili.com/video/BV14e411T7G1</a></li><li><a href="https://www.bilibili.com/video/BV1aS4y1h7Xx" target="_blank" rel="noopener">https://www.bilibili.com/video/BV1aS4y1h7Xx</a></li><li><a href="https://www.bilibili.com/video/BV1cN411X7b4" target="_blank" rel="noopener">https://www.bilibili.com/video/BV1cN411X7b4</a></li></ul><h3 id="ECS云服务器"><a href="#ECS云服务器" class="headerlink" title="ECS云服务器"></a>ECS云服务器</h3><h4 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h4><ul><li>新增磁盘<ul><li>参考: <a href="https://developer.aliyun.com/article/773264" target="_blank" rel="noopener">https://developer.aliyun.com/article/773264</a></li><li>新买的磁盘(数据盘)，需要先在阿里云管理后台进行挂载，然后进入Windows系统进行联机 - 初始化(MBR即可) - 新建简单卷即可</li></ul></li></ul><h4 id="快照"><a href="#快照" class="headerlink" title="快照"></a>快照</h4><ul><li>菜单位置：云服务器 ECS / 快照</li><li>费用<ul><li>快照存储费用: 100G = 0.4元/天</li><li>异地快照备份(可选): 网络传输费(0.5元/GB) + 异地存储费(同上)</li></ul></li><li>云盘快照<ul><li>创建快照：<strong>创建速度很快(如100G几秒钟就完成了)</strong> - 阿里云自动将快照上传到OSS(相对较慢, 如100G需要10分钟) - 恢复快照速度很快(几秒钟)<ul><li>如果非高并发等对性能要求很高的场景，对数据库备份基本无影响(如设置成每天0/10/12/15/18/22点进行快照)</li></ul></li><li>恢复快照(回滚云盘)：先服务器停机 - 对某个快照执行回滚云盘；如果当前正在备份或上传快照则无法对服务器停机</li><li><strong>创建自定义镜像</strong>：将某个快照创建成自定义镜像<ul><li>可将此镜像创建新的ECS实例</li><li>或复制到另外一台服务器上(停机后，更换操作系统): 目标服务器的磁盘必须大于等于镜像磁盘(否则需要补扩充磁盘的费用, 还是最低100G?)</li><li>可复制到其他阿里云账号下(共享镜像)</li></ul></li></ul></li><li>自动快照策略<ul><li>同一个磁盘只能设置一个自动快照策略，如需要设置多个时段创建快照，可设置成如：周一至周日的0,12,18点进行快照</li><li>案例：如果100G的数据，每天创建一个快照，保留最近3天的快照，则每天存储的数据量为300G，相当于1.2元/天。(如果磁盘为100G，只使用了20G，则按照20G的数据计算)</li></ul></li><li>快照一致性组：如可以将某个服务器的系统盘和数据盘进行快照绑定，防止数据不一致的情况（类似整机快照）；但是要求为ESSD类型云盘（高效云盘不支持）</li><li>ECS整机备份?</li></ul><h4 id="云服务器迁移流程"><a href="#云服务器迁移流程" class="headerlink" title="云服务器迁移流程"></a>云服务器迁移流程</h4><blockquote><p>场景: 阿里云某个实例不再续费，重新购买实例，将老实例整体迁移到新实例</p></blockquote><ul><li>先关闭老实例上应用程序</li><li>基于自定义镜像创建<ul><li>再对老实例创建快照，然后创建自定义镜像。如果新实例再另外一个阿里云账户则可将实例共享给其他账户；如果新实例在另外一个厂商，可下载镜像到本地然后上传</li><li>创建新实例，创建的时候镜像选择自定义镜像或共享镜像，密码可使用镜像中的密码(这样密码无需更换)<ul><li>新实例磁盘大小必须大于等于镜像磁盘大小，其他可进行减配</li><li>新实例的安全组开放端口需设置成和老实例一致</li><li>实例创建后自动启动</li></ul></li></ul></li><li>克隆实例: 克隆时选择保留数据(会创建新的磁盘和公网IP)，开始克隆钱需要保证账户中余额足够</li><li>对于宝塔面板<ul><li>直接通过新的外网IP访问即可(访问后可将面板设置 - 服务器IP修改成新的IP)</li><li>宝塔面板https如果基于IP则需要重新申请证书：要先关闭面板SSL，然后重新打开(需要保证认证域名为新的IP)再下载证书即可</li><li>宝塔项目中配置的证书无需修改(证书是基于域名签署的)</li></ul></li><li>修改域名映射的外网IP地址</li><li>最后回到老阿里云账户，解除镜像共享(才能删除镜像和快照)，然后删除镜像和快照</li></ul><h3 id="CDN与ESA"><a href="#CDN与ESA" class="headerlink" title="CDN与ESA"></a>CDN与ESA</h3><ul><li>说明<ul><li>走了 CDN, 相当于源站前面有一层代理</li></ul></li><li>CDN: <a href="https://cdn.console.aliyun.com/" target="_blank" rel="noopener">https://cdn.console.aliyun.com/</a></li><li>边缘安全加速 ESA: <a href="https://esa.console.aliyun.com/" target="_blank" rel="noopener">https://esa.console.aliyun.com/</a> 下一代 CDN<ul><li>基础版: 9.9/月, 包含50G(超过部分0.198元/GB), 100% CDN功能, DDoS, 拦截流量不计费</li><li>站点管理: 添加域名 - 配置域名 DNS 服务器指向 ESA 指定的(不同于阿里云默认的云解析 DNS 服务器)<ul><li><strong>用量封顶</strong>: 按照分钟/小时/天/月配置站点流量超过阈值则可停用站点, 防止被攻击时超量导致额外费用</li><li>DNS - 记录: 解析域名, 启动代理加速(这样可以隐藏源 IP, 防止 DDoS等攻击)</li><li>SSL/TLS<ul><li>边缘证书<ul><li>走了 CDN, 相当于源站前面有一层代理, 所以需要网站 HTTPS, 则必须配置边缘证书(源站证书可以不用配置)</li><li>默认会生成 Let’s Encrypt 3 个月的免费证书, 会自动续签</li><li>强制HTTPS 开启</li><li>HSTS 开启</li></ul></li></ul></li><li>安全防护<ul><li>安全分析</li><li>WAF: 区域黑名单(如拦截国外, 支持放行,拦截,JS挑战等策略)</li><li>Bots: 绝对是Bot - 观察</li></ul></li><li>数据分析<ul><li>分析和日志 - 流量分析</li><li>安全防护 - 安全分析</li></ul></li></ul></li><li>流量计算<ul><li>请求(一般很小, 上传文件可能会大一些)和响应都计算在内</li><li>只有浏览器显示<code>from disk cache</code>才不计算在流量内，尽管命中了 ESA 的缓存(只是不回源了，仍然消耗 ESA 流量)也计算流量</li></ul></li><li>ESA 缓存命中判断，查询响应头的x-site-cache-status/x-cache等(类似 nginx $upstream_cache_status 取值), x-swift-cachetime 缓存时间<ul><li>HIT 响应包含来自缓存的最新有效的内容</li><li>MISS 响应在缓存中找不到，所以需要在服务器中取得。这个响应之后可能会被缓存起来</li><li>BYPASS 响应来自原始服务器而不是缓存，因为请求匹配了一个proxy_cache_bypass。这个响应之后可能会被缓存起来</li><li>DYNAMIC 如调用 API 会走原始服务器</li><li>EXPIRED 缓存中的某一项过期了，来自原始服务器的响应包含最新的内容</li></ul></li></ul></li></ul><h3 id="云安全中心-sas"><a href="#云安全中心-sas" class="headerlink" title="云安全中心(sas)"></a>云安全中心(sas)</h3><ul><li>价格案例</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 2024-09 购买2年 12348.00 元</span></span><br><span class="line">保有服务器台数：2</span><br><span class="line">应用防护授权数：8      <span class="comment"># WEB漏洞分析与防护</span></span><br><span class="line">防勒索：300G          <span class="comment"># 防勒索包含2层被动防御，和第3层备份机制（此处的空间就是用于备份的, 如数据库进行全量或增量备份, 无异地备份功能）</span></span><br><span class="line">防勒索托管服务：否     <span class="comment"># 指会有特定人员帮助到阿里云后台进行配置、之后有问题可协助数据恢复(仅快照恢复，如果需要数据解密需要找云市场的第三方机构)</span></span><br><span class="line">恶意文件检测SDK：否</span><br><span class="line">日志分析：50G</span><br><span class="line">版本选择：企业版</span><br></pre></td></tr></table></figure><ul><li>主机资产授权绑定解绑: 主机资产 - 服务器 - 剩余授权数 - 管理</li><li>风险治理 - 漏洞管理<ul><li>如果修复系统漏洞(如windows漏洞), 需要保证系统盘有足够的存储空间用来下载补丁()</li></ul></li><li>防护配置 - 主机防护 - 防勒索<ul><li>数据库防勒索<ul><li>同一台服务器只能备份一个数据库实例(如备份了Oracle就不能再备份Mysql)</li><li>如Oracle必须为归档模式(会产生归档日志, 开启后需要考虑定期清理归档日志)</li></ul></li></ul></li></ul><h3 id="域名与证书"><a href="#域名与证书" class="headerlink" title="域名与证书"></a>域名与证书</h3><ul><li>域名与网站 <a href="https://dc.console.aliyun.com/" target="_blank" rel="noopener">https://dc.console.aliyun.com/</a><ul><li>注册域名</li><li><strong>修改域名 DNS 服务器(NS记录)</strong>, 修改后24H左右生效(一般新客户端1-2分钟就能生效; 老客户端可能得几分钟或几个小时不等, 可能网络的中间DNS服务器没有及时刷新)</li></ul></li><li>云解析 DNS <a href="https://dnsnext.console.aliyun.com/" target="_blank" rel="noopener">https://dnsnext.console.aliyun.com/</a><ul><li>使用阿里云 DNS 服务器时, 进行域名解析</li><li>支持区分国内和国外分别解析(如不解析国外线路，则国外 IP 无法访问)</li></ul></li><li>数字证书管理服务<ul><li>SSL证书<ul><li>单个域名 - DV域名级SSL - 免费版</li><li>一次只能申请一个二级域名，有效期1年，可申请多个，同一域名可重复申请</li><li>生成成功后会自动解析到阿里云域名，如申请<code>api.aezo.cn</code>的证书，会生成一个<code>_dnsauth.api</code>的解析</li></ul></li></ul></li></ul><h3 id="DataV可视化大屏"><a href="#DataV可视化大屏" class="headerlink" title="DataV可视化大屏"></a>DataV可视化大屏</h3><ul><li>如果进入控制台通过<code>https://datav.aliyuncs.com/</code>进入，则生成的发布链接也是HTTPS，且调试和发布后的API都需要是HTTPS，图片也要是HTTPS；如果进入控制台通过<code>http://datav.aliyuncs.com/</code>进入，则HTTP即可</li></ul><h4 id="基础平面地图"><a href="#基础平面地图" class="headerlink" title="基础平面地图"></a>基础平面地图</h4><ul><li>基于蓝图编辑器更新组件配置，可设置参数如下</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 基础平面地图可更新配置项说明</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// 无极缩放</span></span><br><span class="line">	<span class="string">"steplessZooming"</span>: <span class="literal">true</span>,</span><br><span class="line">	<span class="comment">// 高清渲染</span></span><br><span class="line">	<span class="string">"highPerformance"</span>: <span class="literal">false</span>,</span><br><span class="line">	<span class="comment">// 全局配置</span></span><br><span class="line">	<span class="string">"mapOptions"</span>: &#123;</span><br><span class="line">		<span class="comment">// 地图背景</span></span><br><span class="line">		<span class="string">"background"</span>: <span class="string">"rgba(0,0,0,0)"</span>,</span><br><span class="line">		<span class="comment">// 地图缩放</span></span><br><span class="line">		<span class="string">"zoom"</span>: &#123;</span><br><span class="line">			<span class="comment">// 缩放范围</span></span><br><span class="line">			<span class="string">"zoomRange"</span>: [</span><br><span class="line">				<span class="number">0</span>,</span><br><span class="line">				<span class="number">18</span></span><br><span class="line">			],</span><br><span class="line">			<span class="comment">// 默认级别</span></span><br><span class="line">			<span class="string">"defaultZoom"</span>: <span class="number">12.9</span></span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="comment">// 中心点坐标</span></span><br><span class="line">		<span class="string">"center"</span>: &#123;</span><br><span class="line">			<span class="string">"lng"</span>: <span class="number">121.6165</span>,</span><br><span class="line">			<span class="string">"lat"</span>: <span class="number">31.1593</span></span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="comment">// 比例尺控件</span></span><br><span class="line">		<span class="string">"scaleControl"</span>: &#123;</span><br><span class="line">			<span class="comment">// 是否展示</span></span><br><span class="line">			<span class="string">"show"</span>: <span class="literal">false</span>,</span><br><span class="line">			<span class="string">"fontColor"</span>: <span class="string">"#fff"</span>,</span><br><span class="line">			<span class="string">"borderColor"</span>: <span class="string">"#777"</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="comment">// 弹框配置</span></span><br><span class="line">	<span class="string">"popupStyle"</span>: &#123;</span><br><span class="line">		<span class="string">"textStyle"</span>: &#123;</span><br><span class="line">			<span class="string">"fontFamily"</span>: <span class="string">"Microsoft Yahei"</span>,</span><br><span class="line">			<span class="string">"fontWeight"</span>: <span class="string">"normal"</span>,</span><br><span class="line">			<span class="string">"fontSize"</span>: <span class="number">12</span>,</span><br><span class="line">			<span class="string">"color"</span>: <span class="string">"#FFFFFF"</span></span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="string">"lineHeight"</span>: <span class="number">1.4</span>,</span><br><span class="line">		<span class="string">"borderRadius"</span>: <span class="number">5</span>,</span><br><span class="line">		<span class="string">"margin"</span>: &#123;</span><br><span class="line">			<span class="string">"top"</span>: <span class="number">10</span>,</span><br><span class="line">			<span class="string">"bottom"</span>: <span class="number">10</span>,</span><br><span class="line">			<span class="string">"left"</span>: <span class="number">20</span>,</span><br><span class="line">			<span class="string">"right"</span>: <span class="number">20</span></span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="string">"backgroundColor"</span>: <span class="string">"rgba(6, 75, 199, 0.8)"</span>,</span><br><span class="line">		<span class="string">"closeBtn"</span>: &#123;</span><br><span class="line">			<span class="string">"color"</span>: <span class="string">"rgba(255, 255, 255, 0)"</span>,</span><br><span class="line">			<span class="string">"size"</span>: <span class="number">16</span>,</span><br><span class="line">			<span class="string">"top"</span>: <span class="number">0</span>,</span><br><span class="line">			<span class="string">"right"</span>: <span class="number">0</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="comment">// 交互配置</span></span><br><span class="line">	<span class="string">"interactive"</span>: &#123;</span><br><span class="line">		<span class="string">"dragging"</span>: <span class="literal">true</span>,</span><br><span class="line">		<span class="string">"scrollWheelZoom"</span>: <span class="literal">true</span>,</span><br><span class="line">		<span class="string">"isInteractive"</span>: <span class="literal">true</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="三维城市地图"><a href="#三维城市地图" class="headerlink" title="三维城市地图"></a>三维城市地图</h4><ul><li>三维城市只支持部分城市和城市的部分区域，且最大范围是9Km2。如果需要显示范围较大可多使用几个三维城市组件对地图区域进行切割，然后动态进行组件显示和隐藏。需要(独立)显卡和机器配置较好</li><li>暂时不支持基于蓝图编辑器进行组件配置更新，如动态更新三维城市区域</li></ul><h2 id="Sealos"><a href="#Sealos" class="headerlink" title="Sealos"></a>Sealos</h2><ul><li>K8S模式，支持私有云公有云无缝切换</li><li>私有云开源地址: <a href="https://github.com/labring/sealos" target="_blank" rel="noopener">https://github.com/labring/sealos</a></li><li>公有云地址: 北京节点 <a href="https://bja.sealos.run/" target="_blank" rel="noopener">https://bja.sealos.run/</a> 新加坡节点 <a href="https://cloud.sealos.io/" target="_blank" rel="noopener">https://cloud.sealos.io/</a></li><li>云函数: <a href="https://laf.run/" target="_blank" rel="noopener">https://laf.run/</a></li></ul><h2 id="Cloudflare"><a href="#Cloudflare" class="headerlink" title="Cloudflare"></a>Cloudflare</h2><ul><li>CND服务</li></ul><h3 id="Workers"><a href="#Workers" class="headerlink" title="Workers"></a>Workers</h3><ul><li>可用于API代理，如OpenAI</li><li>增加服务后，添加如下脚本，相当于基于nodejs增加了一层HTTP代理(客户端 -&gt; cloudflare - 目标服务器)<ul><li>由于HTTP无法加密，安全组织很容易识别到传输内容，因此cloudflare默认域名一般无法访问，可绑定一个自定义域名(访问量大的话容易上白名单)</li></ul></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">addEventListener(<span class="string">'fetch'</span>, event =&gt; &#123;</span><br><span class="line">    event.respondWith(fetchAndApply(event.request));</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">fetchAndApply</span>(<span class="params">request</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> response = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">let</span> method = request.method;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> url = <span class="keyword">new</span> URL(request.url);</span><br><span class="line">    <span class="keyword">let</span> url_hostname = url.hostname;</span><br><span class="line">    url.protocol = <span class="string">'https:'</span>;</span><br><span class="line">    url.host = <span class="string">'api.openai.com'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> request_headers = request.headers;</span><br><span class="line">    <span class="keyword">let</span> new_request_headers = <span class="keyword">new</span> Headers(request_headers);</span><br><span class="line">    new_request_headers.set(<span class="string">'Host'</span>, url.host);</span><br><span class="line">    new_request_headers.set(<span class="string">'Referer'</span>, url.protocol + <span class="string">'//'</span> + url_hostname);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> original_response = <span class="keyword">await</span> fetch(url.href, &#123;</span><br><span class="line">        method: method,</span><br><span class="line">        headers: new_request_headers,</span><br><span class="line">        body: request.body</span><br><span class="line">    &#125;)</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">let</span> original_response_clone = original_response.clone();</span><br><span class="line">    <span class="keyword">let</span> original_text = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">let</span> response_headers = original_response.headers;</span><br><span class="line">    <span class="keyword">let</span> new_response_headers = <span class="keyword">new</span> Headers(response_headers);</span><br><span class="line">    <span class="keyword">let</span> status = original_response.status;</span><br><span class="line"></span><br><span class="line">    new_response_headers.set(<span class="string">'Cache-Control'</span>, <span class="string">'no-store'</span>);</span><br><span class="line">    new_response_headers.set(<span class="string">'access-control-allow-origin'</span>, <span class="string">'*'</span>);</span><br><span class="line">    new_response_headers.set(<span class="string">'access-control-allow-credentials'</span>, <span class="literal">true</span>);</span><br><span class="line">    new_response_headers.delete(<span class="string">'content-security-policy'</span>);</span><br><span class="line">    new_response_headers.delete(<span class="string">'content-security-policy-report-only'</span>);</span><br><span class="line">    new_response_headers.delete(<span class="string">'clear-site-data'</span>);</span><br><span class="line"></span><br><span class="line">    original_text = original_response_clone.body</span><br><span class="line">    response = <span class="keyword">new</span> Response(original_text, &#123;</span><br><span class="line">        status,</span><br><span class="line">        headers: new_response_headers</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Github集成"><a href="#Github集成" class="headerlink" title="Github集成"></a>Github集成</h2><h3 id="github文件预览"><a href="#github文件预览" class="headerlink" title="github文件预览"></a>github文件预览</h3><ul><li>谷歌插件<code>Octotree</code>(目前github已支持文件预览)</li><li>将<code>github.com</code>域名改成<code>github1s.com</code>，会将仓库通过在线VsCode打开(需要github授权)</li><li>将<code>github.com</code>域名改成<code>github.dev</code>，或者按<code>。</code>键，会将仓库通过在线VsCode打开</li><li><code>sourcegraph</code> 支持代码笔记 (可安装对应谷歌插件)</li></ul><h3 id="Gitpod远程运行仓库代码"><a href="#Gitpod远程运行仓库代码" class="headerlink" title="Gitpod远程运行仓库代码"></a>Gitpod远程运行仓库代码</h3><ul><li>参考文章 <a href="https://juejin.cn/post/7201383723236458551" target="_blank" rel="noopener">https://juejin.cn/post/7201383723236458551</a></li><li>Gitpod是一个在线集成开发环境（IDE），部署于Kubernetes集群，它为每个工作区创建一个独立的Pod容器<ul><li>它可以使开发人员能够轻松地在浏览器中编写、构建和测试他们的代码，使用Gitpod可以提高开发效率、减少环境配置时间和节省计算资源。免费使用</li><li>支持本地编辑器打开(但是运行环境仍然是远程gitpod环境，代码也存储在远程)</li></ul></li><li>使用<ul><li>将<code>github.com</code>域名改成<code>gitpod.io</code>，或者使用谷歌插件</li><li>然后Dashboard新建Workspace</li><li>选择github对应仓库(可先将他人项目fork过来)</li><li>选择编辑器(默认在线VsCode，之后可修改)</li><li>配置好后，会自动创建一个gitpod空间，并初始化环境</li><li>此时可切换项目分支(如stable等稳定分支)</li></ul></li></ul><h3 id="Railway"><a href="#Railway" class="headerlink" title="Railway"></a>Railway</h3><ul><li><a href="https://railway.app?referralCode=smalle" target="_blank" rel="noopener">railway</a></li><li>2020 年成立的 PaaS 平台，无需信用卡的免费版可以提供 5 美元的额度，如果绑定信用卡则每个月可以使用 10 美元的额度</li><li>它支持数据库和 Docker，所以比起 Vercel 或 Netlify，它更像是 Heroku 的替代品</li></ul><h3 id="ClawCloud"><a href="#ClawCloud" class="headerlink" title="ClawCloud"></a>ClawCloud</h3><ul><li><a href="https://console.run.claw.cloud/signin?link=Q8A75BCU7K7X" target="_blank" rel="noopener">ClawCloud</a></li><li>免费VPS，无需绑卡，赠送5美元额度，4C/8G/10G磁盘/10G流量</li></ul><h3 id="Zeabur"><a href="#Zeabur" class="headerlink" title="Zeabur"></a>Zeabur</h3></div><div></div><div></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> smalle</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="http://blog.aezo.cn/2022/09/22/linux/云厂商产品使用/" title="云厂商产品使用">http://blog.aezo.cn/2022/09/22/linux/云厂商产品使用/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！</li></ul></div><footer class="post-footer"><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2022/09/17/db/mysql/mysql-backup-recover/" rel="next" title="Mysql数据备份与恢复"><i class="fa fa-chevron-left"></i> Mysql数据备份与恢复</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"> <a href="/2022/10/14/others/软考中级/" rel="prev" title="软考中级">软考中级<i class="fa fa-chevron-right"></i></a></div></div></footer></article><div class="post-spread"><div> <a target="_blank" href="https://github.com/oldinaction/ChatGPT-MP"><img class="nofancybox" style="width:300px;margin:0 auto" src="https://cdn7.aezo.cn/one/chat/chat-gpt-open-banner.jpg" alt="ChatGPT开源小程序" title="ChatGPT开源小程序"></a></div></div></div></div><div class="comments" id="comments"></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap"> 文章目录</li><li class="sidebar-nav-overview" data-target="site-overview"> 站点概览</li></ul><section class="site-overview sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" src="https://avatars0.githubusercontent.com/u/15698218?v=3&u=ce740bf0b67ff0d74990ba6fc644d6e92f572dcb&s=400" alt="smalle"><p class="site-author-name" itemprop="name">smalle</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">168</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/index.html"><span class="site-state-item-count">14</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/index.html"><span class="site-state-item-count">153</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"></div><div> 欢迎关注公众号：阿壹族 <img class="nofancybox" style="width:120px;margin:0 auto" src="https://cdn7.aezo.cn/common/qrcode/ayz_qrcode.jpg" alt="欢迎关注公众号：阿壹族" title="欢迎关注公众号：阿壹族"></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#简介"><span class="nav-number">1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#业务"><span class="nav-number">2.</span> <span class="nav-text">业务</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#短信"><span class="nav-number">2.1.</span> <span class="nav-text">短信</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#阿里云短信服务"><span class="nav-number">2.1.1.</span> <span class="nav-text">阿里云短信服务</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#敏感词检测"><span class="nav-number">2.2.</span> <span class="nav-text">敏感词检测</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ToolGood-Words"><span class="nav-number">2.2.1.</span> <span class="nav-text">ToolGood.Words</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#阿里云"><span class="nav-number">3.</span> <span class="nav-text">阿里云</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ECS云服务器"><span class="nav-number">3.1.</span> <span class="nav-text">ECS云服务器</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Windows"><span class="nav-number">3.1.1.</span> <span class="nav-text">Windows</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#快照"><span class="nav-number">3.1.2.</span> <span class="nav-text">快照</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#云服务器迁移流程"><span class="nav-number">3.1.3.</span> <span class="nav-text">云服务器迁移流程</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CDN与ESA"><span class="nav-number">3.2.</span> <span class="nav-text">CDN与ESA</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#云安全中心-sas"><span class="nav-number">3.3.</span> <span class="nav-text">云安全中心(sas)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#域名与证书"><span class="nav-number">3.4.</span> <span class="nav-text">域名与证书</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DataV可视化大屏"><span class="nav-number">3.5.</span> <span class="nav-text">DataV可视化大屏</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#基础平面地图"><span class="nav-number">3.5.1.</span> <span class="nav-text">基础平面地图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#三维城市地图"><span class="nav-number">3.5.2.</span> <span class="nav-text">三维城市地图</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Sealos"><span class="nav-number">4.</span> <span class="nav-text">Sealos</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Cloudflare"><span class="nav-number">5.</span> <span class="nav-text">Cloudflare</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Workers"><span class="nav-number">5.1.</span> <span class="nav-text">Workers</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Github集成"><span class="nav-number">6.</span> <span class="nav-text">Github集成</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#github文件预览"><span class="nav-number">6.1.</span> <span class="nav-text">github文件预览</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Gitpod远程运行仓库代码"><span class="nav-number">6.2.</span> <span class="nav-text">Gitpod远程运行仓库代码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Railway"><span class="nav-number">6.3.</span> <span class="nav-text">Railway</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ClawCloud"><span class="nav-number">6.4.</span> <span class="nav-text">ClawCloud</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Zeabur"><span class="nav-number">6.5.</span> <span class="nav-text">Zeabur</span></a></li></ol></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2016 - <span itemprop="copyrightYear">2025</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">smalle</span>&nbsp;&nbsp;&nbsp;&nbsp;<div class="powered-by"> 由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div><div class="powered-by"> 主题 - <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a></div><div class="theme-info"> <a class="theme-link" target="_blank" href="https://tongji.baidu.com/main/overview/10000542408/overview/index?siteId=18991897">站长统计</a></div></div><div class="ad"> <span style="font-weight:700">AD&nbsp;&nbsp;&nbsp;&nbsp;</span><div class="theme-info"> <a target="_blank" href="https://promotion.aliyun.com/ntms/yunparter/invite.html?userCode=oby5nolb">阿里云大礼包</a></div></div><div class="aezocn"> <span style="font-weight:700">&copy;AEZO.CN&nbsp;&nbsp;&nbsp;&nbsp;</span><div class="powered-by"> <a target="_blank" href="https://shengqitech.aezo.cn/">圣骑科技</a></div><div class="powered-by"> <a target="_blank" href="https://cdn7.aezo.cn/common/qrcode/one_qrcode.jpg">【One能抽屉】小程序</a></div><div class="theme-info"> <a target="_blank" href="http://shop.aezo.cn/">杂货铺(省钱小助手)</a></div></div><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?085f9cd91ef2ad985f791c677472f0d1";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script><script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script type="text/javascript" src="/js/src/js.cookie.js?v=5.1.1"></script><script type="text/javascript" src="/js/src/scroll-cookie.js?v=5.1.1"></script></body></html>