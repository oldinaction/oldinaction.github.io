<!doctype html><html class="theme-next mist use-motion" lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css"><meta name="keywords" content="mq,"><link rel="alternate" href="/atom.xml" title="Smalle's Blog | AEZOCN" type="application/atom+xml"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1"><meta name="description" content="RabbitMQ 简介 rabbitMQ 是一个在 AMQP 协议(高级消息队列协议)标准基础上完整的，可服用的企业消息系统。他遵循 Mozilla Public License 开源协议。采用 Erlang 实现的工业级的消息队列(MQ)服务器。 RabbitMQ 的官方站：http://www.rabbitmq.com/ 相关概念 Broker 消息队列服务器实体 VirtualHost 在"><meta name="keywords" content="mq"><meta property="og:type" content="article"><meta property="og:title" content="RabbitMQ"><meta property="og:url" content="http://blog.aezo.cn/2016/08/14/arch/rabbitmq/index.html"><meta property="og:site_name" content="Smalle&#39;s Blog | AEZOCN"><meta property="og:description" content="RabbitMQ 简介 rabbitMQ 是一个在 AMQP 协议(高级消息队列协议)标准基础上完整的，可服用的企业消息系统。他遵循 Mozilla Public License 开源协议。采用 Erlang 实现的工业级的消息队列(MQ)服务器。 RabbitMQ 的官方站：http://www.rabbitmq.com/ 相关概念 Broker 消息队列服务器实体 VirtualHost 在"><meta property="og:locale" content="zh-Hans"><meta property="og:image" content="http://blog.aezo.cn/data/images/arch/rabbitmq-arch.png"><meta property="og:image" content="http://blog.aezo.cn/data/images/arch/rabbitmq-message-model.png"><meta property="og:updated_time" content="2021-08-31T06:07:20.332Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="RabbitMQ"><meta name="twitter:description" content="RabbitMQ 简介 rabbitMQ 是一个在 AMQP 协议(高级消息队列协议)标准基础上完整的，可服用的企业消息系统。他遵循 Mozilla Public License 开源协议。采用 Erlang 实现的工业级的消息队列(MQ)服务器。 RabbitMQ 的官方站：http://www.rabbitmq.com/ 相关概念 Broker 消息队列服务器实体 VirtualHost 在"><meta name="twitter:image" content="http://blog.aezo.cn/data/images/arch/rabbitmq-arch.png"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Mist",sidebar:{position:"right",display:"post",offset:12,offset_float:0,b2t:!1,scrollpercent:!1},fancybox:!0,motion:!0,duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"BWD6R9FA4K",apiKey:"3330f3cbaa099dfc30395de5f5b20151",indexName:"blog",hits:{per_page:10},labels:{input_placeholder:"请输入关键字",hits_empty:"我们没有找到任何搜索结果: ${query}",hits_stats:"找到约${hits}条结果（用时${time}ms）"}}}</script><link rel="canonical" href="http://blog.aezo.cn/2016/08/14/arch/rabbitmq/"><title>RabbitMQ | Smalle's Blog | AEZOCN</title><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?d82223039d601f2f819f8fe140a63468";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><div style="display:none"><script src="//s95.cnzz.com/z_stat.php?id=cnzz_stat_icon_1276691827&web_id=cnzz_stat_icon_1276691827" language="JavaScript"></script></div></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-right page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">Smalle's Blog | AEZOCN</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">Better Code, Better Life</h1></div><div class="site-nav-toggle"> <button><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br> 首页</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br> 分类</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br> 关于</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br> 归档</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br> 标签</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="menu-item-icon fa fa-fw fa-sitemap"></i><br> 站点地图</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br> 搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i></span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"> <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://blog.aezo.cn/2016/08/14/arch/rabbitmq/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="smalle"><meta itemprop="description" content=""><meta itemprop="image" content="https://avatars0.githubusercontent.com/u/15698218?v=3&u=ce740bf0b67ff0d74990ba6fc644d6e92f572dcb&s=400"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Smalle's Blog | AEZOCN"></span><header class="post-header"><h2 class="post-title" itemprop="name headline">RabbitMQ</h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-08-14T16:49:00+08:00">2016-08-14</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/arch/" itemprop="url" rel="index"><span itemprop="name">arch</span></a></span></span></div></header><div class="post-body" itemprop="articleBody"><div></div><h2 id="RabbitMQ-简介"><a href="#RabbitMQ-简介" class="headerlink" title="RabbitMQ 简介"></a>RabbitMQ 简介</h2><ul><li>rabbitMQ 是一个在 AMQP 协议(高级消息队列协议)标准基础上完整的，可服用的企业消息系统。他遵循 Mozilla Public License 开源协议。采用 Erlang 实现的工业级的消息队列(MQ)服务器。</li><li>RabbitMQ 的官方站：<a href="http://www.rabbitmq.com/" target="_blank" rel="noopener">http://www.rabbitmq.com/</a></li><li>相关概念<ul><li><code>Broker</code> 消息队列服务器实体</li><li><code>VirtualHost</code> 在 RabbitMQ 中可以虚拟消息服务器 VirtualHost，每个 VirtualHost 相当月一个相对独立的 RabbitMQ 服务器，每个 VirtualHost 之间是相互隔离的，一个 broker 里可以开设多个 vhost，用作不同用户的权限分离。exchange、queue、message 不能互通。VirtualName 一般以/开头</li><li><code>Exchange</code> 消息交换机，它指定消息按什么规则，路由到哪个队列</li><li><code>Queue</code> 消息队列载体，每个消息都会被投入到一个或多个队列</li><li><code>Binding</code> 绑定，它的作用就是把 exchange 和 queue 按照路由规则绑定起来</li><li><code>RoutingKey</code> 路由关键字，exchange 根据这个关键字进行消息投递</li><li><code>Producer</code> 消息生产者，就是投递消息的程序</li><li><code>Consumer</code> 消息消费者，就是接受消息的程序</li><li><code>Channel</code> 消息通道，在客户端的每个连接里，可建立多个 channel，每个 channel 代表一个会话任务</li></ul></li><li><p>数据传输</p><p><img src="/data/images/arch/rabbitmq-arch.png" alt="数据传输"></p><ul><li>也可以不用先发送给交换机，直接点对点进行传输</li><li>生成者和消费者必须通过 Channel 向虚拟机开启一个会话</li></ul></li><li><p>7 种消息模型：<a href="https://www.rabbitmq.com/getstarted.html" target="_blank" rel="noopener">https://www.rabbitmq.com/getstarted.html</a><br><img src="/data/images/arch/rabbitmq-message-model.png" alt="消息模型"></p><ul><li>常用<ul><li>点对点</li><li>work（point和work模式配置相同，当多个消费者监听该队列时则任务是work模式，point只有一个消费者）</li><li>订阅类模式（包括：fanout 广播、direct 直连、topic 主题）<ul><li>广播：同一消息，所有的消费者都可以接收到</li><li>Direct 直连（RoutingKey 固定），只能接受固定类型的消息</li><li>Topic 基于通配符（RoutingKey 包含通配符：*匹配一个单词，#匹配多个单词），只能接受主题相匹配的消息</li></ul></li></ul></li><li>Publisher Confirms（发送确认模式）：用来实现消息的可靠投递。当在某个通道(channel)上开启发布确认后，客户端发布的消息会被MQ服务器(broker)异步的确认 <a href="https://blog.csdn.net/Lamb_IT/article/details/102649484" target="_blank" rel="noopener">^2</a></li></ul></li><li>常用测试配置<ul><li>创建虚拟机(可省略，即使用默认的/)：Admin-VirtualHost. 如需要多环境测试可创建虚拟机（因为队列必须一致，最简单的就是改变服务器/虚拟机配置）</li><li>创建项目用户：Admin-Users</li><li>创建项目队列(也可通过程序自动创建)</li><li>创建交换机(当使用订阅类模式时需要)</li></ul></li></ul><h2 id="RabbitMQ-安装"><a href="#RabbitMQ-安装" class="headerlink" title="RabbitMQ 安装"></a>RabbitMQ 安装</h2><h3 id="linux"><a href="#linux" class="headerlink" title="linux"></a>linux</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 安装erlang，版本有一定的要求，参考：https://www.rabbitmq.com/which-erlang.html。具体[参考下文](#erlang)</span></span><br><span class="line"><span class="comment"># 不能使用默认源，否则安装的是R16B03-1。如是centos8则配置为.../el/8/</span></span><br><span class="line">cat &gt; /etc/yum.repos.d/erlang.repo &lt;&lt; EOF</span><br><span class="line">[rabbitmq-erlang]</span><br><span class="line">name=rabbitmq-erlang</span><br><span class="line">baseurl=https://dl.bintray.com/rabbitmq-erlang/rpm/erlang/21/el/7</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=https://dl.bintray.com/rabbitmq/Keys/rabbitmq-release-signing-key.asc</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line">EOF</span><br><span class="line">yum install erlang -y</span><br><span class="line"></span><br><span class="line"><span class="comment">## 安装rabbitmq</span></span><br><span class="line">wget https://github.com/rabbitmq/rabbitmq-server/releases/download/v3.8.7/rabbitmq-server-generic-unix-3.8.7.tar.xz</span><br><span class="line">tar -xvf rabbitmq-server-generic-unix-3.8.7.tar.xz -C /opt/</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'export PATH=$PATH:/opt/rabbitmq_server-3.8.7/sbin'</span> &gt;&gt; /etc/profile</span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line"><span class="comment"># 添加web管理插件</span></span><br><span class="line">rabbitmq-plugins <span class="built_in">enable</span> rabbitmq_management</span><br><span class="line"></span><br><span class="line"><span class="comment">## 后台启动rabbitmq服务</span></span><br><span class="line">rabbitmq-server -detached</span><br><span class="line"></span><br><span class="line"><span class="comment">## 设置loopback_users.guest = false，[参考下文](#配置文件)</span></span><br></pre></td></tr></table></figure><h3 id="windows"><a href="#windows" class="headerlink" title="windows"></a>windows</h3><p>Rabbit MQ 是建立在强大的 Erlang OTP 平台上，因此安装 Rabbit MQ 的前提是安装 Erlang。通过下面两链接下载安装 3.7.7 版本</p><ul><li>安装 <a href="http://erlang.org/download/otp_win64_21.3.exe" target="_blank" rel="noopener">Eralng OTP For Windows (opt21)</a></li><li>设置<code>ERLANG_HOME=D:\software\erl10.3</code></li><li>安装 <a href="https://github.com/rabbitmq/rabbitmq-server/releases/download/v3.8.7/rabbitmq-server-3.8.7.exe" target="_blank" rel="noopener">RabbitMQ Server (3.8.7)</a></li><li><strong>默认监听<code>5672</code>端口(客户端连接使用此端口)，开启后台则默认使用端口<code>15672</code>，默认超级管理员<code>guest/guest</code></strong></li></ul><h4 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h4><ul><li>参考：<a href="https://www.rabbitmq.com/configure.html#config-location" target="_blank" rel="noopener">https://www.rabbitmq.com/configure.html#config-location</a></li><li>增加配置文件（可选）：手动创建<code>$RABBITMQ_HOME/etc/rabbitmq/rabbitmq.conf</code></li><li>相关参数说明，配置文件样例 <code>https://github.com/rabbitmq/rabbitmq-server/blob/v3.7.x/docs/rabbitmq.conf.example</code></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 默认为true，仅允许guest用户通过localhost访问；false表示任何网络均可访问</span></span><br><span class="line">loopback_users.guest = <span class="literal">false</span></span><br></pre></td></tr></table></figure><ul><li>默认端口<ul><li><code>5672</code> 客户端通信amqp端口</li><li><code>15672</code> 开启后台则默认此http端口访问管理界面</li><li><code>25672</code> 集群通信端口</li></ul></li></ul><h2 id="相关命令"><a href="#相关命令" class="headerlink" title="相关命令"></a>相关命令</h2><h3 id="RabbitMQ-启动与停止"><a href="#RabbitMQ-启动与停止" class="headerlink" title="RabbitMQ 启动与停止"></a>RabbitMQ 启动与停止</h3><ul><li>windows<ul><li><code>rabbitmq-service start</code> 启动 RabbitMQ 服务</li><li><code>rabbitmq-service stop</code> 停止服务</li></ul></li><li>linux<ul><li><code>rabbitmq-server -detached</code> 后台启动服务</li><li><code>rabbitmqctl stop</code> 停止</li><li><code>rabbitmqctl status</code></li></ul></li></ul><h3 id="命令说明"><a href="#命令说明" class="headerlink" title="命令说明"></a>命令说明</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">rabbitmq-server <span class="comment"># **启动 RabbitMQ 和 Erlang VM**（关闭需要使用rabbitmqctl）</span></span><br><span class="line">rabbitmqctl <span class="comment"># 管理工具。rabbitmqctl help [command]</span></span><br><span class="line">rabbitmq-diagnostics <span class="comment"># 诊断。rabbitmq-diagnostics help [command]</span></span><br><span class="line">rabbitmq-plugins <span class="comment"># 插件管理。rabbitmq-plugins help [command]</span></span><br><span class="line">rabbitmq-env <span class="comment"># 环境配置</span></span><br><span class="line">rabbitmq-defaults <span class="comment"># 默认参数设置</span></span><br></pre></td></tr></table></figure><h3 id="rabbitmqctl"><a href="#rabbitmqctl" class="headerlink" title="rabbitmqctl"></a>rabbitmqctl</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### rabbitmqctl</span></span><br><span class="line">Usage</span><br><span class="line"></span><br><span class="line">rabbitmqctl [--node &lt;node&gt;] [--timeout &lt;timeout&gt;] [--longnames] [--quiet] &lt;<span class="built_in">command</span>&gt; [&lt;<span class="built_in">command</span> options&gt;]</span><br><span class="line"></span><br><span class="line">Available commands:</span><br><span class="line"></span><br><span class="line">Help:</span><br><span class="line"></span><br><span class="line">   autocomplete                  Provides <span class="built_in">command</span> name autocomplete variants</span><br><span class="line">   <span class="built_in">help</span>                          Displays usage information <span class="keyword">for</span> a <span class="built_in">command</span></span><br><span class="line">   version                       Displays CLI tools version</span><br><span class="line"></span><br><span class="line">Nodes: <span class="comment">### 节点</span></span><br><span class="line"></span><br><span class="line">   await_startup                 Waits <span class="keyword">for</span> the RabbitMQ application to start on the target node</span><br><span class="line">   reset                         <span class="comment"># 设置节点离开集群并回到初始状态</span></span><br><span class="line">   rotate_logs                   Instructs the RabbitMQ node to perform internal <span class="built_in">log</span> rotation</span><br><span class="line">   shutdown                      Stops RabbitMQ and its runtime (Erlang VM). Monitors progress <span class="keyword">for</span> <span class="built_in">local</span> nodes. Does not require a PID file path.</span><br><span class="line">   start_app                     <span class="comment"># 启动 RabbitMQ 程序. Starts the RabbitMQ application but leaves the runtime (Erlang VM) running</span></span><br><span class="line">   stop                          <span class="comment"># 关闭 RabbitMQ 和 Erlang VM 程序. Requires a local node pid file path to monitor progress.</span></span><br><span class="line">   stop_app                      <span class="comment"># 仅关闭 RabbitMQ 程序. leaving the runtime (Erlang VM) running</span></span><br><span class="line">   <span class="built_in">wait</span>                          Waits <span class="keyword">for</span> RabbitMQ node startup by monitoring a <span class="built_in">local</span> PID file. See also <span class="string">'rabbitmqctl await_online_nodes'</span></span><br><span class="line"></span><br><span class="line">Cluster: <span class="comment">### 集群</span></span><br><span class="line"></span><br><span class="line">   await_online_nodes            Waits <span class="keyword">for</span> &lt;count&gt; nodes to join the cluster</span><br><span class="line">   change_cluster_node_type      Changes the <span class="built_in">type</span> of the cluster node</span><br><span class="line">   cluster_status                <span class="comment"># 查看集群状态</span></span><br><span class="line">   force_boot                    Forces node to start even <span class="keyword">if</span> it cannot contact or rejoin any of its previously known peers</span><br><span class="line">   force_reset                   Forcefully returns a RabbitMQ node to its virgin state</span><br><span class="line">   forget_cluster_node           Removes a node from the cluster</span><br><span class="line">   join_cluster                  <span class="comment"># 加入集群</span></span><br><span class="line">   rename_cluster_node           Renames cluster nodes <span class="keyword">in</span> the <span class="built_in">local</span> database</span><br><span class="line">   update_cluster_nodes          Instructs a cluster member node to sync the list of known cluster members from &lt;seed_node&gt;</span><br><span class="line"></span><br><span class="line">Replication:</span><br><span class="line"></span><br><span class="line">   cancel_sync_queue             Instructs a synchronising mirrored queue to stop synchronising itself</span><br><span class="line">   sync_queue                    Instructs a mirrored queue with unsynchronised mirrors (follower replicas) to synchronise them</span><br><span class="line"></span><br><span class="line">Users: <span class="comment">## 账户管理</span></span><br><span class="line"></span><br><span class="line">   add_user                      <span class="comment"># 创建用户。如：rabbitmqctl add_user &lt;用户名&gt; &lt;密码&gt;</span></span><br><span class="line">   authenticate_user             Attempts to authenticate a user. Exits with a non-zero code <span class="keyword">if</span> authentication fails.</span><br><span class="line">   change_password               Changes the user password</span><br><span class="line">   clear_password                Clears (resets) password and disables password login <span class="keyword">for</span> a user</span><br><span class="line">   delete_user                   Removes a user from the internal database. Has no effect on users provided by external backends such as LDAP</span><br><span class="line">   list_users                    <span class="comment"># 查看用户（有一个guest默认用户）和角色（tag）</span></span><br><span class="line">   set_user_tags                 <span class="comment"># 设置用户角色（administrator：超级管理员；management：虚拟机管理者；policymaker：策略制定者；monitoring：监控者；none）</span></span><br><span class="line">        <span class="comment"># rabbitmqctl set_user_tags smalle administrator</span></span><br><span class="line"></span><br><span class="line">Access Control: <span class="comment">## 权限控制</span></span><br><span class="line"></span><br><span class="line">   clear_permissions             Revokes user permissions <span class="keyword">for</span> a vhost</span><br><span class="line">   clear_topic_permissions       Clears user topic permissions <span class="keyword">for</span> a vhost or exchange</span><br><span class="line">   list_permissions              Lists user permissions <span class="keyword">in</span> a virtual host</span><br><span class="line">   list_topic_permissions        Lists topic permissions <span class="keyword">in</span> a virtual host</span><br><span class="line">   list_user_permissions         Lists permissions of a user across all virtual hosts</span><br><span class="line">   list_user_topic_permissions   Lists user topic permissions</span><br><span class="line">   list_vhosts                   Lists virtual hosts</span><br><span class="line">   set_permissions               <span class="comment"># 设置用户对虚拟机的访问权限</span></span><br><span class="line">        <span class="comment"># rabbitmqctl set_permissions -p /test smalle '.*' '.*' '.*' # 设置smalle用户对/test虚拟机拥有所有权限</span></span><br><span class="line">   set_topic_permissions         Sets user topic permissions <span class="keyword">for</span> an exchange</span><br><span class="line"></span><br><span class="line">Monitoring, observability and health checks: <span class="comment">## 健康观测</span></span><br><span class="line"></span><br><span class="line">   list_bindings                 Lists all bindings on a vhost</span><br><span class="line">   list_channels                 Lists all channels <span class="keyword">in</span> the node</span><br><span class="line">   list_ciphers                  Lists cipher suites supported by encoding commands</span><br><span class="line">   list_connections              Lists AMQP 0.9.1 connections <span class="keyword">for</span> the node</span><br><span class="line">   list_consumers                Lists all consumers <span class="keyword">for</span> a vhost</span><br><span class="line">   list_exchanges                Lists exchanges</span><br><span class="line">   list_hashes                   Lists <span class="built_in">hash</span> <span class="built_in">functions</span> supported by encoding commands</span><br><span class="line">   list_queues                   <span class="comment"># 列举所有队列和其配置</span></span><br><span class="line">   list_unresponsive_queues      Tests queues to respond within timeout. Lists those <span class="built_in">which</span> did not respond</span><br><span class="line">   ping                          Checks that the node OS process is up, registered with EPMD and CLI tools can authenticate with it</span><br><span class="line">   report                        Generate a server status report containing a concatenation of all server status information <span class="keyword">for</span> support purposes</span><br><span class="line">   schema_info                   Lists schema database tables and their properties</span><br><span class="line">   status                        Displays status of a node</span><br><span class="line"></span><br><span class="line">Parameters:</span><br><span class="line"></span><br><span class="line">   clear_global_parameter        Clears a global runtime parameter</span><br><span class="line">   clear_parameter               Clears a runtime parameter.</span><br><span class="line">   list_global_parameters        Lists global runtime parameters</span><br><span class="line">   list_parameters               Lists runtime parameters <span class="keyword">for</span> a virtual host</span><br><span class="line">   set_global_parameter          Sets a runtime parameter.</span><br><span class="line">   set_parameter                 Sets a runtime parameter.</span><br><span class="line"></span><br><span class="line">Policies: <span class="comment">### 策略</span></span><br><span class="line"></span><br><span class="line">   clear_operator_policy         Clears an operator policy</span><br><span class="line">   clear_policy                  Clears (removes) a policy</span><br><span class="line">   list_operator_policies        Lists operator policy overrides <span class="keyword">for</span> a virtual host</span><br><span class="line">   list_policies                 <span class="comment"># 列举策略</span></span><br><span class="line">   set_operator_policy           Sets an operator policy that overrides a subset of arguments <span class="keyword">in</span> user policies</span><br><span class="line">   set_policy                    <span class="comment"># 设置或更新策略</span></span><br><span class="line">        <span class="comment"># rabbitmqctl set_policy -p /test ha-all '^hello' '&#123;"ha-mode":"all","ha-sync-mode":"automatic"&#125;' # 对/test虚拟主机增加策略，策略名为ha-all，且交换机和队列以hello开头的，策略描述为 &#123;"ha-mode":"all","ha-sync-mode":"automatic"&#125; (automatic自动同步镜像到集群的all所有节点)。策略增加成功后，会在对应的对应的Features上显示`ha-all`的标识</span></span><br><span class="line"></span><br><span class="line">Virtual hosts: <span class="comment">## 虚拟机</span></span><br><span class="line"></span><br><span class="line">   add_vhost                     Creates a virtual host</span><br><span class="line">   clear_vhost_limits            Clears virtual host limits</span><br><span class="line">   delete_vhost                  Deletes a virtual host</span><br><span class="line">   list_vhost_limits             Displays configured virtual host limits</span><br><span class="line">   restart_vhost                 Restarts a failed vhost data stores and queues</span><br><span class="line">   set_vhost_limits              Sets virtual host limits</span><br><span class="line">   trace_off</span><br><span class="line">   trace_on</span><br><span class="line"></span><br><span class="line">Configuration and Environment:</span><br><span class="line"></span><br><span class="line">   decode                        Decrypts an encrypted configuration value</span><br><span class="line">   encode                        Encrypts a sensitive configuration value</span><br><span class="line">   environment                   Displays the name and value of each variable <span class="keyword">in</span> the application environment <span class="keyword">for</span> each running application</span><br><span class="line">   set_cluster_name              Sets the cluster name</span><br><span class="line">   set_disk_free_limit           Sets the disk_free_limit setting</span><br><span class="line">   set_log_level                 Sets <span class="built_in">log</span> level <span class="keyword">in</span> the running node</span><br><span class="line">   set_vm_memory_high_watermark  Sets the vm_memory_high_watermark setting</span><br><span class="line"></span><br><span class="line">Definitions:</span><br><span class="line"></span><br><span class="line">   export_definitions            Exports definitions <span class="keyword">in</span> JSON or compressed Erlang Term Format.</span><br><span class="line">   import_definitions            Imports definitions <span class="keyword">in</span> JSON or compressed Erlang Term Format.</span><br><span class="line"></span><br><span class="line">Feature flags:</span><br><span class="line"></span><br><span class="line">   enable_feature_flag           Enables a feature flag on target node</span><br><span class="line">   list_feature_flags            Lists feature flags</span><br><span class="line"></span><br><span class="line">Operations:</span><br><span class="line"></span><br><span class="line">   close_all_connections         Instructs the broker to close all connections <span class="keyword">for</span> the specified vhost or entire RabbitMQ node</span><br><span class="line">   close_connection              Instructs the broker to close the connection associated with the Erlang process id</span><br><span class="line">   <span class="built_in">eval</span>                          Evaluates a snippet of Erlang code on the target node</span><br><span class="line">   eval_file                     Evaluates a file that contains a snippet of Erlang code on the target node</span><br><span class="line">   <span class="built_in">exec</span>                          Evaluates a snippet of Elixir code on the CLI node</span><br><span class="line">   force_gc                      Makes all Erlang processes on the target node perform/schedule a full sweep garbage collection</span><br><span class="line"></span><br><span class="line">Queues: <span class="comment">## 队列</span></span><br><span class="line"></span><br><span class="line">   delete_queue                  Deletes a queue</span><br><span class="line">   purge_queue                   <span class="comment"># 清空某个队列里的数据。rabbitmqctl purge_queue &lt;queue_name&gt;</span></span><br><span class="line">Deprecated:</span><br><span class="line"></span><br><span class="line">   hipe_compile                  DEPRECATED. This <span class="built_in">command</span> is a no-op. HiPE is no longer supported by modern Erlang versions</span><br><span class="line">   node_health_check             DEPRECATED. Performs intrusive, opinionated health checks on a fully booted node. See https://www.rabbitmq.com/monitoring.html<span class="comment">#health-checks instead</span></span><br><span class="line"></span><br><span class="line">Use <span class="string">'rabbitmqctl help &lt;command&gt;'</span> to learn more about a specific <span class="built_in">command</span></span><br></pre></td></tr></table></figure><h3 id="rabbitmq-diagnostics"><a href="#rabbitmq-diagnostics" class="headerlink" title="rabbitmq-diagnostics"></a>rabbitmq-diagnostics</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rabbitmq-diagnostics [--node &lt;node&gt;] [--timeout &lt;timeout&gt;] [--longnames] [--quiet] &lt;command&gt; [&lt;command options&gt;]</span></span><br><span class="line">status <span class="comment"># 获取rabbitmq状态</span></span><br></pre></td></tr></table></figure><h3 id="简单使用"><a href="#简单使用" class="headerlink" title="简单使用"></a>简单使用</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加用户和设置角色和权限</span></span><br><span class="line">rabbitmqctl add_user smalle mypass</span><br><span class="line">rabbitmqctl set_user_tags smalle administrator</span><br><span class="line">rabbitmqctl set_permissions -p /<span class="built_in">test</span> smalle <span class="string">'.*'</span> <span class="string">'.*'</span> <span class="string">'.*'</span> <span class="comment"># 可访问/test虚拟机的</span></span><br></pre></td></tr></table></figure><h2 id="客户端使用"><a href="#客户端使用" class="headerlink" title="客户端使用"></a>客户端使用</h2><h3 id="简单使用-1"><a href="#简单使用-1" class="headerlink" title="简单使用"></a>简单使用</h3><ul><li>相关代码参考 <a href="https://github.com/oldinaction/smjava/tree/master/rabbitmq/src/main/java/cn/aezo/demo/rabbitmq" target="_blank" rel="noopener">github-smjava-rabbitmq</a></li><li>引入客户端依赖</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.rabbitmq<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>amqp-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="point-work-点对点-工作模式"><a href="#point-work-点对点-工作模式" class="headerlink" title="point/work(点对点/工作模式)"></a>point/work(点对点/工作模式)</h4><ul><li>point和work模式配置相同，当多个消费者监听该队列时则任务是work模式(point只有一个消费者)</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// =============== 生产者</span></span><br><span class="line"><span class="comment">// 获取连接(springboot则直接在配置文件中配置即可)</span></span><br><span class="line">ConnectionFactory factory = <span class="keyword">new</span> ConnectionFactory();</span><br><span class="line">factory.setHost(<span class="string">"127.0.0.1"</span>);</span><br><span class="line">factory.setPort(<span class="number">5672</span>);</span><br><span class="line">factory.setUsername(<span class="string">"guest"</span>);</span><br><span class="line">factory.setPassword(<span class="string">"guest"</span>);</span><br><span class="line">factory.setVirtualHost(<span class="string">"/test"</span>); <span class="comment">// 需要提前创建好此虚拟主机，默认是 /</span></span><br><span class="line">Connection onnection = factory.newConnection();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 开启一个会话</span></span><br><span class="line">Channel channel = connection.createChannel();</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 声明一个消息队列，如果无此消息队列会自动创建。参数如下：</span></span><br><span class="line"><span class="comment">* 1.queue: 消息队列名称</span></span><br><span class="line"><span class="comment">* 2.durable: 是否持久化。true时，管理后台的Queues-Features会增加"D"标识。false不进行持久化，当MQ服务端重启后，消息队列会丢失(包括队列中的数据)</span></span><br><span class="line"><span class="comment">* 3.exclusive: 是否独占。true独占，表示只能这个channel(会话)访问这个消息队列</span></span><br><span class="line"><span class="comment">* 4.autoDelete: 是否自动删除。true自动删除，当消息消费完成后，且消费者断开连接，则删除此队列</span></span><br><span class="line"><span class="comment">* 5.arguments: 额外参数</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">channel.queueDeclare(<span class="string">"hello"</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 发布消息，参数如下：</span></span><br><span class="line"><span class="comment">* 1.exchange: 使用的交换机名。此时案例展示点对点，留空</span></span><br><span class="line"><span class="comment">* 2.routingKey: 路由键名。此时为点对点传输，填写队列名</span></span><br><span class="line"><span class="comment">* 3.props: 传递消息的额外配置。AMQP.BasicProperties</span></span><br><span class="line"><span class="comment">* 4.body: 消息体</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">channel.basicPublish(<span class="string">""</span>, <span class="string">"hello"</span>, <span class="keyword">null</span>, <span class="string">"这是一条消息"</span>.getBytes());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 之后关掉 connection 程序才会退出，否则会一直运行</span></span><br><span class="line"><span class="comment">// 关闭资源</span></span><br><span class="line">channel.close();</span><br><span class="line">connection.close();</span><br><span class="line"></span><br><span class="line"><span class="comment">// =============== 消费者</span></span><br><span class="line">Connection connection = RabbitmqU.getConnection();</span><br><span class="line">Channel channel = connection.createChannel();</span><br><span class="line"><span class="comment">// 设置prefetchCount=1，一次只能消费一个消息，**否则MQ会把消息队列的中的消息都发channel中，可能导致数据丢失**</span></span><br><span class="line"><span class="comment">// channel.basicQos(1);</span></span><br><span class="line"><span class="comment">// 声明队列时，参数需要和生产者定义的队列一样</span></span><br><span class="line">channel.queueDeclare(<span class="string">"hello"</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 消费消息，参数如下：</span></span><br><span class="line"><span class="comment">* 1.queue: 消息队列名</span></span><br><span class="line"><span class="comment">* 2.autoAck: 是否开启自动消息确认机制</span></span><br><span class="line"><span class="comment">*   - autoAck=true 开启自动确认。则消息发送到channel，不管是否已经消费完成，都会告诉服务端，从而服务端会继续发消息。当有多个消费者的时候是平均消费消息的</span></span><br><span class="line"><span class="comment">*   - autoAck=false 关闭消息自动确认，即消费完消息后需要手动确认告知MQ服务端。到MQ发送到消费者的Channel，但是又没有手动确认的，会在管理端的Queues-Messages-Unacked显示未确认数</span></span><br><span class="line"><span class="comment">* 3.deliverCallback: 收到消息回调</span></span><br><span class="line"><span class="comment">* 4.cancelCallback</span></span><br><span class="line"><span class="comment">* */</span></span><br><span class="line">channel.basicConsume(<span class="string">"hello"</span>, <span class="keyword">true</span>, <span class="keyword">new</span> DefaultConsumer(channel) &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleDelivery</span><span class="params">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, <span class="keyword">byte</span>[] body)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"收到消息："</span> + <span class="keyword">new</span> String(body, <span class="string">"UTF-8"</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试时不关闭，防止还没进行 handle 就退出了</span></span><br><span class="line"><span class="comment">// RabbitmqU.close(channel, connection);</span></span><br></pre></td></tr></table></figure><h4 id="topic"><a href="#topic" class="headerlink" title="topic"></a>topic</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取连接(springboot则直接在配置文件中配置即可)</span></span><br><span class="line">ConnectionFactory factory = <span class="keyword">new</span> ConnectionFactory();</span><br><span class="line">factory.setHost(<span class="string">"127.0.0.1"</span>);</span><br><span class="line">factory.setPort(<span class="number">5672</span>);</span><br><span class="line">factory.setUsername(<span class="string">"guest"</span>);</span><br><span class="line">factory.setPassword(<span class="string">"guest"</span>);</span><br><span class="line">factory.setVirtualHost(<span class="string">"/test"</span>); <span class="comment">// 需要提前创建好此虚拟主机，默认是 /</span></span><br><span class="line">Connection onnection = factory.newConnection();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 生成者发布消息</span></span><br><span class="line">channel.queueDeclare(<span class="string">"hello"</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">null</span>);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 声明一个Exchange交换机，参数如下</span></span><br><span class="line"><span class="comment"> * 1.exchange: 交换机名称</span></span><br><span class="line"><span class="comment"> * 2.type: 交换机类型，fanout/direct/topic等。在管理端Exchanges-Type中会显示</span></span><br><span class="line"><span class="comment"> * 3.其他参数参考 queueDeclare：Durability是否持久化，Auto delete是否自动删除</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">channel.exchangeDeclare(<span class="string">"my_exchange_name"</span>, <span class="string">"topic"</span>);</span><br><span class="line">channel.basicPublish(<span class="string">"my_exchange_name"</span>, <span class="string">"aezo.user"</span>, <span class="keyword">null</span>, (<span class="string">"这是一条消息"</span>).getBytes());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 消费者</span></span><br><span class="line">Channel channel = connection.createChannel();</span><br><span class="line">channel.exchangeDeclare(<span class="string">"my_exchange_name"</span>, <span class="string">"topic"</span>);</span><br><span class="line">String queueName = channel.queueDeclare().getQueue(); <span class="comment">// 获取一个临时队列。管理后台的Queues-Features会增加"AD"(autoDelete)和"Excl"(exclusive)标识</span></span><br><span class="line">channel.queueBind(queueName, <span class="string">"my_exchange_name"</span>, <span class="string">"aezo.#"</span>); <span class="comment">// *匹配一个单词，#匹配多个单词</span></span><br><span class="line">channel.queueBind(queueName, <span class="string">"my_exchange_name"</span>, <span class="string">"*.vip"</span>);</span><br><span class="line">channel.basicConsume(queueName, <span class="keyword">true</span>, <span class="keyword">new</span> DefaultConsumer(channel) &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleDelivery</span><span class="params">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, <span class="keyword">byte</span>[] body)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"consumer收到消息："</span> + <span class="keyword">new</span> String(body, <span class="string">"UTF-8"</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 关闭资源</span></span><br><span class="line">channel.close();</span><br><span class="line">connection.close();</span><br></pre></td></tr></table></figure><h3 id="整合-SpringBoot"><a href="#整合-SpringBoot" class="headerlink" title="整合 SpringBoot"></a>整合 SpringBoot</h3><ul><li>RabbitMQ 是实现了高级消息队列协议(AMQP)的开源消息代理软件，也称为面向消息的中间件。后续操作需要先安装 RabbitMQ 服务</li><li>引入对 amqp 协议支持依赖</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>配置 rabbitmq 服务器链接</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  rabbitmq:</span></span><br><span class="line"><span class="attr">    host:</span> <span class="string">localhost</span></span><br><span class="line"><span class="attr">    port:</span> <span class="number">5672</span></span><br><span class="line"><span class="attr">    username:</span> <span class="string">guest</span></span><br><span class="line"><span class="attr">    password:</span> <span class="string">guest</span></span><br><span class="line">    <span class="comment"># 可以基于多环境配置rabbitmq虚拟服务器(队列是隔离的)</span></span><br><span class="line"><span class="attr">    virtualHost:</span> <span class="string">/test</span></span><br></pre></td></tr></table></figure><ul><li><p>配置队列、生产者、消费者</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 配置队列 hello</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Queue <span class="title">helloQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Queue(<span class="string">"hello"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 生产者</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Provider</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AmqpTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 发送消息</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">send</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String context = <span class="string">"hello "</span> + <span class="keyword">new</span> Date();</span><br><span class="line">        System.out.println(<span class="string">"Provider: "</span> + context);</span><br><span class="line">        rabbitTemplate.convertAndSend(<span class="string">"hello"</span>, context);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 消费者</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@RabbitListener</span>(queues = <span class="string">"hello"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Consumer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RabbitHandler</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Consumer: "</span> + msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id="镜像-集群搭建"><a href="#镜像-集群搭建" class="headerlink" title="(镜像)集群搭建"></a>(镜像)集群搭建</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 在 test1、test2、test3 三台机器上搭建rabbit服务</span></span><br><span class="line"><span class="comment">## 同步 .erlang.cookie 文件：在 test1 机器上找到 .erlang.cookie 文件（如：`/root/.erlang.cookie`，`C:/Users/smalle/.erlang.cookie`，具体位置可find一下），将此文件复制到B、C相同的目录</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 后台启动所有节点服务（erlang vm 和 rabbitmq）</span></span><br><span class="line">rabbitmq-server -detached</span><br><span class="line"></span><br><span class="line"><span class="comment">## 在 test2、test3 上操作</span></span><br><span class="line"><span class="comment"># 关闭 rabbitmq, 但是会保留 erlang vm 进程</span></span><br><span class="line">rabbitmqctl stop_app</span><br><span class="line"><span class="comment"># 加入到集群 rabbit@test1 （需要hosts中有test1的ip映射）</span></span><br><span class="line">rabbitmqctl join_cluster rabbit@test1 <span class="comment"># 成功则提示 Clustering node rabbit@test2 with rabbit@test1</span></span><br><span class="line"><span class="comment"># 重新启动 rabbitmq 进程</span></span><br><span class="line">rabbitmqctl start_app</span><br><span class="line"></span><br><span class="line"><span class="comment">## 查看集群状态。也可以在管理界面的 Overview-Nodes 看到多个节点</span></span><br><span class="line">rabbitmqctl cluster_status</span><br><span class="line"><span class="comment">## 此时 test1 的队列等信息会映射到其他两个节点。客户端可以连接任何一个节点读写消息，但是如果 test1 宕机，则映射过来的队列的 State=down，且改队列不可对外通过服务</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 增加镜像策略解决上述问题</span></span><br><span class="line"><span class="comment"># 对/test虚拟主机增加策略，策略名为ha-all，且交换机和队列以hello开头的，策略描述为 &#123;"ha-mode":"all","ha-sync-mode":"automatic"&#125; (automatic自动同步镜像到集群的all所有节点)。策略增加成功后，会在对应的对应的Features上显示`ha-all`的标识</span></span><br><span class="line">rabbitmqctl set_policy -p /<span class="built_in">test</span> ha-all <span class="string">'^hello'</span> <span class="string">'&#123;"ha-mode":"all","ha-sync-mode":"automatic"&#125;'</span></span><br><span class="line">rabbitmqctl list_policy <span class="comment"># 查看策略</span></span><br><span class="line"><span class="comment"># 此时尽管 test1 宕机，其他节点还是可以对外提供服务</span></span><br></pre></td></tr></table></figure><ul><li><p>常见错误：<code>Authentication failed (rejected by the remote node), please check the Erlang cookie</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 还有如下输出，此时 Erlang cookie hash 是.erlang.cookie文件内容经过hash得到，且.erlang.cookie文件处于/root目录。出现此问题可能是：</span></span><br><span class="line"><span class="comment"># 1.几个节点的.erlang.cookie内容不一致</span></span><br><span class="line"><span class="comment"># 2.Erlang VM没有启动</span></span><br><span class="line"><span class="comment"># 3.rabbitmq app没有关闭（需执行rabbitmqctl stop_app）</span></span><br><span class="line">Current node details:</span><br><span class="line">* node name: <span class="string">'rabbitmqcli79@LAPTOP-SDG10LIN'</span></span><br><span class="line">* effective user<span class="string">'s home directory: /root</span></span><br><span class="line"><span class="string">* Erlang cookie hash: Jx59lsGpH45Mhu5eAkFMGQ==</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="插件"><a href="#插件" class="headerlink" title="插件"></a>插件</h2><h3 id="日志插件"><a href="#日志插件" class="headerlink" title="日志插件"></a>日志插件</h3><ul><li>rabbitmq默认没有开启日志插件</li><li>开启插件</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 开启插件</span></span><br><span class="line">rabbitmq-plugins <span class="built_in">enable</span> rabbitmq_tracing</span><br><span class="line"><span class="comment"># 关闭插件</span></span><br><span class="line">rabbitmq-plugins <span class="built_in">disable</span> rabbitmq_tracing</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看插件列表(有标记的表示已开启)</span></span><br><span class="line">rabbitmq-plugins list</span><br></pre></td></tr></table></figure><ul><li>开启插件后还需手动设置，在后台管理界面 - Admin - Tracing可查看<ul><li>Add a new trace增加一个日志规则，假设Name=test，Format=Text，则会生成一个test.log的文件</li><li>在后台管理界面也可查看</li></ul></li><li>日志格式</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 发送消息为"my-msg"</span></span><br><span class="line">================================================================================</span><br><span class="line">2021-04-14 20:02:55:020: Message published</span><br><span class="line"></span><br><span class="line">Node:         rabbit@node1</span><br><span class="line">Connection:   &lt;rabbit@node1.3.1620.0&gt;</span><br><span class="line">Virtual host: /</span><br><span class="line">User:         guest</span><br><span class="line">Channel:      1</span><br><span class="line">Exchange:     amq.direct</span><br><span class="line">Routing keys: [&lt;&lt;&gt;&gt;]</span><br><span class="line">Routed queues: []</span><br><span class="line">Properties:   [&#123;&lt;&lt;<span class="string">"delivery_mode"</span>&gt;&gt;,signedint,2&#125;,&#123;&lt;&lt;<span class="string">"headers"</span>&gt;&gt;,table,[]&#125;]</span><br><span class="line">Payload: </span><br><span class="line">my-msg</span><br><span class="line"></span><br><span class="line"><span class="comment">## 接受消息</span></span><br><span class="line">================================================================================</span><br><span class="line">2021-04-14 20:02:55:020: Message received</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h2 id="后台管理"><a href="#后台管理" class="headerlink" title="后台管理"></a>后台管理</h2><ul><li>激活 Rabbit MQ’s Management Plugin(可激活管理插件)<ul><li>CMD 进入 RabbitMQ 安装目录，进入到 rabbitmq_server-3.8.7/sbin 目录</li><li>运行 <code>rabbitmq-plugins enable rabbitmq_management</code></li></ul></li><li>登录管理后台<ul><li><code>http://localhost:15672</code> 使用<code>guest/guest</code>登录(需要激活 rabbitmq_management)</li><li>如果需要通过内网访问，可设置配置 loopback_users.guest=false，具体参考上文安装</li></ul></li><li>Overview 概览页面</li><li>Connections 连接客户端查看页</li><li>Channels 客户端会话查看页(在客户端的每个连接里，可建立多个 channel，每个 channel 代表一个会话任务)</li><li>Exchanges 交换机管理页</li><li>Queues 队列管理页面</li><li>Admin 管理员操作页面<ul><li>Users 用户管理<ul><li>Add a user 添加用户</li><li>点击用户进入详情页面<ul><li>Permissions 可设置用户权限<ul><li>选择 Virtual Host，其他为<code>.*</code>表示拥有此虚拟机的所有权限(包括配置交换机、队列等)</li></ul></li><li><strong>Topic permissions</strong> 可设置监听消息队列和订阅权限<ul><li>选择 Virtual Host，需要看队列所属的虚拟机</li><li>Exchange交换机类型：如direct(默认)、topic</li><li>其他为<code>.*</code>表示对此虚拟机下的该交换机类型拥有所有权限</li></ul></li><li>Update this user<ul><li>Tags 角色<ul><li>admin(administrator)：管理员角色，可以管理所有虚拟机资源</li><li>management：只能管理某个虚拟机下的资源</li></ul></li></ul></li></ul></li></ul></li><li>Virtual Hosts 虚拟主机管理<ul><li>Add a new virtual host 添加虚拟主机<ul><li>输入名称如<code>/vhost_aezocn_test</code>，命名上 abc 和 /abc 是不同的</li><li>需要先有对应的虚拟主机，客户端才能连接</li></ul></li><li>点击某个虚拟主机进入到详情页面<ul><li>Permissions 和 Topic permissions 可设置用户权限，参考 Users 中的</li></ul></li></ul></li><li>Policies 策略管理</li></ul></li></ul><h2 id="erlang"><a href="#erlang" class="headerlink" title="erlang"></a>erlang</h2><ul><li><a href="https://www.erlang.org/" target="_blank" rel="noopener">erlang</a></li><li>安装 <a href="https://blog.csdn.net/qq_41709494/article/details/86740162" target="_blank" rel="noopener">^1</a></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 不能使用默认源，否则安装的是R16B03-1。如是centos8则配置为.../el/8/</span></span><br><span class="line">cat &gt; /etc/yum.repos.d/erlang.repo &lt;&lt; EOF</span><br><span class="line">[rabbitmq-erlang]</span><br><span class="line">name=rabbitmq-erlang</span><br><span class="line">baseurl=https://dl.bintray.com/rabbitmq-erlang/rpm/erlang/21/el/7</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=https://dl.bintray.com/rabbitmq/Keys/rabbitmq-release-signing-key.asc</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line">EOF</span><br><span class="line">yum install erlang -y</span><br></pre></td></tr></table></figure><ul><li>命令</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 进入erlang shell。表示版为 R16B03-1 (rabbitmq 3.8.7 至少需要版本 OTP 21.3，参考：https://www.rabbitmq.com/which-erlang.html)</span></span><br><span class="line">erl <span class="comment"># Erlang R16B03-1 (erts-5.10.4) [source] [64-bit] [smp:2:2] [async-threads:10] [hipe] [kernel-poll:false]</span></span><br><span class="line">Ctrl+G, q <span class="comment"># 退出（需要输入两次两次命令）</span></span><br></pre></td></tr></table></figure><hr><p>参考文章</p></div><div></div><div></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> smalle</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="http://blog.aezo.cn/2016/08/14/arch/rabbitmq/" title="RabbitMQ">http://blog.aezo.cn/2016/08/14/arch/rabbitmq/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！</li></ul></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/mq/" rel="tag"># mq</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2016/07/21/linux/linux/" rel="next" title="linux系统"><i class="fa fa-chevron-left"></i> linux系统</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"> <a href="/2016/08/14/db/mongodb/" rel="prev" title="mongodb">mongodb<i class="fa fa-chevron-right"></i></a></div></div></footer></article><div class="post-spread"></div></div></div><div class="comments" id="comments"></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap"> 文章目录</li><li class="sidebar-nav-overview" data-target="site-overview"> 站点概览</li></ul><section class="site-overview sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" src="https://avatars0.githubusercontent.com/u/15698218?v=3&u=ce740bf0b67ff0d74990ba6fc644d6e92f572dcb&s=400" alt="smalle"><p class="site-author-name" itemprop="name">smalle</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">157</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/index.html"><span class="site-state-item-count">13</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/index.html"><span class="site-state-item-count">141</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#RabbitMQ-简介"><span class="nav-number">1.</span> <span class="nav-text">RabbitMQ 简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RabbitMQ-安装"><span class="nav-number">2.</span> <span class="nav-text">RabbitMQ 安装</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#linux"><span class="nav-number">2.1.</span> <span class="nav-text">linux</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#windows"><span class="nav-number">2.2.</span> <span class="nav-text">windows</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#配置文件"><span class="nav-number">2.2.1.</span> <span class="nav-text">配置文件</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#相关命令"><span class="nav-number">3.</span> <span class="nav-text">相关命令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#RabbitMQ-启动与停止"><span class="nav-number">3.1.</span> <span class="nav-text">RabbitMQ 启动与停止</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#命令说明"><span class="nav-number">3.2.</span> <span class="nav-text">命令说明</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#rabbitmqctl"><span class="nav-number">3.3.</span> <span class="nav-text">rabbitmqctl</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#rabbitmq-diagnostics"><span class="nav-number">3.4.</span> <span class="nav-text">rabbitmq-diagnostics</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#简单使用"><span class="nav-number">3.5.</span> <span class="nav-text">简单使用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#客户端使用"><span class="nav-number">4.</span> <span class="nav-text">客户端使用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#简单使用-1"><span class="nav-number">4.1.</span> <span class="nav-text">简单使用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#point-work-点对点-工作模式"><span class="nav-number">4.1.1.</span> <span class="nav-text">point/work(点对点/工作模式)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#topic"><span class="nav-number">4.1.2.</span> <span class="nav-text">topic</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#整合-SpringBoot"><span class="nav-number">4.2.</span> <span class="nav-text">整合 SpringBoot</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#镜像-集群搭建"><span class="nav-number">5.</span> <span class="nav-text">(镜像)集群搭建</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#插件"><span class="nav-number">6.</span> <span class="nav-text">插件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#日志插件"><span class="nav-number">6.1.</span> <span class="nav-text">日志插件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#后台管理"><span class="nav-number">7.</span> <span class="nav-text">后台管理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#erlang"><span class="nav-number">8.</span> <span class="nav-text">erlang</span></a></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2016 - <span itemprop="copyrightYear">2022</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">smalle</span>&nbsp;&nbsp;&nbsp;&nbsp;<div class="powered-by"> 由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div><div class="powered-by"> 主题 - <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a></div><div class="theme-info cnzz" style="margin:0 0 -5px 10px"><script type="text/javascript">var cnzz_protocol="https:"==document.location.protocol?"https://":"http://";document.write(unescape("%3Cspan id='cnzz_stat_icon_1276691827'%3E%3C/span%3E%3Cscript src='"+cnzz_protocol+"s23.cnzz.com/z_stat.php%3Fid%3D1276691827%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"))</script></div></div><div class="ad"> <span style="font-weight:700">AD&nbsp;&nbsp;&nbsp;&nbsp;</span><div class="theme-info"> <a target="_blank" href="https://promotion.aliyun.com/ntms/yunparter/invite.html?userCode=oby5nolb">阿里云大礼包</a></div></div><div class="aezocn"> <span style="font-weight:700">@AEZO.CN&nbsp;&nbsp;&nbsp;&nbsp;</span><div class="theme-info"> <a target="_blank" href="http://shop.aezo.cn/">杂货铺</a></div></div><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?d82223039d601f2f819f8fe140a63468";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script><script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script type="text/javascript" src="/js/src/js.cookie.js?v=5.1.1"></script><script type="text/javascript" src="/js/src/scroll-cookie.js?v=5.1.1"></script></body></html>