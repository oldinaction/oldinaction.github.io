<!doctype html><html class="theme-next mist use-motion" lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css"><meta name="keywords" content="db,mybatis,"><link rel="alternate" href="/atom.xml" title="月星墙的博客" type="application/atom+xml"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1"><meta name="description" content="简介 MyBatis3中文文档 MyBatis Generator：mybatis代码生成(model/dao/mapper)，文档  简单使用12345678910String resource = &quot;SqlMapConfig.xml&quot;;InputStream in = Resources.getResourceAsStream(resource);SqlSessionFactory facto"><meta name="keywords" content="db,mybatis"><meta property="og:type" content="article"><meta property="og:title" content="Mybatis"><meta property="og:url" content="http://blog.aezo.cn/2017/05/22/java/mybatis/index.html"><meta property="og:site_name" content="月星墙的博客"><meta property="og:description" content="简介 MyBatis3中文文档 MyBatis Generator：mybatis代码生成(model/dao/mapper)，文档  简单使用12345678910String resource = &quot;SqlMapConfig.xml&quot;;InputStream in = Resources.getResourceAsStream(resource);SqlSessionFactory facto"><meta property="og:locale" content="zh-Hans"><meta property="og:image" content="https://www.plantuml.com/plantuml/svg/hLLRInj157xE_eg1FXYXRcXz2qMyfILjXO8j2CM7oUvqdJexk-xEUdjIl5TgGh61Ib635dnfLLgi9eX_9hj9_qLdTZPhM5CjfG_Povbplk_Bj-VCzBiCEimpYU9EOcf31vgW0BL9mx4ygWzPn7B0lLmkDpWyr9On0Qa-us3640NCyP32C2D8IOtC3KA6NV04KUH0nck3Qgcnl-YlhmQx9V08cqPsWZ4xcyaKY6Me4CrRgaOpugvHrQP6duAe3YIS0ZK1ySf5ZY8kFNrz4K6CdmM6V4HASebd3rcKeLcM1GzKJ9bZkJRIs4jO8CXztTpwwHVBycLSYJ9vpJ1ai01Tb8yB14koNCbq0N-lMgzkWRTm6ghk555RbIE8GV4CWgqlVl504ZKhHq6nsBmwgLzLWiNZjEL0ZI2v5cmi19ytN6q2cgX-lXbyFUJPVkbzD-ZAA9tqjCbiaGaZ6FzSdadTMwrugBOSUuo53utjlM2z59JNwhMp-w1vijJOFhA9Ps0wO1WECaJzk48iomOop97UOCFZ2DZYN2dXnBlzvkLbKFp0COJcrBMTCMyIKuMw_YACfULIj_ZoakZQRQH7VWiQALNuBUKcgFB9giY6thnfa-nDK6u4Yon2-bEE6XgIxbPIeldjY6xM999DILrhaC6WSX1A-5yQnamII-Z0fLkQPoBA_EEBvcb5Cj_An_KC55p6EurnwBQPuP0ZqBQH4yU4Zk48FwJlLCZnHZ77HMCZpnFrOVkDJWdO744nof_IRqNYZP6dVDnP2mbITmOv_uo7AMOO4ZoF1gYUcqMQnr2yd5PLzGxaDYiYHMtWA14HRHrbkMc-MV9xz2fO8650_hTHNgWnF8sIa6d_S2TOM1JPl0VgvxLVsz_ym-L6QJNyuAaxodjwRlRWNNtt3Csb8pv_vQnUA_ihIuqV-ssiYBW8oBN6QStVtHGnFgrXcyezGqv_OsSPk64RnEWWA5y4tp_-NR_A7I4BD3bHGgOCyQ5G4y12in0XVXrsl9j7HQygpgnet_DNF_bhLJdQuqe_1-67u6y0"><meta property="og:updated_time" content="2024-03-08T03:10:10.682Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Mybatis"><meta name="twitter:description" content="简介 MyBatis3中文文档 MyBatis Generator：mybatis代码生成(model/dao/mapper)，文档  简单使用12345678910String resource = &quot;SqlMapConfig.xml&quot;;InputStream in = Resources.getResourceAsStream(resource);SqlSessionFactory facto"><meta name="twitter:image" content="https://www.plantuml.com/plantuml/svg/hLLRInj157xE_eg1FXYXRcXz2qMyfILjXO8j2CM7oUvqdJexk-xEUdjIl5TgGh61Ib635dnfLLgi9eX_9hj9_qLdTZPhM5CjfG_Povbplk_Bj-VCzBiCEimpYU9EOcf31vgW0BL9mx4ygWzPn7B0lLmkDpWyr9On0Qa-us3640NCyP32C2D8IOtC3KA6NV04KUH0nck3Qgcnl-YlhmQx9V08cqPsWZ4xcyaKY6Me4CrRgaOpugvHrQP6duAe3YIS0ZK1ySf5ZY8kFNrz4K6CdmM6V4HASebd3rcKeLcM1GzKJ9bZkJRIs4jO8CXztTpwwHVBycLSYJ9vpJ1ai01Tb8yB14koNCbq0N-lMgzkWRTm6ghk555RbIE8GV4CWgqlVl504ZKhHq6nsBmwgLzLWiNZjEL0ZI2v5cmi19ytN6q2cgX-lXbyFUJPVkbzD-ZAA9tqjCbiaGaZ6FzSdadTMwrugBOSUuo53utjlM2z59JNwhMp-w1vijJOFhA9Ps0wO1WECaJzk48iomOop97UOCFZ2DZYN2dXnBlzvkLbKFp0COJcrBMTCMyIKuMw_YACfULIj_ZoakZQRQH7VWiQALNuBUKcgFB9giY6thnfa-nDK6u4Yon2-bEE6XgIxbPIeldjY6xM999DILrhaC6WSX1A-5yQnamII-Z0fLkQPoBA_EEBvcb5Cj_An_KC55p6EurnwBQPuP0ZqBQH4yU4Zk48FwJlLCZnHZ77HMCZpnFrOVkDJWdO744nof_IRqNYZP6dVDnP2mbITmOv_uo7AMOO4ZoF1gYUcqMQnr2yd5PLzGxaDYiYHMtWA14HRHrbkMc-MV9xz2fO8650_hTHNgWnF8sIa6d_S2TOM1JPl0VgvxLVsz_ym-L6QJNyuAaxodjwRlRWNNtt3Csb8pv_vQnUA_ihIuqV-ssiYBW8oBN6QStVtHGnFgrXcyezGqv_OsSPk64RnEWWA5y4tp_-NR_A7I4BD3bHGgOCyQ5G4y12in0XVXrsl9j7HQygpgnet_DNF_bhLJdQuqe_1-67u6y0"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Mist",sidebar:{position:"right",display:"post",offset:12,offset_float:0,b2t:!1,scrollpercent:!1},fancybox:!0,motion:!0,duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"BWD6R9FA4K",apiKey:"3330f3cbaa099dfc30395de5f5b20151",indexName:"blog",hits:{per_page:10},labels:{input_placeholder:"请输入关键字",hits_empty:"我们没有找到任何搜索结果: ${query}",hits_stats:"找到约${hits}条结果（用时${time}ms）"}}}</script><link rel="canonical" href="http://blog.aezo.cn/2017/05/22/java/mybatis/"><title>Mybatis | 月星墙的博客</title><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?085f9cd91ef2ad985f791c677472f0d1";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-right page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">月星墙的博客</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">Better Code, Better Life</h1></div><div class="site-nav-toggle"> <button><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br> 首页</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br> 分类</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br> 关于</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br> 归档</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br> 标签</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="menu-item-icon fa fa-fw fa-sitemap"></i><br> 站点地图</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br> 搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i></span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"> <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://blog.aezo.cn/2017/05/22/java/mybatis/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="smalle"><meta itemprop="description" content=""><meta itemprop="image" content="https://avatars0.githubusercontent.com/u/15698218?v=3&u=ce740bf0b67ff0d74990ba6fc644d6e92f572dcb&s=400"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="月星墙的博客"></span><header class="post-header"><h2 class="post-title" itemprop="name headline">Mybatis</h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-22T15:05:00+08:00">2017-05-22</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a></span></span></div></header><div class="post-body" itemprop="articleBody"><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><ul><li><a href="http://www.mybatis.org/mybatis-3/zh/index.html" target="_blank" rel="noopener">MyBatis3中文文档</a></li><li><code>MyBatis Generator</code>：mybatis代码生成(model/dao/mapper)，<a href="http://www.mybatis.org/generator/" target="_blank" rel="noopener">文档</a></li></ul><h3 id="简单使用"><a href="#简单使用" class="headerlink" title="简单使用"></a>简单使用</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">String resource = <span class="string">"SqlMapConfig.xml"</span>;</span><br><span class="line">InputStream in = Resources.getResourceAsStream(resource);</span><br><span class="line">SqlSessionFactory factory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(in);</span><br><span class="line">SqlSession sqlSession = factory.openSession();</span><br><span class="line">OrdersMapper mapper = sqlSession.getMapper(OrdersMapper.class);</span><br><span class="line"></span><br><span class="line">List&lt;Orders&gt; list = mapper.findAll();</span><br><span class="line"><span class="keyword">for</span> (Orders order : list) &#123;</span><br><span class="line">    System.out.println(order);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="整合mybatis-SpringBoot"><a href="#整合mybatis-SpringBoot" class="headerlink" title="整合mybatis(SpringBoot)"></a>整合mybatis(SpringBoot)</h2><ul><li><p>引入依赖(mybatis-spring-boot-starter为mybatis提供的自动配置插件) <a href="http://blog.csdn.net/gebitan505/article/details/54929287" title="整合mybatis" target="_blank" rel="noopener">^1</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 自动配置 https://github.com/mybatis/spring-boot-starter --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- &lt;version&gt;1.3.1&lt;/version&gt; --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--mybatis分页插件: https://github.com/pagehelper/Mybatis-PageHelper--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>5.0.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 方式二：会包含mybatis依赖，并且无需再mybatis配置文件中配置此插件。如果使用mybatis-plus插件则不需要此分页插件</span></span><br><span class="line"><span class="comment">       自动装配时，会获取初始化后的SqlSessionFactory，然后获取其Configuration，再将插件添加进去(而非在SqlSessionFactory初始化前进行配置的)</span></span><br><span class="line"><span class="comment">   --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">&lt;!-- 方式三：使用mybatis-plus(推荐)，使用内置自定义的分页插件 --&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>扫描配置(二者缺一不可)</p><ul><li>启动类中加 <strong><code>@MapperScan({&quot;cn.aezo.springboot.mybatis.mapperxml&quot;, &quot;cn.aezo.springboot.module.*.mapper&quot;})</code></strong> 进行接口扫描<ul><li>此处一层包通配符为<code>.*.</code>，多次包为<code>.**.</code>，和mybatis.mapper-locations通配符配合使用进行多模块管理</li><li>mybatis-plus注解方式也是使用此类</li></ul></li><li>还需要加mybatis.mapper-locations的配置，进行xml映射文件扫描<ul><li>mybatis-plus复写了此配置，对应<code>mybatis-plus.mapper-locations</code>，其默认值为<code>classpath*:/mapper/**/*.xml</code>，因此一般可不用配置此参数</li></ul></li></ul></li><li>Springboot配置</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 基于xml配置时需指明映射文件扫描位置；设置多个路径可用","分割，如："classpath:mapper/*.xml(无法扫描其子目录),classpath:mapper2/*.xml"</span></span><br><span class="line"><span class="comment"># classpath只会扫描当前module的class, 而改为classpath*则会扫描所有jar</span></span><br><span class="line">mybatis.mapper-locations=classpath:mapper/*.xml,classpath:mapper/**/*.xml</span><br><span class="line"><span class="comment"># mybatis配置文件位置(mybatis.config-location和mybatis.configuration...不能同时使用), 由于自动配置对插件支持不够暂时使用xml配置，可用于自定义插件</span></span><br><span class="line">mybatis.config-location=classpath:mybatis-config.xml</span><br><span class="line"></span><br><span class="line"><span class="comment">## 不设置mybatis配置文件时</span></span><br><span class="line"><span class="comment"># mybatis.configuration.map-underscore-to-camel-case=true # 字段格式对应关系：数据库字段为下划线, model字段为驼峰标识(不设定则需要通过resultMap进行转换)</span></span><br><span class="line"><span class="comment"># mybatis.configuration.log-impl=org.apache.ibatis.logging.stdout.StdOutImpl # 声明打印日志到控制台。如果打印到日志需要到logback.xml中增加配置，或者配置logging.level.cn.aezo.mapper=DEBUG</span></span><br><span class="line"><span class="comment"># mybatis.type-aliases-package=cn.aezo.springboot.mybatis.model # 类型别名定义扫描的包(可结合@Alias使用, 默认是类名首字母小写)</span></span><br></pre></td></tr></table></figure><ul><li><p>mybatis配置文件: <code>mybatis-config.xml</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span> <span class="meta">?&gt;</span></span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE configuration PUBLIC "-//mybatis.org//DTD Config 3.0//EN" "http://mybatis.org/dtd/mybatis-3-config.dtd"&gt;</span></span><br><span class="line"><span class="comment">&lt;!--在application.properties中使用了mybatis.configuration进行配置，无需此文件(传统配置)--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--字段格式对应关系：数据库字段为下划线, model字段为驼峰标识(不设定则需要通过resultMap进行转换)--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"mapUnderscoreToCamelCase"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">&lt;!--打印mybatis运行的sql语句到控制台。STDOUT表示调用System.out。--&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 打印到日志，则需要在如logback.xml中加 &lt;logger name="cn.aezo.video.dao" level="debug"/&gt; 定义打印级别 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"logImpl"</span> <span class="attr">value</span>=<span class="string">"STDOUT_LOGGING"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!--类型别名定义--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--定义需要扫描的包--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"cn.aezo.springboot.mybatis.model"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">&lt;!--定义后可在映射文件中间的parameterType等字段中使用userInfo代替cn.aezo.springboot.mybatis.model.UserInfo--&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--&lt;typeAlias alias="userInfo" type="cn.aezo.springboot.mybatis.model.UserInfo" /&gt;--&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 分页插件 --&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 5.0.0以后使用com.github.pagehelper.PageInterceptor作为拦截器 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">plugin</span> <span class="attr">interceptor</span>=<span class="string">"com.github.pagehelper.PageInterceptor"</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!--更多参数配置：https://github.com/pagehelper/Mybatis-PageHelper/blob/master/wikis/zh/HowToUse.md--&gt;</span></span><br><span class="line">			<span class="comment">&lt;!--&lt;property name="pageSizeZero" value="true"/&gt;--&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">&lt;!-- 基于databaseId实现数据库兼容. DB_VENDOR为mybatis内置别名，对应VendorDatabaseIdProvider --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">databaseIdProvider</span> <span class="attr">type</span>=<span class="string">"DB_VENDOR"</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"MySQL"</span> <span class="attr">value</span>=<span class="string">"mysql"</span>/&gt;</span>        </span><br><span class="line">           <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"Oracle"</span> <span class="attr">value</span>=<span class="string">"oracle"</span> /&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">databaseIdProvider</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>Model：<strong>UserInfo/ClassInfo等无需任何注解.</strong>(其中HobbyEnum是一个枚举类)</p></li></ul><h2 id="annotation版本-适合简单业务"><a href="#annotation版本-适合简单业务" class="headerlink" title="annotation版本(适合简单业务)"></a>annotation版本(适合简单业务)</h2><ul><li><p><code>annotation版本(适合简单业务)</code></p><ul><li><p>Dao层：UserMapper.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @Mapper // 在启动类中定义需要扫描mapper的包：@MapperScan("cn.aezo.springboot.mybatis.mapper"), 则此处无需声明@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line">	<span class="comment">// 1. 此处注入变量可以使用#或者$</span></span><br><span class="line">	<span class="comment">// 2. 一个参数可以省略@Param，多个需要进行指定(反射机制)</span></span><br><span class="line">	<span class="comment">// 3. 当未获取到数据时，返回 null</span></span><br><span class="line">	<span class="comment">// 4. (使用配置&lt;setting name="mapUnderscoreToCamelCase" value="true"/&gt;因此无需转换) 数据库字段名和model字段名或javaType不一致的均需要@Result转换</span></span><br><span class="line">		<span class="comment">// @Results(&#123;</span></span><br><span class="line">		<span class="comment">//         @Result(property = "hobby",  column = "hobby", javaType = HobbyEnum.class),</span></span><br><span class="line">		<span class="comment">//         @Result(property = "nickName", column = "nick_name"),</span></span><br><span class="line">		<span class="comment">//         @Result(property = "groupId", column = "group_Id")</span></span><br><span class="line">		<span class="comment">// &#125;)</span></span><br><span class="line">	<span class="meta">@Select</span>(<span class="string">"select * from user_info where nick_name = #&#123;nickName&#125;"</span>)</span><br><span class="line">	<span class="function">UserInfo <span class="title">findByNickName</span><span class="params">(@Param(<span class="string">"nickName"</span>)</span> String nickName)</span>;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Select</span>(<span class="string">"select * from user_info"</span>)</span><br><span class="line">	<span class="function">List&lt;UserInfo&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Insert</span>(<span class="string">"insert into user_info(nick_name, group_id, hobby) values(#&#123;nickName&#125;, #&#123;groupId&#125;, #&#123;hobby&#125;)"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(UserInfo userInfo)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Update</span>(<span class="string">"update user_info set nick_name = #&#123;nickName&#125;, hobby = #&#123;hobby&#125; where id = #&#123;id&#125;"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(UserInfo userInfo)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Delete</span>(<span class="string">"delete from user_info where id = #&#123;id&#125;"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">delete</span><span class="params">(Long id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>分页</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 分页查询：http://localhost:9526/api/users</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/users"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> PageInfo <span class="title">showAllUser</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">		@RequestParam(defaultValue = <span class="string">"1"</span>)</span> Integer pageNum,</span></span><br><span class="line"><span class="function">		@<span class="title">RequestParam</span><span class="params">(defaultValue = <span class="string">"5"</span>)</span> Integer pageSize) </span>&#123;</span><br><span class="line">	PageHelper.startPage(pageNum, pageSize); <span class="comment">// 默认查询第一页，显示5条数据（必须在实例化PageInfo之前）</span></span><br><span class="line">	<span class="comment">// ... // 此处如果发起了其他sql则此处的sql会被分页，而下面的sql则不会被分页</span></span><br><span class="line">	List&lt;UserInfo&gt; users = userMapper.findAll(); <span class="comment">// 第一条执行的SQL语句会被分页，实际上输出users是page对象</span></span><br><span class="line">	PageInfo&lt;UserInfo&gt; pageUser = <span class="keyword">new</span> PageInfo&lt;UserInfo&gt;(users); <span class="comment">// 将users对象绑定到pageInfo</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> pageUser;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>分页查询结果</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	pageNum: <span class="number">1</span>,</span><br><span class="line">	pageSize: <span class="number">5</span>,</span><br><span class="line">	size: <span class="number">2</span>,</span><br><span class="line">	startRow: <span class="number">1</span>,</span><br><span class="line">	endRow: <span class="number">2</span>,</span><br><span class="line">	total: <span class="number">2</span>,</span><br><span class="line">	pages: <span class="number">1</span>,</span><br><span class="line">	list: [</span><br><span class="line">		&#123;</span><br><span class="line">			id: <span class="number">1</span>,</span><br><span class="line">			groupId: <span class="number">1</span>,</span><br><span class="line">			nickName: <span class="string">"smalle"</span>,</span><br><span class="line">			hobby: <span class="string">"GAME"</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			id: <span class="number">2</span>,</span><br><span class="line">			groupId: <span class="number">1</span>,</span><br><span class="line">			nickName: <span class="string">"aezo"</span>,</span><br><span class="line">			hobby: <span class="string">"CODE"</span></span><br><span class="line">		&#125;</span><br><span class="line">	],</span><br><span class="line">	prePage: <span class="number">0</span>,</span><br><span class="line">	nextPage: <span class="number">0</span>,</span><br><span class="line">	isFirstPage: <span class="literal">true</span>,</span><br><span class="line">	isLastPage: <span class="literal">true</span>,</span><br><span class="line">	hasPreviousPage: <span class="literal">false</span>,</span><br><span class="line">	hasNextPage: <span class="literal">false</span>,</span><br><span class="line">	navigatePages: <span class="number">8</span>,</span><br><span class="line">	navigatepageNums: [</span><br><span class="line">		<span class="number">1</span></span><br><span class="line">	],</span><br><span class="line">	navigateFirstPage: <span class="number">1</span>,</span><br><span class="line">	navigateLastPage: <span class="number">1</span>,</span><br><span class="line">	firstPage: <span class="number">1</span>,</span><br><span class="line">	lastPage: <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>测试</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindByNickName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	UserInfo userInfo = userMapper.findByNickName(<span class="string">"smalle"</span>);</span><br><span class="line">	System.out.println(<span class="string">"userInfo = "</span> + userInfo);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testInsert</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">	userMapper.insert(<span class="keyword">new</span> UserInfo(<span class="string">"test"</span>, <span class="number">1L</span>, HobbyEnum.READ));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>基于注解的sql示例(用于简单的查询) <a href="https://segmentfault.com/q/1010000006875476" title="@Select注解中当参数为空则不添加该参数的判断" target="_blank" rel="noopener">^2</a></p><ul><li><p>用script标签包围，然后像xml语法一样书写</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">      <span class="comment">// Dao层，mybatis会基于此注解完成对应的实现</span></span><br><span class="line">      <span class="comment">// 可以理解为查询sql语句返回的是一个List&lt;Map&lt;String, Object&gt;&gt;(List里面必须为Map或其子类)。如果用Map&lt;String, Object&gt;接受返回值则默认取第一条数据</span></span><br><span class="line">      <span class="comment">// 使用双引号重命名字段解决返回数据字段全变大写</span></span><br><span class="line">      <span class="meta">@Select</span>(&#123; <span class="string">"&lt;script&gt;"</span>,</span><br><span class="line">          <span class="string">"select h.help_id as \"help_id\", h.apply_money, h.create_time, h.creator, h.description, h.is_comfort, h.is_valid, h.title, h.update_time, h.updater "</span>,</span><br><span class="line">          <span class="string">"   , e.name"</span>,</span><br><span class="line">          <span class="string">" from th_help as h "</span>,</span><br><span class="line">          <span class="string">"   left join th_event e on e.event_id = h.event_id"</span>,</span><br><span class="line">	<span class="string">"   left join th_group g on g.group_id = h.group_id "</span>,</span><br><span class="line">          <span class="string">" where 1=1 "</span>,</span><br><span class="line">	<span class="comment">// 此时可以使用&lt;if&gt;或&lt;when&gt;</span></span><br><span class="line">	<span class="string">" &lt;if test='plans != null and plans.size() &gt; 0'&gt;"</span>, <span class="comment">// 其中大于号也可以使用`&amp;gt;`来表示</span></span><br><span class="line">          <span class="string">"   and g.plan_id in "</span>,</span><br><span class="line">	<span class="comment">// in 的使用。item为当前元素，index为下标变量</span></span><br><span class="line">          <span class="string">"   &lt;foreach item='plan' index='index' collection='plans' open='(' separator=',' close=')'&gt;"</span>,</span><br><span class="line">          <span class="string">"       #&#123;plan.planId&#125;"</span>,</span><br><span class="line">          <span class="string">"   &lt;/foreach&gt;"</span>,</span><br><span class="line">          <span class="string">" &lt;/if&gt;"</span>,</span><br><span class="line">	<span class="comment">// like 的使用。此处必须使用concat进行字符串连接. oracle则需要使用 h.title like concat(concat('%',#&#123;roleName&#125;),'%')</span></span><br><span class="line">          <span class="string">" &lt;if test='help.title != null and help.title != \"\"'&gt; AND h.title like concat('%', #&#123;help.title&#125;, '%')&lt;/if&gt;"</span>,</span><br><span class="line">          <span class="string">" &lt;if test='event.name != null'&gt; AND e.name = #&#123;event.name&#125;"</span>, <span class="string">"&lt;/if&gt;"</span>,</span><br><span class="line">	<span class="comment">// or 的使用(1 != 1 or .. or ..)</span></span><br><span class="line">	<span class="string">" &lt;if test='help.title != null and help.desc != null or help.start != null and help.end != null'&gt; and ("</span>,</span><br><span class="line">	<span class="string">"  &lt;if test='help.title != null and help.desc != null&gt;"</span>,</span><br><span class="line">	<span class="string">"    help.title = #&#123;help.title&#125;"</span>,</span><br><span class="line">	<span class="string">"  &lt;/if&gt;"</span>,</span><br><span class="line">	<span class="string">"  &lt;if test='help.start != null and help.end != null&gt;"</span>,</span><br><span class="line">	<span class="string">"    or help.start = #&#123;help.start&#125; and help.end = #&#123;help.end&#125;"</span>,</span><br><span class="line">	<span class="string">"  &lt;/if&gt;"</span>,</span><br><span class="line">	<span class="string">" ) &lt;/if&gt;"</span>,</span><br><span class="line">          <span class="string">"&lt;/script&gt;"</span> &#125;)</span><br><span class="line">      List&lt;Map&lt;String, Object&gt;&gt; findHelps(<span class="meta">@Param</span>(<span class="string">"help"</span>) Help help, <span class="meta">@Param</span>(<span class="string">"event"</span>) Event event, <span class="meta">@Param</span>(<span class="string">"plans"</span>) List&lt;Plan&gt; plans);</span><br><span class="line"><span class="comment">// 还是使用上面script，如果提供对应的HelpPojo对象，mybatis会自动将字段的下划线转成驼峰，并去寻找HelpPojo相应的属性</span></span><br><span class="line"><span class="comment">// List&lt;HelpPojo&gt; findHelps(@Param("help") Help help, @Param("event") Event event, @Param("plans") List&lt;Plan&gt; plans);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 此方法也可以再xml中实现（即部分可以通过 @Select 声明，部分可以在xml中实现）</span></span><br><span class="line"><span class="function">List&lt;HelpPojo&gt; <span class="title">findHelps</span><span class="params">(@Param(<span class="string">"help"</span>)</span> HelpPojo helpPojo)</span>; <span class="comment">// 此时xml中必须通过help对象获取属性.如果不写@Param("help")则可直接获取属性值</span></span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 配合分页插件使用</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> Object <span class="title">findHelps</span><span class="params">(Help help, Event event,</span></span></span><br><span class="line"><span class="function"><span class="params">              @RequestParam(defaultValue = <span class="string">"1"</span>)</span> Integer pageNum,</span></span><br><span class="line"><span class="function">              @<span class="title">RequestParam</span><span class="params">(defaultValue = <span class="string">"10"</span>)</span> Integer pageSize) </span>&#123;</span><br><span class="line">          PageHelper.startPage(pageNum, pageSize);</span><br><span class="line">	<span class="comment">// PageHelper要在目标查询的最近开启. 如果此处在查询一下其他数据则容易出现分页无效的情形</span></span><br><span class="line">          List users = helpMapper.findHelps(help, event);</span><br><span class="line">          PageInfo pageUser = <span class="keyword">new</span> PageInfo(users);</span><br><span class="line"></span><br><span class="line">          <span class="keyword">return</span> pageUser;</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure></li><li><p>用Provider去实现SQL拼接(适用于复杂sql)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderProvider</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String TBL_ORDER = <span class="string">"tbl_order"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">queryOrderByParam</span><span class="params">(OrderPara param)</span> </span>&#123;</span><br><span class="line">        SQL sql = <span class="keyword">new</span> SQL().SELECT(<span class="string">"*"</span>).FROM(TBL_ORDER);</span><br><span class="line">        String room = param.getRoom();</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.hasText(room)) &#123;</span><br><span class="line">            sql.WHERE(<span class="string">"room LIKE #&#123;room&#125;"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        Date myDate = param.getMyDate();</span><br><span class="line">        <span class="keyword">if</span> (myDate != <span class="keyword">null</span>) &#123;</span><br><span class="line">            sql.WHERE(<span class="string">"mydate LIKE #&#123;mydate&#125;"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sql.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">OrderDAO</span> </span>&#123;</span><br><span class="line">    <span class="meta">@SelectProvider</span>(type = OrderProvider.class, method = <span class="string">"queryOrderByParam"</span>)</span><br><span class="line">    <span class="function">List&lt;Order&gt; <span class="title">queryOrderByParam</span><span class="params">(OrderParam param)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ul><h2 id="xml版本-适合复杂操作"><a href="#xml版本-适合复杂操作" class="headerlink" title="xml版本(适合复杂操作)"></a>xml版本(适合复杂操作)</h2><ul><li><p><code>xml版本(适合复杂操作)</code></p><ul><li><p>Dao层：UserMapperXml.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapperXml</span> </span>&#123;</span><br><span class="line">	<span class="function">List&lt;UserInfo&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function">UserInfo <span class="title">getOne</span><span class="params">(Long id)</span></span>;</span><br><span class="line"></span><br><span class="line">          <span class="comment">// 如果此处加了@Param别名，则xml中不能直接使用对象属性，而要使用别名.属性</span></span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">insert</span><span class="params">(UserInfo user)</span></span>; <span class="comment">// 成功返回1</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">update</span><span class="params">(UserInfo user)</span></span>; <span class="comment">// jdbc url参数中需要加 &amp;useAffectedRows=true</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">delete</span><span class="params">(Long id)</span></span>;</span><br><span class="line"></span><br><span class="line">          <span class="comment">// mybatis-plus：带有分页查询的mapper</span></span><br><span class="line">          <span class="comment">// 再传入Map参数，如果直接通过 #&#123;param.xxx&#125; 取值会报错，需要加 @Param 注解。https://github.com/baomidou/mybatis-plus/issues/894</span></span><br><span class="line">          <span class="comment">// 如果为其他引用类，则可直接使用参数名</span></span><br><span class="line">          <span class="function">IPage&lt;Map&gt; <span class="title">queryByProjectId</span><span class="params">(Page page, @Param(<span class="string">"param"</span>)</span> Map&lt;String,Object&gt; param)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>Dao实现(映射文件): UserMapper.xml(放在resources/mapper目录下)</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span> <span class="meta">?&gt;</span></span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span></span><br><span class="line"><span class="comment">&lt;!--http://www.mybatis.org/mybatis-3/zh/sqlmap-xml.html#--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--sql映射文件: </span></span><br><span class="line"><span class="comment">	namespace必须为实现接口名；每个sql是一个statement </span></span><br><span class="line"><span class="comment">	使用include关键字调用其他xml文件的sql时，则需要在refid前加上该文件的命名空间</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"cn.aezo.springboot.mybatis.mapperxml.UserMapperXml"</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">		1.resultMap结果集映射定义(用来描述如何从数据库结果集中来加载对象). </span></span><br><span class="line"><span class="comment">		2.resultType 与 resultMap 不能并用. </span></span><br><span class="line"><span class="comment">		3.type也可以为java.util.HashMap,则返回结果中放的是Map</span></span><br><span class="line"><span class="comment">		4.子标签有先后顺序。(constructor?,id*,result*,association*,collection*, discriminator?)</span></span><br><span class="line"><span class="comment">	--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"UserInfoResultMap"</span> <span class="attr">type</span>=<span class="string">"cn.aezo.springboot.mybatis.model.UserInfo"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--设置mybatis.configuration.map-underscore-to-camel-case=true则会自动对格式进行转换, 无需下面转换--&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--&lt;result column="group_id" property="groupId" jdbcType="BIGINT"/&gt;--&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--&lt;result column="nick_name" property="nickName" jdbcType="VARCHAR"/&gt;--&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"desc"</span> <span class="attr">property</span>=<span class="string">"desc"</span> <span class="attr">jdbcType</span>=<span class="string">"BLOB"</span>/&gt;</span><span class="comment">&lt;!-- BLOB/CLOB 类型必须转换 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!--sql:可被其他语句引用的可重用语句块. id:唯一的标识符，可被其它语句引用--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">"UserInfoColumns"</span>&gt;</span>id, group_id, nick_name, hobby<span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">"userColumns"</span>&gt;</span>$&#123;alias&#125;.id, $&#123;alias&#125;.username, $&#123;alias&#125;.password<span class="tag">&lt;/<span class="name">sql</span>&gt;</span><span class="comment">&lt;!-- alias不能通过bind在此sql内部设值 --&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">              id对应接口的方法名</span></span><br><span class="line"><span class="comment">              resultType (类全称或别名, 如内置别名map) 与 resultMap(自定义数据库字段与实体字段转换关系map) 不能并用</span></span><br><span class="line"><span class="comment">              statementType: STATEMENT(statement)、PREPARED(preparedstatement, 默认)、CALLABLE(callablestatement)</span></span><br><span class="line"><span class="comment">              resultSetType: FORWARD_ONLY(游标向前滑动)，SCROLL_SENSITIVE(滚动敏感)，SCROLL_INSENSITIVE(不区分大小写的滚动)</span></span><br><span class="line"><span class="comment">          --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAll"</span> <span class="attr">resultMap</span>=<span class="string">"UserInfoResultMap"</span>&gt;</span></span><br><span class="line">		select</span><br><span class="line">		<span class="comment">&lt;!-- 如果引用在同一命名空间则可省略命名空间。但是 findAll 如果被其他命名空间引用则容易找到不 UserInfoColumns。因此建议一直加上命名空间 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">"cn.aezo.springboot.mybatis.mapperxml.UserMapperXml.UserInfoColumns"</span>/&gt;</span>,</span><br><span class="line">		<span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">"userColumns"</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"alias"</span> <span class="attr">value</span>=<span class="string">"t1"</span>/&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">		from user_info</span><br><span class="line">		where 1=1</span><br><span class="line">              <span class="comment">&lt;!-- 注意：如误写成了 `test='name = "smalle"'` 则会把smalle赋值给name字段，可能会覆盖原始参数；常见的为 `test='name == "smalle"'` --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">'name != null and name != ""'</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">                      1.bind 相当于自定义变量。元素可以从 OGNL 表达式中创建一个变量并将其绑定到上下文；如果在foreach里面使用bind，#使用变量时值永远是最后一个，如果使用$则可动态让变量值改变(但是可能存在sql注入问题)</span></span><br><span class="line"><span class="comment">                      2.案例(还可以同foreach等一起使用)</span></span><br><span class="line"><span class="comment">                      &lt;bind name="index" value="1+1" /&gt;</span></span><br><span class="line"><span class="comment">                      &lt;bind name="index" value="index+2" /&gt;</span></span><br><span class="line"><span class="comment">                      select $&#123;index&#125; "结果index=4" from dual;</span></span><br><span class="line"><span class="comment">                  --&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">                      _parameter 为传入的User对象。如果传入参数为Map，则为 _parameter.get('name')</span></span><br><span class="line"><span class="comment">                      _parameter 为 DynamicContext 中的属性，类似的还有 _databaseId=oracle|mysql</span></span><br><span class="line"><span class="comment">                  --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">bind</span> <span class="attr">name</span>=<span class="string">"nameUpper"</span> <span class="attr">value</span>=<span class="string">"'%' + _parameter.getName().toUpperCase() + '%'"</span> /&gt;</span></span><br><span class="line">                  <span class="comment">&lt;!-- &lt;bind name="nameUpper" value="'%' + _parameter.userInfo.get('name').toUpperCase() + '%'" /&gt; --&gt;</span> </span><br><span class="line">                  <span class="comment">&lt;!-- 定义了参数名 @Param("userInfo") --&gt;</span></span><br><span class="line">			and upper(name) like #&#123;nameUpper&#125; <span class="comment">&lt;!-- 不能写成 #&#123;nameUpper.toUpperCase()&#125; --&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">              and hobby in</span><br><span class="line">              <span class="comment">&lt;!-- index默认从0开始；separator也可使用变量，但是只能使用#，不能使用$，也可以省略此属性 --&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">item</span>=<span class="string">"item"</span> <span class="attr">index</span>=<span class="string">"index"</span> <span class="attr">collection</span>=<span class="string">"hobbyList"</span> <span class="attr">separator</span>=<span class="string">","</span> <span class="attr">open</span>=<span class="string">"("</span> <span class="attr">close</span>=<span class="string">")"</span>&gt;</span></span><br><span class="line">                  #&#123;item.hobby, jdbcType=VARCHAR&#125;</span><br><span class="line">              <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"birthdate != null"</span>&gt;</span></span><br><span class="line">                  &lt;![CDATA[ and DATE_FORMAT(birthdate, '%Y/%m/%d') &gt;= DATE_FORMAT(#&#123;birthdate&#125;, '%Y/%m/%d') ]]&gt;</span><br><span class="line">              <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">          <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"update"</span>&gt;</span></span><br><span class="line">              <span class="comment">&lt;!-- 不使用bind直接把变量写到where里面mysql执行报错 --&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">bind</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">value</span>=<span class="string">"check_item_sql.get(0).id"</span> /&gt;</span></span><br><span class="line">              update sys_user_behavior set total = total + 1, create_time = now() where id = #&#123;id&#125;</span><br><span class="line">          <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- property参数使用 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">"sometable"</span>&gt;</span></span><br><span class="line">		$&#123;prefix&#125;Table where 1=1</span><br><span class="line">              <span class="comment">&lt;!-- 此时 #&#123;username&#125; 可以拿到selectMain的上下文 --&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">'username != null and username != ""'</span>&gt;</span></span><br><span class="line">                  and username = #&#123;username&#125;</span><br><span class="line">              <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">              <span class="comment">&lt;!-- 此时 #&#123;$&#123;field&#125;&#125; 可以拿到selectMain上下文中nickName的值 --&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">'$&#123;field&#125; != null and $&#123;field&#125; != ""'</span>&gt;</span></span><br><span class="line">                  and remark = #&#123;$&#123;field&#125;&#125;</span><br><span class="line">              <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">              </span><br><span class="line">              <span class="comment">&lt;!-- 零散片段. 此处在test语句中使用OGNL表达式`params.$&#123;item&#125;`会报错，只能通过get方法动态获取属性值 --&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"params.get(item) != null"</span>&gt;</span></span><br><span class="line">                  and $&#123;item&#125; = #&#123;params.$&#123;item&#125;&#125;</span><br><span class="line">              <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"></span><br><span class="line">              <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">'strList != null and strList.size() &gt; 0 and strList.contains("ban")'</span>&gt;</span></span><br><span class="line">                  AND 'ban' = 'ban'</span><br><span class="line">              <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- 只支持property参数值(不支持外部传入参数)，且property的value属性值不支持EL表达式 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">"someinclude"</span>&gt;</span>from <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">"$&#123;include_target&#125;"</span>/&gt;</span><span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- 返回 List&lt;Map&gt; 对象 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectMain"</span> <span class="attr">resultType</span>=<span class="string">"map"</span>&gt;</span></span><br><span class="line">		select *</span><br><span class="line">		<span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">"someinclude"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"include_target"</span> <span class="attr">value</span>=<span class="string">"sometable"</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"prefix"</span> <span class="attr">value</span>=<span class="string">"Some"</span>/&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"field"</span> <span class="attr">value</span>=<span class="string">"nickName"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">		1.parameterType传入参数类型(可选，不填则可以通过 TypeHandler 推导出类型). </span></span><br><span class="line"><span class="comment">			1.1 使用typeAliases进行类型别名映射后可写成resultType="userInfo"(自动扫描包mybatis.type-aliases-package, 默认该包下的类名首字母小写为别名).</span></span><br><span class="line"><span class="comment">			1.2 传入parameterType="java.util.HashMap"(可省略)，也可使用 #&#123;myKey&#125; 获取传入参数map中的值</span></span><br><span class="line"><span class="comment">		2.如果返回结果使用resultType="cn.aezo.springboot.mybatis.model.UserInfo", 则nickName，groupId则为null(数据库中下划线对应实体驼峰转换失败，解决办法：设置mybatis.configuration.map-underscore-to-camel-case=true). 此处使用resultMap指明字段对应关系</span></span><br><span class="line"><span class="comment">	--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getOne"</span> <span class="attr">parameterType</span>=<span class="string">"java.lang.Long"</span> <span class="attr">resultType</span>=<span class="string">"userInfo"</span>&gt;</span></span><br><span class="line">		select</span><br><span class="line">		<span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">"UserInfoColumns"</span>/&gt;</span></span><br><span class="line">		from user_info</span><br><span class="line">		where id = #&#123;id&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">          <span class="comment">&lt;!-- 动态order by。此处传入orderBy参数即可，注意需要使用$(此时用#会报错) --&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findList"</span>&gt;</span></span><br><span class="line">		select name from user_info order by $&#123;orderBy&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">          <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"collectionSplit"</span>&gt;</span></span><br><span class="line">              <span class="comment">&lt;!-- foreach collection支持执行函数 --&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"listStr.trim().split('\n')"</span> <span class="attr">item</span>=<span class="string">"item"</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">bind</span> <span class="attr">name</span>=<span class="string">"listVal"</span> <span class="attr">value</span>=<span class="string">"item.trim().split('@')"</span> /&gt;</span></span><br><span class="line">                  <span class="comment">&lt;!-- 此处直接使用#&#123;listVal[0]&#125;、#&#123;listVal[1]&#125;的方式取值会导致上面的foreach无效，每次都是取的最后一条记录的值，改成foreach则不会存在此问题 --&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"listVal"</span> <span class="attr">item</span>=<span class="string">"val"</span>&gt;</span></span><br><span class="line">                      #&#123;val&#125;</span><br><span class="line">                  <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- insert/update返回主键(默认返回修改的数据执行状态/影响行数)</span></span><br><span class="line"><span class="comment">	1.定义方式</span></span><br><span class="line"><span class="comment">		方式一：基于JDBC(Mysql/SqlServer都适用，Oracle不适用)</span></span><br><span class="line"><span class="comment">			keyProperty(主键对应Model的属性名)和useGeneratedKeys(是否使用JDBC来获取内部自增主键，默认false)联合使用返回自增的主键(可用于insert和update语句)。</span></span><br><span class="line"><span class="comment">		方式二：基于方言，每个数据库提供的内部函数(order表示执行selectKey和insert的先后顺序，默认AFTER)</span></span><br><span class="line"><span class="comment">			1.Mysql: &lt;selectKey keyProperty="id" resultType="long"&gt;select LAST_INSERT_ID()&lt;/selectKey&gt;</span></span><br><span class="line"><span class="comment">			2.SqlServer: &lt;selectKey resultType="java.lang.Long" order="AFTER" keyProperty="id"&gt;SELECT IDENT_CURRENT('my_table')&lt;/selectKey&gt;</span></span><br><span class="line"><span class="comment">			3.Oracle: &lt;selectKey keyProperty="id" order="BEFORE" resultType="java.lang.Long"&gt;select SEQ_MY_TABLE.nextval as id from dual&lt;/selectKey&gt; 需要先创建好序列SEQ_MY_TABLE</span></span><br><span class="line"><span class="comment">	2.获取方式：userMapper.insert(userInfo); userInfo.getUserId();</span></span><br><span class="line"><span class="comment">	 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insert"</span> <span class="attr">parameterType</span>=<span class="string">"cn.aezo.springboot.mybatis.model.UserInfo"</span> <span class="attr">keyProperty</span>=<span class="string">"userId"</span> <span class="attr">useGeneratedKeys</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">              <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">                  &lt;selectKey keyProperty="id" order="BEFORE" resultType="java.lang.Long"&gt;select SEQ_MY_TABLE.nextval as id from dual&lt;/selectKey&gt;</span></span><br><span class="line"><span class="comment">              --&gt;</span></span><br><span class="line">		insert into user_info</span><br><span class="line">              <span class="comment">&lt;!-- trim 可以在自己包含的内容前加上某些前缀，也可以在其后加上某些后缀 --&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">"("</span> <span class="attr">suffix</span>=<span class="string">")"</span>&gt;</span></span><br><span class="line">                  nick_name, group_id, hobby</span><br><span class="line">              <span class="tag">&lt;/<span class="name">trim</span>&gt;</span> </span><br><span class="line">              values (#&#123;nickName&#125;, #&#123;groupId&#125;, #&#123;hobby&#125;)</span><br><span class="line">	<span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">          <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">              Mybatis一次执行多条sql，一个标签多个Insert、update、delete操作</span></span><br><span class="line"><span class="comment">              还需要在数据库连接配置中加入 allowMultiQueries=true</span></span><br><span class="line"><span class="comment">           --&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"addPurchase"</span> <span class="attr">parameterType</span>=<span class="string">"com.zhao.vo.PurchaseVoOne"</span>&gt;</span></span><br><span class="line">              insert into t_goods (goods_name) values (#&#123;goodsName&#125;);</span><br><span class="line">              insert into t_supplier (supplier_name) values (#&#123;supplierName&#125;);</span><br><span class="line">          <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"update"</span> <span class="attr">parameterType</span>=<span class="string">"cn.aezo.springboot.mybatis.model.UserInfo"</span>&gt;</span></span><br><span class="line">		update user_info set</span><br><span class="line">		<span class="comment">&lt;!--动态sql, 标签：if、choose (when, otherwise)、trim (where, set)、foreach--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"nickName != null"</span>&gt;</span>nick_name = #&#123;nickName&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">		hobby = #&#123;hobby&#125;</span><br><span class="line">		where id = #&#123;id&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"update"</span> <span class="attr">parameterType</span>=<span class="string">"cn.aezo.springboot.mybatis.model.UserInfo"</span>&gt;</span></span><br><span class="line">		update user_info</span><br><span class="line">              <span class="comment">&lt;!-- set 在更新操作的时候，在包含的语句前输出一个set。注意后面的单引号  --&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">		    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"nickName != null"</span>&gt;</span>nick_name = #&#123;nickName&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">		    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"hobby != null"</span>&gt;</span>hobby = #&#123;hobby&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">		where id = #&#123;id&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">"delete"</span> <span class="attr">parameterType</span>=<span class="string">"java.lang.Long"</span>&gt;</span></span><br><span class="line">		delete from user_info where id = #&#123;id&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- 此时也可执行成功，但是如果传入参数为空，容易报错（java.sql.SQLException: 无效的列类型: 1111） --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">"delete2"</span>&gt;</span></span><br><span class="line">		delete from user_info where id = #&#123;id&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line">          </span><br><span class="line">          <span class="comment">&lt;!-- if else写法，和Boolean类型判断 --&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">choose</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">"boolField"</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">otherwise</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">otherwise</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">choose</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- null 认为是 false --&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">'boolField'</span>&gt;</span><span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">'!boolField'</span>&gt;</span><span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">'not boolField'</span>&gt;</span><span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">'boolField != null'</span>&gt;</span><span class="tag">&lt;/<span class="name">if</span>&gt;</span><span class="comment">&lt;!-- 存在问题：true/false都满足 --&gt;</span></span><br><span class="line"></span><br><span class="line">          <span class="comment">&lt;!-- 执行DDL语句可使用update标签 --&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"changeTriggerStatus"</span>&gt;</span></span><br><span class="line">              ALTER TRIGGER T_TEST ENABLE</span><br><span class="line">          <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>xml联表查询举例</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">   <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getClass"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span> <span class="attr">resultMap</span>=<span class="string">"ClassResultMap"</span>&gt;</span></span><br><span class="line">       select * from class c, teacher t, student s </span><br><span class="line">	where c.teacher_id = t.t_id and c.c_id = s.class_id </span><br><span class="line">		and c.c_id = #&#123;id&#125; and s.name = #&#123;name&#125;</span><br><span class="line">   <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--此处Classes类中仍然需要保存一个Teacher teacher的引用和一个List&lt;Student&gt; students的引用--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"cn.aezo.demo.Classes"</span> <span class="attr">id</span>=<span class="string">"ClassResultMap"</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--一个 ID 结果;标记结果作为 ID 可以帮助提高整体效能。association、collection中都最好加上 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"c_id"</span>/&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--注入到字段或 JavaBean 属性的普通结果--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"name"</span> <span class="attr">column</span>=<span class="string">"c_name"</span>/&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">	association字面意思关联，这里只专门做一对一关联； </span></span><br><span class="line"><span class="comment">		1.property表示是cn.aezo.demo.Classes中的属性(setter)名称； </span></span><br><span class="line"><span class="comment">		2.javaType表示该属性是什么类型对象 </span></span><br><span class="line"><span class="comment">		3.columnPrefix="out_/in_" 字段前缀。如查询主表(Ycross_Storage)中关联某一张表(如Ycross_In_Out_Regist)关联了两次，但是表Ycross_In_Out_Regist的映射只有一个(property和column的对应关系只有一套)。可以再取出Ycross_In_Out_Regist中的字段的时候通过`as out_xxx`对某字段进行别名处理。此时映射的时候会将字段的名称去掉columnPrefix前缀去找对应的property</span></span><br><span class="line"><span class="comment">	--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">association</span> </span></span><br><span class="line"><span class="tag">		<span class="attr">property</span>=<span class="string">"teacher"</span> </span></span><br><span class="line"><span class="tag">		<span class="attr">javaType</span>=<span class="string">"cn.aezo.demo.Teacher"</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"t_id"</span>/&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"name"</span> <span class="attr">column</span>=<span class="string">"t_name"</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">		1.ofType指定students集合中的对象类型。这样查询出来的集合条数和数据出来的一致(子表导致主表查询的条数增多) </span></span><br><span class="line"><span class="comment">		2.javaType="ArrayList"可以省略</span></span><br><span class="line"><span class="comment">	--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"students"</span> <span class="attr">ofType</span>=<span class="string">"cn.aezo.demo.Student"</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"s_id"</span>/&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"name"</span> <span class="attr">column</span>=<span class="string">"s_name"</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">	此时返回的集合是主表的条数，然后基于每一条再重新查询数据获取子表数据并放入到Classes对象的students中。</span></span><br><span class="line"><span class="comment">		1.select指查询Student的接口. 如果为当前mapper文件则可省略命名空间(namespace)直接写成 getStudent。(select和column只有在嵌套查询的时候才用得到)</span></span><br><span class="line"><span class="comment">		2.column是传入到getStudent查询中的参数，id是传入参数名称，s_id获取获取字段值的字段名(就是先从主表查询的结果中获取s_id字段的值，传入到id中，发起getStudent子查询)。如果一个参数也可以直接写成column="s_id" (getStudent的接口中也声明接受一个此类型的参数即可)</span></span><br><span class="line"><span class="comment">		3.columnPrefix="xx_"同上</span></span><br><span class="line"><span class="comment">		4.会产生1+N问题。主表有多少此就会发起多少次查询，无法根据条件判断是否需要发起子查询。导出报表最好不要使用</span></span><br><span class="line"><span class="comment">	--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">collection</span> </span></span><br><span class="line"><span class="tag">		<span class="attr">property</span>=<span class="string">"students"</span> </span></span><br><span class="line"><span class="tag">		<span class="attr">ofType</span>=<span class="string">"cn.aezo.demo.Student"</span> </span></span><br><span class="line"><span class="tag">		<span class="attr">column</span>=<span class="string">"&#123;id = s_id, name = s_name&#125;"</span> </span></span><br><span class="line"><span class="tag">		<span class="attr">select</span>=<span class="string">"cn.aezo.demo.Student.getStudent"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>@MapKey使用</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 如果name唯一则正常；如果同一name可能存在多个，则不会报错，该name对应的值为最后一条记录</span></span><br><span class="line"><span class="meta">@MapKey</span>(<span class="string">"NAME"</span>) <span class="comment">// 由于返回类型是Map，此处为Oracle的情况下返回字段类型为大写，所有为NAME；如果返回对象为实体则可以为name</span></span><br><span class="line">Map&lt;String, Map&lt;String, Object&gt;&gt; findUserMap();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 正常返回，和没有@MapKey一样</span></span><br><span class="line"><span class="meta">@MapKey</span>(<span class="string">"NAME"</span>)</span><br><span class="line">List&lt;Map&lt;String, Object&gt;&gt; findUserMap();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 假设name不唯一，原意图是想返回所有name的值放到List中，但实际返回的对象类型为Map&lt;String, Map&lt;String, Object&gt;&gt;，相同name只会取最后一个</span></span><br><span class="line"><span class="meta">@MapKey</span>(<span class="string">"NAME"</span>)</span><br><span class="line">Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt; findUserMap();</span><br></pre></td></tr></table></figure><ul><li><p>xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findUserMap"</span> <span class="attr">resultType</span>=<span class="string">"java.util.Map"</span>&gt;</span></span><br><span class="line">    select u.id, u.name from user u</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul></li></ul><h2 id="mybatis常见问题"><a href="#mybatis常见问题" class="headerlink" title="mybatis常见问题"></a>mybatis常见问题</h2><ul><li><code>#</code> 和 <code>$</code> 区别<ul><li><code>#</code> 创建的是一个prepared statement语句, <code>$</code> 符创建的是一个inlined statement语句</li><li><code>#{}</code>是实现的是PrepareStatement，<code>${}</code>实现的是普通Statement。使用<code>$</code>时，如字符串值就需要手动增加单引号，如果需要实现动态字段，则需要使用<code>$</code>；<code>#</code>则会自动给字符串值增加单引号</li><li>字段使用变量代替时需要使用 <code>$</code>；foreach.separator 参数如需使用变量，需用 <code>#</code></li></ul></li><li><strong>关于<code>&lt;</code>、<code>&gt;</code>转义字符</strong>(在annotation中需要转义，在xml的sql语句中则不需要转义)<ul><li><code>&lt;</code> 转成 <code>&amp;lt;</code>，<code>&gt;=</code> 转成 <code>&amp;gt;=</code>等</li><li>使用<strong>CDATA</strong> <code>&lt;![CDATA[ when min(starttime) &lt;= &#39;12:00&#39; and max(endtime) &lt;= &#39;12:00&#39; ]]&gt;</code></li></ul></li><li>双引号转义：<code>&lt;if test=&#39;help.title != null and type = \&quot;MY_TYPE\&quot;&#39;&gt;</code></li><li>select等xml语句后不要加<code>;</code></li><li><p>mybatis类型转换问题</p><ul><li><p>mybatis会对Integer转换成字符串时，如果Integer类型值为0，则转换为空字符串。(js也是这样转换的)</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 此时Integer status = 0;时，下列语句返回false. 所有Integer类型的不要加status != '' --&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 前台尽量不要传递 '0' 的字符串，可能导致生成的sql为 status = '0'，则存在隐式转换 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"status != null and status != ''"</span>&gt;</span>and status = #&#123;status&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>多个字符则认为是字符串，单个字符则认为是Character字符.(如mybatis认为：test=”validStatus == ‘Y’”中的Y是字符，test=”validStatus == ‘YY’”中的YY则是字符串)</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 错误写法。传入参数validStatus='Y', 此时会报错NumberFormatException；mybatis认为传入参数是字符串对象Y，比较值是字符'Y'，经过几个判断都不相等，再转成数值时则报错了 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"validStatus == 'Y'"</span>&gt;</span>and validStatus = 1<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 正确写法 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">'validStatus == "Y"'</span>&gt;</span>and validStatus = 1<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"validStatus == 'Y'.toString()"</span>&gt;</span>and validStatus = 1<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p><strong>查询结果返回 1 和 0 的数值时可自动注入到<code>private Boolean hasChildren;</code>的属性中</strong></p></li></ul></li><li><p>处理数组</p><ul><li>dao中可以使用<code>submitTm[0]</code>获取值; xml中不行，其处理数组(如时间段)的方式如下</li><li><p>xml参数中可使用<code>${list.size}</code>获取长度，不能使用#(否则报错UnsupportOperationException)</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">&lt;!-- （1）xml方式 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- &lt;if test='dataSourceList != null and dataSourceList.size() &gt;= 1'&gt; --&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- （2）@Select方式 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">'submitTm != null and submitTm.length &gt;= 1'</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"submitTm"</span> <span class="attr">index</span>=<span class="string">"i"</span> <span class="attr">item</span>=<span class="string">"item"</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">'i == 0 and item != null'</span>&gt;</span>and v.submit_tm &amp;gt;= #&#123;item&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">'i == 1 and item != null'</span>&gt;</span>and v.submit_tm &amp;lt;= #&#123;item&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 或者 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">'planTmSection != null and planTmSection.size() &gt; 0</span></span></span><br><span class="line"><span class="tag"><span class="string">           and planTmSection.get(0) != null and planTmSection.get(0) != ""</span></span></span><br><span class="line"><span class="tag"><span class="string">           and planTmSection.get(1) != null and planTmSection.get(1) != ""'</span>&gt;</span></span><br><span class="line">       and date_format(wl.plan_tm,'%Y-%m-%d') between</span><br><span class="line">       <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">item</span>=<span class="string">"item"</span> <span class="attr">collection</span>=<span class="string">"planTmSection"</span> <span class="attr">separator</span>=<span class="string">"and"</span>&gt;</span></span><br><span class="line">           #&#123;item&#125;</span><br><span class="line">       <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>日期说明</p><ul><li>mysql当前时间获取<code>now()</code>，oracle为sysdate</li><li>mysql数据库日期型可和前台时间字符串进行比较</li><li>当传入Date类型的日期参数时，虽然打印出来的sql仍然是 input_tm &gt; ‘2000-01-01 00:00:00.0’，但是根据传入参数类型可知<code>2000-01-01 00:00:00.0(Timestamp)</code>此时会基于时间进行比较</li><li>如果是字符串参数则为<code>2000-01-01 00:00:00(String)</code>，且需要将字段日期值转成字符串</li></ul></li><li>数据库字段类型根据mybatis映射转换，<code>count(*)</code>转换成<code>Long</code></li><li><code>&lt;when&gt;</code>/<code>&lt;if&gt;</code> 可进行嵌套使用，其子属性test可以使用双引号或单引号</li><li>支持<code>choose (when, otherwise)</code>语句</li><li>xml文件修改无需重新部署，立即生效?</li><li><code>Cause: java.sql.SQLException: 无法转换为内部表示</code> 可能是由于类型转换导致，如强制将数据库中字符串类型字段映射某个对象的Long类型属性上</li><li>mybatis中用Map接收oracle的结果集，返回的数据key为大写。解决：sql可写成<code>select name as &quot;name&quot; from user</code></li><li>xml中传入常量<ul><li>格式<code>${@path$subClass@Attr.getValueMethod()}</code>，<a href="https://commons.apache.org/proper/commons-ognl/language-guide.html" target="_blank" rel="noopener">ognl表达式参考</a></li><li>如 <code>AND type = ${@cn.aezo.test.Const@Type}</code> 或者 <code>AND type = ${@cn.aezo.test.Const$TypeEnum@Test.getValue()}</code>(枚举)</li></ul></li><li>注入全局变量/动态解析全局变量: <a href="https://blog.csdn.net/mashangzhifu/article/details/122845644" target="_blank" rel="noopener">https://blog.csdn.net/mashangzhifu/article/details/122845644</a><ul><li>参考下文<a href="#拦截器(插件">拦截器(插件)</a>)</li></ul></li></ul><h2 id="主键问题"><a href="#主键问题" class="headerlink" title="主键问题"></a>主键问题</h2><ul><li>控制主键自增<ul><li>mybatis使用<ul><li>mysql使用useGeneratedKeys属性</li><li>oracle使用selectKey标签</li></ul></li><li>mybatis-plus使用<ul><li>mysql基于数据自增<code>@TableId(type = IdType.AUTO)</code></li><li>oracle基于序列，<code>@KeySequence</code>结合内置自增策略</li></ul></li><li>mybatis-plus时，主键如何兼容mysql和oracle生成策略<ul><li>使用 id 雪花生成算法(长度为19位，<strong>因此为了方便之后兼容，不建议将主键设置成Integer</strong>)</li><li>基于spring 提供 DataFieldMaxValueIncrementer 接口实现主键生成: <a href="https://blog.csdn.net/huang007guo/article/details/104641660" target="_blank" rel="noopener">https://blog.csdn.net/huang007guo/article/details/104641660</a></li></ul></li></ul></li><li>获取自增主键(mysql为例，需要数据库设置主键自增) <a href="https://www.cnblogs.com/panie2015/p/5807683.html" title="Mybatis操作数据库的主键自增长" target="_blank" rel="noopener">^3</a><ul><li>方式一：keyProperty(主键对应Model的属性名)和useGeneratedKeys(是否使用JDBC来获取内部自增主键，默认false)联合使用返回自增的主键(可用于insert和update语句)</li><li>方式二：<code>&lt;selectKey keyProperty=&quot;id&quot; resultType=&quot;long&quot;&gt;select LAST_INSERT_ID()&lt;/selectKey&gt;</code></li><li>获取方式：<code>userMapper.insert(userInfo); userInfo.getUserId();</code></li></ul></li></ul><h2 id="批量执行语句"><a href="#批量执行语句" class="headerlink" title="批量执行语句"></a>批量执行语句</h2><ul><li>性能比较，同个表插入一万条数据时间近似值<ul><li>JDBC BATCH 1.1秒左右 &gt; Mybatis BATCH 2.2秒左右 &gt; Mybatis foreach 4.5秒左右</li><li>有测试说 Mybatis foreach &gt; Mybatis BATCH</li></ul></li><li><strong>jdbc batch</strong><ul><li>参考<a href="/_posts/java/java-base.md#JDBC">java-base.md#JDBC</a></li><li>采用PreparedStatement.addBatch()方式实现</li><li>Mysql需要在jdbc连接url上追加 <strong><code>rewriteBatchedStatements=true</code></strong>，否则不起作用；<strong>Oracle无需</strong></li></ul></li><li><strong><a href="/_posts/java/springboot.md#JdbcTemplate访问数据">jdbcTemplate.batchUpdate</a></strong></li><li><p><strong>mybatis foreach</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">    mysql版本试用</span></span><br><span class="line"><span class="comment">    1.mysql默认接受sql的大小是1048576(1M)，即第三种方式若数据量超过1M会报`com.mysql.jdbc.PacketTooBigException: Packet for query is too large`异常：（可通过调整MySQL安装目录下的my.ini文件中[mysqld]段的"max_allowed_packet = 1M"） </span></span><br><span class="line"><span class="comment">    2.如果报错，需要在jdbc url上增加 allowMultiQueries=true</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insertbatch"</span>&gt;</span></span><br><span class="line">    insert into t_user(id, name) values</span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"list"</span> <span class="attr">item</span>=<span class="string">"user"</span> <span class="attr">separator</span>=<span class="string">","</span>&gt;</span></span><br><span class="line">        (#&#123;user.id&#125;, #&#123;user.name&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- **oracle版本适用**，或者使用 INSERT ALL INTO, 参考：https://www.cnblogs.com/nemowang1996/p/12519018.html --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 序列不能直接和select union一起使用，如果把seq_user.nextval写到foreach循环里面会报错 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insertbatch"</span>&gt;</span></span><br><span class="line">    insert into t_user(id, name) (</span><br><span class="line">        select seq_user.nextval, a.name, a.sex from (</span><br><span class="line">            <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"list"</span> <span class="attr">item</span>=<span class="string">"user"</span> <span class="attr">separator</span> =<span class="string">"UNION ALL"</span>&gt;</span></span><br><span class="line">                select #&#123;user.name&#125; name, #&#123;user.sex&#125; sex from dual</span><br><span class="line">            <span class="tag">&lt;/<span class="name">foreach</span> &gt;</span></span><br><span class="line">        ) a</span><br><span class="line">    )</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p><strong>mybatis batch</strong></p><ul><li>Mybatis内置的ExecutorType有3种，默认的是simple，该模式下它为每个语句的执行创建一个新的预处理语句，单条提交sql；而batch模式重复使用已经预处理的语句，并且批量执行所有更新语句</li><li>Mysql使用batch模式需要在jdbc连接url上追加 <strong><code>rewriteBatchedStatements=true</code></strong>，否则不起作用；<strong>Oracle无需</strong></li><li><p>案例</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">SqlSessionTemplate sqlSessionTemplate; <span class="comment">// 或者注入SqlSessionFactory</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testInsertBatch2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    User user;</span><br><span class="line">    SqlSession sqlSession = sqlSessionTemplate.getSqlSessionFactory().openSession(ExecutorType.BATCH, <span class="keyword">false</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        UserDao mapper = sqlSession.getMapper(UserDao.class);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> total = <span class="number">500</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; total; i++) &#123;</span><br><span class="line">            user = <span class="keyword">new</span> User();</span><br><span class="line">            user.setId(i+<span class="number">1</span>);</span><br><span class="line">            user.setName(<span class="string">"name"</span> + i);</span><br><span class="line">            mapper.insert(user);</span><br><span class="line"></span><br><span class="line">            count++;</span><br><span class="line">            <span class="keyword">if</span> (count % <span class="number">100</span> == <span class="number">0</span> || count == total) &#123;</span><br><span class="line">                sqlSession.commit();</span><br><span class="line">                sqlSession.clearCache();</span><br><span class="line">                count = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        sqlSession.rollback();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        sqlSession.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>mybatis-plus</strong> 服务中的saveBatch(新增)/updateBatchById(更新)/removeByIds(删除)/saveOrUpdateBatch(新增或基于ID修改)访问，见下文。基于mybatis的<code>openSession(ExecutorType.BATCH)</code>，默认每1000条提交一次</p></li></ul><h2 id="Mybatis缓存"><a href="#Mybatis缓存" class="headerlink" title="Mybatis缓存"></a>Mybatis缓存</h2><ul><li><a href="https://tech.meituan.com/2018/01/19/mybatis-cache.html" target="_blank" rel="noopener">聊聊MyBatis缓存机制</a></li><li>一级缓存<ul><li>配置<code>&lt;setting name=&quot;localCacheScope&quot; value=&quot;SESSION&quot;/&gt;</code><ul><li>共有两个选项，SESSION或者STATEMENT，默认是SESSION级别，即在一个MyBatis会话(同一个sqlSession对象)中执行的所有语句，都会共享这一个缓存。一种是STATEMENT级别，可以理解为缓存只对当前执行的这一个Statement有效(相当于关闭一级缓存)</li></ul></li><li>现象<ul><li>同一个sqlSession对象，执行多次查询，只有第一次会查询数据库，后续则返回缓存数据(不考虑缓存过期的情况)</li><li>在修改操作后执行的相同查询，一级缓存失效(如果只修改bean对象，没有提交sql则缓存仍然存在，返回的是被修改的bean)</li><li>一级缓存只在数据库会话内部共享。如果会话1先读取一次数据，然后会话2修改了该数据(只会让会话2的查询缓存失效)，会话1重新读取此数据获取的任然是修改前数据</li></ul></li><li>总结<ul><li>MyBatis一级缓存的生命周期和SqlSession一致</li><li>MyBatis一级缓存内部设计简单，只是一个没有容量限定的HashMap，在缓存的功能性上有所欠缺</li><li>MyBatis的一级缓存最大范围是SqlSession内部，有多个SqlSession（简单的Spring项目一般只有一个此对象）或者分布式的环境下，数据库写操作会引起脏数据，建议设定缓存级别为Statement</li></ul></li></ul></li><li>二级缓存<ul><li>mybatis-plus默认开启了二级缓存，关闭可设置<code>mybatis-plus.configuration.cacheEnabled=false</code></li><li>配置<ul><li>在MyBatis的配置文件中开启二级缓存<code>&lt;setting name=&quot;cacheEnabled&quot; value=&quot;true&quot;/&gt;</code></li><li>然后在MyBatis的映射XML中配置<code>&lt;cache /&gt;</code>或者<code>&lt;cache-ref namespace=&quot;mapper.DemoMapper&quot;/&gt;</code>；其中cache标签支持属性<ul><li>type：cache使用的类型，默认是PerpetualCache，这在一级缓存中提到过。</li><li>eviction： 定义回收的策略，常见的有FIFO，LRU。</li><li>flushInterval： 配置一定时间自动刷新缓存，单位是毫秒。</li><li>size： 最多缓存对象的个数。</li><li>readOnly： 是否只读，若配置可读写，则需要对应的实体类能够序列化。</li><li>blocking： 若缓存中找不到对应的key，是否会一直blocking，直到有对应的数据进入缓存</li></ul></li></ul></li><li>现象<ul><li>当开启缓存后，数据的查询执行的流程就是 二级缓存 -&gt; 一级缓存 -&gt; 数据库</li><li>执行更新等语句后，缓存失效</li></ul></li><li>总结<ul><li>MyBatis的二级缓存相对于一级缓存来说，实现了SqlSession之间缓存数据的共享，同时粒度更加的细，能够到namespace级别，通过Cache接口实现类不同的组合，对Cache的可控性也更强</li><li>MyBatis在多表查询时，极大可能会出现脏数据，有设计上的缺陷，安全使用二级缓存的条件比较苛刻(可使用cache-ref让两个namespace使用同一个缓存)</li><li>在分布式环境下，由于默认的MyBatis Cache实现都是基于本地的，分布式环境下必然会出现读取到脏数据，需要使用集中式缓存将MyBatis的Cache接口实现，有一定的开发成本，直接使用Redis、Memcached等分布式缓存可能成本更低，安全性也更高</li></ul></li></ul></li></ul><h2 id="基于databaseId实现数据库兼容"><a href="#基于databaseId实现数据库兼容" class="headerlink" title="基于databaseId实现数据库兼容"></a>基于databaseId实现数据库兼容</h2><ul><li>mybatis<ul><li>mybatis-config.xml增加上文所述配置</li></ul></li><li>mybatis-plus</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> DatabaseIdProvider <span class="title">databaseIdProvider</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    VendorDatabaseIdProvider databaseIdProvider = <span class="keyword">new</span> VendorDatabaseIdProvider();</span><br><span class="line">    Properties properties = <span class="keyword">new</span> Properties();</span><br><span class="line">    properties.put(<span class="string">"Oracle"</span>, <span class="string">"oracle"</span>);</span><br><span class="line">    properties.put(<span class="string">"MySQL"</span>, <span class="string">"mysql"</span>);</span><br><span class="line">    databaseIdProvider.setProperties(properties);</span><br><span class="line">    <span class="keyword">return</span> databaseIdProvider;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>使用(会根据数据源自动判断使用那种类型的sql)</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getNextSeqDemo"</span> <span class="attr">resultType</span>=<span class="string">"java.lang.Object"</span> <span class="attr">databaseId</span>=<span class="string">"mysql"</span>&gt;</span></span><br><span class="line">    select next_no+1 from t_seq_no where table_name = 't_demo'</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getNextSeqDemo"</span> <span class="attr">resultType</span>=<span class="string">"java.lang.Object"</span> <span class="attr">databaseId</span>=<span class="string">"oracle"</span>&gt;</span></span><br><span class="line">    select seq_demo.nextval from dual</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="拦截器-插件"><a href="#拦截器-插件" class="headerlink" title="拦截器(插件)"></a>拦截器(插件)</h2><ul><li>mybatis 拦截器 Interceptor 可拦截的目标对象有四个（前面是可被拦截的对象，后面括号中是对象中可被拦截的方法）<ul><li>Executor (update, query, flushStatements, commit, rollback, getTransaction, close, isClosed)</li><li>ParameterHandler (getParameterObject, setParameters)</li><li>StatementHandler (prepare, parameterize, batch, update, query)</li><li>ResultSetHandler (handleResultSets, handleOutputParameters)</li></ul></li><li>拦截器执行顺序<ul><li>不同拦截对象执行顺序，如下：<code>Executor</code> -&gt; <code>StatementHandler</code> -&gt; <code>ParameterHandler</code> -&gt; `ResultSetHandler</li><li>拦截相同对象执行顺序，取决于 mybatis-config.xml 中 plugin 配置顺序，越靠后，优先级越高</li></ul></li><li>mybatis 拦截器使用<ul><li>实现<code>Interceptor</code>接口；<code>@Intercepts</code>注解用于配置需要拦截的对象和方法</li><li>配置mybatis拦截器: 基于xml或者注解成Bean</li></ul></li><li>mybatis-plus 拦截器<ul><li>v3.4.0及以上: 其 <code>InnerInterceptor</code> 机制是基于 mybatis 的 <code>Interceptor</code> 实现的，具体参考 mybatis-plus 类 <code>MybatisPlusInterceptor</code>(v3.4.0)</li><li>v3.4.0以下同 mybatis 拦截器使用，只需注册配置成Bean即可</li></ul></li><li>案例<ul><li>Mybatis拦截器失效(引入了分页插件导致)，参考下文案例：<a href="https://blog.csdn.net/weixin_44032384/article/details/116381837" target="_blank" rel="noopener">https://blog.csdn.net/weixin_44032384/article/details/116381837</a><ul><li><a href="http://xtong.tech/2018/08/01/MyBatis%E6%8B%A6%E6%88%AA%E5%99%A8%E5%9B%A0pagehelper%E8%80%8C%E5%A4%B1%E6%95%88%E7%9A%84%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/" target="_blank" rel="noopener">http://xtong.tech/2018/08/01/MyBatis%E6%8B%A6%E6%88%AA%E5%99%A8%E5%9B%A0pagehelper%E8%80%8C%E5%A4%B1%E6%95%88%E7%9A%84%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/</a></li><li><a href="https://blog.csdn.net/weixin_37672801/article/details/125055660" target="_blank" rel="noopener">https://blog.csdn.net/weixin_37672801/article/details/125055660</a></li></ul></li><li>结合 ThreadLocal 参考：<a href="https://blog.csdn.net/iteye_19045/article/details/100024506" target="_blank" rel="noopener">https://blog.csdn.net/iteye_19045/article/details/100024506</a></li><li>基于查询：<a href="https://juejin.cn/post/6965441270277734430" target="_blank" rel="noopener">https://juejin.cn/post/6965441270277734430</a></li><li>基于修改：<a href="https://www.zhihu.com/question/375124631/answer/2357163072" target="_blank" rel="noopener">https://www.zhihu.com/question/375124631/answer/2357163072</a></li></ul></li><li>主要代码</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 可只拦截某个方法类型</span></span><br><span class="line"><span class="meta">@Intercepts</span>(&#123;</span><br><span class="line">    <span class="meta">@Signature</span>(method = <span class="string">"update"</span>, args = &#123; MappedStatement.class, Object.class &#125;, type = Executor.class),</span><br><span class="line">    <span class="meta">@Signature</span>(method = <span class="string">"query"</span>, args = &#123; MappedStatement.class, Object.class, RowBounds.class, ResultHandler.class &#125;, type = Executor.class),</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestInterceptor</span> <span class="keyword">implements</span> <span class="title">Interceptor</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">intercept</span><span class="params">(Invocation invocation)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        Object target = invocation. getTarget(); <span class="comment">//被代理对象</span></span><br><span class="line">        Method method = invocation. getMethod(); <span class="comment">//代理方法</span></span><br><span class="line">        Object[] args = invocation. getArgs(); <span class="comment">// 方法参数[MappedStatement, Object(parameter), RowBounds, ResultHandler]</span></span><br><span class="line">        <span class="comment">// do something . . . . . .  方法拦截前执行代码块</span></span><br><span class="line">        Object result = invocation. proceed();</span><br><span class="line">        <span class="comment">// do something . . . . . . . 方法拦截后执行代码块</span></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">plugin</span><span class="params">(Object target)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Plugin. wrap(target, <span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 插件初始化的时候调用，也只调用一次，插件配置的属性从这里设置进来</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProperties</span><span class="params">(Properties properties)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// mybatis模式注册插件；mybatis-plus v3.4.0以下直接注册成Bean即可，v3.4.0以上基于MybatisPlusInterceptor注册</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PluginsConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;SqlSessionFactory&gt; sqlSessionFactoryList;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addPageInterceptor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DefaultInterceptor interceptor = <span class="keyword">new</span> TestInterceptor();</span><br><span class="line">        <span class="comment">// 此处往 SqlSessionFactory 中添加</span></span><br><span class="line">        <span class="keyword">for</span> (SqlSessionFactory sqlSessionFactory : sqlSessionFactoryList) &#123;</span><br><span class="line">            sqlSessionFactory.getConfiguration().addInterceptor(interceptor);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>注入全局动态参数<ul><li>参考<a href="/_posts/java/spring.md#加载优先级">spring.md#加载优先级</a></li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 插件逻辑(全局动态参数)</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@Intercepts</span>(&#123;</span><br><span class="line">    <span class="meta">@Signature</span>(method = <span class="string">"update"</span>, args = &#123; MappedStatement.class, Object.class &#125;, type = Executor.class),</span><br><span class="line">    <span class="meta">@Signature</span>(method = <span class="string">"query"</span>, args = &#123; MappedStatement.class, Object.class, RowBounds.class,</span><br><span class="line">            ResultHandler.class &#125;, type = Executor.class),</span><br><span class="line">    <span class="comment">// 如果使用pagehelper分页插件可能需要同时拦截此方法</span></span><br><span class="line">    <span class="meta">@Signature</span>(method = <span class="string">"query"</span>, args = &#123; MappedStatement.class, Object.class, RowBounds.class,</span><br><span class="line">            ResultHandler.class, CacheKey.class, BoundSql.class&#125;, type = Executor.class)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlobalParametersInterceptor</span> <span class="keyword">implements</span> <span class="title">Interceptor</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Set&lt;Integer&gt; sourceStorage = <span class="keyword">new</span> HashSet&lt;Integer&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">intercept</span><span class="params">(Invocation invocation)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        Object[] args = invocation.getArgs();</span><br><span class="line">        MappedStatement mappedStatement = (MappedStatement) args[<span class="number">0</span>];</span><br><span class="line">        SqlSource sqlSource = mappedStatement.getSqlSource();</span><br><span class="line">        <span class="comment">// 只拦截动态sql</span></span><br><span class="line">        <span class="keyword">if</span> (sqlSource <span class="keyword">instanceof</span> DynamicSqlSource) &#123;</span><br><span class="line">            Field field = DynamicSqlSource.class.getDeclaredField(<span class="string">"rootSqlNode"</span>);</span><br><span class="line">            field.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">            SqlNode sqlnode = (SqlNode) field.get(sqlSource);</span><br><span class="line">            <span class="keyword">if</span> (!sourceStorage.contains(sqlSource.hashCode())) &#123;</span><br><span class="line">                <span class="comment">// 获取动态代理对象</span></span><br><span class="line">                SqlNode proxyNode = proxyNode(sqlnode);</span><br><span class="line">                field.set(sqlSource, proxyNode);</span><br><span class="line">                sourceStorage.add(sqlSource.hashCode());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> invocation.proceed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> SqlNode <span class="title">proxyNode</span><span class="params">(SqlNode sqlnode)</span> </span>&#123;</span><br><span class="line">        SqlNode proxyNode = (SqlNode) Proxy.newProxyInstance(sqlnode.getClass().getClassLoader(),</span><br><span class="line">                <span class="keyword">new</span> Class[]&#123;SqlNode.class&#125;, <span class="keyword">new</span> SqlNodeInvocationHandler(sqlnode));</span><br><span class="line">        <span class="keyword">return</span> proxyNode;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">plugin</span><span class="params">(Object target)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Plugin.wrap(target, <span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProperties</span><span class="params">(Properties properties)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">SqlNodeInvocationHandler</span> <span class="keyword">implements</span> <span class="title">InvocationHandler</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> SqlNode target;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">SqlNodeInvocationHandler</span><span class="params">(SqlNode target)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">super</span>();</span><br><span class="line">            <span class="keyword">this</span>.target = target;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">            DynamicContext context = (DynamicContext) args[<span class="number">0</span>];</span><br><span class="line">            <span class="comment">// 手动添加全局动态参数</span></span><br><span class="line">            context.getBindings().put(<span class="string">"_gvUsername"</span>, ShiroUtils.getUsername());</span><br><span class="line">            <span class="keyword">return</span> method.invoke(target, args);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自动配置类(必须让动态注入的全局参数在PageHelperAutoConfiguration之后实例化bean，使用@AutoConfigureAfter到达目的)；注意不能加@Configurable等类，否则@AutoConfigureAfter会失效</span></span><br><span class="line"><span class="meta">@AutoConfigureAfter</span>(&#123;PageHelperAutoConfiguration.class&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlobalParametersConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SqlSessionFactory sqlSessionFactory;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addPageInterceptor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        GlobalParametersInterceptor interceptor = <span class="keyword">new</span> GlobalParametersInterceptor();</span><br><span class="line">        <span class="keyword">this</span>.sqlSessionFactory.getConfiguration().addInterceptor(interceptor);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 必须此配置，从而@AutoConfigureAfter注解才会生效</span></span><br><span class="line"><span class="comment">// META-INFO/spring.factories</span></span><br><span class="line">org.springframework.boot.autoconfigure.EnableAutoConfiguration=\</span><br><span class="line">cn.aezo.test.mybatis.GlobalParametersConfig</span><br><span class="line"></span><br><span class="line"><span class="comment">// (可选)全局静态动态，必须使用$，且如果是字符串则需要加引号(项目启动就会替换)</span></span><br><span class="line"><span class="comment">// application.yml</span></span><br><span class="line">mybatis-plus:</span><br><span class="line">  configuration:</span><br><span class="line">    variables:</span><br><span class="line">      _gvFuncTest: <span class="keyword">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// xml文件写法</span></span><br><span class="line">&lt;select id=<span class="string">"getTestList"</span> resultType=<span class="string">"map"</span>&gt;</span><br><span class="line">    select t.id, t.saas_code </span><br><span class="line">    from t_test t where <span class="number">1</span>=<span class="number">1</span></span><br><span class="line">    &lt;include refid=<span class="string">"existsTest"</span>&gt;</span><br><span class="line">        &lt;property name=<span class="string">"prefix"</span> value=<span class="string">"t"</span>/&gt;</span><br><span class="line">    &lt;/include&gt;</span><br><span class="line">&lt;/select&gt;</span><br><span class="line">&lt;sql id=<span class="string">"existsTest"</span>&gt;</span><br><span class="line">    &lt;!-- _gvFuncTest为全局静态动态，_gvUsername为全局动态变量 --&gt;</span><br><span class="line">    &lt;<span class="keyword">if</span> test=<span class="string">'$&#123;_gvFuncTest&#125; != null and $&#123;_gvFuncTest&#125; and _gvUsername != null and _gvUsername != ""'</span>&gt;</span><br><span class="line">        <span class="function">and <span class="title">exists</span><span class="params">(select <span class="number">1</span> from t_user u</span></span></span><br><span class="line"><span class="function"><span class="params">        where u.username = #&#123;_gvUsername&#125; and (u.saas_code is <span class="keyword">null</span> or u.saas_code = $&#123;prefix&#125;.saas_code)</span>)</span></span><br><span class="line"><span class="function">    &lt;/<span class="keyword">if</span>&gt;</span></span><br><span class="line"><span class="function">&lt;/sql&gt;</span></span><br></pre></td></tr></table></figure><h2 id="数据类型对应关系"><a href="#数据类型对应关系" class="headerlink" title="数据类型对应关系"></a>数据类型对应关系</h2><ul><li>JDBC数据类型转换</li></ul><table><thead><tr><th>JDBC</th><th>Java(Mybatis)</th><th>Mysql</th><th>Oracle</th></tr></thead><tbody><tr><td>Boolean</td><td>Boolean</td><td>bit</td><td></td></tr><tr><td>Integer</td><td>Integer</td><td>tinyint</td><td></td></tr><tr><td>Integer</td><td>Integer</td><td>smallint</td><td></td></tr><tr><td>Integer</td><td>Integer</td><td>mediumint</td><td></td></tr><tr><td>Integer</td><td>Integer</td><td>int</td><td>Number(11)</td></tr><tr><td>Bigint</td><td>Long</td><td>bigint</td><td>Number(20)</td></tr><tr><td>Numeric</td><td>Long</td><td></td><td>Number</td></tr><tr><td>Timestamp</td><td>Date</td><td>datetime</td><td>Date</td></tr><tr><td>Date</td><td>Date</td><td>date</td><td>Date</td></tr><tr><td>Decimal</td><td>BigDecimal</td><td>decimal</td><td>Number(12, 3)</td></tr><tr><td>Char</td><td></td><td>char</td><td>Char</td></tr><tr><td>Blob</td><td>byte[]/Object</td><td>blob</td><td>Blob</td></tr><tr><td>Clob</td><td>String</td><td>text</td><td>Clob</td></tr></tbody></table><ul><li><strong>BLOB为二进制大对象</strong>，可存储图片(转成二进制，实际用的很少)；<strong>CLOB文本大对象</strong>，可用来存储博客文章等；Mybatis对CLOB可直接解析成字符串，而BLOB则需要些对应关系</li></ul><h2 id="MyBatis-Generator"><a href="#MyBatis-Generator" class="headerlink" title="MyBatis Generator"></a>MyBatis Generator</h2><ul><li>使用<code>MyBatis Generator</code>自动生成model/dao/mapper</li><li>官方文档：<a href="http://www.mybatis.org/generator/index.html" target="_blank" rel="noopener">http://www.mybatis.org/generator/index.html</a></li><li><p>生成方式有多种(此处介绍maven插件的方式)</p><ul><li><p>maven配置</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- mybatis(mapper等)自动生成 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.generator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-generator-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!--maven可执行命令--&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">id</span>&gt;</span>Generate MyBatis Artifacts<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">goal</span>&gt;</span>generate<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>resources目录添加文件：<code>generatorConfig.xml</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span><span class="meta">?&gt;</span></span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE generatorConfiguration</span></span><br><span class="line"><span class="meta">		PUBLIC "-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN"</span></span><br><span class="line"><span class="meta">		"http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">generatorConfiguration</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--数据库驱动 --&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- &lt;classPathEntry location="C:\soft\oracle\product\11.2.0\dbhome_1\jdbc\lib\ojdbc6.jar"/&gt; --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">classPathEntry</span> <span class="attr">location</span>=<span class="string">"C:\Users\smalle\.m2\repository\mysql\mysql-connector-java\5.1.43\mysql-connector-java-5.1.43.jar"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">context</span> <span class="attr">id</span>=<span class="string">"MySQLTables"</span> <span class="attr">targetRuntime</span>=<span class="string">"MyBatis3"</span> <span class="attr">defaultModelType</span>=<span class="string">"flat"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">plugin</span> <span class="attr">type</span>=<span class="string">"cn.aezo.mybatis.generator.plugins.MyPluginTableRename"</span>/&gt;</span> <span class="comment">&lt;!--自定义插件，可继承 PluginAdapter--&gt;</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">&lt;!-- 为了防止生成的代码中有很多注释，比较难看 --&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 可自定义方法/字段注释，通过实现 CommentGenerator。参考 https://www.cnblogs.com/NieXiaoHui/p/6094144.html --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">commentGenerator</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suppressDate"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suppressAllComments"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">commentGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">&lt;!--数据库链接地址账号密码 --&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- driverClass="oracle.jdbc.driver.OracleDriver" connectionURL="jdbc:oracle:thin:@//localhost:1521/orcl" --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">jdbcConnection</span></span></span><br><span class="line"><span class="tag">				<span class="attr">driverClass</span>=<span class="string">"com.mysql.jdbc.Driver"</span></span></span><br><span class="line"><span class="tag">				<span class="attr">connectionURL</span>=<span class="string">"jdbc:mysql://localhost:3306/springboot"</span></span></span><br><span class="line"><span class="tag">				<span class="attr">userId</span>=<span class="string">"root"</span></span></span><br><span class="line"><span class="tag">				<span class="attr">password</span>=<span class="string">"root"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">jdbcConnection</span>&gt;</span></span><br><span class="line"></span><br><span class="line">		<span class="tag">&lt;<span class="name">javaTypeResolver</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"forceBigDecimals"</span> <span class="attr">value</span>=<span class="string">"false"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">javaTypeResolver</span>&gt;</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">&lt;!--生成Model类存放位置：targetPackage为model对应的包名；targetProject为项目根目录，此处相对当前项目，还可写成D:/mydemo/src/main/java --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">javaModelGenerator</span></span></span><br><span class="line"><span class="tag">				<span class="attr">targetPackage</span>=<span class="string">"cn.aezo.springboot.mybatis.generator.model"</span></span></span><br><span class="line"><span class="tag">				<span class="attr">targetProject</span>=<span class="string">"src/main/java"</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 是否对类CHAR类型的列的数据进行trim操作 --&gt;</span>  </span><br><span class="line">			<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"trimStrings"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 开启enableSubPackages后，会基于targetPackage目录添加数据库表的Catalog和Schema配置(table标签属性) --&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- &lt;property name="enableSubPackages" value="true" /&gt; --&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">javaModelGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">&lt;!--生成映射文件存放位置，会存放在src/main/resources/mapper目录下(自动创建mapper目录) --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">sqlMapGenerator</span></span></span><br><span class="line"><span class="tag">				<span class="attr">targetPackage</span>=<span class="string">"mapper"</span></span></span><br><span class="line"><span class="tag">				<span class="attr">targetProject</span>=<span class="string">"src/main/resources"</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- &lt;property name="enableSubPackages" value="true" /&gt; --&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">sqlMapGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">&lt;!--生成Dao类存放位置 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">javaClientGenerator</span></span></span><br><span class="line"><span class="tag">				<span class="attr">type</span>=<span class="string">"XMLMAPPER"</span></span></span><br><span class="line"><span class="tag">				<span class="attr">targetPackage</span>=<span class="string">"cn.aezo.springboot.mybatis.generator.dao"</span></span></span><br><span class="line"><span class="tag">				<span class="attr">targetProject</span>=<span class="string">"src/main/java"</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- &lt;property name="enableSubPackages" value="true" /&gt; --&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">javaClientGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">&lt;!-- 读取所有的table标签，有几个table标签就解析几个 --&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- %标识根据表名生成，tableName="t_%"表示只生成t_开头的表名 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">"%"</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">				1、生成selectKey语句，为mybatis生成获取自增主键值语句(必须数据库字段设置成自增)</span></span><br><span class="line"><span class="comment">				2、column表的字段名(不支持通配符，因此为了方便可将所有表的主键名设置为id)</span></span><br><span class="line"><span class="comment">				3、sqlStatement="MySql/DB2/SqlServer等"</span></span><br><span class="line"><span class="comment">					3-1、SqlServer会生成`SELECT SCOPE_IDENTITY()`，测试无法返回主键，可使用JDBC解决</span></span><br><span class="line"><span class="comment">				4、identity：true表示column代表的是主键，会在插入记录之后获取自增值替换对应model的id值(自增需要由数据库提供)，实际的insert语句将不含有主键字段; false表示非主键，会在插入记录获取自增值并替换model的id(如从序列中获取), 此时insert语句含有主键字段</span></span><br><span class="line"><span class="comment">				5、最终生成的语句如</span></span><br><span class="line"><span class="comment">				&lt;selectKey keyProperty="userId" order="AFTER" resultType="java.lang.Long"&gt;</span></span><br><span class="line"><span class="comment">					SELECT LAST_INSERT_ID()</span></span><br><span class="line"><span class="comment">				&lt;/selectKey&gt;</span></span><br><span class="line"><span class="comment">			--&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">generatedKey</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">sqlStatement</span>=<span class="string">"MySql"</span> <span class="attr">identity</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">			<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">				sqlStatement="JDBC"会生成如下代码来获取主键，适用于MySql/SqlServer</span></span><br><span class="line"><span class="comment">				&lt;insert id="insert" parameterType="cn.aezo.demo.MyTable" keyColumn="id" keyProperty="id" useGeneratedKeys="true"&gt;</span></span><br><span class="line"><span class="comment">			 --&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- &lt;generatedKey column="id" sqlStatement="JDBC" identity="true" /&gt; --&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">&lt;!-- 去掉表前缀：生成之后的文件名字User.java等。enableCountByExample标识是否使用Example --&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 如oracle此时的schema相当于用户名，如果不定义则会获取到多个t_user表，但是只会基于其中某个一个生成代码. 但是此时生成的mapper中表名带有前缀`smalle.` --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">table</span> <span class="attr">schema</span>=<span class="string">"smalle"</span> <span class="attr">tableName</span>=<span class="string">"t_user"</span> <span class="attr">domainObjectName</span>=<span class="string">"User"</span></span></span><br><span class="line"><span class="tag">			<span class="attr">enableCountByExample</span>=<span class="string">"false"</span> <span class="attr">enableUpdateByExample</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag">			<span class="attr">enableDeleteByExample</span>=<span class="string">"false"</span> <span class="attr">enableSelectByExample</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 去掉字段前缀 `t_` --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"useActualColumnNames"</span> <span class="attr">value</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">columnRenamingRule</span> <span class="attr">searchString</span>=<span class="string">"^t_"</span> <span class="attr">replaceString</span>=<span class="string">""</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">context</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">generatorConfiguration</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>MyPluginTableRename 自定义插件。配置文件的table节点在自定义了schema后，生成的mapper表名会包含schema信息，此插件主要是为了去除此schema信息</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.mybatis.generator.api.PluginAdapter;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 插件的生命周期：http://www.mybatis.org/generator/reference/pluggingIn.html</span></span><br><span class="line"><span class="comment">// 官方内置的插件：http://www.mybatis.org/generator/reference/plugins.html</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyPluginTableRename</span> <span class="keyword">extends</span> <span class="title">PluginAdapter</span> </span>&#123;</span><br><span class="line">	<span class="comment">// 验证此插件是否可以开启</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">validate</span><span class="params">(List&lt;String&gt; warnings)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 循环每个table时，执行对应初始化</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initialized</span><span class="params">(IntrospectedTable introspectedTable)</span> </span>&#123;</span><br><span class="line">		String schema = introspectedTable.getTableConfiguration().getSchema();</span><br><span class="line">		<span class="keyword">if</span>(schema != <span class="keyword">null</span> &amp;&amp; !<span class="string">""</span>.equals(schema)) &#123;</span><br><span class="line">			String tableName = introspectedTable.getTableConfiguration().getTableName();</span><br><span class="line">			introspectedTable.setSqlMapFullyQualifiedRuntimeTableName(tableName);</span><br><span class="line">			introspectedTable.setSqlMapAliasedFullyQualifiedRuntimeTableName(tableName);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>进入到pom.xml目录，cmd执行命令生成文件：<code>mvn mybatis-generator:generate</code></p></li><li><p>生成Mapper中Example的使用：<a href="http://www.mybatis.org/generator/generatedobjects/exampleClassUsage.html" target="_blank" rel="noopener">http://www.mybatis.org/generator/generatedobjects/exampleClassUsage.html</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">UserExample userExample = <span class="keyword">new</span> UserExample();</span><br><span class="line">      userExample.createCriteria().andUsernameEqualTo(<span class="string">"smalle"</span>)</span><br><span class="line">			.andSexEqualTo(<span class="number">1</span>);</span><br><span class="line">userExample.setOrderByClause(<span class="string">"username asc"</span>);</span><br><span class="line"></span><br><span class="line">      List&lt;User&gt; users =  userMapper.selectByExample(userExample); <span class="comment">// 未查询到数据时返回一个大小为0的数组</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// generator生成的mapper</span></span><br><span class="line">userMapper.insert(user); <span class="comment">// 完全基于user创建(新增记录时不考虑数据库的默认值)</span></span><br><span class="line">userMapper.insertSelective(user); <span class="comment">// 不为 null 才会拼接此字段(新增记录时考虑数据库的默认值)</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>通过java代码调用mybatis-generator生成</p><ul><li><p>引入依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.generator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-generator-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>关键代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; warnings = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">      <span class="keyword">boolean</span> overwrite = <span class="keyword">true</span>;</span><br><span class="line">      File configFile = <span class="keyword">new</span> File(<span class="string">"generatorConfig.xml"</span>);</span><br><span class="line">      ConfigurationParser cp = <span class="keyword">new</span> ConfigurationParser(warnings);</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">          Configuration config = cp.parseConfiguration(configFile);</span><br><span class="line">          DefaultShellCallback callback = <span class="keyword">new</span> DefaultShellCallback(overwrite);</span><br><span class="line">          MyBatisGenerator myBatisGenerator = <span class="keyword">new</span> MyBatisGenerator(config, callback, warnings);</span><br><span class="line">          myBatisGenerator.generate(<span class="keyword">null</span>);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">          e.printStackTrace();</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>使用oracle数据库</p><ul><li>配置文件设置成<code>&lt;generatedKey column=&quot;id&quot; sqlStatement=&quot;MySql&quot; identity=&quot;false&quot; /&gt;</code>中identity=”false”为了生成id的insert语句（oracle需要通过序列来完成）</li><li>修改生成的<code>&lt;selectKey&gt;</code>语句为根据序列获取主键</li><li>将oracle表转成mysql数据表，可参考<a href="/_posts/db/mysql-dba.md#Oracle表结构与Mysql表结构转换">《mysql-dba.md》</a></li></ul></li><li>plugin插件使用<ul><li>内部通过PluginAggregator来保证plugin的生命周期</li><li>使用参考上述示例 <code>MyPluginTableRename</code></li></ul></li></ul><h3 id="源码解析"><a href="#源码解析" class="headerlink" title="源码解析"></a>源码解析</h3><p><img src="https://www.plantuml.com/plantuml/svg/hLLRInj157xE_eg1FXYXRcXz2qMyfILjXO8j2CM7oUvqdJexk-xEUdjIl5TgGh61Ib635dnfLLgi9eX_9hj9_qLdTZPhM5CjfG_Povbplk_Bj-VCzBiCEimpYU9EOcf31vgW0BL9mx4ygWzPn7B0lLmkDpWyr9On0Qa-us3640NCyP32C2D8IOtC3KA6NV04KUH0nck3Qgcnl-YlhmQx9V08cqPsWZ4xcyaKY6Me4CrRgaOpugvHrQP6duAe3YIS0ZK1ySf5ZY8kFNrz4K6CdmM6V4HASebd3rcKeLcM1GzKJ9bZkJRIs4jO8CXztTpwwHVBycLSYJ9vpJ1ai01Tb8yB14koNCbq0N-lMgzkWRTm6ghk555RbIE8GV4CWgqlVl504ZKhHq6nsBmwgLzLWiNZjEL0ZI2v5cmi19ytN6q2cgX-lXbyFUJPVkbzD-ZAA9tqjCbiaGaZ6FzSdadTMwrugBOSUuo53utjlM2z59JNwhMp-w1vijJOFhA9Ps0wO1WECaJzk48iomOop97UOCFZ2DZYN2dXnBlzvkLbKFp0COJcrBMTCMyIKuMw_YACfULIj_ZoakZQRQH7VWiQALNuBUKcgFB9giY6thnfa-nDK6u4Yon2-bEE6XgIxbPIeldjY6xM999DILrhaC6WSX1A-5yQnamII-Z0fLkQPoBA_EEBvcb5Cj_An_KC55p6EurnwBQPuP0ZqBQH4yU4Zk48FwJlLCZnHZ77HMCZpnFrOVkDJWdO744nof_IRqNYZP6dVDnP2mbITmOv_uo7AMOO4ZoF1gYUcqMQnr2yd5PLzGxaDYiYHMtWA14HRHrbkMc-MV9xz2fO8650_hTHNgWnF8sIa6d_S2TOM1JPl0VgvxLVsz_ym-L6QJNyuAaxodjwRlRWNNtt3Csb8pv_vQnUA_ihIuqV-ssiYBW8oBN6QStVtHGnFgrXcyezGqv_OsSPk64RnEWWA5y4tp_-NR_A7I4BD3bHGgOCyQ5G4y12in0XVXrsl9j7HQygpgnet_DNF_bhLJdQuqe_1-67u6y0"></p><h2 id="mybatis-plus"><a href="#mybatis-plus" class="headerlink" title="mybatis-plus"></a>mybatis-plus</h2><ul><li><a href="https://mp.baomidou.com/" target="_blank" rel="noopener">mybatis-plus</a>、<a href="https://github.com/baomidou/mybatis-plus" target="_blank" rel="noopener">github</a></li><li>返回结果集类型为List，当没有数据时返回大小为0的List，而不是null</li></ul><h4 id="springboot依赖及配置"><a href="#springboot依赖及配置" class="headerlink" title="springboot依赖及配置"></a>springboot依赖及配置</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 包含 mybatis、mybatis-plus、generator --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>配置类增加<code>@MapperScan({&quot;cn.aezo.**.mapper&quot;})</code>扫描Mapper(Java类)<ul><li>可能还需配置<code>mapper-locations</code>指定xml文件位置(默认值为classpath/mapper下的xml文件，如果在其子目录或其他目录则需配置)</li></ul></li><li>application.yaml配置(可省略)</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mybatis-plus 配置</span></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="comment"># 默认为classpath*:/mapper/**/*.xml, 一般可以不用配置, 但是如果要扫描mapper文件根目录下的文件则需要修改如下(classpath*主要针对多模块, 可加载多个jar下的xml)</span></span><br><span class="line"><span class="attr">  mapper-locations:</span> <span class="string">classpath*:/mapper/*.xml,classpath*:/mapper/**/*.xml</span></span><br><span class="line"></span><br><span class="line"><span class="attr">  global-config:</span></span><br><span class="line">    <span class="comment"># 逻辑删除配置(无需其他配置)</span></span><br><span class="line"><span class="attr">    db-config:</span></span><br><span class="line"><span class="attr">      logic-delete-field:</span> <span class="string">valid_status</span> <span class="comment"># 逻辑删除字段，since 3.3.0可省略定义 `@TableLogic`(测试下来还是需要增加此注解). IService#remove则是修改逻辑字段(原本为硬删除)，IService的方法则全部加valid_status=1，但是手写的Mapper则需要手动加此条件</span></span><br><span class="line"><span class="attr">      logic-delete-value:</span> <span class="number">0</span> <span class="comment"># 逻辑已删除值</span></span><br><span class="line"><span class="attr">      logic-not-delete-value:</span> <span class="number">1</span> <span class="comment"># 逻辑未删除值</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment"># [原生配置](https://baomidou.com/pages/56bac0/#configuration-2)</span></span><br><span class="line">  <span class="comment"># 可通过xml文件或yml的形式配置</span></span><br><span class="line">  <span class="comment"># configLocation: classpath:mybatis-config.xml</span></span><br><span class="line"><span class="attr">  configuration:</span></span><br><span class="line">    <span class="comment"># 默认是true, 字段格式对应关系：数据库字段为下划线, model字段为驼峰标识(不设定则需要通过resultMap进行转换)</span></span><br><span class="line">    <span class="comment"># map-underscore-to-camel-case: true</span></span><br><span class="line"><span class="attr">    cache-enabled:</span> <span class="literal">false</span></span><br><span class="line">    <span class="comment"># 如果查询语句中某些字段值是null的，则这个字段就无法返回</span></span><br><span class="line"><span class="attr">    call-setters-on-nulls:</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment"># mybatis-plus + oracle 不配置则会报错: 无效的列类型: 1111</span></span><br><span class="line"><span class="attr">    jdbc-type-for-null:</span> <span class="string">'null'</span></span><br><span class="line">    <span class="comment"># 声明打印日志到控制台。如果打印到日志需要到logback.xml中增加配置，或者配置logging.level.cn.aezo.mapper=DEBUG</span></span><br><span class="line"><span class="attr">    log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br><span class="line"></span><br><span class="line">   <span class="comment"># 配置别名扫描的包，如果查询结果resultType值填全类名，则可不需要配置. 别名如(cn.aezo.demo.party.entity.User类对应别名则可直接写类名User)</span></span><br><span class="line">   <span class="comment"># typeAliasesPackage: cn.aezo.demo.**.entity</span></span><br></pre></td></tr></table></figure><h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><ul><li>注解说明<ul><li>如果Model主键名称不为<code>id</code>，则需要在对应主键字段上注解<code>@TableId</code></li><li>如果Model名称不为表名，则可通过<code>@TableName</code>进行注解真实名称</li><li>如果Model的字段不为表字段，可通过<code>@TableField(exist = false)</code>注解</li></ul></li><li>API使用<ul><li>此处的<code>SubscribeService</code>继承了<code>ServiceImpl</code>，对应接口继承了<code>IService</code></li><li>使用mapper，如<code>SubscribeMapper</code>则会继承<code>BaseMapper</code></li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ======== 基于 Mapper 进行访问</span></span><br><span class="line"><span class="comment">// 返回 List&lt;Map&lt;String, Object&gt;&gt;，此时LambdaQueryWrapper基于TemplateItem实体生成sql语句(sql语句驼峰会转成下划线，返回的Map中的key全为大写下划线)</span></span><br><span class="line">List&lt;Map&lt;String, Object&gt;&gt; list = </span><br><span class="line">    templateItemMapper.selectMaps(</span><br><span class="line">        <span class="keyword">new</span> LambdaQueryWrapper&lt;TemplateItem&gt;() <span class="comment">// 此处一定要加入泛型</span></span><br><span class="line">            .eq(TemplateItem::getTemplateId, templateId)</span><br><span class="line">            .ne(TemplateItem::getTemplateId, <span class="number">1</span>) <span class="comment">// != 1</span></span><br><span class="line">            .apply(StrUtil.isNotBlank(startDate),</span><br><span class="line">                <span class="string">"date_format (optime,'%Y-%m-%d') &gt;= date_format('"</span> + startDate + <span class="string">"','%Y-%m-%d')"</span>)</span><br><span class="line">            <span class="comment">// &#123;index&#125; 为占位参数</span></span><br><span class="line">            .apply(StrUtil.isNotBlank(endDate),</span><br><span class="line">                <span class="string">"date_format (optime,'%Y-%m-%d') &lt;= date_format(&#123;0&#125;,'%Y-%m-%d')"</span>, endDate)</span><br><span class="line">            .select(TemplateItem::getTemplateId, TemplateItem::getTemplateName) <span class="comment">// 仅获取部分字段</span></span><br><span class="line">            <span class="comment">// .select(TemplateItem.class, x -&gt; selectProps.contains(x.getProperty()))</span></span><br><span class="line">    );</span><br><span class="line">List&lt;Template&gt; list2 = templateItemMapper.selectByMap(map); <span class="comment">// 参数 map 中的字段即为数据库的字段(如：user_id)，且不能有非数据库字段</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ======== 基于 Service 进行访问</span></span><br><span class="line">List&lt;Subscribe&gt; subscribes = subscribeService.list(<span class="keyword">new</span> LambdaQueryWrapper&lt;Subscribe&gt;().eq(Subscribe::getFlowStatus, <span class="number">1</span>));</span><br><span class="line">subscribeService.listByMap(map); <span class="comment">// 参数 map 中的字段即为数据库的字段(如：user_id)，且不能有非数据库字段</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ======== 批量新增/更新/删除</span></span><br><span class="line"><span class="comment">// 假设提交3条数据，如果第二条报错了，此时第1条已经记录到缓存中。如果之后不回滚则第1条会正常保存，第2、3条不会保存；如果再次提交第1条，此时相当于保存了2次(如果主键不是自动生成的则可能报错唯一冲突，但是第一次任然正常提交)</span></span><br><span class="line">subscribeService.saveBatch(List&lt;Subscribe&gt;);</span><br><span class="line">subscribeService.updateBatchById(List&lt;Subscribe&gt;);</span><br><span class="line">subscribeService.removeByIds(List&lt;Subscribe&gt;);</span><br><span class="line">subscribeService.saveOrUpdateBatch(List&lt;Subscribe&gt;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ========= and/or</span></span><br><span class="line"><span class="comment">// select * from user where name = ? and ( pwd= ? or phone = ?)</span></span><br><span class="line">QueryWrapper&lt;User&gt; userWrapper = <span class="keyword">new</span> QueryWrapper&lt;User&gt;() <span class="comment">// 必须加上&lt;&gt;泛型标识才能链式调用</span></span><br><span class="line">    .eq(<span class="string">"name"</span>, name)</span><br><span class="line">    .and(wrapper -&gt; wrapper.eq(<span class="string">"pwd"</span>, pwd).or().eq(<span class="string">"phone"</span>, phone));</span><br><span class="line"></span><br><span class="line">List&lt;User&gt; userList = userService.list(<span class="keyword">new</span> LambdaQueryWrapper&lt;User&gt;()</span><br><span class="line">    .eq(User::getSex, <span class="number">1</span>)</span><br><span class="line">    .and(wrapper -&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> wrapper.in(User::getHobby, MiscU.toList(<span class="string">'games'</span>, <span class="string">'book'</span>)).or().eq(ShipBill::getAge, <span class="number">18</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    .select(User::getUsername));</span><br></pre></td></tr></table></figure><h4 id="分页"><a href="#分页" class="headerlink" title="分页"></a>分页</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.启用分页插件</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> PaginationInterceptor <span class="title">paginationInterceptor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    PaginationInterceptor paginationInterceptor = <span class="keyword">new</span> PaginationInterceptor();</span><br><span class="line">    <span class="comment">// paginationInterceptor.setLimit(500); // 最大单页限制数量，默认 500 条，小于 0 如 -1 不受限制</span></span><br><span class="line">    <span class="keyword">return</span> paginationInterceptor;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.Controller </span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/findList"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Result <span class="title">findList</span><span class="params">(@RequestBody Map&lt;String, Object&gt; map)</span> </span>&#123;</span><br><span class="line">    Page&lt;Map&gt; page = <span class="keyword">new</span> Page(</span><br><span class="line">            Long.valueOf(ValidU.isEmpty(map.get(<span class="string">"current"</span>)) ? <span class="string">"1"</span> : map.get(<span class="string">"current"</span>).toString()),</span><br><span class="line">            Long.valueOf(ValidU.isEmpty(map.get(<span class="string">"size"</span>)) ? <span class="string">"20"</span> : map.get(<span class="string">"size"</span>).toString()));</span><br><span class="line">    IPage&lt;Users&gt; users = userMapper.findList(page, map);</span><br><span class="line">    <span class="keyword">return</span> Result.success(users);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 2.1 基于Service Lambda查询进行分页</span></span><br><span class="line">Page&lt;Subscribe&gt; subscribePage = <span class="keyword">new</span> Page&lt;&gt;(<span class="number">0</span>, <span class="number">100</span>);</span><br><span class="line">LambdaQueryWrapper lambdaQueryWrapper = <span class="keyword">new</span> LambdaQueryWrapper&lt;Subscribe&gt;()</span><br><span class="line">		.eq(Subscribe::getFlowStatus, flowStatus)</span><br><span class="line">		.eq(Subscribe::getValidStatus, <span class="number">1</span>)</span><br><span class="line">		.and(date != <span class="keyword">null</span>, obj -&gt; obj.gt(Subscribe::getUpdateTm, date)) <span class="comment">// **基于某个条件判断是否添加查询此查询条件**</span></span><br><span class="line">		.orderByAsc(date != <span class="keyword">null</span>, Subscribe::getClawCount)</span><br><span class="line">        .orderBy(<span class="keyword">true</span>, <span class="keyword">false</span>, Subscribe::getClawCount, Subscribe::getClawDate) <span class="comment">// orderBy(true, true, "id", "age"); // 是否组装条件，是否升序，对应字段...</span></span><br><span class="line">        .last(<span class="string">"limit 10"</span>); <span class="comment">// 基于某个条件添加排序</span></span><br><span class="line">subscribePage = (Page&lt;Subscribe&gt;) subscribeService.page(subscribePage, lambdaQueryWrapper);</span><br><span class="line">List&lt;Subscribe&gt; subscribes =  subscribePage.getRecords();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.Mapper</span></span><br><span class="line"><span class="function">IPage&lt;Users&gt; <span class="title">findList</span><span class="params">(Page&lt;?&gt; page, @Param(<span class="string">"ctx"</span>)</span> Map&lt;String, Object&gt; context)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4.XML</span></span><br><span class="line">&lt;select id=<span class="string">"findList"</span> resultType=<span class="string">"cn.aezo.demo.entity.Users"</span>&gt;</span><br><span class="line">    select username </span><br><span class="line">    from t_users u </span><br><span class="line">    where u.valid_status = <span class="number">1</span></span><br><span class="line">    &lt;<span class="keyword">if</span> test=<span class="string">'ctx.username != null and ctx.username != ""'</span>&gt;</span><br><span class="line">        and u.username = #&#123;ctx.username&#125;</span><br><span class="line">    &lt;/if&gt;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure><ul><li>取前100条</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// mysql</span></span><br><span class="line"><span class="keyword">new</span> LambdaQueryWrapper&lt;Subscribe&gt;()</span><br><span class="line">.eq(Subscribe::getFlowStatus, flowStatus)</span><br><span class="line">.last(<span class="string">"limit 100"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// oracle</span></span><br><span class="line"><span class="keyword">new</span> LambdaQueryWrapper&lt;Subscribe&gt;()</span><br><span class="line">.eq(Subscribe::getFlowStatus, flowStatus)</span><br><span class="line">.apply(<span class="string">"rownum &lt; &#123;0&#125;"</span>, <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// sqlserver手动写sql</span></span><br></pre></td></tr></table></figure><h4 id="Oracle序列"><a href="#Oracle序列" class="headerlink" title="Oracle序列"></a>Oracle序列</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Entity增加注解</span></span><br><span class="line"><span class="meta">@KeySequence</span>(value = <span class="string">"SEQ_ORACLE_LONG_KEY"</span>, clazz = Long.class) <span class="comment">// 默认是Long类型</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">YourEntity</span> </span>&#123;</span><br><span class="line">    <span class="meta">@TableId</span>(value = <span class="string">"ID_LONG"</span>, type = IdType.INPUT) <span class="comment">// 如果使用序列必须是 IdType.INPUT</span></span><br><span class="line">    <span class="keyword">private</span> Long idLong;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@KeySequence</span>(value = <span class="string">"SEQ_ORACLE_STRING_KEY"</span>, clazz = String.class)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">YourEntity</span> </span>&#123;</span><br><span class="line">    <span class="meta">@TableId</span>(value = <span class="string">"ID_STR"</span>, type = IdType.INPUT)</span><br><span class="line">    <span class="keyword">private</span> String idStr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注入生成器</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> OracleKeyGenerator <span class="title">oracleKeyGenerator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> OracleKeyGenerator();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="NULL空值处理"><a href="#NULL空值处理" class="headerlink" title="NULL空值处理"></a>NULL空值处理</h4><ul><li>mybatis-plus默认策略为<code>NOT_NULL</code>：在执行updateById(user)，如果user对象的属性为NULL，则不会更新(空字符串会更新)；也可以修改策略</li><li>如果需要进行NULL更新，则可通过设置字段策略或者通过UpdateWrapper进行（推荐）</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// https://baomidou.com/guide/faq.html#%E6%8F%92%E5%85%A5%E6%88%96%E6%9B%B4%E6%96%B0%E7%9A%84%E5%AD%97%E6%AE%B5%E6%9C%89-%E7%A9%BA%E5%AD%97%E7%AC%A6%E4%B8%B2-%E6%88%96%E8%80%85-null</span></span><br><span class="line">mapper.update(</span><br><span class="line">   <span class="keyword">new</span> User().setName(<span class="string">"mp"</span>).setAge(<span class="number">3</span>),</span><br><span class="line">   Wrappers.&lt;User&gt;lambdaUpdate()</span><br><span class="line">           .set(User::getEmail, <span class="keyword">null</span>) <span class="comment">//把email设置成null</span></span><br><span class="line">           .eq(User::getId, <span class="number">2</span>)</span><br><span class="line">);</span><br><span class="line"><span class="comment">//也可以参考下面这种写法</span></span><br><span class="line">mapper.update(</span><br><span class="line">    <span class="keyword">null</span>,</span><br><span class="line">    Wrappers.&lt;User&gt;lambdaUpdate()</span><br><span class="line">       .set(User::getAge, <span class="number">3</span>)</span><br><span class="line">       .set(User::getName, <span class="string">"mp"</span>)</span><br><span class="line">       .set(User::getEmail, <span class="keyword">null</span>) <span class="comment">//把email设置成null</span></span><br><span class="line">       .eq(User::getId, <span class="number">2</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h4 id="乐观锁插件"><a href="#乐观锁插件" class="headerlink" title="乐观锁插件"></a>乐观锁插件</h4><ul><li><a href="https://mybatis.plus/guide/optimistic-locker-plugin.html" target="_blank" rel="noopener">https://mybatis.plus/guide/optimistic-locker-plugin.html</a></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.启用乐观锁插件</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> OptimisticLockerInterceptor <span class="title">optimisticLockerInterceptor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="comment">// com.baomidou.mybatisplus.extension.plugins.OptimisticLockerInterceptor</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> OptimisticLockerInterceptor();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.注解实体</span></span><br><span class="line"><span class="meta">@Version</span></span><br><span class="line"><span class="keyword">private</span> Integer version;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.修改。仅支持 updateById(id) 与 update(entity, wrapper) 方法；在 update(entity, wrapper) 方法下, wrapper 不能复用</span></span><br><span class="line">User user = userMapper.selectById(<span class="number">1</span>);</span><br><span class="line">user.setAge(<span class="number">18</span>);</span><br><span class="line"><span class="keyword">int</span> res = userMapper.updateById(user); <span class="comment">// 1成功。生成的sql类似: update t_user set age = 18,version = 2 where id = 1 and version = 1</span></span><br></pre></td></tr></table></figure><h4 id="代码生成"><a href="#代码生成" class="headerlink" title="代码生成"></a>代码生成</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">GlobalConfig gc = <span class="keyword">new</span> GlobalConfig();</span><br><span class="line">gc.setIdType(IdType.ASSIGN_ID); <span class="comment">// ID使用字符串序列</span></span><br><span class="line">gc.setDateType(DateType.SQL_PACK); <span class="comment">// 时间使用数据库类型对应，否则生成 LocalDateTime 等</span></span><br><span class="line"></span><br><span class="line">StrategyConfig strategy = <span class="keyword">new</span> StrategyConfig();</span><br><span class="line">strategy.setTablePrefix(<span class="string">"f_"</span>); <span class="comment">// 此处可以修改表前缀</span></span><br><span class="line">strategy.setColumnNaming(NamingStrategy.underline_to_camel); <span class="comment">// 表名生成策略</span></span><br><span class="line">strategy.setEntityLombokModel(<span class="keyword">true</span>);</span><br><span class="line">strategy.setRestControllerStyle(<span class="keyword">true</span>);</span><br><span class="line">strategy.setControllerMappingHyphenStyle(<span class="keyword">true</span>);</span><br><span class="line">strategy.setVersionFieldName(<span class="string">"version"</span>); <span class="comment">// 设置乐观锁字段(表中无此字段则不会生成对应注解)</span></span><br><span class="line">strategy.setLogicDeleteFieldName(<span class="string">"valid_status"</span>); <span class="comment">// 生成逻辑删除(可配置成逻辑删除或逻辑有效)</span></span><br><span class="line">strategy.setInclude(tableNameArr); <span class="comment">// 需要生成的表名</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 逻辑删除需要注入</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> LogicSqlInjector <span class="title">logicSqlInjector</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> LogicSqlInjector();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h4><ul><li><p>entity继承注意项</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Foo</span> <span class="title">extend</span> <span class="title">Bar</span> </span>&#123;&#125;</span><br><span class="line"><span class="comment">// 当执行下列语句时，生成的sql会包含 Bar 的字段；因此Bar中的字段必须是foo表中的字段，否则执行报错</span></span><br><span class="line">fooMappler.selectOne(id);</span><br></pre></td></tr></table></figure></li><li><p>数据库兼容</p><ul><li><a href="https://www.i4k.xyz/article/woyyazj/105111463" target="_blank" rel="noopener">https://www.i4k.xyz/article/woyyazj/105111463</a></li><li>自定义sql语句兼容: 基于 databaseId (mybatis功能): <a href="https://blog.csdn.net/zhaizhisheng/article/details/105834300" target="_blank" rel="noopener">https://blog.csdn.net/zhaizhisheng/article/details/105834300</a></li><li>主键如何兼容mysql和oracle生成策略: 参考上文<a href="#主键问题">主键问题</a><ul><li><strong>建议主键为字符串雪花ID</strong></li></ul></li><li>字段为关键字的处理<ul><li>通过拦截器动态修改生成sql中字段名</li><li><strong>建议字段名不能为关键字</strong></li></ul></li><li>Mybatis-Plus整合多数据源: <a href="https://juejin.cn/post/7020066406012026893" target="_blank" rel="noopener">https://juejin.cn/post/7020066406012026893</a></li></ul></li><li>字段为mysql关键字处理<ul><li>如字段value在mysql中是关键字，不能直接使用，可在字段上加注解<code>@TableField(value = &quot;</code>value<code>&quot;)</code></li></ul></li></ul><hr><p>参考文章</p></div><div></div><div></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> smalle</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="http://blog.aezo.cn/2017/05/22/java/mybatis/" title="Mybatis">http://blog.aezo.cn/2017/05/22/java/mybatis/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！</li></ul></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/db/" rel="tag"># db</a> <a href="/tags/mybatis/" rel="tag"># mybatis</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2017/05/21/java/hibernate/" rel="next" title="Hibernate"><i class="fa fa-chevron-left"></i> Hibernate</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"> <a href="/2017/06/24/linux/vmware/" rel="prev" title="vmware">vmware<i class="fa fa-chevron-right"></i></a></div></div></footer></article><div class="post-spread"><div> <a target="_blank" href="https://github.com/oldinaction/ChatGPT-MP"><img class="nofancybox" style="width:300px;margin:0 auto" src="https://cdn7.aezo.cn/one/chat/chat-gpt-open-banner.jpg" alt="ChatGPT开源小程序" title="ChatGPT开源小程序"></a></div></div></div></div><div class="comments" id="comments"></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap"> 文章目录</li><li class="sidebar-nav-overview" data-target="site-overview"> 站点概览</li></ul><section class="site-overview sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" src="https://avatars0.githubusercontent.com/u/15698218?v=3&u=ce740bf0b67ff0d74990ba6fc644d6e92f572dcb&s=400" alt="smalle"><p class="site-author-name" itemprop="name">smalle</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">162</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/index.html"><span class="site-state-item-count">14</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/index.html"><span class="site-state-item-count">149</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"></div><div> 欢迎关注公众号：阿壹族 <img class="nofancybox" style="width:120px;margin:0 auto" src="https://cdn7.aezo.cn/common/qrcode/ayz_qrcode.jpg" alt="欢迎关注公众号：阿壹族" title="欢迎关注公众号：阿壹族"></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#简介"><span class="nav-number">1.</span> <span class="nav-text">简介</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#简单使用"><span class="nav-number">1.1.</span> <span class="nav-text">简单使用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#整合mybatis-SpringBoot"><span class="nav-number">2.</span> <span class="nav-text">整合mybatis(SpringBoot)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#annotation版本-适合简单业务"><span class="nav-number">3.</span> <span class="nav-text">annotation版本(适合简单业务)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#xml版本-适合复杂操作"><span class="nav-number">4.</span> <span class="nav-text">xml版本(适合复杂操作)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#mybatis常见问题"><span class="nav-number">5.</span> <span class="nav-text">mybatis常见问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#主键问题"><span class="nav-number">6.</span> <span class="nav-text">主键问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#批量执行语句"><span class="nav-number">7.</span> <span class="nav-text">批量执行语句</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Mybatis缓存"><span class="nav-number">8.</span> <span class="nav-text">Mybatis缓存</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#基于databaseId实现数据库兼容"><span class="nav-number">9.</span> <span class="nav-text">基于databaseId实现数据库兼容</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#拦截器-插件"><span class="nav-number">10.</span> <span class="nav-text">拦截器(插件)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数据类型对应关系"><span class="nav-number">11.</span> <span class="nav-text">数据类型对应关系</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MyBatis-Generator"><span class="nav-number">12.</span> <span class="nav-text">MyBatis Generator</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#源码解析"><span class="nav-number">12.1.</span> <span class="nav-text">源码解析</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#mybatis-plus"><span class="nav-number">13.</span> <span class="nav-text">mybatis-plus</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#springboot依赖及配置"><span class="nav-number">13.0.1.</span> <span class="nav-text">springboot依赖及配置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#使用"><span class="nav-number">13.0.2.</span> <span class="nav-text">使用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#分页"><span class="nav-number">13.0.3.</span> <span class="nav-text">分页</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Oracle序列"><span class="nav-number">13.0.4.</span> <span class="nav-text">Oracle序列</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#NULL空值处理"><span class="nav-number">13.0.5.</span> <span class="nav-text">NULL空值处理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#乐观锁插件"><span class="nav-number">13.0.6.</span> <span class="nav-text">乐观锁插件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#代码生成"><span class="nav-number">13.0.7.</span> <span class="nav-text">代码生成</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#常见问题"><span class="nav-number">13.0.8.</span> <span class="nav-text">常见问题</span></a></li></ol></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2016 - <span itemprop="copyrightYear">2024</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">smalle</span>&nbsp;&nbsp;&nbsp;&nbsp;<div class="powered-by"> 由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div><div class="powered-by"> 主题 - <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a></div><div class="theme-info"> <a class="theme-link" target="_blank" href="https://tongji.baidu.com/main/overview/10000542408/overview/index?siteId=18991897">站长统计</a></div></div><div class="ad"> <span style="font-weight:700">AD&nbsp;&nbsp;&nbsp;&nbsp;</span><div class="theme-info"> <a target="_blank" href="https://promotion.aliyun.com/ntms/yunparter/invite.html?userCode=oby5nolb">阿里云大礼包</a></div></div><div class="aezocn"> <span style="font-weight:700">&copy;AEZO.CN&nbsp;&nbsp;&nbsp;&nbsp;</span><div class="powered-by"> <a target="_blank" href="https://shengqitech.aezo.cn/">圣骑科技</a></div><div class="powered-by"> <a target="_blank" href="https://cdn7.aezo.cn/common/qrcode/one_qrcode.jpg">【One能抽屉】小程序</a></div><div class="theme-info"> <a target="_blank" href="http://shop.aezo.cn/">杂货铺(省钱小助手)</a></div></div><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?085f9cd91ef2ad985f791c677472f0d1";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script><script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script type="text/javascript" src="/js/src/js.cookie.js?v=5.1.1"></script><script type="text/javascript" src="/js/src/scroll-cookie.js?v=5.1.1"></script></body></html>