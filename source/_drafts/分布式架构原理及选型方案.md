---
layout: "post"
title: "分布式架构原理及选型方案"
date: "2019-09-03 14:22"
categories: [arch]
tags: [mq]
---

## MQ

- MQ优缺点
  - 优点：解耦、异步、削峰
  - 缺点：系统可用性降低、存在一致性问题、系统复杂度提高
- ActiveMQ、RabbitMQ、RocketMQ、Kafka对比

    ![mq](/data/images/arch/mq.png)
- 消息丢失问题（如网络波动导致）：如果消息未被确认，或确认失败，可以使用定时任务来进行消息重试
- 保证消息不被重复消费（消息"丢失"带来的消息重复）：让每个消息携带一个全局的唯一ID（如UUID），并增加消息消费状态字段，即可保证消息的幂等性
- 消息堆积的问题
  - 定时删除旧的没有使用过的消息信息（重要性不高的消息）
  - 对某些重要的 TAG 型（支付型）消息进行落库
- 保证消息消费的顺序性
  - RabbitMQ：一个 queue，多个 consumer就可能导致消息乱序消费。因此可拆分多个 queue，每个 queue 一个 consumer

## 分布式事务

- https://www.cnblogs.com/bluemiaomiao/p/11216380.html





