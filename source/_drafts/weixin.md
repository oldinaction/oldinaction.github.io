---
layout: "post"
title: "微信开发"
date: "2017-10-10 21:34"
categories: [web]
tags: [H5, App]
---

## 简介

- 此处微信开发包含微信公众号开发，公众号H5开发，微信小程序开发，微信支付等
- [微信网页开发](https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/JS-SDK.html)
    - 通过微信浏览器打开网页时的场景。此时可调用JS-SDK获取一些硬件能力
    - 通过使用微信JS-SDK，网页开发者可借助微信高效地使用拍照、选图、语音、位置等手机系统的能力，同时可以直接使用微信分享、扫一扫、卡券、支付等微信特有的能力，为微信用户提供更优质的网页体验


## 微信小程序限制

### 认证/审核/权限

- 小程序可直接复用同一主体的公众号认证(无需额外费用)
- 管理员可设置运营者/开发者；运营者可直接发布审核后的版本；开发者可添加体验人员(50人)，开发者可设置域名、发布体验版、提交审核版(但发布线上版则需管理审核)
- 审核
    - 发布小程序提交审核，不通过会通知发布人和管理员
    - 线上版本发布每次均需审核，官方称1-7天完成
        - 实际发现不涉及特殊业务时，快的时候1-2小时即可完成
        - 涉及如资质类如餐饮、红包等，一般2-7天
    - 审核人员工作时间
        - 周末也可提交审核
        - 小程序如若需要登录，需要提供正确的账号密码供审核人员使用
    - 加急机制
        - 最快2小时内完成
        - 加急时间段：企业是9:00-24:00，个人是9:00-21:00
        - 非个人主体一年3次机会，个人一年1次机会。如在审核前撤回申请，机会将不会被消耗
        - 选择了加急审核，但审核单被驳回了。开发者可以在12小时内重新整改并在驳回站内信内的【前往反馈页面】重新提交审核，即可获得相应加急的队列。否则将会直接浪费了一次加急机会

### 域名限制

- API地址：必须是https域名，且需在微信后台配置(可配置API、ws、文件上传下载、打开网页域名等)
    - 开发环境可在微信编辑器中设置成不校验此限制(可为ip地址)，体验版则需打开调试模式(在胶囊中设置)
- iframe(web-view)地址：必须https域名，且需要在微信后台配置业务域名。开发环境同上
- 图片地址：必须是https域名，且需要在微信后台配置业务域名。开发环境同上

### 其他

- 小程序背景图必须是base64格式或网络图片(http/https，无需绑定域名)，否则不显示(仅开发版显示)
- 开发版真机调试需手机wifi和API地址处于同一网络
- **web-view**组件(类似iframe，小程序本身是不能使用iframe标签的)，如出现"此网页由xxx提供"均为web-view
    - web-view 不支持推送服务通知(即模板消息)
        - 类似下单等页面需要发送通知则需改写成小程序页面
    - 打开的域名没有在小程序管理后台设置业务域名，打开的页面 302 过去的地址也必须设置过业务域名，web-view嵌入的页面可以包含 iframe，但是 iframe 的地址必须为业务域名。且都需要是https
    - 小程序内嵌 web-view 跟微信内置浏览器是一套环境，即Storage等共享
    - 可通过url传递参数进行用户验证
- **小程序不支持多环境编译**，对于API地址完全取决于上传到微信平台时代码中的地址(只能为一个，无法获取环境)。因此通过uni-app开发时，需要点击发行才会对应到生产环境API

## 微信H5开发

- 微信H5项目开发一般包含：微信浏览器访问(普通手机浏览器访问)，项目后台管理两块
- 基于目前流行框架一般会将后台服务和界面进行分离，数据以REST的形式传输。基于REST数据传输也可分为前后分离项目和非前后分离项目
- 如果为REST形式非前后分离项目则有三块：`/api`、`/admin`、`/myapp`，这是控制层的顶级路径(可理解为contextPath)，之后再分模块和功能等(方便做权限控制、路由等)

### 前台界面

- 获取的微信用户头像可缩放为`160*160.jpg`保存











---
